(function($,epi){epi.shell.error=function(){var sharedResourceKey="EPiServer.Shell.Resources.Texts";var pub={};pub.openErrorDialog=function(element,errorText){var errorDialog=$(".epi-errorOutputDialog",element);if(errorDialog.length===0){$(element).append("<div class='epi-errorOutputDialog'><iframe class='epi-errorOutputFrame'></iframe></div>");errorDialog=$(".epi-errorOutputDialog",element);}$(errorDialog).epiDialog({title:"Error",width:600,height:Math.min($(window).height(),600),resizable:true,buttons:{"Close":function(){$(this).epiDialog("close");errorDialog.remove();}}});$(errorDialog).epiDialog("open");var document=$(".epi-errorOutputFrame",errorDialog)[0].contentWindow.document;document.open();document.write(errorText);document.close();};pub.createErrorMessage=function(parentElement,errorTitle,errorText,status,includeMoreInformation){if(errorTitle){if(!errorText){includeMoreInformation=false;}if(includeMoreInformation){errorTitle=errorTitle+" <br/><a href='#' class='epi-openErrorDialogButton'>"+epi.shell.resource.get(sharedResourceKey,"ErrorMoreInformationText")+"</a>";}parentElement.html(errorTitle);$(".epi-openErrorDialogButton",parentElement).click(function(e){pub.openErrorDialog(parentElement,errorText);});}};pub.showDialogWithElementContent=function(errorContainer){pub.openErrorDialog(document.body,$(errorContainer).html());};return pub;}();}(epiJQuery,epi));(function($){$.widget("ui.epiContextMenu",{_init:function(){var self=this;var o=this.options;this.element.addClass(o.controlClass).hide();var lists=$("ul",this.element);$("a",lists).each(function(i,item){var firstSpan=$("span:first",item);if(firstSpan.length===0){firstSpan=$(item).wrapInner("<span></span>").children(":first");}firstSpan.addClass(o.itemNameClass);});if(lists.length>0){lists.eq(0).addClass(o.firstListClass);}this._hide=function(e){if(!self._isOpening){self.hide();}self._isOpening=false;};this.element.keydown(function(e){self._keyDownHandler(e);}).keypress(function(e){e.stopPropagation();});this._addClickHandlerToMenuItem($("a",this.element),o.preventDefaultMenuItemAction);if(o.clickSelector){$(o.clickSelector).click(function(e){self.show();e.preventDefault();});}if(o.contextMenuSelector){$(o.contextMenuSelector).bind("contextmenu",function(e){self.show();e.preventDefault();});}},_addClickHandlerToMenuItem:function(links,preventDefault){var self=this;links.bind("click",this,function(e){if(self.options.attachedTo!==null){self.options.attachedTo.focus();}self.hide();self.element.trigger("epimenuclick",this);if(preventDefault){e.preventDefault();}});},_isOpening:false,_setSelected:function(index){var links=$("a:not(ul>li>div a)",this.element);if(links.length>0){links.eq(this.selectedIndex).attr("tabindex",-1);this.selectedIndex=index;links.eq(index).attr("tabindex",0).focus();}},_keyDownHandler:function(e){var keyCode=e.which;if(epi.shell.isArrowKey(keyCode)&&!e.ctrlKey&&!e.shiftKey&&!e.altKey){var links=$("a:not(ul>li>div a):visible",this.element);var index=this.selectedIndex;if(keyCode===epi.shell.keyCode.arrowLeft||keyCode===epi.shell.keyCode.arrowUp){index=index===0?links.length-1:index-1;}else{if(keyCode===epi.shell.keyCode.arrowRight||keyCode===epi.shell.keyCode.arrowDown){index=index===links.length-1?0:index+1;}}this._setSelected(index);e.preventDefault();}else{if(keyCode===epi.shell.keyCode.tab&&!e.ctrlKey&&!e.altKey){if(this.options.attachedTo!==null){this.options.attachedTo.focus();}this.hide();}else{if(keyCode===epi.shell.keyCode.escape&&!e.ctrlKey&&!e.altKey){if(this.options.attachedTo!==null){if(this.options.attachedTo.is("a")){this.options.attachedTo.focus();}else{this.options.attachedTo.find("a:first").focus();}}this.hide();}}}},show:function(event){var o=this.options;var self=this;this._isOpening=true;this.previousSibling=this.element.prev();if(!this.previousSibling.length){this.parentElement=this.element.parent();}this.element.show();if(o.appendTo!==null){this.element.appendTo(o.appendTo);}else{this.element.appendTo($("body"));}if(o.attachedTo!==null){var offset=o.attachedTo.offset();var top=offset.top+o.attachedTo.height();var left=offset.left;if(o.alignedRight){left=left-this.element.outerWidth()+o.attachedTo.width();}else{var documentWidth=$(document.documentElement).width();var right=left+this.element.outerWidth();if(right>documentWidth){left=left-(right-documentWidth);}}if(left<0){left=0;}this.element.css("top",top).css("left",left);}if(o.autohide){epi.shell.events.bindFrameClickHandler(this._hide);}window.setTimeout(function(){self._setSelected(0);self._isOpening=false;},1);this._trigger("show");},hide:function(event){this.element.css("left","auto").css("top","auto").hide();if(this.parentElement){this.element.appendTo(this.parentElement);}else{if(this.previousSibling){this.element.insertAfter(this.previousSibling);}}epi.shell.events.unbindFrameClickHandler(this._hide);this._trigger("hide");},add:function(refName,url,label,title,isInsert,listIndex,itemIndex){var o=this.options;var lists=$("ul",this.element);if(!lists.length){lists=$("<ul></ul>").addClass(o.firstListClass).appendTo(this.element);listIndex=0;}else{if(typeof listIndex==="undefined"){listIndex=lists.length-1;}}if(isInsert){$("<ul/>").insertBefore(lists.eq(listIndex));}else{if(isInsert===false&&lists.eq(listIndex).children().length>0){$("<ul/>").insertAfter(lists.eq(listIndex));listIndex++;}}lists=$("ul",this.element);$("."+o.firstListClass,this.element).removeClass(o.firstListClass);lists.eq(0).addClass(o.firstListClass);var item=$(o.itemTemplate.replace(/#\{href\}/g,url).replace(/#\{label\}/g,label));if(title&&title.length&&title.length>0){item.attr("title",title);}var ul=lists.eq(listIndex);var items=$("li",ul);var itemsLength=items.length;if(typeof itemIndex==="undefined"||itemIndex>=itemsLength){item.appendTo(ul);}else{item.insertBefore(this.items[itemIndex]);}$("span",item).addClass(o.itemNameClass);this[refName]=$("a",item);this._addClickHandlerToMenuItem(this[refName],o.preventDefaultMenuItemAction);},getMenuItem:function(name){return this[name];}});$.extend($.ui.epiContextMenu,{version:"0.1",eventPrefix:"epimenu",getter:"getMenuItem",defaults:{autohide:true,controlClass:"epi-contextMenu",firstListClass:"first",itemNameClass:"epi-contextMenuItemName",itemTemplate:'<li><a href="#{href}"><span>#{label}</span></a></li>',attachedTo:null,alignedRight:false,clickSelector:null,contextMenuSelector:null,preventDefaultMenuItemAction:true,appendTo:null}});})(epiJQuery);(function($){epi.shell.registerInitFunction(function(){$(".epi-navigation-global:first").epiNavigation();});$.widget("ui.epiNavigation",{_init:function(){var self=this;this._keyPressHandler=function(e){var target=$(e.target);switch(e.which){case epi.shell.keyCode.space:if(self._isTopMenuItem(target)&&self._hasSubMenu(target)){self._openSubMenu(target);e.preventDefault();}else{target.bind("click",function(e){if(typeof this.onclick==="function"){this.onclick();}else{if(!e.isDefaultPrevented()&&(typeof(this.click)==="undefined")&&this.href.length!==0){window.location.href=this.href;}else{this.click();}}}).click();}break;}};this._keyDownHandler=function(e){var target=$(e.target);switch(e.which){case epi.shell.keyCode.escape:if(!self._isTopMenuItem(target)){self._closeSubMenu(target);}break;case epi.shell.keyCode.arrowUp:if(self._isTopMenuItem(target)){self._openSubMenu(target);e.preventDefault();}else{self._closeSubMenu(target);}break;case epi.shell.keyCode.arrowDown:if(self._isTopMenuItem(target)&&self._hasSubMenu(target)){self._openSubMenu(target);e.preventDefault();}else{if(self._isDropDownMenu(target)){self._openSubMenu(target);e.preventDefault();}else{self._siblingFocus(target,"next");e.preventDefault();}}break;case epi.shell.keyCode.arrowLeft:self._siblingFocus(target,"previous");break;case epi.shell.keyCode.arrowRight:self._siblingFocus(target,"next");break;}};this._clickHandler=function(e){var target=$(e.target);if(!target.is("a")){target=target.closest("a");}if(self._isMenuSection(target)){self._openSubMenu(target);e.preventDefault();}else{if(self._isDropDownMenu(target)){self._openDropDownMenu(target);e.preventDefault();}else{self.element.trigger("navigate");}}};this._moreMenuItemClickHandler=function(e){var target=$(e.target);if(!target.is("a")){target=target.closest("a");}if(self._isDropDownMenu(target)){$(".epi-navigation-more-items-wrapper",this._topMenuBar).epiContextMenu("show");}self._clickHandler.call(this,e);};this._makeNavigation();},_makeNavigation:function(){this._focusClassName="epi-navigation-focus";this._selectedClassName="epi-navigation-selected";this._topMenuBar=$(".epi-navigation-container1",this.element);this._subMenuBar=$(".epi-navigation-container2",this.element);this._isRTL=$("body",document).css("direction")==="rtl";$("a",this._topMenuBar).attr("tabindex",-1).attr("aria-pressed",false);$("li.epi-navigation-standard > ul",this._topMenuBar).appendTo(this._subMenuBar).hide();this._utilItemsContainer=$(".epi-navigation-container-utils",this.element);$("<ul></ul>").appendTo(this._utilItemsContainer);$("li.epi-navigation-util",this._topMenuBar).appendTo($("ul",this._utilItemsContainer));$("a",this._utilItemsContainer).attr("tabindex",0).attr("aria-pressed",false);var container=this.element;$("li.epi-navigation-dropdown>ul",container).each(function(i,item){item=$(item).wrap("<div></div>").parent();$(item).epiContextMenu({appendTo:container,attachedTo:$(item).parent(),preventDefaultMenuItemAction:false,alignedRight:true});});this._selectedTopItem=$("li."+this._selectedClassName+">a",this._topMenuBar);if(this._selectedTopItem.length>0){this._setTopMenuItemSelected(this._selectedTopItem);if(this._hasSubMenu(this._selectedTopItem)){this._openSubMenu(this._selectedTopItem);}}this._initMoreMenu();this.element.bind("keydown",this._keyDownHandler).bind("keypress",this._keyPressHandler).bind("click",this._clickHandler);this.element.bind("layoutchange",function(){$.event.trigger("/epi/shell/globalnavigation/layoutchange");});this.element.attr("role","menu");this._subMenuBar.attr("role","presentation");this._topMenuBar.attr("role","presentation");},_initMoreMenu:function(){var moreMenuTitle=$(".epi-navigation-global_more .epi-navigation-menuText",this._topMenuBar).text();var standardMenuItems=$("ul:first",this._topMenuBar).children().not($(".epi-navigation-global_more",this._topMenuBar).parent());var summaryTopMenuWidth=this._utilItemsContainer.width();var maxItemWidth=0;standardMenuItems.each(function(i,item){var itemWidth=$(item).width();summaryTopMenuWidth+=itemWidth;if(itemWidth>maxItemWidth){maxItemWidth=itemWidth;}});this._topMenuBar.data("moreMenuTitle",moreMenuTitle);this._topMenuBar.data("standardMenuItems",standardMenuItems);this._topMenuBar.data("summaryTopMenuWidth",summaryTopMenuWidth);this._topMenuBar.data("maxItemWidth",maxItemWidth);this._createMoreMenuItem();var self=this;self._isResizing=false;$(window).resize(function(e){if(self._isResizing){return;}self._isResizing=true;self._removeMoreMenuItem();self._createMoreMenuItem();setTimeout(function(){self._isResizing=false;},200);});},_createMoreMenuItem:function(){var standardMenuItems=this._topMenuBar.data("standardMenuItems");var summaryTopMenuWidth=this._topMenuBar.data("summaryTopMenuWidth");var maxItemWidth=this._topMenuBar.data("maxItemWidth");$(".epi-navigation-global_more",this._topMenuBar).parent().removeClass(this._selectedClassName);this._setMoreMenuTitle();var windowWidth=this._topMenuBar.width();if(summaryTopMenuWidth>windowWidth){this._moreMenuItem=$(".epi-navigation-global_more",this._topMenuBar).parent();var lastMenuItem=$("ul:first>li:last",this._topMenuBar);if(this._moreMenuItem[0]!=lastMenuItem[0]){lastMenuItem.after(this._moreMenuItem);}var moreMenuHref=$("a",this._moreMenuItem)[0].href;var moreMenuId=moreMenuHref.substring(moreMenuHref.lastIndexOf("#")+1,moreMenuHref.length);this._moreMenuSubmenu=$("<ul class='epi-navigation-more-items' id='"+moreMenuId+"'></ul>");var lastMenuItemIndex=standardMenuItems.length-1;summaryTopMenuWidth+=maxItemWidth;while(summaryTopMenuWidth>windowWidth){var item=standardMenuItems.eq(lastMenuItemIndex);lastMenuItemIndex--;summaryTopMenuWidth-=$(item).width();this._moreMenuSubmenu.prepend(item);if(item.hasClass(this._selectedClassName)){this._setMoreMenuTitle(item.text());this._selectedTopItem=this._selectedTopItem.add($(".epi-navigation-global_more",this._topMenuBar).parent());$(".epi-navigation-global_more",this._topMenuBar).parent().addClass(this._selectedClassName);}else{if($("a:first",item).hasClass(this._focusClassName)){this._setMoreMenuTitle(item.text());this._focusedItem=this._focusItem.add($(".epi-navigation-global_more",this._topMenuBar).parent());$(".epi-navigation-global_more",this._topMenuBar).parent().addClass(this._focusClassName);}}if(lastMenuItemIndex<0){break;}}this._moreMenuItem.show();this._moreMenuSubmenu=this._moreMenuSubmenu.wrap("<div class='epi-navigation-more-items-wrapper'></div>").parent();this._moreMenuItem.append(this._moreMenuSubmenu);this._moreMenuSubmenu.epiContextMenu({attachedTo:this._moreMenuItem,preventDefaultMenuItemAction:false,alignedRight:false,autohide:true});$("a",this._moreMenuSubmenu).bind("click",this._moreMenuItemClickHandler);}else{$(".epi-navigation-global_more",this._topMenuBar).parent().hide();}},_removeMoreMenuItem:function(){if(this._moreMenuSubmenu){this._moreMenuSubmenu.epiContextMenu("hide");}if($(".epi-navigation-more-items>li",this._topMenuBar).length>0){$(".epi-navigation-more-items>li>a",this._topMenuBar).unbind("click",this._moreMenuItemClickHandler);$(".epi-navigation-more-items>li>a>span",this._topMenuBar).removeClass("epi-contextMenuItemName");$(".epi-navigation-more-items>li",this._topMenuBar).insertBefore($(".epi-navigation-global_more").parent());$(".epi-navigation-global_more",this._topMenuBar).parent().find(".epi-navigation-more-items-wrapper").remove();}},_setMoreMenuTitle:function(text){if(text==undefined){text=this._topMenuBar.data("moreMenuTitle");}$(".epi-navigation-global_more .epi-navigation-menuText",this._topMenuBar).text(text);},_isTopMenuItem:function(menuItem){return menuItem.is("a:not(div.epi-navigation-container2 ul li a, div.epi-navigation-container1 div.epi-navigation-container-utils ul li a)");},_hasSubMenu:function(menuItem){var targetId=menuItem[0].href.substring(menuItem[0].href.lastIndexOf("#")+1,menuItem[0].href.length);return $("#"+targetId).length>0;},_isMenuSection:function(menuItem){return $(menuItem).closest("li").is(".epi-navigation-standard");},_isUtilMenu:function(menuItem){return $(menuItem).closest("li").is(".epi-navigation-util");},_isDropDownMenu:function(menuItem){return $(menuItem).closest("li").is(".epi-navigation-dropdown");},_isInsideMoreMenu:function(menuItem){return $(menuItem).parents(".epi-navigation-more-items-wrapper").length>0;},_setFocusedItem:function(menuItem){if(this._focusItem){this._focusItem.attr("tabindex",-1).removeClass(this._focusClassName);}if(this._selectedTopItem){this._selectedTopItem.attr("tabindex",-1);}this._focusItem=menuItem;if(this._isInsideMoreMenu(menuItem)){this._focusItem=this._focusItem.add($(".epi-navigation-global_more"));this._setMoreMenuTitle(menuItem.text());}else{this._setMoreMenuTitle();}this._focusItem.attr("tabindex",0).addClass(this._focusClassName);},_setTopMenuItemSelected:function(menuItem){if(this._selectedTopItem){this._selectedTopItem.attr("tabindex",-1).attr("aria-pressed",false).removeClass(this._selectedClassName);}this._selectedTopItem=menuItem;if(this._isInsideMoreMenu(menuItem)){this._selectedTopItem=this._selectedTopItem.add($(".epi-navigation-global_more").parent());this._setMoreMenuTitle(menuItem.text());}else{this._setMoreMenuTitle();}this._selectedTopItem.attr("tabindex",0).attr("aria-pressed",true).addClass(this._selectedClassName).focus();},_openSubMenu:function(menuItem){var self=this;if(self._isDropDownMenu(menuItem)){self._openDropDownMenu(menuItem);return;}var targetId=menuItem[0].href.substring(menuItem[0].href.lastIndexOf("#")+1,menuItem[0].href.length);var visibleChild=$("ul:visible",this._subMenuBar);if((visibleChild.length>0&&visibleChild[0].id!==targetId)||visibleChild.length==0){this._subMenuBar.children().hide();visibleChild=$("#"+targetId).show();var moreMenu=menuItem.closest("ul.epi-navigation-more-items");if(moreMenu.length>0){visibleChild.data("parentMenuItem",$("a:first",this._moreMenuItem));}else{visibleChild.data("parentMenuItem",menuItem);}$(this.element).trigger("layoutchange");}this._setFocusedItem(menuItem);visibleChild.find("li:not(.epi-navigation-util):first a").focus();},_openDropDownMenu:function(menuItem){var self=this;$(menuItem).siblings("div").epiContextMenu("show");},_closeSubMenu:function(menuItem){if(this._isTopMenuItem(menuItem)&&this._hasSubMenu(menuItem)){this._subMenuBar.children().hide();$(this.element).trigger("layoutchange");}else{var parent=menuItem.closest("ul").data("parentMenuItem");if(parent&&parent.length>0){parent.focus();}}},_siblingFocus:function(menuItem,direction){var siblingListElement;if(this._isUtilMenu(menuItem)){return;}if(this._isRTL){if(direction==="next"){direction="previous";}else{direction="next";}}if(direction==="next"){siblingListElement=menuItem.closest("li:visible").next(":visible");}else{siblingListElement=menuItem.closest("li:visible").prev(":visible");}if(siblingListElement.length===0){if(direction==="next"){siblingListElement=menuItem.closest("li:visible").siblings("li:visible:first");}else{siblingListElement=menuItem.closest("li:visible").siblings("li:visible:last");}}var siblingMenuItem=$("a:first",siblingListElement);if(this._isTopMenuItem(siblingMenuItem)&&!this._hasSubMenu(siblingMenuItem)){this._setFocusedItem(siblingMenuItem);this._closeSubMenu(menuItem);}if(this._isMenuSection(siblingMenuItem)&&this._hasSubMenu(siblingMenuItem)){this._openSubMenu(siblingMenuItem);}siblingMenuItem.focus();}});$.extend($.ui.epiNavigation,{version:"0.1",defaults:{className:"epi-globalNavigation"}});})(epiJQuery);(function($){$.widget("ui.epiItemList",{_init:function(){var self=this;var options=this.options;var list=(this.list=this.element).attr("role","select").addClass(options.listClass);var item,contentDiv,toolbar,content;this._listItems=[];this._selectedIndex=-1;list.children().each(function(i){$(this).addClass(options.listItemClass);content=$(this).html();$(this).html("");item=self._createListItem().addClass(options.listItemContentClass);if(i===0){item.attr("tabindex","0");}toolbar=$("<div/>").epiToolbar({buttons:options.buttons});item.append(content).append(toolbar);$(this).append(item);self._listItems[self._listItems.length]=item;});if(options.paging){this._createPager(options.pages,options.currentPage);}},addItem:function(content){var self=this;var options=this.options;var isFirst=(this.list.children().length===0);var toolbar=$("<div/>").epiToolbar({buttons:options.buttons});var item=this._createListItem().append(content).append(toolbar);var listItem=$("<li/>").addClass(options.listItemClass).append(item);this._listItems[this._listItems.length]=item;this.list.append(listItem);return this;},changePagerDisplay:function(page,keepFocus){if(this.pager){this.pager.epiPager("goToPage",page,keepFocus);}},clear:function(){this._selectedIndex=-1;this.list.children().each(function(i){$(this).remove();});this._listItems.splice(0,this._listItems.length);return this;},getSelectedListItem:function(){return this._listItems[this.getSelectedIndex()];},getSelectedIndex:function(){return this._selectedIndex;},getListItem:function(index){return this._listItems[index];},getAllListItems:function(){return this._listItems;},setNumberOfPages:function(pages){var self=this;if(pages<2){this.pager.remove();this.pager=null;return this;}if(typeof this.pager==="undefined"||this.pager===null){this._createPager(pages,this.options.currentPage);}else{this.pager.epiPager("changeNumberOfPages",pages);}},setSelectedIndex:function(index){var options=this.options;if(index<this._listItems.length&&index>-1){this._focusedElement=this.getListItem(index);this._triggerSelect();}else{if(index===-1){var _isPreviouslySelected=((typeof this._selectedIndex!=="undefined")&&(this._selectedIndex>-1));if(_isPreviouslySelected){this.getSelectedListItem().removeClass(options.listItemSelectedClass).addClass(options.listItemContentClass);this.getSelectedListItem().removeAttr("aria-selected");$("."+options.listItemButtonSelectedClass,this.getSelectedListItem()).removeClass(options.listItemButtonSelectedClass).addClass(options.listItemButtonClass);}this._selectedIndex=-1;}}return this;},_createPager:function(pages,currentpage){var self=this;(this.pager=$("<div/>")).epiPager({pages:pages,currentPage:currentpage}).insertAfter(this.list).bind("epipagerpagechanged",function(e,data){self._pagerPageChanged(e,data);});},_pagerPageChanged:function(e,data){this._trigger("pagechanged",null,data);},_createListItem:function(){var self=this;var options=this.options;var item=$("<div/>").addClass(options.listItemContentClass).attr("role","option").mouseenter(function(e){$(this).addClass(options.listItemContentHoverClass);}).mouseleave(function(e){$(this).removeClass(options.listItemContentHoverClass);}).keydown(function(e){self._onKeyDown(e);}).keypress(function(e){self._onKeyPress(e);}).focus(function(){self._focusedElement=$(this);}).click(function(){self._focusedElement=$(this);self._triggerSelect();});return item;},_triggerSelect:function(){this._updateSelectGraphics();this._trigger("select",null,this._focusedElement);},_triggerPageChanged:function(data){this._trigger("pagechanged",null,data);},_updateSelectGraphics:function(){var options=this.options;var isPreviouslySelected=((typeof this._selectedIndex!=="undefined")&&(this._selectedIndex>-1));if(isPreviouslySelected){this.getSelectedListItem().removeClass(options.listItemSelectedClass).addClass(options.listItemContentClass);this.getSelectedListItem().removeAttr("aria-selected");this.getSelectedListItem().attr("tabindex","-1");}if(options.listItemButtonSelectedClass!==""&&options.listItemButtonClass!==""){if(isPreviouslySelected){$("."+options.listItemButtonSelectedClass,this.getSelectedListItem()).removeClass(options.listItemButtonSelectedClass).addClass(options.listItemButtonClass);}$("."+options.listItemButtonClass,this._focusedElement).removeClass(options.listItemButtonClass).addClass(options.listItemButtonSelectedClass);}this._selectedIndex=this._getIndexForObject(this._focusedElement);this._focusedElement.removeClass(options.listItemContentClass).addClass(options.listItemSelectedClass);this._focusedElement.attr("aria-selected",true);this._focusedElement.attr("tabindex",0);},_getIndexForObject:function(object){var listItem=object.parent();return listItem.prevAll().length;},_getSiblingItem:function(direction){var listItem=this._focusedElement.parent();var siblingItem;if(direction===-1){siblingItem=listItem.prev();}else{if(direction===1){siblingItem=listItem.next();}else{return this._focusedElement;}}var siblingLink=siblingItem.children().eq(0);if(siblingLink&&siblingLink.is(":visible")){return siblingLink;}else{return this._focusedElement;}},_onKeyDown:function(e){if(epi.shell.isArrowKey(e.which)&&!e.ctrlKey&&!e.altKey&&!e.shiftKey){if(epi.shell.keyCode.arrowRight===e.which||epi.shell.keyCode.arrowDown===e.which){this._moveFocus(1);}else{if(epi.shell.keyCode.arrowLeft===e.which||epi.shell.keyCode.arrowUp===e.which){this._moveFocus(-1);}}}},_onKeyPress:function(e){if((e.which===epi.shell.keyCode.enter||e.which===epi.shell.keyCode.space)&&!e.ctrlKey&&!e.altKey&&!e.shiftKey){this._triggerSelect();e.preventDefault();}},_moveFocus:function(direction){this._focusedElement.attr("tabindex","-1");var elem=this._getSiblingItem(direction);$(elem).attr("tabindex","0");elem.focus();}});$.extend($.ui.epiItemList,{version:"0.1",eventPrefix:"epiitemlist",getter:"getSelectedListItem getSelectedIndex getListItem getAllListItems",setter:"setSelectedIndex setNumberOfPages",defaults:{listClass:"epi-itemList",listItemClass:"epi-itemList-wrapper",listItemContentClass:"epi-itemList-content",listItemContentHoverClass:"epi-itemList-hover",listItemSelectedClass:"epi-itemList-content",listItemButtonClass:"epi-iconToolbar-add",listItemButtonSelectedClass:"",paging:false,pages:1,currentPage:1,buttons:{}}});})(epiJQuery);(function($){$.widget("ui.epiFoldOutPanel",{_init:function(){var self=this;var options=this.options;var panel=(this._panel=this.element).hide().addClass(options.panelClass).wrapInner("<div><div></div></div>");var panelBody=(this._panelBody=panel.children().eq(0)).addClass(options.panelBodyClass);var innerContent=(this._innerContent=panelBody.children().eq(0)).show().attr("aria-hidden","true").attr("role","group").addClass(options.panelContentClass);$("<a/>").addClass(options.panelSplitterClass).attr("href","#").attr("title",options.collapseButtonDescription).html("<span>"+options.collapseButtonText+"</span>").click(function(e){self.collapse(e);return false;}).appendTo(panel);var panelHeader=(this.panelHeader=$("<div/>")).addClass(options.panelHeaderClass).append("<h3>"+options.panelHeaderText+"</h3>").prependTo(panel);if(options.showClosebutton){$.extend(options.buttons,{closeButton:{text:options.collapseButtonText,description:options.collapseButtonDescription,buttonClass:options.panelCloseButtonClass,click:function(e){self.collapse(e);return false;},clickable:true,tabIndex:0}});}$("<div/>").epiToolbar({buttons:options.buttons,controlsClass:options.panelControlsClass}).appendTo(panelHeader);(options.autoOpen&&this.expand());},expand:function(e){if(!this._trigger("beforeexpand",null)){return;}var effectOptions={};this._panelBody.hide();this._panel.show();var self=this;var callback=function(){self._trigger("expand",null);};this._innerContent.attr("aria-hidden","false");this._panelBody.show("blind",effectOptions,120,callback);},collapse:function(e){if(!this._trigger("beforecollapse",null)){return;}var effectOptions={};var self=this;var callback=function(){self._panel.hide();self._panelBody.show();self._innerContent.attr("aria-hidden","true");self._trigger("collapse",null);};this._panelBody.hide("blind",effectOptions,120,callback);}});$.extend($.ui.epiFoldOutPanel,{version:"0.1",eventPrefix:"epifoldoutpanel",defaults:{panelClass:"epi-foldOutPanel",panelBodyClass:"epi-foldOutPanel-body",panelHeaderClass:"epi-foldOutPanel-header",panelSplitterClass:"epi-foldOutPanel-splitter",panelControlsClass:"epi-foldOutPanel-controls",panelContentClass:"epi-foldOutPanel-content",panelCloseButtonClass:"epi-iconToolbar-close",panelHeaderText:"",autoOpen:false,showClosebutton:true,collapseButtonText:"Collapse",collapseButtonDescription:"Hide this panel.",buttons:{}}});})(epiJQuery);(function($){$.widget("ui.epiPager",{_init:function(){var self=this;var options=this.options;this._pages=options.pages;var pagerContainer=(this.pagerContainer=this.element).addClass(options.pagerContainerClass);this._listId=epi.shell.generateId("Pager");var pagerList=(this.pagerList=$("<ul></ul>")).addClass(options.pagerListClass).attr("id",this._listId).attr("role","navigation").keydown(function(e){self._onKeyDown(e);}).appendTo(pagerContainer);this._addPrevButtons();for(i=1;i<=this._pages;i=i+1){this._addPage((options.currentPage===i),i);}this._addNextButtons();this._updateButtonVisibility();},_addPrevButtons:function(){var self=this;var options=this.options;var firstButton=(this.firstButton=this._addPage(false,"&laquo;",function(){self.goToPage(1,$(this));return false;}));var previousButton=(this.previousButton=this._addPage(false,"&lsaquo;",function(){self.goToPage(options.currentPage-1,$(this));return false;}));},_addNextButtons:function(){var self=this;var options=this.options;var nextButton=(this.nextButton=this._addPage(false,"&rsaquo;",function(){self.goToPage(options.currentPage+1,$(this));return false;}));var lastButton=(this.lastButton=this._addPage(false,"&raquo;",function(){self.goToPage(self._pages,$(this));return false;}));},_addPage:function(selected,text,clickMethod,insertAfterTarget){var options=this.options;var self=this;var pagerItem=(this.pagerItem=$("<li></li>")).addClass(options.pagerItemClass);if(typeof clickMethod!=="function"){clickMethod=function(){self.goToPage(text);return false;};}var link=$('<a href="#"></a>').attr("title",text).attr("role","button").focus(function(){self._focusedElement=$(this);}).append(text).click(clickMethod).appendTo(pagerItem);if(selected){link.addClass(options.pagerSelectedClass).attr("tabindex","0").attr("aria-selected","true");}else{link.addClass(options.pagerLinkClass).attr("tabindex","-1");}if(typeof insertAfterTarget==="undefined"){pagerItem.appendTo(this.pagerList);}else{pagerItem.insertAfter(insertAfterTarget);}return $(pagerItem);},_removePage:function(index){this._getObjectForIndex(index).parent().remove();this._pages=this._pages-1;},_updateButtonVisibility:function(){var options=this.options;this.nextButton.css("display","none").attr("aria-hidden","true");this.lastButton.css("display","none").attr("aria-hidden","true");this.firstButton.css("display","none").attr("aria-hidden","true");this.previousButton.css("display","none").attr("aria-hidden","true");((options.currentPage<this._pages)&&this.nextButton.removeAttr("style").removeAttr("aria-hidden"));((options.currentPage<this._pages)&&this.lastButton.removeAttr("style").removeAttr("aria-hidden"));((options.currentPage>1)&&this.firstButton.removeAttr("style").removeAttr("aria-hidden"));((options.currentPage>1)&&this.previousButton.removeAttr("style").removeAttr("aria-hidden"));},_getSiblingItem:function(direction){var listItem=this._focusedElement.parent();var siblingItem;if(direction===-1){siblingItem=listItem.prev();}else{if(direction===1){siblingItem=listItem.next();}else{return this._focusedElement;}}var siblingLink=siblingItem.children().eq(0);if(siblingLink&&siblingLink.is(":visible")){return siblingLink;}else{return this._focusedElement;}},_onKeyDown:function(e){if(e.ctrlKey||e.altKey||e.shiftKey){}else{if(epi.shell.isArrowKey(e.which)){if(epi.shell.keyCode.arrowRight===e.which){this._moveFocus(1);}else{if(epi.shell.keyCode.arrowLeft===e.which){this._moveFocus(-1);}}}}},_moveFocus:function(direction){this._focusedElement.blur();this._getSiblingItem(direction).focus();},_getObjectForIndex:function(index){return $("[title="+index+"]",this.pagerList);},changeNumberOfPages:function(newPages){var self=this;var options=this.options;if(newPages<this._pages){while(newPages!==this._pages){this._removePage(this._pages);}}else{if(newPages>this._pages){while(newPages!==this._pages){this._addPage(false,this._pages+1,null,this._getObjectForIndex(this._pages).parent());this._pages=this._pages+1;}}}if(options.currentPage>this._pages){this.goToPage(this._pages);}else{this._updateButtonVisibility();}},goToPage:function(page,keepFocus){var self=this;var options=this.options;var previousPage=options.currentPage;var newLinkObject;if(page!==previousPage){var previousLinkObject=this._getObjectForIndex(previousPage);newLinkObject=this._getObjectForIndex(page);previousLinkObject.removeClass(options.pagerSelectedClass).addClass(options.pagerLinkClass).removeAttr("aria-selected").attr("tabindex","-1");newLinkObject.removeClass(options.pagerLinkClass).addClass(options.pagerSelectedClass).attr("aria-selected","true").attr("tabindex","0");}options.currentPage=page;var dataObj={pages:this._pages,currentPage:options.currentPage};self._trigger("pagechanged",null,dataObj);this._updateButtonVisibility();if((typeof keepFocus!=="undefined")&&keepFocus.is(":visible")){this._focusedElement.blur();keepFocus.focus();}else{if(typeof keepFocus!=="undefined"){newLinkObject=this._getObjectForIndex(page);newLinkObject.focus();}}}});$.extend($.ui.epiPager,{version:"0.1",eventPrefix:"epipager",defaults:{pages:1,currentPage:1,pagerContainerClass:"epi-pager",pagerListClass:"epi-pager-group",pagerItemClass:"epi-pager-item",pagerLinkClass:"epi-pager-link",pagerLinkFocusClass:"epi-pager-link-focus",pagerSelectedClass:"epi-pager-selected"}});})(epiJQuery);(function($){var setDataSwitch={dragStart:"start.draggable",drag:"drag.draggable",dragStop:"stop.draggable",maxHeight:"maxHeight.resizable",minHeight:"minHeight.resizable",maxWidth:"maxWidth.resizable",minWidth:"minWidth.resizable",resizeStart:"start.resizable",resize:"drag.resizable",resizeStop:"stop.resizable"};$.widget("ui.epiDialog",$.extend({},$.ui.dialog.prototype,{_init:function(){this.originalTitle=this.element.attr("title");var self=this;var options=this.options;this._nonContentHeight=0;var title=options.title||this.originalTitle||"&nbsp;";var titleId=$.ui.dialog.getTitleId(this.element);var uiDialog=(this.uiDialog=$("<div/>")).appendTo(document.body).hide().addClass(options.dialogClass).css({position:"absolute",overflow:"hidden",zIndex:options.zIndex}).attr("tabIndex",-1).css("outline",0).keydown(function(event){(options.closeOnEscape&&event.keyCode&&event.keyCode==$.ui.keyCode.ESCAPE&&self.close(event));}).attr({role:"dialog","aria-labelledby":titleId}).mousedown(function(event){self.moveToTop(false,event);});var uiContentArea=(this.uiContentArea=$("<div/>")).addClass("epi-dialog-contentArea").appendTo(uiDialog);var uiDialogContent=this.element.show().removeAttr("title").addClass("epi-dialog-content").appendTo(uiContentArea);var uiDialogTitlebar=(this.uiDialogTitlebar=$("<div/>")).addClass("epi-dialog-titleBar").prependTo(uiDialog);var uiDialogTitlebarClose=$('<a href="#"/>').addClass("epi-dialog-closeLink ").attr("role","button").hover(function(){uiDialogTitlebarCloseText.addClass("epi-dialog-closeIcon-hover");},function(){uiDialogTitlebarCloseText.removeClass("epi-dialog-closeIcon-hover");}).focus(function(){uiDialogTitlebarClose.addClass("epi-dialog-closeIcon-focus");}).blur(function(){uiDialogTitlebarClose.removeClass("epi-dialog-closeIcon-focus");}).mousedown(function(e){e.stopPropagation();}).click(function(e){self.close(e);return false;}).appendTo(uiDialogTitlebar);var uiDialogTitlebarCloseText=(this.uiDialogTitlebarCloseText=$("<span/>")).addClass("epi-dialog-closeIcon").text(options.closeText).appendTo(uiDialogTitlebarClose);var uiDialogTitle=$("<h1/>").attr("id",titleId).html(title).prependTo(uiDialogTitlebar);uiDialogTitlebar.find("*").add(uiDialogTitlebar).disableSelection();(options.draggable&&$.fn.draggable&&this._makeDraggable());(options.resizable&&$.fn.resizable&&this._makeResizable());this._createButtons(options.buttons);this._isOpen=false;(options.bgiframe&&$.fn.bgiframe&&uiDialog.bgiframe());(options.autoOpen&&this.open());this.contentCover=$("<div />").addClass("epi-dialog-contentCover").appendTo(uiContentArea);},_createButtons:function(buttons){var self=this;var hasButtons=false;var uiDialogButtonPane=$("<div/>").addClass("epi-dialog-buttonBar");this.uiDialog.find(".epi-dialog-buttonBar").remove();(typeof buttons=="object"&&buttons!==null&&$.each(buttons,function(){return !(hasButtons=true);}));if(hasButtons){$.each(buttons,function(name,fn){$('<input type="submit" class="epi-button-child-item" />').attr("value",name).click(function(){fn.apply(self.element[0],arguments);}).wrap('<span class="epi-button-child" />').parent().wrap('<span class="epi-button" />').parent().appendTo(uiDialogButtonPane);});uiDialogButtonPane.appendTo(this.uiContentArea);}},open:function(){if(this._isOpen){return;}var options=this.options;var uiDialog=this.uiDialog;this.overlay=options.modal?new $.ui.dialog.overlay(this):null;(uiDialog.next().length&&uiDialog.appendTo("body"));this._size();this._position(options.position);uiDialog.show(options.show);this.moveToTop(true);(options.modal&&uiDialog.bind("keydown.ui-dialog",function(event){if(event.keyCode!=$.ui.keyCode.TAB){return;}var tabbables=$(":tabbable",this);var first=tabbables.filter(":first")[0];var last=tabbables.filter(":last")[0];if(event.target==last&&!event.shiftKey){setTimeout(function(){first.focus();},1);}else{if(event.target==first&&event.shiftKey){setTimeout(function(){last.focus();},1);}}}));$([]).add(uiDialog.find(".epi-dialog-content :tabbable:first")).add(uiDialog.find(".epi-dialog-buttonBar :tabbable:first")).add(uiDialog).filter(":first").focus();this._trigger("open");this._isOpen=true;},_setData:function(key,value){(setDataSwitch[key]&&this.uiDialog.data(setDataSwitch[key],value));switch(key){case"buttons":this._createButtons(value);break;case"closeText":this.uiDialogTitlebarCloseText.text(value);break;case"dialogClass":this.uiDialog.removeClass(this.options.dialogClass).addClass(value);break;case"draggable":(value?this._makeDraggable():this.uiDialog.draggable("destroy"));break;case"height":this.uiDialog.height(value);this.element.height(Math.max(value-this._nonContentHeight,0));break;case"position":this._position(value);break;case"resizable":var uiDialog=this.uiDialog,isResizable=this.uiDialog.is(":data(resizable)");(isResizable&&!value&&uiDialog.resizable("destroy"));(isResizable&&typeof value=="string"&&uiDialog.resizable("option","handles",value));(isResizable||this._makeResizable(value));break;case"title":$("h1",this.uiDialogTitlebar).html(value||"&nbsp;");break;case"width":this.uiDialog.width(value);break;}$.widget.prototype._setData.apply(this,arguments);},_size:function(){var options=this.options;this.element.css({height:0,minHeight:0,width:"auto"}).hide();var nonContentHeight=this._nonContentHeight=this.uiDialog.css({height:"auto",width:options.width}).height();this.element.css({minHeight:Math.max(options.minHeight-nonContentHeight,0),height:options.height=="auto"?"auto":Math.max(options.height-nonContentHeight,0)}).show();},_makeDraggable:function(){var self=this,options=this.options,heightBeforeDrag;this.uiDialog.draggable({cancel:".epi-dialog-contentArea",handle:".epi-dialog-titleBar",containment:"document",start:function(){heightBeforeDrag=$(this).height();$(this).addClass("ui-dialog-dragging");self.contentCover.css({display:"block"});(options.dragStart&&options.dragStart.apply(self.element[0],arguments));},drag:function(){(options.drag&&options.drag.apply(self.element[0],arguments));},stop:function(){self.contentCover.css({display:"none"});$(this).removeClass("ui-dialog-dragging");(options.dragStop&&options.dragStop.apply(self.element[0],arguments));$.ui.dialog.overlay.resize();}});},_makeResizable:function(handles){handles=(handles===undefined?this.options.resizable:handles);var self=this,options=this.options,resizeHandles=typeof handles=="string"?handles:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".epi-dialog-content",alsoResize:this.element,maxWidth:options.maxWidth,maxHeight:options.maxHeight,minWidth:options.minWidth,minHeight:options.minHeight,start:function(){$(this).addClass("ui-dialog-resizing");(options.resizeStart&&options.resizeStart.apply(self.element[0],arguments));self.contentCover.css({display:"block"});},resize:function(){(options.resize&&options.resize.apply(self.element[0],arguments));},handles:resizeHandles,stop:function(){$(this).removeClass("ui-dialog-resizing");options.height=$(this).height();options.width=$(this).width();(options.resizeStop&&options.resizeStop.apply(self.element[0],arguments));$.ui.dialog.overlay.resize();self.element.hide();self.element.css({minHeight:Math.max(options.minHeight-self._nonContentHeight,0),height:options.height=="auto"?"auto":Math.max(options.height-self._nonContentHeight,0),width:"auto"}).show();$(this).height(options.height);self.contentCover.css({display:"none"});}}).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se");}}));$.extend($.ui.epiDialog,{version:"1.7.1",defaults:{autoOpen:true,bgiframe:false,buttons:{},closeOnEscape:true,closeText:"Close",dialogClass:"epi-dialog",draggable:true,hide:null,height:"auto",maxHeight:false,maxWidth:false,minHeight:150,minWidth:150,modal:true,position:"center",resizable:true,show:null,stack:true,title:"",width:300,zIndex:1000},getter:"isOpen",uuid:0,maxZ:0,getTitleId:function($el){return"ui-dialog-title-"+($el.attr("id")||++this.uuid);},overlay:function(dialog){this.$el=$.ui.dialog.overlay.create(dialog);}});$.extend($.ui.dialog.overlay,{create:function(dialog){if(this.instances.length===0){setTimeout(function(){$(document).bind($.ui.dialog.overlay.events,function(event){var dialogZ=$(event.target).parents(".epi-dialog").css("zIndex")||0;return(dialogZ>$.ui.dialog.overlay.maxZ);});},1);$(document).bind("keydown.dialog-overlay",function(event){(dialog.options.closeOnEscape&&event.keyCode&&event.keyCode==$.ui.keyCode.ESCAPE&&dialog.close(event));});$(window).bind("resize.dialog-overlay",$.ui.dialog.overlay.resize);}var $el=$("<div></div>").appendTo(document.body).addClass("ui-widget-overlay").css({width:this.width(),height:this.height()});(dialog.options.bgiframe&&$.fn.bgiframe&&$el.bgiframe());this.instances.push($el);return $el;}});})(epiJQuery);(function($){$.widget("ui.epiToolTip",{_init:function(){this.element.attr("aria-hidden",true);var opener=this._selectOpener();opener.data("opensToolTip",this.element[0]).hover(this._onMouseOver,this._onMouseOut).focus(this._onMouseOver).blur(this._onMouseOut);},_onMouseOver:function(){var tt=$(this).data("opensToolTip");var offset=$(this).offset();var top=offset.top+$(this).height();var left=offset.left;$(tt).show().attr("aria-hidden",false).css("top",top).css("left",left);if(tt.parentElement!==document.body){$(tt).appendTo(document.body);}},_onMouseOut:function(){var tt=$(this).data("opensToolTip");$(tt).hide().attr("aria-hidden",true);},_selectOpener:function(){if(this.options.openerSelector){return $(this.options.openerSelector);}return this.element.prev("*");},destroy:function(){this.element.unbind("focus",this._onMouseOver);this.element.unbind("blur",this._onMouseOut);this.element.unbind("mouseenter",this._onMouseOver);this.element.unbind("mouseleave",this._onMouseOut);this.element.removeAttr("aria-hidden");this.element.css("top","");this.element.css("left","");}});$.extend($.ui.epiToolTip,{version:"0.1",defaults:{openerSelector:null}});})(epiJQuery);(function($){$.widget("ui.epiCollapsiblePanel",{_init:function(){var self=this;var options=this.options;this._headerPanel=$(options.headerContentSelector,self.element);this._contentPanel=$(options.contentSelector,self.element);$("a",this._headerPanel).toggle(function(e){self.collapse(e);},function(e){self.expand(e);});},expand:function(e){var options=this.options;this._headerPanel.removeClass(options.collapsedClass);this._contentPanel.show();},collapse:function(e){var options=this.options;this._headerPanel.addClass(options.collapsedClass);this._contentPanel.hide();}});$.extend($.ui.epiCollapsiblePanel,{version:"0.1",eventPrefix:"epicollapsiblepanel",defaults:{collapsedClass:"epi-collapsiblePanel-header-collapsed",headerContentSelector:".epi-collapsiblePanel-header",contentSelector:".epi-collapsiblePanel-content"}});})(epiJQuery);(function($){$.extend($.fn,{validate:function(options){if(!this.length){options&&options.debug&&window.console&&console.warn("nothing selected, can't validate, returning nothing");return;}var validator=$.data(this[0],"validator");if(validator){return validator;}validator=new $.validator(options,this[0]);$.data(this[0],"validator",validator);if(validator.settings.onsubmit){this.find("input, button").filter(".cancel").click(function(){validator.cancelSubmit=true;});if(validator.settings.submitHandler){this.find("input, button").filter(":submit").click(function(){validator.submitButton=this;});}this.submit(function(event){if(validator.settings.debug){event.preventDefault();}function handle(){if(validator.settings.submitHandler){if(validator.submitButton){var hidden=$("<input type='hidden'/>").attr("name",validator.submitButton.name).val(validator.submitButton.value).appendTo(validator.currentForm);}validator.settings.submitHandler.call(validator,validator.currentForm);if(validator.submitButton){hidden.remove();}return false;}return true;}if(validator.cancelSubmit){validator.cancelSubmit=false;return handle();}if(validator.form()){if(validator.pendingRequest){validator.formSubmitted=true;return false;}return handle();}else{validator.focusInvalid();return false;}});}return validator;},valid:function(){if($(this[0]).is("form")){return this.validate().form();}else{var valid=true;var validator=$(this[0].form).validate();this.each(function(){valid&=validator.element(this);});return valid;}},removeAttrs:function(attributes){var result={},$element=this;$.each(attributes.split(/\s/),function(index,value){result[value]=$element.attr(value);$element.removeAttr(value);});return result;},rules:function(command,argument){var element=this[0];if(command){var settings=$.data(element.form,"validator").settings;var staticRules=settings.rules;var existingRules=$.validator.staticRules(element);switch(command){case"add":$.extend(existingRules,$.validator.normalizeRule(argument));staticRules[element.name]=existingRules;if(argument.messages){settings.messages[element.name]=$.extend(settings.messages[element.name],argument.messages);}break;case"remove":if(!argument){delete staticRules[element.name];return existingRules;}var filtered={};$.each(argument.split(/\s/),function(index,method){filtered[method]=existingRules[method];delete existingRules[method];});return filtered;}}var data=$.validator.normalizeRules($.extend({},$.validator.metadataRules(element),$.validator.classRules(element),$.validator.attributeRules(element),$.validator.staticRules(element)),element);if(data.required){var param=data.required;delete data.required;data=$.extend({required:param},data);}return data;}});$.extend($.expr[":"],{blank:function(a){return !$.trim(a.value);},filled:function(a){return !!$.trim(a.value);},unchecked:function(a){return !a.checked;}});$.validator=function(options,form){this.settings=$.extend({},$.validator.defaults,options);this.currentForm=form;this.init();};$.validator.format=function(source,params){if(arguments.length==1){return function(){var args=$.makeArray(arguments);args.unshift(source);return $.validator.format.apply(this,args);};}if(arguments.length>2&&params.constructor!=Array){params=$.makeArray(arguments).slice(1);}if(params.constructor!=Array){params=[params];}$.each(params,function(i,n){source=source.replace(new RegExp("\\{"+i+"\\}","g"),n);});return source;};$.extend($.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:true,errorContainer:$([]),errorLabelContainer:$([]),onsubmit:true,ignore:[],ignoreTitle:false,onfocusin:function(element){this.lastActive=element;if(this.settings.focusCleanup&&!this.blockFocusCleanup){this.settings.unhighlight&&this.settings.unhighlight.call(this,element,this.settings.errorClass,this.settings.validClass);this.errorsFor(element).hide();}},onfocusout:function(element){if(!this.checkable(element)&&(element.name in this.submitted||!this.optional(element))){this.element(element);}},onkeyup:function(element){if(element.name in this.submitted||element==this.lastElement){this.element(element);}},onclick:function(element){if(element.name in this.submitted){this.element(element);}},highlight:function(element,errorClass,validClass){$(element).addClass(errorClass).removeClass(validClass);},unhighlight:function(element,errorClass,validClass){$(element).removeClass(errorClass).addClass(validClass);}},setDefaults:function(settings){$.extend($.validator.defaults,settings);},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",dateDE:"Bitte geben Sie ein gültiges Datum ein.",number:"Please enter a valid number.",numberDE:"Bitte geben Sie eine Nummer ein.",digits:"Please enter only digits",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:$.validator.format("Please enter no more than {0} characters."),minlength:$.validator.format("Please enter at least {0} characters."),rangelength:$.validator.format("Please enter a value between {0} and {1} characters long."),range:$.validator.format("Please enter a value between {0} and {1}."),max:$.validator.format("Please enter a value less than or equal to {0}."),min:$.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:false,prototype:{init:function(){this.labelContainer=$(this.settings.errorLabelContainer);this.errorContext=this.labelContainer.length&&this.labelContainer||$(this.currentForm);this.containers=$(this.settings.errorContainer).add(this.settings.errorLabelContainer);this.submitted={};this.valueCache={};this.pendingRequest=0;this.pending={};this.invalid={};this.reset();var groups=(this.groups={});$.each(this.settings.groups,function(key,value){$.each(value.split(/\s/),function(index,name){groups[name]=key;});});var rules=this.settings.rules;$.each(rules,function(key,value){rules[key]=$.validator.normalizeRule(value);});function delegate(event){var validator=$.data(this[0].form,"validator");validator.settings["on"+event.type]&&validator.settings["on"+event.type].call(validator,this[0]);}$(this.currentForm).delegate("focusin focusout keyup",":text, :password, :file, select, textarea",delegate).delegate("click",":radio, :checkbox",delegate);if(this.settings.invalidHandler){$(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler);}},form:function(){this.checkForm();$.extend(this.submitted,this.errorMap);this.invalid=$.extend({},this.errorMap);if(!this.valid()){$(this.currentForm).triggerHandler("invalid-form",[this]);}this.showErrors();return this.valid();},checkForm:function(){this.prepareForm();for(var i=0,elements=(this.currentElements=this.elements());elements[i];i++){this.check(elements[i]);}return this.valid();},element:function(element){element=this.clean(element);this.lastElement=element;this.prepareElement(element);this.currentElements=$(element);var result=this.check(element);if(result){delete this.invalid[element.name];}else{this.invalid[element.name]=true;}if(!this.numberOfInvalids()){this.toHide=this.toHide.add(this.containers);}this.showErrors();return result;},showErrors:function(errors){if(errors){$.extend(this.errorMap,errors);this.errorList=[];for(var name in errors){this.errorList.push({message:errors[name],element:this.findByName(name)[0]});}this.successList=$.grep(this.successList,function(element){return !(element.name in errors);});}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors();},resetForm:function(){if($.fn.resetForm){$(this.currentForm).resetForm();}this.submitted={};this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass);},numberOfInvalids:function(){return this.objectLength(this.invalid);},objectLength:function(obj){var count=0;for(var i in obj){count++;}return count;},hideErrors:function(){this.addWrapper(this.toHide).hide();},valid:function(){return this.size()==0;},size:function(){return this.errorList.length;},focusInvalid:function(){if(this.settings.focusInvalid){try{$(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus();}catch(e){}}},findLastActive:function(){var lastActive=this.lastActive;return lastActive&&$.grep(this.errorList,function(n){return n.element.name==lastActive.name;}).length==1&&lastActive;},elements:function(){var validator=this,rulesCache={};return $([]).add(this.currentForm.elements).filter(":input").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){!this.name&&validator.settings.debug&&window.console&&console.error("%o has no name assigned",this);if(this.name in rulesCache||!validator.objectLength($(this).rules())){return false;}rulesCache[this.name]=true;return true;});},clean:function(selector){return $(selector)[0];},errors:function(){return $(this.settings.errorElement+"."+this.settings.errorClass,this.errorContext);},reset:function(){this.successList=[];this.errorList=[];this.errorMap={};this.toShow=$([]);this.toHide=$([]);this.formSubmitted=false;this.currentElements=$([]);},prepareForm:function(){this.reset();this.toHide=this.errors().add(this.containers);},prepareElement:function(element){this.reset();this.toHide=this.errorsFor(element);},check:function(element){element=this.clean(element);if(this.checkable(element)){element=this.findByName(element.name)[0];}var rules=$(element).rules();var dependencyMismatch=false;for(method in rules){var rule={method:method,parameters:rules[method]};try{var result=$.validator.methods[method].call(this,element.value.replace(/\r/g,""),element,rule.parameters);if(result=="dependency-mismatch"){dependencyMismatch=true;continue;}dependencyMismatch=false;if(result=="pending"){this.toHide=this.toHide.not(this.errorsFor(element));return;}if(!result){this.formatAndAdd(element,rule);return false;}}catch(e){this.settings.debug&&window.console&&console.log("exception occured when checking element "+element.id+", check the '"+rule.method+"' method");throw e;}}if(dependencyMismatch){return;}if(this.objectLength(rules)){this.successList.push(element);}return true;},customMetaMessage:function(element,method){if(!$.metadata){return;}var meta=this.settings.meta?$(element).metadata()[this.settings.meta]:$(element).metadata();return meta&&meta.messages&&meta.messages[method];},customMessage:function(name,method){var m=this.settings.messages[name];return m&&(m.constructor==String?m:m[method]);},findDefined:function(){for(var i=0;i<arguments.length;i++){if(arguments[i]!==undefined){return arguments[i];}}return undefined;},defaultMessage:function(element,method){return this.findDefined(this.customMessage(element.name,method),this.customMetaMessage(element,method),!this.settings.ignoreTitle&&element.title||undefined,$.validator.messages[method],"<strong>Warning: No message defined for "+element.name+"</strong>");},formatAndAdd:function(element,rule){var message=this.defaultMessage(element,rule.method);if(typeof message=="function"){message=message.call(this,rule.parameters,element);}this.errorList.push({message:message,element:element});this.errorMap[element.name]=message;this.submitted[element.name]=message;},addWrapper:function(toToggle){if(this.settings.wrapper){toToggle=toToggle.add(toToggle.parent(this.settings.wrapper));}return toToggle;},defaultShowErrors:function(){for(var i=0;this.errorList[i];i++){var error=this.errorList[i];this.settings.highlight&&this.settings.highlight.call(this,error.element,this.settings.errorClass,this.settings.validClass);this.showLabel(error.element,error.message);}if(this.errorList.length){this.toShow=this.toShow.add(this.containers);}if(this.settings.success){for(var i=0;this.successList[i];i++){this.showLabel(this.successList[i]);}}if(this.settings.unhighlight){for(var i=0,elements=this.validElements();elements[i];i++){this.settings.unhighlight.call(this,elements[i],this.settings.errorClass,this.settings.validClass);}}this.toHide=this.toHide.not(this.toShow);this.hideErrors();this.addWrapper(this.toShow).show();},validElements:function(){return this.currentElements.not(this.invalidElements());},invalidElements:function(){return $(this.errorList).map(function(){return this.element;});},showLabel:function(element,message){var label=this.errorsFor(element);if(label.length){label.removeClass().addClass(this.settings.errorClass);label.attr("generated")&&label.html(message);}else{label=$("<"+this.settings.errorElement+"/>").attr({"for":this.idOrName(element),generated:true}).addClass(this.settings.errorClass).html(message||"");if(this.settings.wrapper){label=label.hide().show().wrap("<"+this.settings.wrapper+"/>").parent();}if(!this.labelContainer.append(label).length){this.settings.errorPlacement?this.settings.errorPlacement(label,$(element)):label.insertAfter(element);}}if(!message&&this.settings.success){label.text("");typeof this.settings.success=="string"?label.addClass(this.settings.success):this.settings.success(label);}this.toShow=this.toShow.add(label);},errorsFor:function(element){return this.errors().filter("[for='"+this.idOrName(element)+"']");},idOrName:function(element){return this.groups[element.name]||(this.checkable(element)?element.name:element.id||element.name);},checkable:function(element){return/radio|checkbox/i.test(element.type);},findByName:function(name){var form=this.currentForm;return $(document.getElementsByName(name)).map(function(index,element){return element.form==form&&element.name==name&&element||null;});},getLength:function(value,element){switch(element.nodeName.toLowerCase()){case"select":return $("option:selected",element).length;case"input":if(this.checkable(element)){return this.findByName(element.name).filter(":checked").length;}}return value.length;},depend:function(param,element){return this.dependTypes[typeof param]?this.dependTypes[typeof param](param,element):true;},dependTypes:{"boolean":function(param,element){return param;},"string":function(param,element){return !!$(param,element.form).length;},"function":function(param,element){return param(element);}},optional:function(element){return !$.validator.methods.required.call(this,$.trim(element.value),element)&&"dependency-mismatch";},startRequest:function(element){if(!this.pending[element.name]){this.pendingRequest++;this.pending[element.name]=true;}},stopRequest:function(element,valid){this.pendingRequest--;if(this.pendingRequest<0){this.pendingRequest=0;}delete this.pending[element.name];if(valid&&this.pendingRequest==0&&this.formSubmitted&&this.form()){$(this.currentForm).submit();}else{if(!valid&&this.pendingRequest==0&&this.formSubmitted){$(this.currentForm).triggerHandler("invalid-form",[this]);}}},previousValue:function(element){return $.data(element,"previousValue")||$.data(element,"previousValue",previous={old:null,valid:true,message:this.defaultMessage(element,"remote")});}},classRuleSettings:{required:{required:true},email:{email:true},url:{url:true},date:{date:true},dateISO:{dateISO:true},dateDE:{dateDE:true},number:{number:true},numberDE:{numberDE:true},digits:{digits:true},creditcard:{creditcard:true}},addClassRules:function(className,rules){className.constructor==String?this.classRuleSettings[className]=rules:$.extend(this.classRuleSettings,className);},classRules:function(element){var rules={};var classes=$(element).attr("class");classes&&$.each(classes.split(" "),function(){if(this in $.validator.classRuleSettings){$.extend(rules,$.validator.classRuleSettings[this]);}});return rules;},attributeRules:function(element){var rules={};var $element=$(element);for(method in $.validator.methods){var value=$element.attr(method);if(value){rules[method]=value;}}if(rules.maxlength&&/-1|2147483647|524288/.test(rules.maxlength)){delete rules.maxlength;}return rules;},metadataRules:function(element){if(!$.metadata){return{};}var meta=$.data(element.form,"validator").settings.meta;return meta?$(element).metadata()[meta]:$(element).metadata();},staticRules:function(element){var rules={};var validator=$.data(element.form,"validator");if(validator.settings.rules){rules=$.validator.normalizeRule(validator.settings.rules[element.name])||{};}return rules;},normalizeRules:function(rules,element){$.each(rules,function(prop,val){if(val===false){delete rules[prop];return;}if(val.param||val.depends){var keepRule=true;switch(typeof val.depends){case"string":keepRule=!!$(val.depends,element.form).length;break;case"function":keepRule=val.depends.call(element,element);break;}if(keepRule){rules[prop]=val.param!==undefined?val.param:true;}else{delete rules[prop];}}});$.each(rules,function(rule,parameter){rules[rule]=$.isFunction(parameter)?parameter(element):parameter;});$.each(["minlength","maxlength","min","max"],function(){if(rules[this]){rules[this]=Number(rules[this]);}});$.each(["rangelength","range"],function(){if(rules[this]){rules[this]=[Number(rules[this][0]),Number(rules[this][1])];}});if($.validator.autoCreateRanges){if(rules.min&&rules.max){rules.range=[rules.min,rules.max];delete rules.min;delete rules.max;}if(rules.minlength&&rules.maxlength){rules.rangelength=[rules.minlength,rules.maxlength];delete rules.minlength;delete rules.maxlength;}}if(rules.messages){delete rules.messages;}return rules;},normalizeRule:function(data){if(typeof data=="string"){var transformed={};$.each(data.split(/\s/),function(){transformed[this]=true;});data=transformed;}return data;},addMethod:function(name,method,message){$.validator.methods[name]=method;$.validator.messages[name]=message||$.validator.messages[name];if(method.length<3){$.validator.addClassRules(name,$.validator.normalizeRule(name));}},methods:{required:function(value,element,param){if(!this.depend(param,element)){return"dependency-mismatch";}switch(element.nodeName.toLowerCase()){case"select":var options=$("option:selected",element);return options.length>0&&(element.type=="select-multiple"||($.browser.msie&&!(options[0].attributes["value"].specified)?options[0].text:options[0].value).length>0);case"input":if(this.checkable(element)){return this.getLength(value,element)>0;}default:return $.trim(value).length>0;}},remote:function(value,element,param){if(this.optional(element)){return"dependency-mismatch";}var previous=this.previousValue(element);if(!this.settings.messages[element.name]){this.settings.messages[element.name]={};}this.settings.messages[element.name].remote=typeof previous.message=="function"?previous.message(value):previous.message;param=typeof param=="string"&&{url:param}||param;if(previous.old!==value){previous.old=value;var validator=this;this.startRequest(element);var data={};data[element.name]=value;$.ajax($.extend(true,{url:param,mode:"abort",port:"validate"+element.name,dataType:"json",data:data,success:function(response){var valid=response===true;if(valid){var submitted=validator.formSubmitted;validator.prepareElement(element);validator.formSubmitted=submitted;validator.successList.push(element);validator.showErrors();}else{var errors={};errors[element.name]=previous.message=response||validator.defaultMessage(element,"remote");validator.showErrors(errors);}previous.valid=valid;validator.stopRequest(element,valid);}},param));return"pending";}else{if(this.pending[element.name]){return"pending";}}return previous.valid;},minlength:function(value,element,param){return this.optional(element)||this.getLength($.trim(value),element)>=param;},maxlength:function(value,element,param){return this.optional(element)||this.getLength($.trim(value),element)<=param;},rangelength:function(value,element,param){var length=this.getLength($.trim(value),element);return this.optional(element)||(length>=param[0]&&length<=param[1]);},min:function(value,element,param){return this.optional(element)||value>=param;},max:function(value,element,param){return this.optional(element)||value<=param;},range:function(value,element,param){return this.optional(element)||(value>=param[0]&&value<=param[1]);},email:function(value,element){return this.optional(element)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(value);},url:function(value,element){return this.optional(element)||/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(value);},date:function(value,element){return this.optional(element)||!/Invalid|NaN/.test(new Date(value));},dateISO:function(value,element){return this.optional(element)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(value);},dateDE:function(value,element){return this.optional(element)||/^\d\d?\.\d\d?\.\d\d\d?\d?$/.test(value);},number:function(value,element){return this.optional(element)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(value);},numberDE:function(value,element){return this.optional(element)||/^-?(?:\d+|\d{1,3}(?:\.\d{3})+)(?:,\d+)?$/.test(value);},digits:function(value,element){return this.optional(element)||/^\d+$/.test(value);},creditcard:function(value,element){if(this.optional(element)){return"dependency-mismatch";}if(/[^0-9-]+/.test(value)){return false;}var nCheck=0,nDigit=0,bEven=false;value=value.replace(/\D/g,"");for(n=value.length-1;n>=0;n--){var cDigit=value.charAt(n);var nDigit=parseInt(cDigit,10);if(bEven){if((nDigit*=2)>9){nDigit-=9;}}nCheck+=nDigit;bEven=!bEven;}return(nCheck%10)==0;},accept:function(value,element,param){param=typeof param=="string"?param.replace(/,/g,"|"):"png|jpe?g|gif";return this.optional(element)||value.match(new RegExp(".("+param+")$","i"));},equalTo:function(value,element,param){return value==$(param).val();}}});$.format=$.validator.format;})(epiJQuery);(function($){var ajax=$.ajax;var pendingRequests={};$.ajax=function(settings){settings=$.extend(settings,$.extend({},$.ajaxSettings,settings));var port=settings.port;if(settings.mode=="abort"){if(pendingRequests[port]){pendingRequests[port].abort();}return(pendingRequests[port]=ajax.apply(this,arguments));}return ajax.apply(this,arguments);};})(epiJQuery);(function($){$.each({focus:"focusin",blur:"focusout"},function(original,fix){$.event.special[fix]={setup:function(){if($.browser.msie){return false;}this.addEventListener(original,$.event.special[fix].handler,true);},teardown:function(){if($.browser.msie){return false;}this.removeEventListener(original,$.event.special[fix].handler,true);},handler:function(e){arguments[0]=$.event.fix(e);arguments[0].type=fix;return $.event.handle.apply(this,arguments);}};});$.extend($.fn,{delegate:function(type,delegate,handler){return this.bind(type,function(event){var target=$(event.target);if(target.is(delegate)){return handler.apply(target,arguments);}});},triggerEvent:function(type,target){return this.triggerHandler(type,[$.event.fix({type:type,target:target})]);}});})(epiJQuery);(function($,epi){var jQueryValidateResourceKey="EPiServer.Shell.UI.Resources.JQueryValidate";if(typeof require!=="undefined"){require(["epi/i18n!epi/shell/ui/nls/"+jQueryValidateResourceKey,"dojo/domReady!"],function(res){epi.shell.resource.add(jQueryValidateResourceKey,res);registerResources();});}else{epi.shell.registerInitFunction(registerResources);}function registerResources(resources){$.extend(jQuery.validator.messages,{required:epi.shell.resource.get(jQueryValidateResourceKey,"required"),remote:epi.shell.resource.get(jQueryValidateResourceKey,"remote"),email:epi.shell.resource.get(jQueryValidateResourceKey,"email"),url:epi.shell.resource.get(jQueryValidateResourceKey,"url"),date:epi.shell.resource.get(jQueryValidateResourceKey,"date"),dateISO:epi.shell.resource.get(jQueryValidateResourceKey,"dateiso"),number:epi.shell.resource.get(jQueryValidateResourceKey,"number"),digits:epi.shell.resource.get(jQueryValidateResourceKey,"digits"),creditcard:epi.shell.resource.get(jQueryValidateResourceKey,"creditcard"),equalTo:epi.shell.resource.get(jQueryValidateResourceKey,"equalto"),accept:epi.shell.resource.get(jQueryValidateResourceKey,"accept"),maxlength:$.validator.format(epi.shell.resource.get(jQueryValidateResourceKey,"maxlength")),minlength:$.validator.format(epi.shell.resource.get(jQueryValidateResourceKey,"minlength")),rangelength:$.validator.format(epi.shell.resource.get(jQueryValidateResourceKey,"rangelength")),range:$.validator.format(epi.shell.resource.get(jQueryValidateResourceKey,"range")),max:$.validator.format(epi.shell.resource.get(jQueryValidateResourceKey,"max")),min:$.validator.format(epi.shell.resource.get(jQueryValidateResourceKey,"min")),nohtml:$.validator.format(epi.shell.resource.get(jQueryValidateResourceKey,"nohtml"))});}})(epiJQuery,epi);(function($,epi){epi.shell.registerInitFunction(function(){$.validator.addMethod("nohtml",function(value,element){return this.optional(element)||!/([<>])|(&#)/.test(value);});});})(epiJQuery,epi);(function($){$.extend($.ui,{datepicker:{version:"1.7.2"}});var PROP_NAME="datepicker";function Datepicker(){this.debug=false;this._curInst=null;this._keyEvent=false;this._disabledInputs=[];this._datepickerShowing=false;this._inDialog=false;this._mainDivId="ui-datepicker-div";this._inlineClass="ui-datepicker-inline";this._appendClass="ui-datepicker-append";this._triggerClass="ui-datepicker-trigger";this._dialogClass="ui-datepicker-dialog";this._disableClass="ui-datepicker-disabled";this._unselectableClass="ui-datepicker-unselectable";this._currentClass="ui-datepicker-current-day";this._dayOverClass="ui-datepicker-days-cell-over";this.regional=[];this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],dateFormat:"mm/dd/yy",firstDay:0,isRTL:false};this._defaults={showOn:"focus",showAnim:"show",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:false,hideIfNoPrevNext:false,navigationAsDateFormat:false,gotoCurrent:false,changeMonth:false,changeYear:false,showMonthAfterYear:false,yearRange:"-10:+10",showOtherMonths:false,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"normal",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:true,showButtonPanel:false};$.extend(this._defaults,this.regional[""]);this.dpDiv=$('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all ui-helper-hidden-accessible"></div>');this.dpDiv.css({display:"none"});}$.extend(Datepicker.prototype,{markerClassName:"hasDatepicker",log:function(){if(this.debug){console.log.apply("",arguments);}},setDefaults:function(settings){extendRemove(this._defaults,settings||{});return this;},_attachDatepicker:function(target,settings){var inlineSettings=null;for(var attrName in this._defaults){var attrValue=target.getAttribute("date:"+attrName);if(attrValue){inlineSettings=inlineSettings||{};try{inlineSettings[attrName]=eval(attrValue);}catch(err){inlineSettings[attrName]=attrValue;}}}var nodeName=target.nodeName.toLowerCase();var inline=(nodeName=="div"||nodeName=="span");if(!target.id){target.id="dp"+(++this.uuid);}var inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{},inlineSettings||{});if(nodeName=="input"){this._connectDatepicker(target,inst);}else{if(inline){this._inlineDatepicker(target,inst);}}},_newInst:function(target,inline){var id=target[0].id.replace(/([:\[\]\.])/g,"\\\\$1");return{id:id,input:target,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:inline,dpDiv:(!inline?this.dpDiv:$('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))};},_connectDatepicker:function(target,inst){var input=$(target);inst.append=$([]);inst.trigger=$([]);if(input.hasClass(this.markerClassName)){return;}var appendText=this._get(inst,"appendText");var isRTL=this._get(inst,"isRTL");if(appendText){inst.append=$('<span class="'+this._appendClass+'">'+appendText+"</span>");input[isRTL?"before":"after"](inst.append);}var showOn=this._get(inst,"showOn");if(showOn=="focus"||showOn=="both"){input.focus(this._showDatepicker);}if(showOn=="button"||showOn=="both"){var buttonText=this._get(inst,"buttonText");var buttonImage=this._get(inst,"buttonImage");inst.trigger=$(this._get(inst,"buttonImageOnly")?$("<img/>").addClass(this._triggerClass).attr({src:buttonImage,alt:buttonText,title:buttonText}):$('<button type="button"></button>').addClass(this._triggerClass).html(buttonImage==""?buttonText:$("<img/>").attr({src:buttonImage,alt:buttonText,title:buttonText})));input[isRTL?"before":"after"](inst.trigger);inst.trigger.click(function(){if($.datepicker._datepickerShowing&&$.datepicker._lastInput==target){$.datepicker._hideDatepicker();}else{$.datepicker._showDatepicker(target);}return false;});}input.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).bind("setData.datepicker",function(event,key,value){inst.settings[key]=value;}).bind("getData.datepicker",function(event,key){return this._get(inst,key);});$.data(target,PROP_NAME,inst);},_inlineDatepicker:function(target,inst){var divSpan=$(target);if(divSpan.hasClass(this.markerClassName)){return;}divSpan.addClass(this.markerClassName).append(inst.dpDiv).bind("setData.datepicker",function(event,key,value){inst.settings[key]=value;}).bind("getData.datepicker",function(event,key){return this._get(inst,key);});$.data(target,PROP_NAME,inst);this._setDate(inst,this._getDefaultDate(inst));this._updateDatepicker(inst);this._updateAlternate(inst);},_dialogDatepicker:function(input,dateText,onSelect,settings,pos){var inst=this._dialogInst;if(!inst){var id="dp"+(++this.uuid);this._dialogInput=$('<input type="text" id="'+id+'" size="1" style="position: absolute; top: -100px;"/>');this._dialogInput.keydown(this._doKeyDown);$("body").append(this._dialogInput);inst=this._dialogInst=this._newInst(this._dialogInput,false);inst.settings={};$.data(this._dialogInput[0],PROP_NAME,inst);}extendRemove(inst.settings,settings||{});this._dialogInput.val(dateText);this._pos=(pos?(pos.length?pos:[pos.pageX,pos.pageY]):null);if(!this._pos){var browserWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;var browserHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;var scrollX=document.documentElement.scrollLeft||document.body.scrollLeft;var scrollY=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[(browserWidth/2)-100+scrollX,(browserHeight/2)-150+scrollY];}this._dialogInput.css("left",this._pos[0]+"px").css("top",this._pos[1]+"px");inst.settings.onSelect=onSelect;this._inDialog=true;this.dpDiv.addClass(this._dialogClass);this._showDatepicker(this._dialogInput[0]);if($.blockUI){$.blockUI(this.dpDiv);}$.data(this._dialogInput[0],PROP_NAME,inst);return this;},_destroyDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return;}var nodeName=target.nodeName.toLowerCase();$.removeData(target,PROP_NAME);if(nodeName=="input"){inst.append.remove();inst.trigger.remove();$target.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress);}else{if(nodeName=="div"||nodeName=="span"){$target.removeClass(this.markerClassName).empty();}}},_enableDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return;}var nodeName=target.nodeName.toLowerCase();if(nodeName=="input"){target.disabled=false;inst.trigger.filter("button").each(function(){this.disabled=false;}).end().filter("img").css({opacity:"1.0",cursor:""});}else{if(nodeName=="div"||nodeName=="span"){var inline=$target.children("."+this._inlineClass);inline.children().removeClass("ui-state-disabled");}}this._disabledInputs=$.map(this._disabledInputs,function(value){return(value==target?null:value);});},_disableDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return;}var nodeName=target.nodeName.toLowerCase();if(nodeName=="input"){target.disabled=true;inst.trigger.filter("button").each(function(){this.disabled=true;}).end().filter("img").css({opacity:"0.5",cursor:"default"});}else{if(nodeName=="div"||nodeName=="span"){var inline=$target.children("."+this._inlineClass);inline.children().addClass("ui-state-disabled");}}this._disabledInputs=$.map(this._disabledInputs,function(value){return(value==target?null:value);});this._disabledInputs[this._disabledInputs.length]=target;},_isDisabledDatepicker:function(target){if(!target){return false;}for(var i=0;i<this._disabledInputs.length;i++){if(this._disabledInputs[i]==target){return true;}}return false;},_getInst:function(target){try{return $.data(target,PROP_NAME);}catch(err){throw"Missing instance data for this datepicker";}},_optionDatepicker:function(target,name,value){var inst=this._getInst(target);if(arguments.length==2&&typeof name=="string"){return(name=="defaults"?$.extend({},$.datepicker._defaults):(inst?(name=="all"?$.extend({},inst.settings):this._get(inst,name)):null));}var settings=name||{};if(typeof name=="string"){settings={};settings[name]=value;}if(inst){if(this._curInst==inst){this._hideDatepicker(null);}var date=this._getDateDatepicker(target);extendRemove(inst.settings,settings);this._setDateDatepicker(target,date);this._updateDatepicker(inst);}},_changeDatepicker:function(target,name,value){this._optionDatepicker(target,name,value);},_refreshDatepicker:function(target){var inst=this._getInst(target);if(inst){this._updateDatepicker(inst);}},_setDateDatepicker:function(target,date,endDate){var inst=this._getInst(target);if(inst){this._setDate(inst,date,endDate);this._updateDatepicker(inst);this._updateAlternate(inst);}},_getDateDatepicker:function(target){var inst=this._getInst(target);if(inst&&!inst.inline){this._setDateFromField(inst);}return(inst?this._getDate(inst):null);},_doKeyDown:function(event){var inst=$.datepicker._getInst(event.target);var handled=true;var isRTL=inst.dpDiv.is(".ui-datepicker-rtl");inst._keyEvent=true;if($.datepicker._datepickerShowing){switch(event.keyCode){case 9:$.datepicker._hideDatepicker(null,"");break;case 13:var sel=$("td."+$.datepicker._dayOverClass+", td."+$.datepicker._currentClass,inst.dpDiv);if(sel[0]){$.datepicker._selectDay(event.target,inst.selectedMonth,inst.selectedYear,sel[0]);}else{$.datepicker._hideDatepicker(null,$.datepicker._get(inst,"duration"));}return false;break;case 27:$.datepicker._hideDatepicker(null,$.datepicker._get(inst,"duration"));break;case 33:$.datepicker._adjustDate(event.target,(event.ctrlKey?-$.datepicker._get(inst,"stepBigMonths"):-$.datepicker._get(inst,"stepMonths")),"M");break;case 34:$.datepicker._adjustDate(event.target,(event.ctrlKey?+$.datepicker._get(inst,"stepBigMonths"):+$.datepicker._get(inst,"stepMonths")),"M");break;case 35:if(event.ctrlKey||event.metaKey){$.datepicker._clearDate(event.target);}handled=event.ctrlKey||event.metaKey;break;case 36:if(event.ctrlKey||event.metaKey){$.datepicker._gotoToday(event.target);}handled=event.ctrlKey||event.metaKey;break;case 37:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,(isRTL?+1:-1),"D");}handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey){$.datepicker._adjustDate(event.target,(event.ctrlKey?-$.datepicker._get(inst,"stepBigMonths"):-$.datepicker._get(inst,"stepMonths")),"M");}break;case 38:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,-7,"D");}handled=event.ctrlKey||event.metaKey;break;case 39:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,(isRTL?-1:+1),"D");}handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey){$.datepicker._adjustDate(event.target,(event.ctrlKey?+$.datepicker._get(inst,"stepBigMonths"):+$.datepicker._get(inst,"stepMonths")),"M");}break;case 40:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,+7,"D");}handled=event.ctrlKey||event.metaKey;break;default:handled=false;}}else{if(event.keyCode==36&&event.ctrlKey){$.datepicker._showDatepicker(this);}else{handled=false;}}if(handled){event.preventDefault();event.stopPropagation();}},_doKeyPress:function(event){var inst=$.datepicker._getInst(event.target);if($.datepicker._get(inst,"constrainInput")){var chars=$.datepicker._possibleChars($.datepicker._get(inst,"dateFormat"));var chr=String.fromCharCode(event.charCode==undefined?event.keyCode:event.charCode);return event.ctrlKey||(chr<" "||!chars||chars.indexOf(chr)>-1);}},_showDatepicker:function(input){input=input.target||input;if(input.nodeName.toLowerCase()!="input"){input=$("input",input.parentNode)[0];}if($.datepicker._isDisabledDatepicker(input)||$.datepicker._lastInput==input){return;}var inst=$.datepicker._getInst(input);var beforeShow=$.datepicker._get(inst,"beforeShow");extendRemove(inst.settings,(beforeShow?beforeShow.apply(input,[input,inst]):{}));$.datepicker._hideDatepicker(null,"");$.datepicker._lastInput=input;$.datepicker._setDateFromField(inst);if($.datepicker._inDialog){input.value="";}if(!$.datepicker._pos){$.datepicker._pos=$.datepicker._findPos(input);$.datepicker._pos[1]+=input.offsetHeight;}var isFixed=false;$(input).parents().each(function(){isFixed|=$(this).css("position")=="fixed";return !isFixed;});if(isFixed&&$.browser.opera){$.datepicker._pos[0]-=document.documentElement.scrollLeft;$.datepicker._pos[1]-=document.documentElement.scrollTop;}var offset={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};$.datepicker._pos=null;inst.rangeStart=null;inst.dpDiv.css({position:"absolute","z-index":10000,display:"block",top:"-1000px"});$.datepicker._updateDatepicker(inst);offset=$.datepicker._checkOffset(inst,offset,isFixed);inst.dpDiv.css({position:($.datepicker._inDialog&&$.blockUI?"static":(isFixed?"fixed":"absolute")),display:"none",left:offset.left+"px",top:offset.top+"px"});if(!inst.inline){var showAnim=$.datepicker._get(inst,"showAnim")||"show";var duration=$.datepicker._get(inst,"duration");var postProcess=function(){$.datepicker._datepickerShowing=true;if($.browser.msie&&parseInt($.browser.version,10)<7){$("iframe.ui-datepicker-cover").css({width:inst.dpDiv.width()+4,height:inst.dpDiv.height()+4});}};if($.effects&&$.effects[showAnim]){inst.dpDiv.show(showAnim,$.datepicker._get(inst,"showOptions"),duration,postProcess);}else{inst.dpDiv[showAnim](duration,postProcess);}if(duration==""){postProcess();}if(inst.input[0].type!="hidden"){inst.input[0].focus();}$.datepicker._curInst=inst;}},_updateDatepicker:function(inst){var dims={width:inst.dpDiv.width()+4,height:inst.dpDiv.height()+4};var self=this;inst.dpDiv.empty().append(this._generateHTML(inst)).find("iframe.ui-datepicker-cover").css({width:dims.width,height:dims.height}).end().find("button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a").bind("mouseout",function(){$(this).removeClass("ui-state-hover");if(this.className.indexOf("ui-datepicker-prev")!=-1){$(this).removeClass("ui-datepicker-prev-hover");}if(this.className.indexOf("ui-datepicker-next")!=-1){$(this).removeClass("ui-datepicker-next-hover");}}).bind("mouseover",function(){if(!self._isDisabledDatepicker(inst.inline?inst.dpDiv.parent()[0]:inst.input[0])){$(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover");$(this).addClass("ui-state-hover");if(this.className.indexOf("ui-datepicker-prev")!=-1){$(this).addClass("ui-datepicker-prev-hover");}if(this.className.indexOf("ui-datepicker-next")!=-1){$(this).addClass("ui-datepicker-next-hover");}}}).end().find("."+this._dayOverClass+" a").trigger("mouseover").end();var numMonths=this._getNumberOfMonths(inst);var cols=numMonths[1];var width=17;if(cols>1){inst.dpDiv.addClass("ui-datepicker-multi-"+cols).css("width",(width*cols)+"em");}else{inst.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width("");}inst.dpDiv[(numMonths[0]!=1||numMonths[1]!=1?"add":"remove")+"Class"]("ui-datepicker-multi");inst.dpDiv[(this._get(inst,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl");if(inst.input&&inst.input[0].type!="hidden"&&inst==$.datepicker._curInst){$(inst.input[0]).focus();}},_checkOffset:function(inst,offset,isFixed){var dpWidth=inst.dpDiv.outerWidth();var dpHeight=inst.dpDiv.outerHeight();var inputWidth=inst.input?inst.input.outerWidth():0;var inputHeight=inst.input?inst.input.outerHeight():0;var viewWidth=(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)+$(document).scrollLeft();var viewHeight=(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)+$(document).scrollTop();offset.left-=(this._get(inst,"isRTL")?(dpWidth-inputWidth):0);offset.left-=(isFixed&&offset.left==inst.input.offset().left)?$(document).scrollLeft():0;offset.top-=(isFixed&&offset.top==(inst.input.offset().top+inputHeight))?$(document).scrollTop():0;offset.left-=(offset.left+dpWidth>viewWidth&&viewWidth>dpWidth)?Math.abs(offset.left+dpWidth-viewWidth):0;offset.top-=(offset.top+dpHeight>viewHeight&&viewHeight>dpHeight)?Math.abs(offset.top+dpHeight+inputHeight*2-viewHeight):0;return offset;},_findPos:function(obj){while(obj&&(obj.type=="hidden"||obj.nodeType!=1)){obj=obj.nextSibling;}var position=$(obj).offset();return[position.left,position.top];},_hideDatepicker:function(input,duration){var inst=this._curInst;if(!inst||(input&&inst!=$.data(input,PROP_NAME))){return;}if(inst.stayOpen){this._selectDate("#"+inst.id,this._formatDate(inst,inst.currentDay,inst.currentMonth,inst.currentYear));}inst.stayOpen=false;if(this._datepickerShowing){duration=(duration!=null?duration:this._get(inst,"duration"));var showAnim=this._get(inst,"showAnim");var postProcess=function(){$.datepicker._tidyDialog(inst);};if(duration!=""&&$.effects&&$.effects[showAnim]){inst.dpDiv.hide(showAnim,$.datepicker._get(inst,"showOptions"),duration,postProcess);}else{inst.dpDiv[(duration==""?"hide":(showAnim=="slideDown"?"slideUp":(showAnim=="fadeIn"?"fadeOut":"hide")))](duration,postProcess);}if(duration==""){this._tidyDialog(inst);}var onClose=this._get(inst,"onClose");if(onClose){onClose.apply((inst.input?inst.input[0]:null),[(inst.input?inst.input.val():""),inst]);}this._datepickerShowing=false;this._lastInput=null;if(this._inDialog){this._dialogInput.css({position:"absolute",left:"0",top:"-100px"});if($.blockUI){$.unblockUI();$("body").append(this.dpDiv);}}this._inDialog=false;}this._curInst=null;},_tidyDialog:function(inst){inst.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar");},_checkExternalClick:function(event){if(!$.datepicker._curInst){return;}var $target=$(event.target);if(($target.parents("#"+$.datepicker._mainDivId).length==0)&&!$target.hasClass($.datepicker.markerClassName)&&!$target.hasClass($.datepicker._triggerClass)&&$.datepicker._datepickerShowing&&!($.datepicker._inDialog&&$.blockUI)){$.datepicker._hideDatepicker(null,"");}},_adjustDate:function(id,offset,period){var target=$(id);var inst=this._getInst(target[0]);if(this._isDisabledDatepicker(target[0])){return;}this._adjustInstDate(inst,offset+(period=="M"?this._get(inst,"showCurrentAtPos"):0),period);this._updateDatepicker(inst);},_gotoToday:function(id){var target=$(id);var inst=this._getInst(target[0]);if(this._get(inst,"gotoCurrent")&&inst.currentDay){inst.selectedDay=inst.currentDay;inst.drawMonth=inst.selectedMonth=inst.currentMonth;inst.drawYear=inst.selectedYear=inst.currentYear;}else{var date=new Date();inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();}this._notifyChange(inst);this._adjustDate(target);},_selectMonthYear:function(id,select,period){var target=$(id);var inst=this._getInst(target[0]);inst._selectingMonthYear=false;inst["selected"+(period=="M"?"Month":"Year")]=inst["draw"+(period=="M"?"Month":"Year")]=parseInt(select.options[select.selectedIndex].value,10);this._notifyChange(inst);this._adjustDate(target);},_clickMonthYear:function(id){var target=$(id);var inst=this._getInst(target[0]);if(inst.input&&inst._selectingMonthYear&&!$.browser.msie){inst.input[0].focus();}inst._selectingMonthYear=!inst._selectingMonthYear;},_selectDay:function(id,month,year,td){var target=$(id);if($(td).hasClass(this._unselectableClass)||this._isDisabledDatepicker(target[0])){return;}var inst=this._getInst(target[0]);inst.selectedDay=inst.currentDay=$("a",td).html();inst.selectedMonth=inst.currentMonth=month;inst.selectedYear=inst.currentYear=year;if(inst.stayOpen){inst.endDay=inst.endMonth=inst.endYear=null;}this._selectDate(id,this._formatDate(inst,inst.currentDay,inst.currentMonth,inst.currentYear));if(inst.stayOpen){inst.rangeStart=this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay));this._updateDatepicker(inst);}},_clearDate:function(id){var target=$(id);var inst=this._getInst(target[0]);inst.stayOpen=false;inst.endDay=inst.endMonth=inst.endYear=inst.rangeStart=null;this._selectDate(target,"");},_selectDate:function(id,dateStr){var target=$(id);var inst=this._getInst(target[0]);dateStr=(dateStr!=null?dateStr:this._formatDate(inst));if(inst.input){inst.input.val(dateStr);}this._updateAlternate(inst);var onSelect=this._get(inst,"onSelect");if(onSelect){onSelect.apply((inst.input?inst.input[0]:null),[dateStr,inst]);}else{if(inst.input){inst.input.trigger("change");}}if(inst.inline){this._updateDatepicker(inst);}else{if(!inst.stayOpen){this._hideDatepicker(null,this._get(inst,"duration"));this._lastInput=inst.input[0];if(typeof(inst.input[0])!="object"){inst.input[0].focus();}this._lastInput=null;}}},_updateAlternate:function(inst){var altField=this._get(inst,"altField");if(altField){var altFormat=this._get(inst,"altFormat")||this._get(inst,"dateFormat");var date=this._getDate(inst);dateStr=this.formatDate(altFormat,date,this._getFormatConfig(inst));$(altField).each(function(){$(this).val(dateStr);});}},noWeekends:function(date){var day=date.getDay();return[(day>0&&day<6),""];},iso8601Week:function(date){var checkDate=new Date(date.getFullYear(),date.getMonth(),date.getDate());var firstMon=new Date(checkDate.getFullYear(),1-1,4);var firstDay=firstMon.getDay()||7;firstMon.setDate(firstMon.getDate()+1-firstDay);if(firstDay<4&&checkDate<firstMon){checkDate.setDate(checkDate.getDate()-3);return $.datepicker.iso8601Week(checkDate);}else{if(checkDate>new Date(checkDate.getFullYear(),12-1,28)){firstDay=new Date(checkDate.getFullYear()+1,1-1,4).getDay()||7;if(firstDay>4&&(checkDate.getDay()||7)<firstDay-3){return 1;}}}return Math.floor(((checkDate-firstMon)/86400000)/7)+1;},parseDate:function(format,value,settings){if(format==null||value==null){throw"Invalid arguments";}value=(typeof value=="object"?value.toString():value+"");if(value==""){return null;}var shortYearCutoff=(settings?settings.shortYearCutoff:null)||this._defaults.shortYearCutoff;var dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort;var dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames;var monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort;var monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames;var year=-1;var month=-1;var day=-1;var doy=-1;var literal=false;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches){iFormat++;}return matches;};var getNumber=function(match){lookAhead(match);var origSize=(match=="@"?14:(match=="y"?4:(match=="o"?3:2)));var size=origSize;var num=0;while(size>0&&iValue<value.length&&value.charAt(iValue)>="0"&&value.charAt(iValue)<="9"){num=num*10+parseInt(value.charAt(iValue++),10);size--;}if(size==origSize){throw"Missing number at position "+iValue;}return num;};var getName=function(match,shortNames,longNames){var names=(lookAhead(match)?longNames:shortNames);var size=0;for(var j=0;j<names.length;j++){size=Math.max(size,names[j].length);}var name="";var iInit=iValue;while(size>0&&iValue<value.length){name+=value.charAt(iValue++);for(var i=0;i<names.length;i++){if(name==names[i]){return i+1;}}size--;}throw"Unknown name at position "+iInit;};var checkLiteral=function(){if(value.charAt(iValue)!=format.charAt(iFormat)){throw"Unexpected literal at position "+iValue;}iValue++;};var iValue=0;for(var iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)=="'"&&!lookAhead("'")){literal=false;}else{checkLiteral();}}else{switch(format.charAt(iFormat)){case"d":day=getNumber("d");break;case"D":getName("D",dayNamesShort,dayNames);break;case"o":doy=getNumber("o");break;case"m":month=getNumber("m");break;case"M":month=getName("M",monthNamesShort,monthNames);break;case"y":year=getNumber("y");break;case"@":var date=new Date(getNumber("@"));year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case"'":if(lookAhead("'")){checkLiteral();}else{literal=true;}break;default:checkLiteral();}}}if(year==-1){year=new Date().getFullYear();}else{if(year<100){year+=new Date().getFullYear()-new Date().getFullYear()%100+(year<=shortYearCutoff?0:-100);}}if(doy>-1){month=1;day=doy;do{var dim=this._getDaysInMonth(year,month-1);if(day<=dim){break;}month++;day-=dim;}while(true);}var date=this._daylightSavingAdjust(new Date(year,month-1,day));if(date.getFullYear()!=year||date.getMonth()+1!=month||date.getDate()!=day){throw"Invalid date";}return date;},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TIMESTAMP:"@",W3C:"yy-mm-dd",formatDate:function(format,date,settings){if(!date){return"";}var dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort;var dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames;var monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort;var monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches){iFormat++;}return matches;};var formatNumber=function(match,value,len){var num=""+value;if(lookAhead(match)){while(num.length<len){num="0"+num;}}return num;};var formatName=function(match,value,shortNames,longNames){return(lookAhead(match)?longNames[value]:shortNames[value]);};var output="";var literal=false;if(date){for(var iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)=="'"&&!lookAhead("'")){literal=false;}else{output+=format.charAt(iFormat);}}else{switch(format.charAt(iFormat)){case"d":output+=formatNumber("d",date.getDate(),2);break;case"D":output+=formatName("D",date.getDay(),dayNamesShort,dayNames);break;case"o":var doy=date.getDate();for(var m=date.getMonth()-1;m>=0;m--){doy+=this._getDaysInMonth(date.getFullYear(),m);}output+=formatNumber("o",doy,3);break;case"m":output+=formatNumber("m",date.getMonth()+1,2);break;case"M":output+=formatName("M",date.getMonth(),monthNamesShort,monthNames);break;case"y":output+=(lookAhead("y")?date.getFullYear():(date.getYear()%100<10?"0":"")+date.getYear()%100);break;case"@":output+=date.getTime();break;case"'":if(lookAhead("'")){output+="'";}else{literal=true;}break;default:output+=format.charAt(iFormat);}}}}return output;},_possibleChars:function(format){var chars="";var literal=false;for(var iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)=="'"&&!lookAhead("'")){literal=false;}else{chars+=format.charAt(iFormat);}}else{switch(format.charAt(iFormat)){case"d":case"m":case"y":case"@":chars+="0123456789";break;case"D":case"M":return null;case"'":if(lookAhead("'")){chars+="'";}else{literal=true;}break;default:chars+=format.charAt(iFormat);}}}return chars;},_get:function(inst,name){return inst.settings[name]!==undefined?inst.settings[name]:this._defaults[name];},_setDateFromField:function(inst){var dateFormat=this._get(inst,"dateFormat");var dates=inst.input?inst.input.val():null;inst.endDay=inst.endMonth=inst.endYear=null;var date=defaultDate=this._getDefaultDate(inst);var settings=this._getFormatConfig(inst);try{date=this.parseDate(dateFormat,dates,settings)||defaultDate;}catch(event){this.log(event);date=defaultDate;}inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();inst.currentDay=(dates?date.getDate():0);inst.currentMonth=(dates?date.getMonth():0);inst.currentYear=(dates?date.getFullYear():0);this._adjustInstDate(inst);},_getDefaultDate:function(inst){var date=this._determineDate(this._get(inst,"defaultDate"),new Date());var minDate=this._getMinMaxDate(inst,"min",true);var maxDate=this._getMinMaxDate(inst,"max");date=(minDate&&date<minDate?minDate:date);date=(maxDate&&date>maxDate?maxDate:date);return date;},_determineDate:function(date,defaultDate){var offsetNumeric=function(offset){var date=new Date();date.setDate(date.getDate()+offset);return date;};var offsetString=function(offset,getDaysInMonth){var date=new Date();var year=date.getFullYear();var month=date.getMonth();var day=date.getDate();var pattern=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g;var matches=pattern.exec(offset);while(matches){switch(matches[2]||"d"){case"d":case"D":day+=parseInt(matches[1],10);break;case"w":case"W":day+=parseInt(matches[1],10)*7;break;case"m":case"M":month+=parseInt(matches[1],10);day=Math.min(day,getDaysInMonth(year,month));break;case"y":case"Y":year+=parseInt(matches[1],10);day=Math.min(day,getDaysInMonth(year,month));break;}matches=pattern.exec(offset);}return new Date(year,month,day);};date=(date==null?defaultDate:(typeof date=="string"?offsetString(date,this._getDaysInMonth):(typeof date=="number"?(isNaN(date)?defaultDate:offsetNumeric(date)):date)));date=(date&&date.toString()=="Invalid Date"?defaultDate:date);if(date){date.setHours(0);date.setMinutes(0);date.setSeconds(0);date.setMilliseconds(0);}return this._daylightSavingAdjust(date);},_daylightSavingAdjust:function(date){if(!date){return null;}date.setHours(date.getHours()>12?date.getHours()+2:0);return date;},_setDate:function(inst,date,endDate){var clear=!(date);var origMonth=inst.selectedMonth;var origYear=inst.selectedYear;date=this._determineDate(date,new Date());inst.selectedDay=inst.currentDay=date.getDate();inst.drawMonth=inst.selectedMonth=inst.currentMonth=date.getMonth();inst.drawYear=inst.selectedYear=inst.currentYear=date.getFullYear();if(origMonth!=inst.selectedMonth||origYear!=inst.selectedYear){this._notifyChange(inst);}this._adjustInstDate(inst);if(inst.input){inst.input.val(clear?"":this._formatDate(inst));}},_getDate:function(inst){var startDate=(!inst.currentYear||(inst.input&&inst.input.val()=="")?null:this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));return startDate;},_generateHTML:function(inst){var today=new Date();today=this._daylightSavingAdjust(new Date(today.getFullYear(),today.getMonth(),today.getDate()));var isRTL=this._get(inst,"isRTL");var showButtonPanel=this._get(inst,"showButtonPanel");var hideIfNoPrevNext=this._get(inst,"hideIfNoPrevNext");var navigationAsDateFormat=this._get(inst,"navigationAsDateFormat");var numMonths=this._getNumberOfMonths(inst);var showCurrentAtPos=this._get(inst,"showCurrentAtPos");var stepMonths=this._get(inst,"stepMonths");var stepBigMonths=this._get(inst,"stepBigMonths");var isMultiMonth=(numMonths[0]!=1||numMonths[1]!=1);var currentDate=this._daylightSavingAdjust((!inst.currentDay?new Date(9999,9,9):new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));var minDate=this._getMinMaxDate(inst,"min",true);var maxDate=this._getMinMaxDate(inst,"max");var drawMonth=inst.drawMonth-showCurrentAtPos;var drawYear=inst.drawYear;if(drawMonth<0){drawMonth+=12;drawYear--;}if(maxDate){var maxDraw=this._daylightSavingAdjust(new Date(maxDate.getFullYear(),maxDate.getMonth()-numMonths[1]+1,maxDate.getDate()));maxDraw=(minDate&&maxDraw<minDate?minDate:maxDraw);while(this._daylightSavingAdjust(new Date(drawYear,drawMonth,1))>maxDraw){drawMonth--;if(drawMonth<0){drawMonth=11;drawYear--;}}}inst.drawMonth=drawMonth;inst.drawYear=drawYear;var prevText=this._get(inst,"prevText");prevText=(!navigationAsDateFormat?prevText:this.formatDate(prevText,this._daylightSavingAdjust(new Date(drawYear,drawMonth-stepMonths,1)),this._getFormatConfig(inst)));var prev=(this._canAdjustMonth(inst,-1,drawYear,drawMonth)?'<a class="ui-datepicker-prev ui-corner-all" onclick="DP_jQuery.datepicker._adjustDate(\'#'+inst.id+"', -"+stepMonths+", 'M');\""+' title="'+prevText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?"e":"w")+'">'+prevText+"</span></a>":(hideIfNoPrevNext?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+prevText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?"e":"w")+'">'+prevText+"</span></a>"));var nextText=this._get(inst,"nextText");nextText=(!navigationAsDateFormat?nextText:this.formatDate(nextText,this._daylightSavingAdjust(new Date(drawYear,drawMonth+stepMonths,1)),this._getFormatConfig(inst)));var next=(this._canAdjustMonth(inst,+1,drawYear,drawMonth)?'<a class="ui-datepicker-next ui-corner-all" onclick="DP_jQuery.datepicker._adjustDate(\'#'+inst.id+"', +"+stepMonths+", 'M');\""+' title="'+nextText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?"w":"e")+'">'+nextText+"</span></a>":(hideIfNoPrevNext?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+nextText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?"w":"e")+'">'+nextText+"</span></a>"));var currentText=this._get(inst,"currentText");var gotoDate=(this._get(inst,"gotoCurrent")&&inst.currentDay?currentDate:today);currentText=(!navigationAsDateFormat?currentText:this.formatDate(currentText,gotoDate,this._getFormatConfig(inst)));var controls=(!inst.inline?'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" onclick="DP_jQuery.datepicker._hideDatepicker();">'+this._get(inst,"closeText")+"</button>":"");var buttonPanel=(showButtonPanel)?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(isRTL?controls:"")+(this._isInRange(inst,gotoDate)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" onclick="DP_jQuery.datepicker._gotoToday(\'#'+inst.id+"');\""+">"+currentText+"</button>":"")+(isRTL?"":controls)+"</div>":"";var firstDay=parseInt(this._get(inst,"firstDay"),10);firstDay=(isNaN(firstDay)?0:firstDay);var dayNames=this._get(inst,"dayNames");var dayNamesShort=this._get(inst,"dayNamesShort");var dayNamesMin=this._get(inst,"dayNamesMin");var monthNames=this._get(inst,"monthNames");var monthNamesShort=this._get(inst,"monthNamesShort");var beforeShowDay=this._get(inst,"beforeShowDay");var showOtherMonths=this._get(inst,"showOtherMonths");var calculateWeek=this._get(inst,"calculateWeek")||this.iso8601Week;var endDate=inst.endDay?this._daylightSavingAdjust(new Date(inst.endYear,inst.endMonth,inst.endDay)):currentDate;var defaultDate=this._getDefaultDate(inst);var html="";for(var row=0;row<numMonths[0];row++){var group="";for(var col=0;col<numMonths[1];col++){var selectedDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,inst.selectedDay));var cornerClass=" ui-corner-all";var calender="";if(isMultiMonth){calender+='<div class="ui-datepicker-group ui-datepicker-group-';switch(col){case 0:calender+="first";cornerClass=" ui-corner-"+(isRTL?"right":"left");break;case numMonths[1]-1:calender+="last";cornerClass=" ui-corner-"+(isRTL?"left":"right");break;default:calender+="middle";cornerClass="";break;}calender+='">';}calender+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+cornerClass+'">'+(/all|left/.test(cornerClass)&&row==0?(isRTL?next:prev):"")+(/all|right/.test(cornerClass)&&row==0?(isRTL?prev:next):"")+this._generateMonthYearHeader(inst,drawMonth,drawYear,minDate,maxDate,selectedDate,row>0||col>0,monthNames,monthNamesShort)+'</div><table class="ui-datepicker-calendar"><thead>'+"<tr>";var thead="";for(var dow=0;dow<7;dow++){var day=(dow+firstDay)%7;thead+="<th"+((dow+firstDay+6)%7>=5?' class="ui-datepicker-week-end"':"")+">"+'<span title="'+dayNames[day]+'">'+dayNamesMin[day]+"</span></th>";}calender+=thead+"</tr></thead><tbody>";var daysInMonth=this._getDaysInMonth(drawYear,drawMonth);if(drawYear==inst.selectedYear&&drawMonth==inst.selectedMonth){inst.selectedDay=Math.min(inst.selectedDay,daysInMonth);}var leadDays=(this._getFirstDayOfMonth(drawYear,drawMonth)-firstDay+7)%7;var numRows=(isMultiMonth?6:Math.ceil((leadDays+daysInMonth)/7));var printDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,1-leadDays));for(var dRow=0;dRow<numRows;dRow++){calender+="<tr>";var tbody="";for(var dow=0;dow<7;dow++){var daySettings=(beforeShowDay?beforeShowDay.apply((inst.input?inst.input[0]:null),[printDate]):[true,""]);var otherMonth=(printDate.getMonth()!=drawMonth);var unselectable=otherMonth||!daySettings[0]||(minDate&&printDate<minDate)||(maxDate&&printDate>maxDate);tbody+='<td class="'+((dow+firstDay+6)%7>=5?" ui-datepicker-week-end":"")+(otherMonth?" ui-datepicker-other-month":"")+((printDate.getTime()==selectedDate.getTime()&&drawMonth==inst.selectedMonth&&inst._keyEvent)||(defaultDate.getTime()==printDate.getTime()&&defaultDate.getTime()==selectedDate.getTime())?" "+this._dayOverClass:"")+(unselectable?" "+this._unselectableClass+" ui-state-disabled":"")+(otherMonth&&!showOtherMonths?"":" "+daySettings[1]+(printDate.getTime()>=currentDate.getTime()&&printDate.getTime()<=endDate.getTime()?" "+this._currentClass:"")+(printDate.getTime()==today.getTime()?" ui-datepicker-today":""))+'"'+((!otherMonth||showOtherMonths)&&daySettings[2]?' title="'+daySettings[2]+'"':"")+(unselectable?"":" onclick=\"DP_jQuery.datepicker._selectDay('#"+inst.id+"',"+drawMonth+","+drawYear+', this);return false;"')+">"+(otherMonth?(showOtherMonths?printDate.getDate():"&#xa0;"):(unselectable?'<span class="ui-state-default">'+printDate.getDate()+"</span>":'<a class="ui-state-default'+(printDate.getTime()==today.getTime()?" ui-state-highlight":"")+(printDate.getTime()>=currentDate.getTime()&&printDate.getTime()<=endDate.getTime()?" ui-state-active":"")+'" href="#">'+printDate.getDate()+"</a>"))+"</td>";printDate.setDate(printDate.getDate()+1);printDate=this._daylightSavingAdjust(printDate);}calender+=tbody+"</tr>";}drawMonth++;if(drawMonth>11){drawMonth=0;drawYear++;}calender+="</tbody></table>"+(isMultiMonth?"</div>"+((numMonths[0]>0&&col==numMonths[1]-1)?'<div class="ui-datepicker-row-break"></div>':""):"");group+=calender;}html+=group;}html+=buttonPanel+($.browser.msie&&parseInt($.browser.version,10)<7&&!inst.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':"");inst._keyEvent=false;return html;},_generateMonthYearHeader:function(inst,drawMonth,drawYear,minDate,maxDate,selectedDate,secondary,monthNames,monthNamesShort){minDate=(inst.rangeStart&&minDate&&selectedDate<minDate?selectedDate:minDate);var changeMonth=this._get(inst,"changeMonth");var changeYear=this._get(inst,"changeYear");var showMonthAfterYear=this._get(inst,"showMonthAfterYear");var html='<div class="ui-datepicker-title">';var monthHtml="";if(secondary||!changeMonth){monthHtml+='<span class="ui-datepicker-month">'+monthNames[drawMonth]+"</span> ";}else{var inMinYear=(minDate&&minDate.getFullYear()==drawYear);var inMaxYear=(maxDate&&maxDate.getFullYear()==drawYear);monthHtml+='<select class="ui-datepicker-month" '+"onchange=\"DP_jQuery.datepicker._selectMonthYear('#"+inst.id+"', this, 'M');\" "+"onclick=\"DP_jQuery.datepicker._clickMonthYear('#"+inst.id+"');\""+">";for(var month=0;month<12;month++){if((!inMinYear||month>=minDate.getMonth())&&(!inMaxYear||month<=maxDate.getMonth())){monthHtml+='<option value="'+month+'"'+(month==drawMonth?' selected="selected"':"")+">"+monthNamesShort[month]+"</option>";}}monthHtml+="</select>";}if(!showMonthAfterYear){html+=monthHtml+((secondary||changeMonth||changeYear)&&(!(changeMonth&&changeYear))?"&#xa0;":"");}if(secondary||!changeYear){html+='<span class="ui-datepicker-year">'+drawYear+"</span>";}else{var years=this._get(inst,"yearRange").split(":");var year=0;var endYear=0;if(years.length!=2){year=drawYear-10;endYear=drawYear+10;}else{if(years[0].charAt(0)=="+"||years[0].charAt(0)=="-"){year=drawYear+parseInt(years[0],10);endYear=drawYear+parseInt(years[1],10);}else{year=parseInt(years[0],10);endYear=parseInt(years[1],10);}}year=(minDate?Math.max(year,minDate.getFullYear()):year);endYear=(maxDate?Math.min(endYear,maxDate.getFullYear()):endYear);html+='<select class="ui-datepicker-year" '+"onchange=\"DP_jQuery.datepicker._selectMonthYear('#"+inst.id+"', this, 'Y');\" "+"onclick=\"DP_jQuery.datepicker._clickMonthYear('#"+inst.id+"');\""+">";for(;year<=endYear;year++){html+='<option value="'+year+'"'+(year==drawYear?' selected="selected"':"")+">"+year+"</option>";}html+="</select>";}if(showMonthAfterYear){html+=(secondary||changeMonth||changeYear?"&#xa0;":"")+monthHtml;}html+="</div>";return html;},_adjustInstDate:function(inst,offset,period){var year=inst.drawYear+(period=="Y"?offset:0);var month=inst.drawMonth+(period=="M"?offset:0);var day=Math.min(inst.selectedDay,this._getDaysInMonth(year,month))+(period=="D"?offset:0);var date=this._daylightSavingAdjust(new Date(year,month,day));var minDate=this._getMinMaxDate(inst,"min",true);var maxDate=this._getMinMaxDate(inst,"max");date=(minDate&&date<minDate?minDate:date);date=(maxDate&&date>maxDate?maxDate:date);inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();if(period=="M"||period=="Y"){this._notifyChange(inst);}},_notifyChange:function(inst){var onChange=this._get(inst,"onChangeMonthYear");if(onChange){onChange.apply((inst.input?inst.input[0]:null),[inst.selectedYear,inst.selectedMonth+1,inst]);}},_getNumberOfMonths:function(inst){var numMonths=this._get(inst,"numberOfMonths");return(numMonths==null?[1,1]:(typeof numMonths=="number"?[1,numMonths]:numMonths));},_getMinMaxDate:function(inst,minMax,checkRange){var date=this._determineDate(this._get(inst,minMax+"Date"),null);return(!checkRange||!inst.rangeStart?date:(!date||inst.rangeStart>date?inst.rangeStart:date));},_getDaysInMonth:function(year,month){return 32-new Date(year,month,32).getDate();},_getFirstDayOfMonth:function(year,month){return new Date(year,month,1).getDay();},_canAdjustMonth:function(inst,offset,curYear,curMonth){var numMonths=this._getNumberOfMonths(inst);var date=this._daylightSavingAdjust(new Date(curYear,curMonth+(offset<0?offset:numMonths[1]),1));if(offset<0){date.setDate(this._getDaysInMonth(date.getFullYear(),date.getMonth()));}return this._isInRange(inst,date);},_isInRange:function(inst,date){var newMinDate=(!inst.rangeStart?null:this._daylightSavingAdjust(new Date(inst.selectedYear,inst.selectedMonth,inst.selectedDay)));newMinDate=(newMinDate&&inst.rangeStart<newMinDate?inst.rangeStart:newMinDate);var minDate=newMinDate||this._getMinMaxDate(inst,"min");var maxDate=this._getMinMaxDate(inst,"max");return((!minDate||date>=minDate)&&(!maxDate||date<=maxDate));},_getFormatConfig:function(inst){var shortYearCutoff=this._get(inst,"shortYearCutoff");shortYearCutoff=(typeof shortYearCutoff!="string"?shortYearCutoff:new Date().getFullYear()%100+parseInt(shortYearCutoff,10));return{shortYearCutoff:shortYearCutoff,dayNamesShort:this._get(inst,"dayNamesShort"),dayNames:this._get(inst,"dayNames"),monthNamesShort:this._get(inst,"monthNamesShort"),monthNames:this._get(inst,"monthNames")};},_formatDate:function(inst,day,month,year){if(!day){inst.currentDay=inst.selectedDay;inst.currentMonth=inst.selectedMonth;inst.currentYear=inst.selectedYear;}var date=(day?(typeof day=="object"?day:this._daylightSavingAdjust(new Date(year,month,day))):this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));return this.formatDate(this._get(inst,"dateFormat"),date,this._getFormatConfig(inst));}});function extendRemove(target,props){$.extend(target,props);for(var name in props){if(props[name]==null||props[name]==undefined){target[name]=props[name];}}return target;}function isArray(a){return(a&&(($.browser.safari&&typeof a=="object"&&a.length)||(a.constructor&&a.constructor.toString().match(/\Array\(\)/))));}$.fn.datepicker=function(options){if(!$.datepicker.initialized){$(document).mousedown($.datepicker._checkExternalClick).find("body").append($.datepicker.dpDiv);$.datepicker.initialized=true;}var otherArgs=Array.prototype.slice.call(arguments,1);if(typeof options=="string"&&(options=="isDisabled"||options=="getDate")){return $.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this[0]].concat(otherArgs));}if(options=="option"&&arguments.length==2&&typeof arguments[1]=="string"){return $.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this[0]].concat(otherArgs));}return this.each(function(){typeof options=="string"?$.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this].concat(otherArgs)):$.datepicker._attachDatepicker(this,options);});};$.datepicker=new Datepicker();$.datepicker.initialized=false;$.datepicker.uuid=new Date().getTime();$.datepicker.version="1.7.2";window.DP_jQuery=$;})(epiJQuery);(function($,epi){var resourceKey="EPiServer.Shell.UI.Resources.DatePicker";if(typeof require!=="undefined"){require(["epi/i18n!epi/shell/ui/nls/"+resourceKey,"dojo/domReady!"],function(res){epi.shell.resource.add(resourceKey,res);registerResources();});}else{epi.shell.registerInitFunction(registerResources);}function registerResources(){$.datepicker.regional[""]={closeText:epi.shell.resource.get(resourceKey,"closetext"),prevText:epi.shell.resource.get(resourceKey,"prevtext"),nextText:epi.shell.resource.get(resourceKey,"nexttext"),currentText:epi.shell.resource.get(resourceKey,"currenttext"),monthNames:epi.shell.resource.get(resourceKey,"monthnames").split(","),monthNamesShort:epi.shell.resource.get(resourceKey,"monthnamesshort").split(","),dayNames:epi.shell.resource.get(resourceKey,"daynames").split(","),dayNamesShort:epi.shell.resource.get(resourceKey,"daynamesshort").split(","),dayNamesMin:epi.shell.resource.get(resourceKey,"daynamesmin").split(","),dateFormat:epi.shell.resource.get(resourceKey,"dateformat"),firstDay:parseInt(epi.shell.resource.get(resourceKey,"firstday")),isRTL:epi.shell.resource.get(resourceKey,"isrtl")=="true"};$.datepicker.setDefaults($.datepicker.regional[""]);}})(epiJQuery,epi);var minDate=new Date("07/10/2010");var maxDate=new Date("10/18/2010");var previousRange;var dateFormat="dd.mm.yy";var parent;$.widget("ui.daterange",{_isVisible:false,_previousStartDate:null,_previousEndDate:null,_popup:null,_startViewElement:null,_endViewElement:null,_delimiterViewElement:null,_startDatePicker:null,_endDatePicker:null,_isDate:function(date){return(date&&"object"==typeof date)&&date.getMonth;},_setPosition:function(){var top=this.element.offset().top-$(this.options.popupParent).offset().top+$(this.options.popupParent).scrollTop()+this.element.innerHeight()+1;var left=this.element.offset().left-$(this.options.popupParent).offset().left+$(this.options.popupParent).scrollLeft();if(this.options.popupAlign=="right"){left+=this.element.outerWidth()-this._popup.outerWidth();}this._popup.css({"left":left,"top":top});},_updateView:function(){this._startViewElement.text($.datepicker.formatDate(this.options.viewDateFormat,this.options.startDate));this._endViewElement.text($.datepicker.formatDate(this.options.viewDateFormat,this.options.endDate));},_setDate:function(startDate,endDate){this.options.startDate=(this._isDate(startDate))?startDate:new Date();this._startDatePicker.datepicker("setDate",this.options.startDate).datepicker("show");this.options.endDate=(this._isDate(endDate))?endDate:new Date();this._endDatePicker.datepicker("setDate",this.options.endDate);},_init:function(){var _this=this;this.element.addClass("ui-daterange");this._startViewElement=$("<span></span>").appendTo(this.element).addClass("ui-daterange-startDate");this._delimiterViewElement=$("<span></span>").appendTo(this.element).addClass("ui-daterange-delimiter").text(this.options.delimiter);this._endViewElement=$("<span></span>").appendTo(this.element).addClass("ui-daterange-endDate");this._startViewElement.bind("click",function(){_this.show();});this._endViewElement.bind("click",function(){_this.show();});this._popup=$("<div></div>").addClass("ui-daterange-popup").css({"position":"absolute","z-index":5000}).hide();this._popup.appendTo(this.options.popupParent);var dpArea=$("<div></div>").appendTo(this._popup).addClass("ui-daterange-datepickersArea");this._startDatePicker=$("<div></div>").appendTo(dpArea).addClass("ui-daterange-startDatepicker").datepicker({minDate:this.options.minDate,maxDate:this.options.maxDate});this._endDatePicker=$("<div></div>").appendTo(dpArea).addClass("ui-daterange-endDatepicker").datepicker({minDate:this.options.minDate,maxDate:this.options.maxDate});this._startDatePicker.datepicker("option",$.extend({showMonthAfterYear:false},$.datepicker.regional[this.options.lang]));this._endDatePicker.datepicker("option",$.extend({showMonthAfterYear:false},$.datepicker.regional[this.options.lang]));this._setDate(this.options.startDate,this.options.endDate);this._updateView();var btnArea=$("<div></div>").appendTo(this._popup).addClass("ui-daterange-buttonsArea");$('<button type="button">'+this.options.selectText+"</button>").appendTo(btnArea).addClass("ui-daterange-button").bind("click",function(e){e.preventDefault();_this.select();});$('<button type="button">'+this.options.cancelText+"</button>").appendTo(btnArea).addClass("ui-daterange-button").bind("click",function(e){e.preventDefault();_this.cancel();});this._startDatePicker.datepicker("option","onSelect",function(){_this._selecting();});this._endDatePicker.datepicker("option","onSelect",function(){_this._selecting();});},_selecting:function(){this.options.startDate=this._startDatePicker.datepicker("getDate");this.options.endDate=this._endDatePicker.datepicker("getDate");this._updateView();if(typeof this.options.onSelecting=="function"){this.options.onSelecting.call(this.element);}},show:function(){if(!this._isVisible){this._isVisible=true;this._previousStartDate=this.options.startDate;this._previousEndDate=this.options.endDate;this._setDate(this.options.startDate,this.options.endDate);this._setPosition();this._popup.show();if(typeof this.options.onShow=="function"){if(typeof this.options.onShow=="function"){this.options.onShow.call(this.element);}}}},hide:function(){if(this._isVisible){this._isVisible=false;this._popup.hide();if(typeof this.options.onHide=="function"){if(typeof this.options.onHide=="function"){this.options.onHide.call(this.element);}}}},select:function(){if(this.options.startDate<=this.options.endDate){this.hide();if(typeof this.options.onSelect=="function"){this.options.onSelect.call(this.element,{widget:this});}}else{alert(this.options.wrongRangeMessage);}},cancel:function(){this._setDate(this._previousStartDate,this._previousEndDate);this._updateView();this.hide();if(typeof this.options.onCancel=="function"){this.options.onCancel.call(this.element);}},destroy:function(){$.widget.prototype.destroy.apply(this,arguments);}});$.extend($.ui.daterange,{defaults:{viewDateFormat:"dd/mm/yy",queryDateFormat:"yy.mm.dd",queryStartDateKey:"",queryEndDateKey:"",minDate:null,maxDate:null,startDate:new Date(),endDate:new Date(),popupAlign:"right",popupParent:"body",delimiter:"—",lang:"",wrongRangeMessage:"",onSelecting:null,onSelect:null,onCancel:null,onShow:null,onHide:null,cancelText:"Cancel",selectText:"Select"}});(function($,epi){epi.search=function(){var pub={};var _searchProviders;var _queriesInProgress=0;var _tooltips=[];var _createTooltipRow=function(heading,content){return $("<tr>").append($("<th>").html(heading)).append($("<td>").html(content));};var _createToolTip=function(searchResult){if(searchResult){var table=$("<table>");for(var toolTipIndex in searchResult.ToolTipElements){var toolTipElement=searchResult.ToolTipElements[toolTipIndex];table.append(_createTooltipRow(toolTipElement.Label,toolTipElement.Value+"&nbsp;"));}if(typeof(searchResult.PreviewText)==="string"&&searchResult.PreviewText.length>0){var heading=epi.shell.resource.get("episerver.shell.ui.views.search.resources","previewtext");table.append(_createTooltipRow(heading,searchResult.PreviewText));}if(typeof(searchResult.Language)==="string"&&searchResult.Language!==""){var heading=epi.shell.resource.get("episerver.shell.ui.views.search.resources","language");table.append(_createTooltipRow(heading,searchResult.Language));}if($("tr",table).length){return $("<div>").addClass("epi-toolTip").append(table);}}return"";};pub.performSearch=function(e){e.preventDefault();$.each(_tooltips,function(index,tooltipsByProvider){tooltipsByProvider.remove();});_tooltips=[];$("#epiSearchResultContainer").show();$("#epiSearchNoResultMessage").hide();var jqForm=$(this);var action=jqForm.attr("action");var formValues=jqForm.serializeArray();if(!_hasFormDataValues(formValues)){return;}var encodedData=formValues.slice();encodedData[0].value=$.trim($("<div/>").text(encodedData[0].value).html());for(var i=0;i<_searchProviders.length;i++){_setAjaxLoaderVisibility(true);var providerId=_searchProviders[i].id;$("#epiProviderResult"+providerId).hide();var postData=encodedData.slice();postData.push({name:"id",value:providerId});postData.push({name:"parameters",value:'{"global": true}'});$.ajax({url:action,type:"post",dataType:"json",cache:false,data:postData,error:_showErrorReport,success:_populateResult});}};var _populateResult=function(data){if(typeof(data)==="object"&&typeof(data.providerId)==="string"){var providerId=data.providerId;var resultContainer=$("#epiProviderResult"+providerId+">div>ol");var results=data.searchResult;if(results.length>0){resultContainer.empty();for(var i=0;i<results.length;i++){var result=results[i];var anchor=$("<a>").attr("href",result.Url).addClass(result.IconCssClass).html(result.Title);var previewText=result.PreviewText;if(typeof(previewText)==="string"&&previewText.length>0){anchor.append(" - ");anchor.append($("<span>").html(previewText));}var toolTip=_createToolTip(results[i]);var li=$("<li>").append(anchor).append(toolTip);li.appendTo(resultContainer);li.find("a:first").click(_onSearchResultClick).data("resultData",{area:data.area,result:results[i]}).closest("li").keydown(_resultKeyDown);}_tooltips.push($("#epiProviderResult"+providerId).find(".epi-toolTip").epiToolTip());$("#epiProviderResult"+providerId).slideDown("normal");}$("#epiSearch").addClass("epi-searchBorder");}else{$("#epiSearch").removeClass("epi-searchBorder");}if(_setAjaxLoaderVisibility(false)===0){if($(".epi-searchProviderResult:visible").length===0){$("#epiSearchNoResultMessage").slideDown("normal");}}};var _resultKeyDown=function(e){switch(e.which){case epi.shell.keyCode.arrowDown:$(this).next().children("a:first").focus();break;case epi.shell.keyCode.arrowUp:$(this).prev().children("a:first").focus();break;}};var _setAjaxLoaderVisibility=function(visible){var searchField=$("#epiSearchForm>#epiSearchQuery");if(visible){_queriesInProgress++;searchField.addClass("epi-searchInputLoading");}else{_queriesInProgress--;if(_queriesInProgress===0){searchField.removeClass("epi-searchInputLoading");}}return _queriesInProgress;};var _hasFormDataValues=function(formData){var i=0;for(;i<formData.length;i++){if($.trim(formData[i].value).length>0){return true;}}return false;};var _showErrorReport=function(xmlHttpRequest,status,errorThrown){var data=epi.shell.serializeQueryStringAsArray(this.data);var providerId=data["id"];var resultContainer=$("#epiProviderResult"+providerId+">div>ol");resultContainer.empty();var html=[];html.push("<li>");html.push(epi.shell.resource.get("episerver.shell.ui.views.search.resources","searchprovidererrortext"));html.push("</li>");html.push("<li>");html.push(xmlHttpRequest.statusText);html.push("</li>");$(html.join("")).appendTo(resultContainer);$("#epiProviderResult"+providerId).show();_setAjaxLoaderVisibility(false);};var _onSearchResultClick=function(e){var searchEvent=jQuery.Event("episearchresultnavigate");var data=$(this).data("resultData");pub.closeSearchDialog();$("#epiSearch").trigger(searchEvent,data);if(searchEvent.isDefaultPrevented()){e.preventDefault();}if(searchEvent.isPropagationStopped()){e.stopPropagation();}};var _onFrameClicked=function(e){var target=e.target;if($(target).closest("#epi-searchContainer").length>0||$(target).closest("a").is(".epi-navigation-global_search")){return;}pub.closeSearchDialog();};pub.openSearchDialog=function(e){if($("#epi-searchContainer:visible").length>0){return;}var searchContainer=$("#epi-searchContainer");if(searchContainer.length>0){searchContainer.show();$("#epiSearchQuery").focus();}else{var parentDiv=$(e.target).closest(".epi-navigation-container-root");var path=epi.routes.getActionPath({moduleArea:"shell",controller:"Search",action:"Index",searchArea:epi.routes.defaultModuleArea});$.get(path,{},function(data){searchContainer=$("<div id='epi-searchContainer'></div>").appendTo(parentDiv).html(data);$("#epiSearchQuery").focus();});$("#epiSearchQuery").live("keydown",function(e){if(e.which===epi.shell.keyCode.escape){pub.closeSearchDialog();}});}$(".epi-navigation-global_search").parent("li").addClass("epi-navigation-toggled");setTimeout(function(){epi.shell.events.bindFrameClickHandler(_onFrameClicked);},0);};pub.closeSearchDialog=function(){$(".epi-over","#epi-searchContainer").removeClass("epi-over");$("#epi-searchContainer").hide();$(".epi-navigation-global_search").parent("li").removeClass("epi-navigation-toggled");epi.shell.events.unbindFrameClickHandler(_onFrameClicked);};pub.initialize=function(providers){_searchProviders=providers;};epi.shell.registerInitFunction(function(){$(".epi-navigation-global_search").click(function(e){e.preventDefault();if($("#epi-searchContainer:visible").length>0){pub.closeSearchDialog();}else{pub.openSearchDialog(e);}});});return pub;}();}(epiJQuery,epi));