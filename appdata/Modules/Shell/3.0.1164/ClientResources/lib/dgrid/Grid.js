//>>built
define("dgrid/Grid",["dojo/_base/kernel","dojo/_base/declare","dojo/on","dojo/has","put-selector/put","./List","./util/misc","dojo/_base/sniff"],function(_1,_2,_3,_4,_5,_6,_7){var _8=_4("ie")<8&&!_4("quirks");var _9=/[^\._a-zA-Z0-9-]/g;function _a(_b,_c){if(_c&&_c.nodeType){_b.appendChild(_c);}};var _d=_2(_6,{columns:null,cellNavigation:true,tabableHeader:true,showHeader:true,column:function(_e){if(typeof _e!="object"){return this.columns[_e];}else{return this.cell(_e).column;}},listType:"grid",cell:function(_f,_10){if(_f.column&&_f.element){return _f;}if(_f.target&&_f.target.nodeType){_f=_f.target;}var _11;if(_f.nodeType){var _12;do{if(this._rowIdToObject[_f.id]){break;}var _13=_f.columnId;if(_13){_10=_13;_11=_f;break;}_f=_f.parentNode;}while(_f&&_f!=this.domNode);}if(!_11&&typeof _10!="undefined"){var row=this.row(_f),_14=row&&row.element;if(_14){var _15=_14.getElementsByTagName("td");for(var i=0;i<_15.length;i++){if(_15[i].columnId==_10){_11=_15[i];break;}}}}if(_f!=null){return {row:row||this.row(_f),column:_10&&this.column(_10),element:_11};}},createRowCells:function(tag,_16,_17){var row=_5("table.dgrid-row-table[role=presentation]"),_18=this.cellNavigation,_19=(_4("ie")<9||_4("quirks"))?_5(row,"tbody"):row,tr,si,sl,i,l,_1a,_1b,id,_1c,_1d,_1e,_1f,_20;_17=_17||this.subRows;for(si=0,sl=_17.length;si<sl;si++){_1a=_17[si];tr=_5(_19,"tr");if(_1a.className){_5(tr,"."+_1a.className);}for(i=0,l=_1a.length;i<l;i++){_1b=_1a[i];id=_1b.id;_1c=_1b.className||(_1b.field&&"field-"+_1b.field);_1d=_5(tag+(".dgrid-cell.dgrid-cell-padding"+(id?".dgrid-column-"+id:"")+(_1c?"."+_1c:"")).replace(_9,"-")+"[role="+(tag==="th"?"columnheader":"gridcell")+"]");_1d.columnId=id;if(_8){_1e=_5(_1d,"!dgrid-cell-padding div.dgrid-cell-padding");_1d.contents=_1e;}else{_1e=_1d;}_1f=_1b.colSpan;if(_1f){_1d.colSpan=_1f;}_20=_1b.rowSpan;if(_20){_1d.rowSpan=_20;}_16(_1e,_1b);tr.appendChild(_1d);}}return row;},left:function(_21,_22){if(!_21.element){_21=this.cell(_21);}return this.cell(this._move(_21,-(_22||1),"dgrid-cell"));},right:function(_23,_24){if(!_23.element){_23=this.cell(_23);}return this.cell(this._move(_23,_24||1,"dgrid-cell"));},renderRow:function(_25,_26){var _27=this;var row=this.createRowCells("td",function(td,_28){var _29=_25;if(_28.get){_29=_28.get(_25);}else{if("field" in _28&&_28.field!="_item"){_29=_29[_28.field];}}if(_28.renderCell){_a(td,_28.renderCell(_25,_29,td,_26));}else{_2a.call(_28,_25,_29,td,_26);}},_26&&_26.subRows);return _5("div[role=row]>",row);},renderHeader:function(){var _2b=this,_2c=this.columns,_2d=this.headerNode,i=_2d.childNodes.length;_2d.setAttribute("role","row");while(i--){_5(_2d.childNodes[i],"!");}var row=this.createRowCells("th",function(th,_2e){var _2f=_2e.headerNode=th;if(_8){th=th.parentNode;}var _30=_2e.field;if(_30){th.field=_30;}if(_2e.renderHeaderCell){_a(_2f,_2e.renderHeaderCell(_2f));}else{if("label" in _2e||_2e.field){_2f.appendChild(document.createTextNode("label" in _2e?_2e.label:_2e.field));}}if(_2e.sortable!==false&&_30&&_30!="_item"){th.sortable=true;th.className+=" dgrid-sortable";}},this.subRows&&this.subRows.headerRows);this._rowIdToObject[row.id=this.id+"-header"]=this.columns;_2d.appendChild(row);if(this._sortListener){this._sortListener.remove();}this._sortListener=_3(row,"click,keydown",function(_31){if(_31.type=="click"||_31.keyCode==32||(!_4("opera")&&_31.keyCode==13)){var _32=_31.target,_33,_34,_35,_36;do{if(_32.sortable){_35=[{attribute:(_33=_32.field||_32.columnId),descending:(_34=_2b._sort[0])&&_34.attribute==_33&&!_34.descending}];_36={bubbles:true,cancelable:true,grid:_2b,parentType:_31.type,sort:_35};if(_3.emit(_31.target,"dgrid-sort",_36)){_2b._sortNode=_32;_2b.set("sort",_35);}break;}}while((_32=_32.parentNode)&&_32!=_2d);}});},resize:function(){var _37=this.headerNode.firstChild,_38=this.contentNode,_39;this.inherited(arguments);if(!_4("ie")||(_4("ie")>7&&!_4("quirks"))){_38.style.width="";if(_38&&_37){if((_39=_37.offsetWidth)!=_38.offsetWidth){_38.style.width=_39+"px";}}}},destroy:function(){this._destroyColumns();if(this._sortListener){this._sortListener.remove();}this.inherited(arguments);},_setSort:function(_3a,_3b){this.inherited(arguments);this.updateSortArrow(this._sort);},updateSortArrow:function(_3c,_3d){if(this._lastSortedArrow){_5(this._lastSortedArrow,"<!dgrid-sort-up!dgrid-sort-down");_5(this._lastSortedArrow,"!");delete this._lastSortedArrow;}if(_3d){this._sort=_3c;}if(!_3c[0]){return;}var _3e=_3c[0].attribute,_3f=_3c[0].descending,_40=this._sortNode,_41,_42,i;delete this._sortNode;if(!_40){_41=this.columns;for(i in _41){_42=_41[i];if(_42.field==_3e){_40=_42.headerNode;break;}}}if(_40){_40=_40.contents||_40;this._lastSortedArrow=_5(_40.firstChild,"-div.dgrid-sort-arrow.ui-icon[role=presentation]");this._lastSortedArrow.innerHTML="&nbsp;";_5(_40,_3f?".dgrid-sort-down":".dgrid-sort-up");this.resize();}},styleColumn:function(_43,css){return this.addCssRule("#"+_7.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+_43,css);},_configColumns:function(_44,_45){var _46=[],_47=_45 instanceof Array;function _48(_49,_4a){if(typeof _49=="string"){_45[_4a]=_49={label:_49};}if(!_47&&!_49.field){_49.field=_4a;}_4a=_49.id=_49.id||(isNaN(_4a)?_4a:(_44+_4a));if(_47){this.columns[_4a]=_49;}if(this._configColumn){this._configColumn(_49,_4a,_45,_44);}_49.grid=this;if(typeof _49.init==="function"){_49.init();}_46.push(_49);};_7.each(_45,_48,this);return _47?_45:_46;},_destroyColumns:function(){var _4b=this.subRows,_4c=_4b&&_4b.length,i,j,_4d,len;this.cleanup();for(i=0;i<_4c;i++){for(j=0,len=_4b[i].length;j<len;j++){_4d=_4b[i][j];if(typeof _4d.destroy==="function"){_4d.destroy();}}}},configStructure:function(){var _4e=this.subRows,_4f=this._columns=this.columns;this.columns=!_4f||_4f instanceof Array?{}:_4f;if(_4e){for(var i=0;i<_4e.length;i++){_4e[i]=this._configColumns(i+"-",_4e[i]);}}else{this.subRows=[this._configColumns("",_4f)];}},_getColumns:function(){return this._columns||this.columns;},_setColumns:function(_50){this._destroyColumns();this.subRows=null;this.columns=_50;this._updateColumns();},_setSubRows:function(_51){this._destroyColumns();this.subRows=_51;this._updateColumns();},setColumns:function(_52){_1.deprecated("setColumns(...)","use set(\"columns\", ...) instead","dgrid 0.4");this.set("columns",_52);},setSubRows:function(_53){_1.deprecated("setSubRows(...)","use set(\"subRows\", ...) instead","dgrid 0.4");this.set("subRows",_53);},_updateColumns:function(){this.configStructure();this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);if(this._started){if(this._sort&&this._sort.length){this.updateSortArrow(this._sort);}else{this.resize();}}}});function _2a(_54,_55,td,_56){if(this.formatter){var _57=this.formatter,_58=this.grid.formatterScope;td.innerHTML=typeof _57==="string"&&_58?_58[_57](_55,_54):_57(_55,_54);}else{if(_55!=null){td.appendChild(document.createTextNode(_55));}}};_d.appendIfNode=_a;_d.defaultRenderCell=_2a;return _d;});