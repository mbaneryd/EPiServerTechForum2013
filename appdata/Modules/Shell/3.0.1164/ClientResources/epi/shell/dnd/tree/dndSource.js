//>>built
define("epi/shell/dnd/tree/dndSource",["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/dom-class","dojo/dom-geometry","dojo/_base/lang","dojo/on","dojo/touch","dojo/topic","dojo/dnd/Manager","dojo/when","dijit/tree/dndSource","../_DndDataMixin"],function(_1,_2,_3,_4,_5,_6,on,_7,_8,_9,_a,_b,_c){return _3([_b,_c],{generateText:false,singular:true,deleteSelectedNodes:function(){},userSelect:function(_d){this.inherited(arguments,[_d,false,false]);},onDndDrop:function(_e,_f,_10,_11){if(this.containerState=="Over"){var _12=this.tree,_13=_12.model,_14=this.targetAnchor;this.isDragging=false;var _15;var _16=(_14&&_14.item)||_12.item;if(this.dropPosition=="Before"||this.dropPosition=="After"){_16=(_14.getParent()&&_14.getParent().item)||_12.item;_15=_14.getIndexInParent();if(this.dropPosition=="After"){_15=_14.getIndexInParent()+1;}}var _17=this.itemCreator(_f,_14.rowNode,_e,_11);if(_e==this){if(_13.pasteItems){_13.pasteItems(_17,_16,_10,_15);}else{_1.forEach(_17,function(_18){if(_18.dndData){var _19=_18.dndData.options;var _1a=_19?_19.oldParentItem:null;var _1b=_19?_19.indexInParent:0;if(typeof _15=="number"){if(_16==_1a&&_1b<_15){_15-=1;}}_13.pasteItem(_18.dndData.data,_1a,_16,_10,_15);}});}}else{if(_13.newItems){_13.newItems(_17,_16,_15);}else{_1.forEach(_17,function(_1c){_13.newItem(_1c,_16,_15);});}}if(!_e.isDragging&&!_11.isDragging){this.onDndEnd();}}if(_e!==_11&&!_10&&_e.onDndItemRemoved){var _1d=_1.map(_f,function(_1e){return this._getDndData(_e.getItem(_1e.id),this.accept,this===_e);},this);_e.onDndItemRemoved(_1d,_e,_f,_10,_11);}this.onDndCancel();},onMouseOut:function(){this.inherited(arguments);if(this._expandOnDndTimeout){clearTimeout(this._expandOnDndTimeout);}},_onDragMouse:function(e,_1f){this.inherited(arguments);var m=_9.manager();if(m.canDropFlag){_a(this.checkItemAcceptance(this.current.rowNode,m.source,null),function(_20){m.canDrop(_20);});}if(this._expandOnDndTimeout){clearTimeout(this._expandOnDndTimeout);}if(this.tree&&this.tree.expandOnDnd===true&&this.targetAnchor){this._expandOnDndTimeout=setTimeout(_6.hitch(this,function(){this.isDragging&&this.tree._expandNode(this.targetAnchor);}),500);}},onDndEnd:function(){},onDndItemRemoved:function(_21,_22,_23,_24,_25){},itemCreator:function(_26,_27,_28,_29){return _1.map(_26,function(_2a){return {id:_2a.id,name:_2a.textContent||_2a.innerText||"",dndData:this._getDndData(_28.getItem(_2a.id),this.accept,this===_28)};},this);},getItem:function(key){var _2b=this.inherited(arguments);if(this.tree.getItemType&&_2b&&_2b.data&&_2b.data.item){_2b.type=this.tree.getItemType(_2b.data.item);}_2b.options=this.getItemOptions(_2b);return _2b;},getItemOptions:function(_2c){var _2d={};if(_2c.data){if(_2c.data.getParent){var _2e=_2c.data.getParent();_2d.oldParentItem=_2e?_2e.item:null;}if(_2c.data.getIndexInParent){_2d.indexInParent=_2c.data.getIndexInParent();}}return _2d;},onMouseDown:function(e){var _2f=_4.contains(e.target,"dojoDndContainerOver");if(_2f){return;}this.inherited(arguments);},checkAcceptance:function(_30,_31){if(this.readOnly){return false;}var _32=_1.map(_31,function(_33){return _30.getItem(_33.id);});return this._checkAcceptanceForItems(_32,this.accept);}});});