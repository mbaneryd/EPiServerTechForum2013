//>>built
define("epi/shell/ShellModule",["epi/patch/patches","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/topic","dojo/when","dojo/dnd/Manager","epi","epi/_Module","epi/routes","epi/Url","epi/shell/store/Registry","epi/shell/widget/Application","epi/shell/Profile","epi/shell/layout/PositioningUtility","epi/shell/ContextService","epi/shell/ContextHistory","epi/shell/HashWrapper","epi/shell/ViewContextHistory","epi/shell/widget/ComponentController","epi/shell/command/GlobalCommandRegistry","epi/shell/dnd/Avatar","epi/shell/MetadataManager","epi/shell/widget/WidgetFactory","epi/shell/MessageService","epi/shell/customFocusIndicator","epi/shell/TypeDescriptorManager","epi/shell/ViewSettings"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_1a,_1b,_1c){return _2([_9],{_settings:null,_initializeHandle:null,constructor:function(_1d){this._settings=_1d;},initialize:function(){return _6(this.inherited(arguments),_3.hitch(this,function(){var _1e=new _c();this._initializeStores(_1e);this.registerDependency("epi.storeregistry",_1e);this.registerDependency("epi.shell.Profile",new _e());this.registerDependency("epi.shell.MetadataManager",_17);this.registerDependency("epi.shell.widget.WidgetFactory",_18);this.registerDependency("epi.shell.MessageService",_19);this.registerDependency("epi.shell.layout.PositioningUtility",_f);this.registerDependency("epi.globalcommandregistry",_15);var _1f=new _12();var _20=new _13();this.registerDependency("epi.shell.controller.Components",new _14({moduleArea:"Shell"}));this.registerDependency("epi.shell.ContextService",new _10());this.registerDependency("epi.shell.ContextHistory",new _11());this.registerDependency("epi.shell.HashWrapper",_1f);var _21=_7.manager();_21.makeAvatar=function(){return new _16(this);};_21.OFFSET_X=6;_21.OFFSET_Y=6;_4.after(_21,"stopDrag",function(_22){_5.publish("/dnd/stop",null);return _22;});this._initializeHandle=_5.subscribe("/epi/shell/application/initialized",_3.hitch(this,this._requestInitialContext,_1f,_20));return _1b.initialize();}));},uninitialize:function(){if(this._requestFailedHandle){this._requestFailedHandle.remove();}this.inherited(arguments);},_initializeStores:function(_23){var _24=_a.getRestPath({moduleArea:"shell",storeName:"metadata"}),_25=_a.getRestPath({moduleArea:"shell",storeName:"context"}),_26=_a.getRestPath({moduleArea:"shell",storeName:"searchproviders"}),_27=_a.getRestPath({moduleArea:"shell",storeName:"searchresults"}),_28=_a.getRestPath({moduleArea:"shell",storeName:"componentcategory"}),_29=_a.getRestPath({moduleArea:"shell",storeName:"componentdefinition"}),_2a=_a.getRestPath({moduleArea:"shell",storeName:"component"}),_2b=_a.getRestPath({moduleArea:"shell",storeName:"componentsortorder"}),_2c=_a.getRestPath({moduleArea:"shell",storeName:"licenseinformation"});uiDescriptorUrl=_a.getRestPath({moduleArea:"shell",storeName:"uidescriptor"});_23.create("epi.shell.metadata",_24);_23.create("epi.shell.context",_25,{idProperty:"uri"});_23.create("epi.shell.searchproviders",_26);_23.create("epi.shell.searchresults",_27);_23.create("epi.shell.componentcategory",_28,{idProperty:"name"});_23.create("epi.shell.componentdefinition",_29);_23.create("epi.shell.component",_2a);_23.create("epi.shell.componentsortorder",_2b);_23.create("epi.shell.licenseinformation",_2c);_23.create("epi.shell.uidescriptor",uiDescriptorUrl);},_requestInitialContext:function(_2d,_2e){if(this._initializeHandle){this._initializeHandle.remove();}var _2f=_3.hitch(this,function(_30){var _31=_30||_1c.settings.defaultContext;var _32=null;if(_31){this._requestFailedHandle=_5.subscribe("/epi/shell/context/requestfailed",_3.hitch(this,function(_33,_34,_35){if(_35&&_35.sender==this){this._requestFailedHandle.remove();_2f(null);}}));_32={uri:_31};}_5.publish("/epi/shell/context/request",_32,{sender:this});});var _36=_2d.getHash();if(_36&&_36.context){_2f(_36.context);return;}_6(_2e.getLastContextForView(),function(_37){var _38=null;if(_37&&_37.fullHomeUrl){var url=new _b(_37.fullHomeUrl);if(url.authority.toLowerCase()===window.location.host.toLowerCase()){_38=_37.versionAgnosticUri;}}_2f(_38);});}});});