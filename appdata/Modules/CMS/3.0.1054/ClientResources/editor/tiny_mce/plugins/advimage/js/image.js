var ImageDialog={preInit:function(){var url;tinyMCEPopup.requireLangPack(),(url=tinyMCEPopup.getParam("external_image_list_url"))&&document.write('<script language="javascript" type="text/javascript" src="'+tinyMCEPopup.editor.documentBaseURI.toAbsolute(url)+'"></script>')},init:function(ed){var f=document.forms[0],nl=f.elements,ed=tinyMCEPopup.editor,dom=ed.dom,n=ed.selection.getNode(),fl=tinyMCEPopup.getParam("external_image_list","tinyMCEImageList");ed.selection.isCollapsed()&&(ed.selection.moveToBookmark(ed.windowManager.bookmark),n=ed.selection.getNode()),tinyMCEPopup.resizeToInnerSize(),this.fillClassList("class_list"),this.fillFileList("src_list",fl),this.fillFileList("over_list",fl),this.fillFileList("out_list",fl),TinyMCE_EditableSelects.init(),"IMG"==n.nodeName&&(nl.src.value=dom.getAttrib(n,"src").replace(/(\?|&)epi_image_timestamp=.*(&|$)/g,""),nl.width.value=dom.getAttrib(n,"width"),nl.height.value=dom.getAttrib(n,"height"),nl.alt.value=dom.getAttrib(n,"alt"),nl.title.value=dom.getAttrib(n,"title"),nl.vspace.value=this.getAttrib(n,"vspace"),nl.hspace.value=this.getAttrib(n,"hspace"),nl.border.value=this.getAttrib(n,"border"),selectByValue(f,"align",this.getAttrib(n,"align")),selectByValue(f,"class_list",dom.getAttrib(n,"class"),!0,!0),nl.style.value=dom.getAttrib(n,"style"),nl.id.value=dom.getAttrib(n,"id"),nl.dir.value=dom.getAttrib(n,"dir"),nl.lang.value=dom.getAttrib(n,"lang"),nl.usemap.value=dom.getAttrib(n,"usemap"),nl.longdesc.value=dom.getAttrib(n,"longdesc"),nl.insert.value=ed.getLang("update"),/^\s*this.src\s*=\s*\'([^\']+)\';?\s*$/.test(dom.getAttrib(n,"onmouseover"))&&(nl.onmouseoversrc.value=dom.getAttrib(n,"onmouseover").replace(/^\s*this.src\s*=\s*\'([^\']+)\';?\s*$/,"$1")),/^\s*this.src\s*=\s*\'([^\']+)\';?\s*$/.test(dom.getAttrib(n,"onmouseout"))&&(nl.onmouseoutsrc.value=dom.getAttrib(n,"onmouseout").replace(/^\s*this.src\s*=\s*\'([^\']+)\';?\s*$/,"$1")),ed.settings.inline_styles&&(dom.getAttrib(n,"align")&&this.updateStyle("align"),dom.getAttrib(n,"hspace")&&this.updateStyle("hspace"),dom.getAttrib(n,"border")&&this.updateStyle("border"),dom.getAttrib(n,"vspace")&&this.updateStyle("vspace"))),document.getElementById("srcbrowsercontainer").innerHTML=getBrowserHTML("srcbrowser","src","image","theme_advanced_image"),isVisible("srcbrowser")&&(document.getElementById("src").style.width="260px"),document.getElementById("onmouseoversrccontainer").innerHTML=getBrowserHTML("overbrowser","onmouseoversrc","image","theme_advanced_image"),isVisible("overbrowser")&&(document.getElementById("onmouseoversrc").style.width="260px"),document.getElementById("onmouseoutsrccontainer").innerHTML=getBrowserHTML("outbrowser","onmouseoutsrc","image","theme_advanced_image"),isVisible("outbrowser")&&(document.getElementById("onmouseoutsrc").style.width="260px"),ed.getParam("advimage_constrain_proportions",!0)&&(f.constrain.checked=!0),nl.onmouseoversrc.value||nl.onmouseoutsrc.value?this.setSwapImage(!0):this.setSwapImage(!1),this.changeAppearance(),this.showPreviewImage(nl.src.value,1)},insert:function(){var ed=tinyMCEPopup.editor,t=this,f=document.forms[0];return""===f.src.value?("IMG"==ed.selection.getNode().nodeName&&(ed.dom.remove(ed.selection.getNode()),ed.execCommand("mceRepaint")),tinyMCEPopup.close(),void 0):tinyMCEPopup.getParam("accessibility_warnings",1)&&!f.alt.value?(tinyMCEPopup.confirm(tinyMCEPopup.getLang("advimage_dlg.missing_alt"),function(s){s&&t.insertAndClose()}),void 0):(t.insertAndClose(),void 0)},insertAndClose:function(){var el,ed=tinyMCEPopup.editor,f=document.forms[0],nl=f.elements,args={};tinyMCEPopup.restoreSelection(),tinymce.isWebKit&&ed.getWin().focus(),args=ed.settings.inline_styles?{vspace:"",hspace:"",border:"",align:""}:{vspace:nl.vspace.value,hspace:nl.hspace.value,border:nl.border.value,align:getSelectValue(f,"align")},tinymce.extend(args,{src:nl.src.value.replace(/ /g,"%20"),width:nl.width.value,height:nl.height.value,alt:nl.alt.value,title:nl.title.value,"class":getSelectValue(f,"class_list"),style:nl.style.value,id:nl.id.value,dir:nl.dir.value,lang:nl.lang.value,usemap:nl.usemap.value,longdesc:nl.longdesc.value}),args.onmouseover=args.onmouseout="",f.onmousemovecheck.checked&&(nl.onmouseoversrc.value&&(args.onmouseover="this.src='"+nl.onmouseoversrc.value+"';"),nl.onmouseoutsrc.value&&(args.onmouseout="this.src='"+nl.onmouseoutsrc.value+"';")),el=ed.selection.getNode(),el&&"IMG"==el.nodeName?(ed.dom.setAttribs(el,args),ed.undoManager.add()):(tinymce.each(args,function(value,name){""===value&&delete args[name]}),ed.execCommand("mceInsertContent",!1,tinyMCEPopup.editor.dom.createHTML("img",args),{skip_undo:1}),ed.undoManager.add()),tinyMCEPopup.editor.execCommand("mceRepaint"),tinyMCEPopup.editor.focus(),tinyMCEPopup.close()},getAttrib:function(e,at){var v,v2,ed=tinyMCEPopup.editor,dom=ed.dom;if(ed.settings.inline_styles)switch(at){case"align":if(v=dom.getStyle(e,"float"))return v;if(v=dom.getStyle(e,"vertical-align"))return v;break;case"hspace":if(v=dom.getStyle(e,"margin-left"),v2=dom.getStyle(e,"margin-right"),v&&v==v2)return parseInt(v.replace(/[^0-9]/g,""));break;case"vspace":if(v=dom.getStyle(e,"margin-top"),v2=dom.getStyle(e,"margin-bottom"),v&&v==v2)return parseInt(v.replace(/[^0-9]/g,""));break;case"border":if(v=0,tinymce.each(["top","right","bottom","left"],function(sv){return sv=dom.getStyle(e,"border-"+sv+"-width"),!sv||sv!=v&&0!==v?(v=0,!1):(sv&&(v=sv),void 0)}),v)return parseInt(v.replace(/[^0-9]/g,""))}return(v=dom.getAttrib(e,at))?v:""},setSwapImage:function(st){var f=document.forms[0];f.onmousemovecheck.checked=st,setBrowserDisabled("overbrowser",!st),setBrowserDisabled("outbrowser",!st),f.over_list&&(f.over_list.disabled=!st),f.out_list&&(f.out_list.disabled=!st),f.onmouseoversrc.disabled=!st,f.onmouseoutsrc.disabled=!st},fillClassList:function(id){var lst=tinyMCEPopup.dom.get(id);addClassesToList(id,tinyMCEPopup.getParam("style_formats",!1)?{tag:"IMG"}:null),lst.options.length>0?lst.options[0].text=tinyMCEPopup.getLang("not_set"):dom.remove(dom.getParent(id,"tr"))},fillFileList:function(id,l){var dom=tinyMCEPopup.dom,lst=dom.get(id);l="function"==typeof l?l():window[l],lst.options.length=0,l&&l.length>0?(lst.options[lst.options.length]=new Option("",""),tinymce.each(l,function(o){lst.options[lst.options.length]=new Option(o[0],o[1])})):dom.remove(dom.getParent(id,"tr"))},resetImageData:function(){var f=document.forms[0];f.elements.width.value=f.elements.height.value=""},updateImageData:function(img,st){var f=document.forms[0];st||(f.elements.width.value=img.width,f.elements.height.value=img.height),this.preloadImg=img},changeAppearance:function(){var ed=tinyMCEPopup.editor,f=document.forms[0],img=document.getElementById("alignSampleImg");img&&(ed.getParam("inline_styles")?ed.dom.setAttrib(img,"style",f.style.value):(img.align=f.align.value,img.border=f.border.value,img.hspace=f.hspace.value,img.vspace=f.vspace.value))},changeHeight:function(){var tp,f=document.forms[0],t=this;f.constrain.checked&&t.preloadImg&&""!=f.width.value&&""!=f.height.value&&(tp=parseInt(f.width.value)/parseInt(t.preloadImg.width)*t.preloadImg.height,f.height.value=tp.toFixed(0))},changeWidth:function(){var tp,f=document.forms[0],t=this;f.constrain.checked&&t.preloadImg&&""!=f.width.value&&""!=f.height.value&&(tp=parseInt(f.height.value)/parseInt(t.preloadImg.height)*t.preloadImg.width,f.width.value=tp.toFixed(0))},updateStyle:function(ty){var b,bStyle,bColor,v,dom=tinyMCEPopup.dom,isIE=tinymce.isIE,f=document.forms[0],img=dom.create("img",{style:dom.get("style").value});if(tinyMCEPopup.editor.settings.inline_styles){if("align"==ty&&(dom.setStyle(img,"float",""),dom.setStyle(img,"vertical-align",""),v=getSelectValue(f,"align"),v&&("left"==v||"right"==v?dom.setStyle(img,"float",v):img.style.verticalAlign=v)),"border"==ty&&(b=img.style.border?img.style.border.split(" "):[],bStyle=dom.getStyle(img,"border-style"),bColor=dom.getStyle(img,"border-color"),dom.setStyle(img,"border",""),v=f.border.value,v||"0"==v))if("0"==v)img.style.border=isIE?"0":"0 none none";else{var isOldIE=tinymce.isIE&&(!document.documentMode||9>document.documentMode);3==b.length&&b[isOldIE?2:1]?bStyle=b[isOldIE?2:1]:bStyle&&"none"!=bStyle||(bStyle="solid"),3==b.length&&b[isIE?0:2]?bColor=b[isOldIE?0:2]:bColor&&"none"!=bColor||(bColor="black"),img.style.border=v+"px "+bStyle+" "+bColor}"hspace"==ty&&(dom.setStyle(img,"marginLeft",""),dom.setStyle(img,"marginRight",""),v=f.hspace.value,v&&(img.style.marginLeft=v+"px",img.style.marginRight=v+"px")),"vspace"==ty&&(dom.setStyle(img,"marginTop",""),dom.setStyle(img,"marginBottom",""),v=f.vspace.value,v&&(img.style.marginTop=v+"px",img.style.marginBottom=v+"px")),dom.get("style").value=dom.serializeStyle(dom.parseStyle(img.style.cssText),"img")}},changeMouseMove:function(){},showPreviewImage:function(u,st){return u?(!st&&tinyMCEPopup.getParam("advimage_update_dimensions_onchange",!0)&&this.resetImageData(),u=tinyMCEPopup.editor.documentBaseURI.toAbsolute(u),st?tinyMCEPopup.dom.setHTML("prev",'<img id="previewImg" src="'+u+'" border="0" onload="ImageDialog.updateImageData(this, 1);" />'):tinyMCEPopup.dom.setHTML("prev",'<img id="previewImg" src="'+u+'" border="0" onload="ImageDialog.updateImageData(this);" onerror="ImageDialog.resetImageData();" />'),void 0):(tinyMCEPopup.dom.setHTML("prev",""),void 0)}};ImageDialog.preInit(),tinyMCEPopup.onInit.add(ImageDialog.init,ImageDialog);