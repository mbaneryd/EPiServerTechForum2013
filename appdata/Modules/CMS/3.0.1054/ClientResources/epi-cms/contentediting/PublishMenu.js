//>>built
require({cache:{"url:epi-cms/contentediting/templates/PublishMenu.html":"<div class=\"epi-invertedTooltip epi-publishActionMenu\" role=\"menu\" tabIndex=\"${tabIndex}\" data-dojo-attach-event=\"onkeypress:_onKeyPress\" >\r\n    <div class=\"epi-tooltipDialogTop\" data-dojo-attach-point=\"topInfoSection\">\r\n        <ul>\r\n            <li data-dojo-attach-point=\"lastChangeStatusNode\" class=\"epi-lastchangeStatus\"></li>\r\n            <li data-dojo-attach-point=\"mainButtonSection\">\r\n                <button data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"mainButton\" data-dojo-attach-event=\"onClick: _onMainButtonClick\" class=\"epi-fullWidthButton\"></button>\r\n            </li>            \r\n        </ul>          \r\n        <div data-dojo-attach-point=\"lastPublishedIcon\" class=\"dijitTooltipConnector\"></div>\r\n    </div>\r\n    <div class=\"epi-tooltipDialogInfo\"data-dojo-attach-point=\"publishInfoSection\">\r\n        <ul>\r\n            <li data-dojo-attach-point=\"lastPublishedTitleNode\"></li>\r\n            <li>\r\n                <span data-dojo-attach-point=\"lastPublishedTextNode\"></span>\r\n            </li>\r\n            <li>\r\n                <a href=\"#\" title=\"${res.lastpublishedviewlinktooltip}\" data-dojo-attach-point=\"lastPublishedViewLinkNode\">${res.view}</a>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n    <div class=\"epi-tooltipDialogInfo\" data-dojo-attach-point=\"additionalInfoSection\">\r\n        <ul>\r\n            <li data-dojo-attach-point=\"additionalInfoNode\"></li>\r\n        </ul>\r\n    </div>\r\n    <table class=\"dijitReset epi-tooltipDialogMenu epi-menuInverted\" cellspacing=\"0\">\r\n\t    <tbody data-dojo-attach-point=\"containerNode\" ></tbody>\r\n    </table>\r\n</div>\r\n"}});define("epi-cms/contentediting/PublishMenu",["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-style","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/html","dojo/on","dojo/sniff","dojo/Stateful","dojo/when","dijit/DropDownMenu","dijit/_KeyNavContainer","dijit/_WidgetsInTemplateMixin","epi","epi/shell/TypeDescriptorManager","epi/shell/widget/_ModelBindingMixin","epi/shell/command/builder/MenuBuilder","epi/shell/Downloader","epi-cms/contentediting/ContentActionSupport","dojo/text!./templates/PublishMenu.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,on,_a,_b,_c,_d,_e,_f,epi,_10,_11,_12,_13,_14,_15,res){return _2([_d,_f,_11],{templateString:_15,res:res,_menuBuilder:null,commands:null,mainButtonCommand:null,postMixInProperties:function(){this._menuBuilder=new _12();},modelBindingMap:{"commands":["commands"],"mainButtonCommand":["mainButtonCommand"],"mainButtonSectionVisible":["mainButtonSectionVisible"],"lastChangeStatus":["lastChangeStatus"],"topInfoSectionVisible":["topInfoSectionVisible"],"publishInfoSectionVisible":["publishInfoSectionVisible"],"lastPublishedTitle":["lastPublishedTitle"],"lastPublishedTitleVisible":["lastPublishedTitleVisible"],"lastPublishedText":["lastPublishedText"],"lastPublishedViewLinkVisible":["lastPublishedViewLinkVisible"],"lastPublishedViewLinkHref":["lastPublishedViewLinkHref"],"additionalInfoSectionVisible":["additionalInfoSectionVisible"],"additionalInfoText":["additionalInfoText"],"typeIdentifier":["typeIdentifier"]},_setCommandsAttr:function(_16){this.focusedChild=null;var _17=this.getChildren();_1.forEach(_17,function(_18){this.removeChild(_18);},this);this.destroyDescendants();this._addCommandsToMenu(_16);this.focusFirstChild();},_setMainButtonCommandAttr:function(_19){this._set("mainButtonCommand",_19);if(_19){this.mainButton.set("label",_19.label);this.mainButton.set("disabled",!_19.get("canExecute"));_7.remove(this.mainButton.domNode,"epi-loading");if(this._addedMainButtonClass){_7.remove(this.mainButton.domNode,this._addedMainButtonClass);}if(_19.options&&_19.options.mainButtonClass){this._addedMainButtonClass=_19.options.mainButtonClass;_7.add(this.mainButton.domNode,this._addedMainButtonClass);}}},_setMainButtonSectionVisibleAttr:function(_1a){_5.set(this.mainButtonSection,"display",_1a?"":"none");_5.set(this.mainButton.domNode,"display",_1a?"":"none");},_setLastChangeStatusAttr:{node:"lastChangeStatusNode",type:"innerHTML"},_setTopInfoSectionVisibleAttr:function(_1b){_5.set(this.topInfoSection,"display",_1b?"":"none");},_setPublishInfoSectionVisibleAttr:function(_1c){_5.set(this.publishInfoSection,"display",_1c?"":"none");},_setLastPublishedTitleAttr:{node:"lastPublishedTitleNode",type:"innerHTML"},_setLastPublishedTitleVisibleAttr:function(_1d){_5.set(this.lastPublishedTitleNode,"display",_1d?"":"none");},_setLastPublishedTextAttr:{node:"lastPublishedTextNode",type:"innerHTML"},_setLastPublishedViewLinkVisibleAttr:function(_1e){_5.set(this.lastPublishedViewLinkNode,"display",_1e?"":"none");},_setLastPublishedViewLinkHrefAttr:function(_1f){_6.set(this.lastPublishedViewLinkNode,"href",_1f);},_setAdditionalInfoSectionVisibleAttr:function(_20){_5.set(this.additionalInfoSection,"display",_20?"":"none");},_setAdditionalInfoTextAttr:{node:"additionalInfoNode",type:"innerHTML"},_setTypeIdentifierAttr:function(_21){var _22=this.model&&this.model.dataModel&&this.model.dataModel.contentData,_23=_22&&_22.downloadUrl,_24=_21&&_10.getValue(_21,"actAsAnAsset");if(!_24||!_23){_6.set(this.lastPublishedViewLinkNode,"title",res.lastpublishedviewlinktooltip);_9.set(this.lastPublishedViewLinkNode,res.view);if(this._downloadClickHandler){this._downloadClickHandler.remove();this._downloadClickHandler=null;}return;}_6.set(this.lastPublishedViewLinkNode,"title",res.download);_9.set(this.lastPublishedViewLinkNode,res.download);if(!this._downloadClickHandler){this.own(this._downloadClickHandler=on(this.lastPublishedViewLinkNode,"click",_4.hitch(this,function(e){_3.stop(e);var _25=this.model&&this.model.dataModel&&this.model.dataModel.contentData,url=_25&&_25.downloadUrl,_26=_25.name;_13.download(url,_26);})));}},postCreate:function(){this.inherited(arguments);this.mainButton._setSelected=this.mainButton._onUnhover=function(){};},onOpen:function(){this.model.set("isOpen",true);this.inherited(arguments);},onClose:function(){this.model.set("isOpen",false);this.inherited(arguments);},_setModelAttr:function(){this.inherited(arguments);this.ownByKey(this.model,this.connect(this.model,"onCommandsChanged","onCommandsChanged"));},onCommandsChanged:function(_27,_28,_29){if(_28){this._removeCommandsFromMenu(_4.isArray(_28)?_28:[_28]);}if(_29){this._addCommandsToMenu(_4.isArray(_29)?_29:[_29]);}},_addCommandsToMenu:function(_2a){_1.forEach(_2a,function(_2b){if(_2b!==this.model.mainButtonCommand){this._menuBuilder.create(_2b,this);}},this);},_removeCommandsFromMenu:function(_2c){var _2d=this.menu.getChildren();_1.forEach(_2c,function(_2e){for(var i=_2d.length-1;i>=0;i--){var _2f=_2d[i];if(_2f._command==_2e){this.removeChild(_2f);break;}}},this);},_onMainButtonClick:function(){if(this.mainButtonCommand){this.mainButton.set("label",this.mainButtonCommand.executingLabel);_7.add(this.mainButton.domNode,"epi-loading");var _30=_4.hitch(this,function(_31){if(_31||this.mainButtonCommand.options&&this.mainButtonCommand.options.resetLabelAfterExecution){this.mainButton.set("label",this.mainButtonCommand.label);}_7.remove(this.mainButton.domNode,"epi-loading");if(this.mainButtonCommand.options&&!this.mainButtonCommand.options.keepMenuOpen){this.onExecute();}}),_32=_4.hitch(this,function(){this.model.set("lastExecutedCommand",this.mainButtonCommand);});_c(this.mainButtonCommand.execute(),function(){return _c(_30(false),_32);},function(){return _30();});}},focusFirstChild:function(){if(this.mainButton.isFocusable()){return this.focusChild(this.mainButton);}else{return this.inherited(arguments);}},focusNext:function(){var _33=this._getLastFocusableChild();if(!this.focusedChild.focused){return this.focusChild(this._getFirstFocusableChild());}else{if(this.focusedChild===_33){this.focusedChild._setSelected(false);return _5.get(this.mainButton.domNode,"display")==="none"?this.lastPublishedViewLinkNode.focus():this.focusChild(this.mainButton);}else{if(this.focusedChild===this.mainButton){return this.lastPublishedViewLinkNode.focus();}else{return this.inherited(arguments);}}}},focusPrev:function(){var _34=this._getFirstFocusableChild();if(!this.focusedChild.focused){return _5.get(this.mainButton.domNode,"display")==="none"?this.focusChild(this._getLastFocusableChild()):this.focusChild(this.mainButton);}else{if(this.focusedChild===_34){this.focusedChild._setSelected(false);return this.lastPublishedViewLinkNode.focus();}else{return this.inherited(arguments);}}},resize:function(_35){var _36=_8.getMarginBox(this.domNode),_37=_8.getPadExtents(this.topInfoSection),_38=_8.getMarginBox(this.mainButton.containerNode),_39=_8.getMarginBox(this.containerNode);var _3a=Math.max(_38.w+_37.l+_37.r,_36.w);_3a=Math.max(_39.w,_3a);_35.w=_3a;_8.setMarginBox(this.domNode,_35);}});});