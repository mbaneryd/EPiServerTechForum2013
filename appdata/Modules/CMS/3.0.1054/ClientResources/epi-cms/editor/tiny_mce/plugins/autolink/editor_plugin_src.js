(function(){tinymce.create("tinymce.plugins.AutolinkPlugin",{init:function(ed){var t=this;ed.onKeyDown.addToTop(function(ed,e){return 13==e.keyCode?t.handleEnter(ed):void 0}),tinyMCE.isIE||(ed.onKeyPress.add(function(ed,e){return 41==e.which?t.handleEclipse(ed):void 0}),ed.onKeyUp.add(function(ed,e){return 32==e.keyCode?t.handleSpacebar(ed):void 0}))},handleEclipse:function(ed){this.parseCurrentLine(ed,-1,"(",!0)},handleSpacebar:function(ed){this.parseCurrentLine(ed,0,"",!0)},handleEnter:function(ed){this.parseCurrentLine(ed,-1,"",!1)},parseCurrentLine:function(ed,end_offset,delimiter){var r,end,start,endContainer,bookmark,text,matches,prev,len;if(r=ed.selection.getRng(!0).cloneRange(),5>r.startOffset){if(prev=r.endContainer.previousSibling,null==prev){if(null==r.endContainer.firstChild||null==r.endContainer.firstChild.nextSibling)return;prev=r.endContainer.firstChild.nextSibling}if(len=prev.length,r.setStart(prev,len),r.setEnd(prev,len),5>r.endOffset)return;end=r.endOffset,endContainer=prev}else{if(endContainer=r.endContainer,3!=endContainer.nodeType&&endContainer.firstChild){for(;3!=endContainer.nodeType&&endContainer.firstChild;)endContainer=endContainer.firstChild;3==endContainer.nodeType&&(r.setStart(endContainer,0),r.setEnd(endContainer,endContainer.nodeValue.length))}end=1==r.endOffset?2:r.endOffset-1-end_offset}start=end;do r.setStart(endContainer,end>=2?end-2:0),r.setEnd(endContainer,end>=1?end-1:0),end-=1;while(" "!=""+r&&""!=""+r&&160!=(""+r).charCodeAt(0)&&end-2>=0&&""+r!=delimiter);""+r==delimiter||160==(""+r).charCodeAt(0)?(r.setStart(endContainer,end),r.setEnd(endContainer,start),end+=1):0==r.startOffset?(r.setStart(endContainer,0),r.setEnd(endContainer,start)):(r.setStart(endContainer,end),r.setEnd(endContainer,start));var text=""+r;if("."==text.charAt(text.length-1)&&r.setEnd(endContainer,start-1),text=""+r,matches=text.match(/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+-]+@)(.+)$/i),matches&&("www."==matches[1]?matches[1]="http://www.":/@$/.test(matches[1])&&!/^mailto:/.test(matches[1])&&(matches[1]="mailto:"+matches[1]),bookmark=ed.selection.getBookmark(),ed.selection.setRng(r),tinyMCE.execCommand("createlink",!1,matches[1]+matches[2]),ed.selection.moveToBookmark(bookmark),ed.nodeChanged(),tinyMCE.isWebKit)){ed.selection.collapse(!1);var max=Math.min(endContainer.length,start+1);r.setStart(endContainer,max),r.setEnd(endContainer,max),ed.selection.setRng(r)}},getInfo:function(){return{longname:"Autolink",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/autolink",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("autolink",tinymce.plugins.AutolinkPlugin)})();