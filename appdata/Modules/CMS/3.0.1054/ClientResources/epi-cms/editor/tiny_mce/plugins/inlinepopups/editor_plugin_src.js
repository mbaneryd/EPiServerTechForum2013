(function(){var DOM=tinymce.DOM,Element=tinymce.dom.Element,Event=tinymce.dom.Event,each=tinymce.each,is=tinymce.is;tinymce.create("tinymce.plugins.InlinePopups",{init:function(ed,url){ed.onBeforeRenderUI.add(function(){ed.windowManager=new tinymce.InlineWindowManager(ed),DOM.loadCSS(url+"/skins/"+(ed.settings.inlinepopups_skin||"clearlooks2")+"/window.css")})},getInfo:function(){return{longname:"InlinePopups",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/inlinepopups",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.create("tinymce.InlineWindowManager:tinymce.WindowManager",{InlineWindowManager:function(ed){var t=this;t.parent(ed),t.zIndex=3e5,t.count=0,t.windows={}},open:function(f,p){var id,vp,mdf,clf,w,u,parentWindow,t=this,opt="",ed=t.editor,dw=0,dh=0;return f=f||{},p=p||{},f.inline?(parentWindow=t._frontWindow(),parentWindow&&DOM.get(parentWindow.id+"_ifr")&&(parentWindow.focussedElement=DOM.get(parentWindow.id+"_ifr").contentWindow.document.activeElement),f.type||(t.bookmark=ed.selection.getBookmark(1)),id=DOM.uniqueId(),vp=DOM.getViewPort(),f.width=parseInt(f.width||320),f.height=parseInt(f.height||240)+(tinymce.isIE?8:0),f.min_width=parseInt(f.min_width||150),f.min_height=parseInt(f.min_height||100),f.max_width=parseInt(f.max_width||2e3),f.max_height=parseInt(f.max_height||2e3),f.left=f.left||Math.round(Math.max(vp.x,vp.x+vp.w/2-f.width/2)),f.top=f.top||Math.round(Math.max(vp.y,vp.y+vp.h/2-f.height/2)),f.movable=f.resizable=!0,p.mce_width=f.width,p.mce_height=f.height,p.mce_inline=!0,p.mce_window_id=id,p.mce_auto_focus=f.auto_focus,t.features=f,t.params=p,t.onOpen.dispatch(t,f,p),f.type&&(opt+=" mceModal",f.type&&(opt+=" mce"+f.type.substring(0,1).toUpperCase()+f.type.substring(1)),f.resizable=!1),f.statusbar&&(opt+=" mceStatusbar"),f.resizable&&(opt+=" mceResizable"),f.minimizable&&(opt+=" mceMinimizable"),f.maximizable&&(opt+=" mceMaximizable"),f.movable&&(opt+=" mceMovable"),t._addAll(DOM.doc.body,["div",{id:id,role:"dialog","aria-labelledby":f.type?id+"_content":id+"_title","class":(ed.settings.inlinepopups_skin||"clearlooks2")+(tinymce.isIE&&window.getSelection?" ie9":""),style:"width:100px;height:100px"},["div",{id:id+"_wrapper","class":"mceWrapper"+opt},["div",{id:id+"_top","class":"mceTop"},["div",{"class":"mceLeft"}],["div",{"class":"mceCenter"}],["div",{"class":"mceRight"}],["span",{id:id+"_title"},f.title||""]],["div",{id:id+"_middle","class":"mceMiddle"},["div",{id:id+"_left","class":"mceLeft",tabindex:"0"}],["span",{id:id+"_content"}],["div",{id:id+"_right","class":"mceRight",tabindex:"0"}]],["div",{id:id+"_bottom","class":"mceBottom"},["div",{"class":"mceLeft"}],["div",{"class":"mceCenter"}],["div",{"class":"mceRight"}],["span",{id:id+"_status"},"Content"]],["a",{"class":"mceMove",tabindex:"-1",href:"javascript:;"}],["a",{"class":"mceMin",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceMax",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceMed",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceClose",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{id:id+"_resize_n","class":"mceResize mceResizeN",tabindex:"-1",href:"javascript:;"}],["a",{id:id+"_resize_s","class":"mceResize mceResizeS",tabindex:"-1",href:"javascript:;"}],["a",{id:id+"_resize_w","class":"mceResize mceResizeW",tabindex:"-1",href:"javascript:;"}],["a",{id:id+"_resize_e","class":"mceResize mceResizeE",tabindex:"-1",href:"javascript:;"}],["a",{id:id+"_resize_nw","class":"mceResize mceResizeNW",tabindex:"-1",href:"javascript:;"}],["a",{id:id+"_resize_ne","class":"mceResize mceResizeNE",tabindex:"-1",href:"javascript:;"}],["a",{id:id+"_resize_sw","class":"mceResize mceResizeSW",tabindex:"-1",href:"javascript:;"}],["a",{id:id+"_resize_se","class":"mceResize mceResizeSE",tabindex:"-1",href:"javascript:;"}]]]),DOM.setStyles(id,{top:-1e4,left:-1e4}),tinymce.isGecko&&DOM.setStyle(id,"overflow","auto"),f.type||(dw+=DOM.get(id+"_left").clientWidth,dw+=DOM.get(id+"_right").clientWidth,dh+=DOM.get(id+"_top").clientHeight,dh+=DOM.get(id+"_bottom").clientHeight),DOM.setStyles(id,{top:f.top,left:f.left,width:f.width+dw,height:f.height+dh}),u=f.url||f.file,u&&(tinymce.relaxedDomain&&(u+=(-1==u.indexOf("?")?"?":"&")+"mce_rdomain="+tinymce.relaxedDomain),u=tinymce._addVer(u)),f.type?(DOM.add(id+"_wrapper","a",{id:id+"_ok","class":"mceButton mceOk",href:"javascript:;",onmousedown:"return false;"},"Ok"),"confirm"==f.type&&DOM.add(id+"_wrapper","a",{"class":"mceButton mceCancel",href:"javascript:;",onmousedown:"return false;"},"Cancel"),DOM.add(id+"_middle","div",{"class":"mceIcon"}),DOM.setHTML(id+"_content",f.content.replace("\n","<br />")),Event.add(id,"keyup",function(evt){var VK_ESCAPE=27;return evt.keyCode===VK_ESCAPE?(f.button_func(!1),Event.cancel(evt)):void 0}),Event.add(id,"keydown",function(evt){var cancelButton,VK_TAB=9;return evt.keyCode===VK_TAB?(cancelButton=DOM.select("a.mceCancel",id+"_wrapper")[0],cancelButton&&cancelButton!==evt.target?cancelButton.focus():DOM.get(id+"_ok").focus(),Event.cancel(evt)):void 0})):(DOM.add(id+"_content","iframe",{id:id+"_ifr",src:'javascript:""',frameBorder:0,style:"border:0;width:10px;height:10px"}),DOM.setStyles(id+"_ifr",{width:f.width,height:f.height}),DOM.setAttrib(id+"_ifr","src",u)),mdf=Event.add(id,"mousedown",function(e){var w,vp,n=e.target;if(w=t.windows[id],t.focus(id),"A"==n.nodeName||"a"==n.nodeName){if("mceClose"==n.className)return t.close(null,id),Event.cancel(e);if("mceMax"==n.className)w.oldPos=w.element.getXY(),w.oldSize=w.element.getSize(),vp=DOM.getViewPort(),vp.w-=2,vp.h-=2,w.element.moveTo(vp.x,vp.y),w.element.resizeTo(vp.w,vp.h),DOM.setStyles(id+"_ifr",{width:vp.w-w.deltaWidth,height:vp.h-w.deltaHeight}),DOM.addClass(id+"_wrapper","mceMaximized");else if("mceMed"==n.className)w.element.moveTo(w.oldPos.x,w.oldPos.y),w.element.resizeTo(w.oldSize.w,w.oldSize.h),w.iframeElement.resizeTo(w.oldSize.w-w.deltaWidth,w.oldSize.h-w.deltaHeight),DOM.removeClass(id+"_wrapper","mceMaximized");else{if("mceMove"==n.className)return t._startDrag(id,e,n.className);if(DOM.hasClass(n,"mceResize"))return t._startDrag(id,e,n.className.substring(13))}}}),clf=Event.add(id,"click",function(e){var n=e.target;if(t.focus(id),"A"==n.nodeName||"a"==n.nodeName)switch(n.className){case"mceClose":return t.close(null,id),Event.cancel(e);case"mceButton mceOk":case"mceButton mceCancel":return f.button_func("mceButton mceOk"==n.className),Event.cancel(e)}}),Event.add([id+"_left",id+"_right"],"focus",function(evt){var iframe=DOM.get(id+"_ifr");if(iframe){var body=iframe.contentWindow.document.body,focusable=DOM.select(":input:enabled,*[tabindex=0]",body);evt.target.id===id+"_left"?focusable[focusable.length-1].focus():focusable[0].focus()}else DOM.get(id+"_ok").focus()}),w=t.windows[id]={id:id,mousedown_func:mdf,click_func:clf,element:new Element(id,{blocker:1,container:ed.getContainer()}),iframeElement:new Element(id+"_ifr"),features:f,deltaWidth:dw,deltaHeight:dh},w.iframeElement.on("focus",function(){t.focus(id)}),0==t.count&&"modal"==t.editor.getParam("dialog_type","modal")?(DOM.add(DOM.doc.body,"div",{id:"mceModalBlocker","class":(t.editor.settings.inlinepopups_skin||"clearlooks2")+"_modalBlocker",style:{zIndex:t.zIndex-1}}),DOM.show("mceModalBlocker"),DOM.setAttrib(DOM.doc.body,"aria-hidden","true")):DOM.setStyle("mceModalBlocker","z-index",t.zIndex-1),(tinymce.isIE6||/Firefox\/2\./.test(navigator.userAgent)||tinymce.isIE&&!DOM.boxModel)&&DOM.setStyles("mceModalBlocker",{position:"absolute",left:vp.x,top:vp.y,width:vp.w-2,height:vp.h-2}),DOM.setAttrib(id,"aria-hidden","false"),t.focus(id),t._fixIELayout(id,1),DOM.get(id+"_ok")&&DOM.get(id+"_ok").focus(),t.count++,w):t.parent(f,p)},focus:function(id){var w,t=this;(w=t.windows[id])&&(w.zIndex=this.zIndex++,w.element.setStyle("zIndex",w.zIndex),w.element.update(),id+="_wrapper",DOM.removeClass(t.lastId,"mceFocus"),DOM.addClass(id,"mceFocus"),t.lastId=id,w.focussedElement?w.focussedElement.focus():DOM.get(id+"_ok")?DOM.get(w.id+"_ok").focus():DOM.get(w.id+"_ifr")&&DOM.get(w.id+"_ifr").focus())},_addAll:function(te,ne){var i,t=this,dom=tinymce.DOM;if(is(ne,"string"))te.appendChild(dom.doc.createTextNode(ne));else if(ne.length)for(te=te.appendChild(dom.create(ne[0],ne[1])),i=2;ne.length>i;i++)t._addAll(te,ne[i])},_startDrag:function(id,se,ac){function startMove(){eb||(t._fixIELayout(id,0),DOM.add(d.body,"div",{id:"mceEventBlocker","class":"mceEventBlocker "+(t.editor.settings.inlinepopups_skin||"clearlooks2"),style:{zIndex:t.zIndex+1}}),(tinymce.isIE6||tinymce.isIE&&!DOM.boxModel)&&DOM.setStyles("mceEventBlocker",{position:"absolute",left:vp.x,top:vp.y,width:vp.w-2,height:vp.h-2}),eb=new Element("mceEventBlocker"),eb.update(),p=we.getXY(),sz=we.getSize(),sx=cp.x+p.x-vp.x,sy=cp.y+p.y-vp.y,DOM.add(eb.get(),"div",{id:"mcePlaceHolder","class":"mcePlaceHolder",style:{left:sx,top:sy,width:sz.w,height:sz.h}}),ph=new Element("mcePlaceHolder"))}var mu,mm,eb,p,sz,ph,cp,vp,sx,sy,sex,sey,dx,dy,dw,dh,t=this,d=DOM.doc,w=t.windows[id],we=w.element;return we.getXY(),cp={x:0,y:0},vp=DOM.getViewPort(),vp.w-=2,vp.h-=2,sex=se.screenX,sey=se.screenY,dx=dy=dw=dh=0,mu=Event.add(d,"mouseup",function(e){return Event.remove(d,"mouseup",mu),Event.remove(d,"mousemove",mm),eb&&eb.remove(),we.moveBy(dx,dy),we.resizeBy(dw,dh),sz=we.getSize(),DOM.setStyles(id+"_ifr",{width:sz.w-w.deltaWidth,height:sz.h-w.deltaHeight}),t._fixIELayout(id,1),Event.cancel(e)}),"Move"!=ac&&startMove(),mm=Event.add(d,"mousemove",function(e){var x,y,v;switch(startMove(),x=e.screenX-sex,y=e.screenY-sey,ac){case"ResizeW":dx=x,dw=0-x;break;case"ResizeE":dw=x;break;case"ResizeN":case"ResizeNW":case"ResizeNE":"ResizeNW"==ac?(dx=x,dw=0-x):"ResizeNE"==ac&&(dw=x),dy=y,dh=0-y;break;case"ResizeS":case"ResizeSW":case"ResizeSE":"ResizeSW"==ac?(dx=x,dw=0-x):"ResizeSE"==ac&&(dw=x),dh=y;break;case"mceMove":dx=x,dy=y}return(v=w.features.min_width-sz.w)>dw&&(0!==dx&&(dx+=dw-v),dw=v),(v=w.features.min_height-sz.h)>dh&&(0!==dy&&(dy+=dh-v),dh=v),dw=Math.min(dw,w.features.max_width-sz.w),dh=Math.min(dh,w.features.max_height-sz.h),dx=Math.max(dx,vp.x-(sx+vp.x)),dy=Math.max(dy,vp.y-(sy+vp.y)),dx=Math.min(dx,vp.w+vp.x-(sx+sz.w+vp.x)),dy=Math.min(dy,vp.h+vp.y-(sy+sz.h+vp.y)),0!==dx+dy&&(0>sx+dx&&(dx=0),0>sy+dy&&(dy=0),ph.moveTo(sx+dx,sy+dy)),0!==dw+dh&&ph.resizeTo(sz.w+dw,sz.h+dh),Event.cancel(e)}),Event.cancel(se)},resizeBy:function(dw,dh,id){var w=this.windows[id];w&&(w.element.resizeBy(dw,dh),w.iframeElement.resizeBy(dw,dh))},close:function(win,id){var w,fw,id,t=this,d=DOM.doc;return id=t._findId(id||win),t.windows[id]?(t.count--,0==t.count&&(DOM.remove("mceModalBlocker"),DOM.setAttrib(DOM.doc.body,"aria-hidden","false"),t.editor.focus()),(w=t.windows[id])&&(t.onClose.dispatch(t),Event.remove(d,"mousedown",w.mousedownFunc),Event.remove(d,"click",w.clickFunc),Event.clear(id),Event.clear(id+"_ifr"),DOM.setAttrib(id+"_ifr","src",'javascript:""'),w.element.remove(),delete t.windows[id],fw=t._frontWindow(),fw&&t.focus(fw.id)),void 0):(t.parent(win),void 0)},_frontWindow:function(){var fw,ix=0;return each(this.windows,function(w){w.zIndex>ix&&(fw=w,ix=w.zIndex)}),fw},setTitle:function(w,ti){var e;w=this._findId(w),(e=DOM.get(w+"_title"))&&(e.innerHTML=DOM.encode(ti))},alert:function(txt,cb){var w,t=this;w=t.open({title:t,type:"alert",button_func:function(s){cb&&cb.call(s||t,s),t.close(null,w.id)},content:DOM.encode(t.editor.getLang(txt,txt)),inline:1,width:400,height:130})},confirm:function(txt,cb){var w,t=this;w=t.open({title:t,type:"confirm",button_func:function(s){cb&&cb.call(s||t,s),t.close(null,w.id)},content:DOM.encode(t.editor.getLang(txt,txt)),inline:1,width:400,height:130})},_findId:function(w){var t=this;return"string"==typeof w?w:(each(t.windows,function(wo){var ifr=DOM.get(wo.id+"_ifr");return ifr&&w==ifr.contentWindow?(w=wo.id,!1):void 0}),w)},_fixIELayout:function(id,s){var w,img;tinymce.isIE6&&(each(["n","s","w","e","nw","ne","sw","se"],function(v){var e=DOM.get(id+"_resize_"+v);DOM.setStyles(e,{width:s?e.clientWidth:"",height:s?e.clientHeight:"",cursor:DOM.getStyle(e,"cursor",1)}),DOM.setStyle(id+"_bottom","bottom","-1px"),e=0}),(w=this.windows[id])&&(w.element.hide(),w.element.show(),each(DOM.select("div,a",id),function(e){"none"!=e.currentStyle.backgroundImage&&(img=new Image,img.src=e.currentStyle.backgroundImage.replace(/url\(\"(.+)\"\)/,"$1"))}),DOM.get(id).style.filter=""))}}),tinymce.PluginManager.add("inlinepopups",tinymce.plugins.InlinePopups)})();