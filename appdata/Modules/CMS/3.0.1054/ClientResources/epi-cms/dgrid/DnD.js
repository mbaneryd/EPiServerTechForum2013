//>>built
define("epi-cms/dgrid/DnD",["dojo/_base/declare","dojo/_base/lang","dojo/_base/NodeList","epi/shell/dnd/Source","dojo/dom-construct","epi/dependency","epi/shell/TypeDescriptorManager","put-selector/put"],function(_1,_2,_3,_4,_5,_6,_7,_8){var _9=_1(_4,{_legalMouseDown:function(_a){var _b=this.inherited(arguments);return _b&&_a.target!=this.grid.bodyNode;},getSelectedNodes:function(){var _c=this.inherited(arguments);if(!this.grid.selection||Object.keys(this.grid.selection).length===0){this.grid.select(_c[0]);return _c;}var _d=false;var _e=new _3();for(var id in this.grid.selection){if(this.grid.row(id).element!=_c[0]){_e.push(this.grid.row(id).element);}else{_d=true;_e.push(_c[0]);}}if(_d){return _e;}else{this.grid.clearSelection();this.grid.select(_c[0]);return _c;}}});return _1([],{dndSourceTypes:null,dndParams:null,dndConstructor:_9,dndDisabled:false,postCreate:function(){this.inherited(arguments);if(!this.dndDisabled){this._setupDnD();}},insertRow:function(_f){var row=this.inherited(arguments);if(this.dndDisabled){return row;}_8(row,".dojoDndItem");this._setupDnD();var _10={};if(this.query){_10.oldParentItem={contentLink:this.query.referenceId};}this.dndSource.setItem(row.id,{data:_f,type:this._getDndType(_f),options:_10});return row;},_getDndType:function(_11){var _12=_7.getAndConcatenateValues(_11.typeIdentifier,"dndTypes");if((!_12||_12.length<=0)&&this.dndSourceTypes){_12=this.dndSourceTypes;}return _12;},_setupDnD:function(){if(this.dndSource){return;}if(!this.dndParams.creator){this.dndParams.creator=_2.hitch(this,this._dndNodeCreator);}this.dndSource=new (this.dndConstructor)(this.bodyNode,_2.mixin(this.dndParams,{grid:this,dropParent:this.contentNode}));this.dndSource.singular=true;},_dndNodeCreator:function(_13,_14){var _15,_16;if(_13.typeIdentifier){_15=_7.getAndConcatenateValues(_13.typeIdentifier,"dndTypes");}if(!_15&&this.dndTypes){_15=this.dndTypes;}_16=_5.create("div").appendChild(document.createTextNode(_13.name));return {"node":_16,"type":_15,"data":_13};}});});