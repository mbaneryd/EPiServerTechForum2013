//>>built
define("epi-cms/widget/ContentSelectorDialog",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetBase","epi","epi/shell/TypeDescriptorManager","epi-cms/ApplicationSettings","epi-cms/widget/ContentTree","epi-cms/widget/ContextualContentForestStoreModel","epi/shell/widget/_ActionProviderWidget","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.widget.contentselectordialog"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e){return _2([_6,_5,_c],{_contentRef:null,res:_e,roots:null,typeIdentifiers:null,showButtons:true,model:null,canSelectOwnerContent:true,multiRootsMode:false,templateString:"<div><div data-dojo-attach-point=\"_treeNode\"></div></div>",_typesToDisplay:null,showAllLanguages:false,selectedContentType:null,buildRendering:function(){this.inherited(arguments);var _f=this._getTypesToDisplay(),_10=this.model,_11=this.roots||(_10&&_10.roots);this.preventContextualContentFor=this.preventContextualContentFor||this._getSettingFromContentType();if(!_10||this.showContextualContent){_10=new _b({roots:_11,typeIdentifiers:_f,notSupportContextualContents:this.preventContextualContentFor,showAllLanguages:this.showAllLanguages});}_10.set("view","contentselector");this.tree=new _a({roots:_11,typeIdentifiers:_f,allowManipulation:false,model:_10,expandExtraNodeItems:_9.startPage},this._treeNode);this.connect(this.tree,"onClick","_onTreeNodeClick");},_getSettingFromContentType:function(){if(!this.selectedContentType){return null;}var _12=this.contentRepositoryDescriptors||_d.resolve("epi.cms.contentRepositoryDescriptors");var _13,_14=function(_15){return _8.isBaseTypeIdentifier(this.selectedContentType,_15);};for(var _16 in _12){var _17=_12[_16];if(_1.some(_17.containedTypes,_14,this)){_13=_17;break;}}return _13.preventContextualContentFor;},_getTypesToDisplay:function(){if(!this._typesToDisplay){var _18=[];this._getContainerTypesRecursive(this.allowedTypes,_18);this._typesToDisplay=_18;}return this._typesToDisplay;},_getContainerTypesRecursive:function(_19,_1a,_1b){if(!_1b){_1b=[];}_1.forEach(_19,_3.hitch(this,function(_1c){if(_1.indexOf(_1b,_1c)===-1){_1b.push(_1c);if(_1.indexOf(_1a,_1c)===-1){_1a.push(_1c);}var _1d=_8.getValue(_1c,"containerTypes");if(_1d){this._getContainerTypesRecursive(_1d,_1a,_1b);}}}));},_setValueAttr:function(_1e){if(_1e){this._contentRef=_1e;var _1f=this._contentRef==="-"?null:this._contentRef;if(this.multiRootsMode){_4(this.tree.onLoadDeferred,_3.hitch(this,function(){this.tree.selectContent(_1f);}));}else{if(!_7.isEmpty(_1f)){this.tree.selectContent(_1f);}}}else{this._contentRef=null;this._clearSelectedContent();}},_getValueAttr:function(){this.inherited(arguments);if(this._contentRef){return this._contentRef.toString();}else{return "";}},_clearSelectedContent:function(){this.tree.set("selectedNodes",[]);this.tree.set("selectedItems",[]);},getActions:function(){return this.canSelectOwnerContent?[{name:"selectpage",label:_e.currentpage,settings:{type:"submit"},action:_3.hitch(this,function(){this._setValueOwnerContent();})}]:[];},_onTreeNodeClick:function(_20){var _21=_20.contentLink;var _22=_1.indexOf(this.allowedTypes,_20.typeIdentifier)!==-1;if(!_22){_22=_1.some(this.allowedTypes,function(_23){return _8.isBaseTypeIdentifier(_20.typeIdentifier,_23);});}if(!_22){this.tree.lastFocused.setSelected(false);_21=null;}this.set("value",_21);this.onChange(this.get("value"));},_setValueOwnerContent:function(){this.set("value","-");},onChange:function(_24){},focus:function(){this.tree.focus();}});});