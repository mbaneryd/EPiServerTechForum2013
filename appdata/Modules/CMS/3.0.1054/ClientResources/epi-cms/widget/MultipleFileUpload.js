//>>built
require({cache:{"url:epi-cms/widget/templates/MultipleFileUpload.html":"<div class=\"epi-multiFileUpload\">\r\n    <form method=\"post\" action=\"\" enctype=\"multipart/form-data\">\r\n        <div data-dojo-attach-point=\"breadcrumbBar\" data-dojo-type=\"epi-cms/widget/Breadcrumb\"></div>\r\n        <div data-dojo-attach-point=\"uploadToolbar\" class=\"epi-toolbar-unwrapped\">\r\n            <span title=\"${res.uploadform.addfiles}\" >\r\n                <input type=\"file\" multiple=\"multiple\" data-dojo-type=\"dojox.form.Uploader\" data-dojo-attach-point=\"uploaderInput\" \r\n                    data-dojo-props=\"iconClass:'epi-iconPlus', showLabel: false, multiple: true\" />\r\n            </span>\r\n            <div data-dojo-attach-point=\"toolbarDisableLayer\"></div>\r\n        </div>\r\n        <div data-dojo-attach-point=\"fileList\" data-dojo-type=\"epi-cms/widget/FileList\"></div>\r\n    </form>\r\n</div>"}});define("epi-cms/widget/MultipleFileUpload",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/aspect","dojo/when","dojo/Evented","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/Toolbar","dojox/form/Uploader","dojox/form/uploader/plugins/Flash","epi/routes","epi/shell/widget/dialog/Alert","epi-cms/widget/Breadcrumb","epi-cms/widget/FileList","epi-cms/widget/MultipleFileUploadConfirmation","epi-cms/widget/UploadUtil","epi-cms/widget/viewmodel/FileListViewModel","dojo/text!./templates/MultipleFileUpload.html","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18){return _2([_a,_b,_c,_9],{res:_18,_isCompleted:true,_uploadStatus:[],templateString:_17,postCreate:function(){this.inherited(arguments);this._setupUploader();this._setupFileList();this._confirmationDialog=this._confirmationDialog||new _14();},upload:function(_19){var _1a=this,_1b=_1a.uploaderInput,_1c=_1a._getUploadSettings();_8(_1a.model.upload(_19),function(_1d){_8(_1a._confirm(_1d),function(_1e){_1a._resetUploader();if(!(_1e instanceof Array)||_1e.length===0){return;}_1a._fileListModel.set("uploadFiles",_1e);_1b._files=_1e;_1b.upload(_1c);});});},close:function(){var _1f=this,_20=_1f.uploaderInput._files,_21=function(_22){_1f.emit("close",_22);_1f.set("disableToolbar",false);};if(_1f._isCompleted||!_20||_20.length<=0){_21(false);}else{var _23=new _11({description:_18.confirmdialog.description,onAction:function(){_21(true);}});_23.show();}},_setUploadStatusAttr:function(_24,_25,_26){this._uploadStatus=_15.addStatus(this._uploadStatus,_24,_25,_26);},_getUploadStatusAttr:function(){return this._uploadStatus;},_setBreadcrumbAttr:function(_27){this.breadcrumbBar._cleanUp();this.breadcrumbBar._availableWidth=_5.getContentBox(this.breadcrumbBar.domNode).w;var i=0,_28=_27?_27.length:0;if(_28>0){for(i;i<_28-1;i++){this.breadcrumbBar._createItem(_27[i],true);}this.breadcrumbBar._createItem(_27[_28-1],false);}},_setDisableToolbarAttr:function(_29){var _2a=this.uploaderInput;if(_15.supportNativeDndFiles()){_2a.set("disabled",_29);!_29&&_2a.set("tabindex",0);}else{_4.toggle(this.toolbarDisableLayer,"epi-uploadToolbarOverlay",_29);_15.toggleVisibility(this.toolbarDisableLayer,_29);_2a.flashMovie&&(_29===false?_2a.flashMovie.focus():_2a.flashMovie.blur());if(_29===true&&!this._toolbarSize){this._toolbarSize=_5.position(this.uploadToolbar);_6.set(this.toolbarDisableLayer,{"width":this._toolbarSize.w+"px","height":this._toolbarSize.h+"px"});}}},_setupUploader:function(){this._setupUploaderDefault();this._setupUploaderHtml5Plugin();this._setupUploaderFlashPlugin();},_setupUploaderDefault:function(){var _2b=this,_2c=_2b.uploaderInput;_2c.uploadUrl=_10.getActionPath({moduleArea:"CMS",controller:"FileUpload",action:"Upload"});_2b.own(_7.before(_2c,"onChange",function(_2d){_2b._isCompleted=false;_2b.set("disableToolbar",true);return [_2b._getUploadSettings()];}));},_setupUploaderHtml5Plugin:function(){if(!_15.supportNativeDndFiles()){return;}var _2e=this;_2e.own(_2e.uploaderInput.on("error",function(err){_2e.set("uploadStatus",_15.StatusScope.All,"",_18.uploadform.errormessage);_2e._onUploadComplete();}));},_setupUploaderFlashPlugin:function(){if(_15.supportNativeDndFiles()){return;}var _2f=this;_2f.own(_2f.uploaderInput.on("error",function(err){_2f.set("uploadStatus",_15.StatusScope.Single,err.target&&err.target.name,_18.uploadform.errormessage);}));_2f._setFlashUploaderSize();_2f._setFocusOnFlash();},_setFlashUploaderSize:function(){this.own(_7.around(this.uploaderInput,"_createInput",function(_30){return function(){var _31=_3.clone(this.btnSize);this.btnSize.w+=10;this.btnSize.h+=10;_30.apply(this,arguments);this.btnSize=_31;};}));},_setFocusOnFlash:function(){var _32=this.uploaderInput;["focus","load"].forEach(function(_33){_32.on(_33,function(){setTimeout(function(){var swf=_32.flashMovie;if(swf){swf.focus();}return;},1);});},this);},_getUploadSettings:function(){return {"useFlash":!_15.supportNativeDndFiles(),"uploadDirectory":this.get("uploadDirectory"),"createAsLocalAsset":this.get("createAsLocalAsset")};},_setupFileList:function(){var _34=this,_35=this.uploaderInput;_34._fileListModel=new _16();_34.fileList.set("model",_34._fileListModel);this.own(_35.on("begin",function(_36){if(_36&&_36.length>0){_34._fileListModel.set("showProgressBar",true);}}),_35.on("progress",function(_37){_34._fileListModel.set("progress",_37);}),_35.on("complete",_3.hitch(_34,_34._onUploadComplete)),_7.after(_35,"reset",_3.hitch(_34,_34._fileListModel.clear)),_7.around(_35,"onChange",function(_38){return function(_39){var _3a=_35._files;return _8(_34.model.upload(_3a),function(_3b){return _8(_34._confirm(_3b),function(_3c){_34._clearUploadStatus();_3c=_15.getFileArray(_3c);if(!(_3c instanceof Array)||_3c.length===0){_34._resetUploader();return _38.apply(_35,[_39]);}_34._fileListModel.set("uploadFiles",_3c);_35._files=_3c;_35.upload(_34._getUploadSettings());return _38.apply(_35,[_39]);});});};}));},_confirm:function(_3d){return _3d.showConfirmation===true?this._confirmationDialog.showConfirmation(_3d.existingContents,_3d.uploadingFiles,_3d.newFiles):_3d.uploadingFiles;},_clearUploadStatus:function(){this._uploadStatus=[];},_clearUploadFiles:function(){this.uploaderInput._files=[];},_resetUploader:function(){var _3e=this,_3f=_3e.uploaderInput,_40=function(){_3e._fileListModel.set("showProgressBar",false);_3f.reset();_3e.set("disableToolbar",false);};if(_15.supportNativeDndFiles()){_40();return;}(_3f.flashMovie&&_3f.flashMovie["reset"])&&_40();},_onUploadComplete:function(evt){this._isCompleted=true;if(evt){if(evt instanceof Array){var _41="";_1.forEach(evt,function(_42){_41=_42.errorMessage||_42.error;if(_41!=="server timeout"){if(!_15.supportNativeDndFiles()&&_42.additionalParams&&_42.additionalParams.replaceChar){_15.setAltCommaChar(_42.additionalParams.replaceChar);}this.set("uploadStatus",_42.index?_15.StatusScope.Single:_15.StatusScope.All,_42.fileName||_42.name,_41);}},this);}else{if(evt.isValid===false&&evt.saved===false){this.set("uploadStatus",_15.StatusScope.All,"",evt.errorMessage);}}}this._fileListModel.set("uploadStatus",this.get("uploadStatus"));this.set("disableToolbar",false);this._clearUploadFiles();this.emit("uploadComplete",!this._fileListModel.uploadStatus?this._fileListModel.uploadFiles:null);}});});