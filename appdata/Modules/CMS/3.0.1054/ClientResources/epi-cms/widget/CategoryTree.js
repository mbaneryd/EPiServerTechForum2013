//>>built
define("epi-cms/widget/CategoryTree",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/Tree","epi","epi-cms/widget/_CategoryTreeNode","epi-cms/widget/CategoryTreeStoreModel"],function(_1,_2,_3,_4,_5,_6,_7){return _2([_4],{showRoot:false,selectedNodeIds:null,selectedNodeData:null,constructor:function(){this.selectedNodeIds=[];this.selectedNodeData={};},postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.model=new _7({rootCategory:this.rootCategory});this.persist=false;}},postCreate:function(){this.inherited(arguments);this.connect(this,"onOpen",_3.hitch(this,this._onNodeOpen));this.connect(this,"onClose",_3.hitch(this,this._onNodeClose));this.watch("selectedNodeData",_3.hitch(this,this._loadSelectedNodes));},startup:function(){this.inherited(arguments);this.dndController.singular=true;},buildNodeFromTemplate:function(_8){return new _6(_8);},getNodeById:function(_9){var _a=this.getNodesByItem(_9.toString());if(!_a){return null;}return _a[0];},_getTotalSelectedNodes:function(_b,_c,_d){if(!_b||!_b.item||!_b.item.hasChildren||!_3.isArray(_c)||_c.length===0||!_d){return 0;}var _e=0,_f=[],_10=[],_11=_3.clone(_b.item.parentsNameCollection);var _12=function(_13){if(_3.isArray(_13)&&_13.length>0){_13.pop();}};_11[_11.length-1]=_b.item.name;_1.forEach(_c,function(_14){_f=_3.clone(_d[_14]);_12(_f);_10=_3.clone(_f);_3.mixin(_10,_11);if(_3.isArray(_f)&&_5.areEqual(_f,_10)){_e++;}},this);return _e;},_setTotalSelectedNodes:function(_15){if(_15){_15.set("totalSelectedNodes",this._getTotalSelectedNodes(_15,this.selectedNodeIds,this.selectedNodeData));_1.forEach(_15.getChildren(),function(_16){if(_16&&_16.item&&_16.item.hasChildren){if(_16.isExpanded){this._setTotalSelectedNodes(_16);}else{_16.set("totalSelectedNodes",this._getTotalSelectedNodes(_16,this.selectedNodeIds,this.selectedNodeData));}}},this);}},_loadSelectedNodes:function(){this.expandChildrenDeferred.then(_3.hitch(this,function(){this.set("toggleSelectNodes",this.rootNode,this.selectedNodeIds);this._setTotalSelectedNodes(this.rootNode);}));},_onNodeCreated:function(_17){_17.set("totalSelectedNodes",this._getTotalSelectedNodes(_17,this.selectedNodeIds,this.selectedNodeData));},_onNodeSelectChanged:function(_18,_19){if(!this.getNodeById(_19.id)){return;}var _1a=this.selectedNodeIds.indexOf(_19.id),_1b=_1a!=-1;if(_18&&!_1b){this.selectedNodeIds.push(_19.id);this.selectedNodeData[_19.id]=_19.parentsNameCollection;}if(!_18&&_1b){this.selectedNodeIds.splice(_1a,1);this.selectedNodeData[_19.id]={};}},_onNodeOpen:function(_1c,_1d){this.set("toggleSelectNodes",_1d,this.selectedNodeIds);this._setTotalSelectedNodes(_1d);},_onNodeClose:function(_1e,_1f){this._setTotalSelectedNodes(_1f);},_setToggleSelectNodesAttr:function(_20,_21){if(!_20||!_3.isArray(_21)){return;}var _22=false;_1.forEach(_20.getChildren(),function(_23){if(_23){_22=_21.indexOf(_23.item.id)!=-1;_23.set("checked",_22);if(_23.hasChildren()){this.set("toggleSelectNodes",_23,_21);}}},this);},_createTreeNode:function(_24){var _25=this.buildNodeFromTemplate(_24);_25.connect(_25,"onNodeSelectChanged",_3.hitch(this,function(_26,_27){this._onNodeSelectChanged(_26,_27);}));this._onNodeCreated(_25);return _25;}});});