//>>built
require({cache:{"url:epi-cms/widget/templates/ContentSelector.html":"<div class=\"dijitReset dijitInputField dijitInputContainer dijitInline epi-resourceInputContainer\" id=\"widget_${id}\">\r\n    <div data-dojo-attach-point=\"displayNode, dropAreaNode, stateNode\" class=\"dijit dijitReset dijitInline dijitInlineTable dijitLeft dijitTextBox displayNode\">\r\n        <div class=\"dijitReset dijitLeft dijitInputField dijitInputContainer\">\r\n            <div data-dojo-attach-point=\"clearButton\" class=\"epi-clearButton\">&nbsp;</div>\r\n            <div data-dojo-attach-point=\"resourceName\" class=\"dijitInline epi-resourceName dojoxEllipsis\"/>\r\n                <span data-dojo-attach-point=\"selectedContentNameNode\"></span> <span data-dojo-attach-point=\"selectedContentLinkNode\"></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <input type=\"hidden\" ${!nameAttrSetting} value=\"${value}\" data-dojo-attach-point=\"input\"/>\r\n    <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick: _onButtonClick\" data-dojo-attach-point=\"button\" data-dojo-props=\"label:'...'\"></div>\r\n</div>"}});define("epi-cms/widget/ContentSelector",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/dom-class","dojo/dom-style","dojo/query","dojo/string","dojo/when","dijit/_CssStateMixin","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/focus","dijit/form/Button","epi/dependency","epi/shell/TypeDescriptorManager","epi/shell/widget/_ValueRequiredMixin","epi/shell/widget/dialog/Dialog","epi-cms/core/ContentReference","epi-cms/core/PermanentLinkHelper","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/_Droppable","epi-cms/widget/_HasClearButton","epi-cms/widget/_HasChildDialogMixin","epi-cms/widget/ContentSelectorDialog","dojo/text!./templates/ContentSelector.html","epi/i18n!epi/cms/nls/episerver.cms.widget.contentselector"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_1a,_1b,_1c){return _2([_c,_b,_d,_a,_18,_19,_17,_12],{templateString:_1b,roots:null,value:null,required:false,missingMessage:_1c.requiredmessage,tooltipPosition:[],contentLink:null,permanentLink:null,canSelectOwnerContent:false,accessLevel:_16.accessLevel.Read,showAllLanguages:true,_setSelectedContentNameAttr:function(_1d){_7(this.selectedContentNameNode).text(_1d);},_setDisabledAttr:function(_1e){this.inherited(arguments);this.button.set("disabled",_1e);this._set("disabled",_1e);},_setSelectedContentLinkAttr:{node:"selectedContentLinkNode",type:"innerHTML"},postMixInProperties:function(){this.inherited(arguments);var _1f=_10.resolve("epi.storeregistry");this._store=_1f.get("epi.cms.content.light");if(!this.roots){var _20=this.contentRepositoryDescriptors||_10.resolve("epi.cms.contentRepositoryDescriptors");var _21=_20[this.repositoryKey];this.roots=_21.roots;}this.nameAttrSetting=this.name?("name=\""+this.name.replace(/"/g,"&quot;")+"\""):"";},_setReadOnlyAttr:function(_22){this._set("readOnly",_22);_6.set(this.button.domNode,"display",_22?"none":"");_6.set(this.clearButton,"display",_22?"none":"");_5.toggle(this.domNode,"dijitReadOnly",_22);},_setValueAttr:function(_23){this._set("value",_23);this._setValueAndFireOnChange(_23);},_getDialog:function(){if(this.dialog&&this.dialog.domNode){return this.dialog;}var _24=_1c.title;if(this.allowedTypes&&this.allowedTypes.length===1){var _25=_11.getResourceValue(this.allowedTypes[0],"name");if(_25){_24=_8.substitute(_1c.format,[_25]);}}this.contentSelectorDialog=new _1a({canSelectOwnerContent:this.canSelectOwnerContent,showButtons:false,roots:this.roots,allowedTypes:this.allowedTypes,showAllLanguages:this.showAllLanguages});this.dialog=new _13({title:_24,dialogClass:"epi-dialog-portrait",content:this.contentSelectorDialog,destroyOnHide:true});this.connect(this.contentSelectorDialog,"onChange","_setDialogButtonState");this.connect(this.dialog,"onExecute","_onDialogExecute");this.connect(this.dialog,"onHide","_onDialogHide");return this.dialog;},_isContentAllowed:function(_26){var _27=_1.indexOf(this.allowedTypes,_26)!==-1;if(!_27){_27=_1.some(this.allowedTypes,function(_28){return _11.isBaseTypeIdentifier(_26,_28);});}return _27;},_onButtonClick:function(){_9(this._getContentData(this.contentLink),_3.hitch(this,function(_29){this.canSelectOwnerContent=_29&&this._isContentAllowed(_29.typeIdentifier);var _2a=this._getDialog();this.isShowingChildDialog=true;var _2b;if(this.value){_2b=this._convertValueToContentReference(this.value);}if(_2b){_2b=_2b.createVersionUnspecificReference().toString();}this.contentSelectorDialog.set("value",_2b);_2a.show();}));},_onDialogExecute:function(){var _2c=this.contentSelectorDialog.get("value");this._setValueAndFireOnChange(_2c);},_convertValueToContentReference:function(_2d){return new _14(_2d);},_onDialogHide:function(){this.isShowingChildDialog=false;},_setValueAndFireOnChange:function(_2e){var _2f=_2e==="-"?this.contentLink:_2e;this.set("permanentLink",null);_9(this._getContentData(_2f),_3.hitch(this,function(_30){var _31=this.value!==_2f;this.value=_2f;this.input.value=this.value;this._started&&this.validate();this._updateDisplayNode(_30);if(_31){this.onChange(_2f);}if(_30){this.set("permanentLink",_15.toPermanentLink(_30));}}));},_getContentData:function(_32){if(!_32){return null;}return this._store.get(_32);},_getValueAttr:function(){return this.value;},_onFocus:function(){if(this.get("disabled")){return;}this.inherited(arguments);this.validate();},_onBlur:function(){if(this.get("disabled")){return;}this.inherited(arguments);this.validate();},focus:function(){if(!this.button.disabled&&this.button.focusNode&&this.button.focusNode.focus){try{_e.focus(this.button.focusNode);}catch(e){}}},onChange:function(_33){},_updateDisplayNode:function(_34){if(_34){_5.remove(this.domNode,"epi-noValue");_5.remove(this.resourceName,"dijitPlaceHolder");this.set("selectedContentName",_34.name);this.set("selectedContentLink",new _14(_34.contentLink).id);}else{_5.add(this.domNode,"epi-noValue");_5.add(this.resourceName,"dijitPlaceHolder");this.set("selectedContentName",_1c.helptext);this.set("selectedContentLink","");}},reset:function(){this.set("value",null);},_setDialogButtonState:function(_35){var _36=this;if(!_35){return;}_9(_36._store.get(_35),function(_37){_36.dialog.definitionConsumer.setItemProperty(_36.dialog._okButtonName,"disabled",!_16.hasAccess(_37.accessMask,_36.accessLevel));});}});});