//>>built
require({cache:{"epi-cms/layers/cms-widgets":function(){define(["dijit/form/ValidationTextBox","epi-cms/_ContentContextMixin","epi-cms/ApplicationSettings","epi-cms/CMSModule","epi-cms/component/ContextHistory","epi-cms/component/GlobalToolbar","epi-cms/component/MainNavigationComponent","epi-cms/component/Media","epi-cms/component/PageNavigationTree","epi-cms/component/RecentlyChanged","epi-cms/component/SharedBlocks","epi-cms/component/SiteTree","epi-cms/component/Tasks","epi-cms/component/Trash","epi-cms/component/Versions","epi-cms/contentediting/_Renderer","epi-cms/contentediting/ContentDetails","epi-cms/contentediting/CreateContent","epi-cms/contentediting/CreateLanguageBranch","epi-cms/contentediting/DateTimeNowEditor","epi-cms/contentediting/DialogEditorWrapper","epi-cms/contentediting/EditActionPanel","epi-cms/contentediting/EditingBase","epi-cms/contentediting/editors/CheckBoxListEditor","epi-cms/contentediting/editors/CollectionEditor","epi-cms/contentediting/editors/ContentAreaEditor","epi-cms/contentediting/editors/ItemCollectionEditor","epi-cms/contentediting/editors/PreviewableDateTimeEditor","epi-cms/contentediting/editors/PreviewableTextEditor","epi-cms/contentediting/editors/SelectionEditor","epi-cms/contentediting/editors/ShortcutEditor","epi-cms/contentediting/editors/TinyMCEEditor","epi-cms/contentediting/editors/TinyMCEInlineEditor","epi-cms/contentediting/EditToolbar","epi-cms/contentediting/FloatingEditorWrapper","epi-cms/contentediting/FlyoutEditorWrapper","epi-cms/contentediting/FormEditing","epi-cms/contentediting/InlineEditorWrapper","epi-cms/contentediting/NotificationBar","epi-cms/contentediting/OnPageEditing","epi-cms/contentediting/PageDataController","epi-cms/contentediting/PropertyRenderer","epi-cms/contentediting/PublishMenu","epi-cms/contentediting/SettingsPanel","epi-cms/contentediting/ValidationTextboxWithWarning","epi-cms/contentediting/viewmodel/ContentDetailsViewModel","epi-cms/conversion/PropertyContentAreaConverter","epi-cms/conversion/PropertyDateConverter","epi-cms/core/ContentReference","epi-cms/layout/CreateContentGroupContainer","epi-cms/layout/EditLayoutContainer","epi-cms/legacy/LegacyDialogPopup","epi-cms/legacy/LegacyFormEditor","epi-cms/widget/_GridWidgetBase","epi-cms/widget/CategorySelector","epi-cms/widget/ContentSelector","epi-cms/widget/HyperLinkSelector","epi-cms/widget/NotificationStatusBar","epi-cms/widget/NotificationStatusZone","epi-cms/widget/overlay/Block","epi-cms/widget/overlay/ContentArea","epi-cms/widget/overlay/ItemCollection","epi-cms/widget/overlay/overlayFactory","epi-cms/widget/ReadOnlyDateTimeEditor","epi-cms/widget/TooltipDialog","epi-cms/widget/UrlContentSelector","epi-cms/widget/UrlSelector","epi-cms/widget/XFormEditor"],1);},"epi-cms/_ContentContextMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/when","dijit/Destroyable","epi/dependency","epi/UriParser","epi/shell/_ContextMixin","epi-cms/core/ContentReference"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){return _1([_9,_6],{ignoreVersionWhenComparingLinks:false,contentDataStore:null,_currentContentContext:null,postscript:function(){this.inherited(arguments);this.own(_3.after(this.getContentDataStore(),"onItemChanged",_2.hitch(this,this.itemChanged)));},getContentDataStore:function(){if(!this.contentDataStore){var _b=_7.resolve("epi.storeregistry");this.contentDataStore=_b.get("epi.cms.contentdata");}return this.contentDataStore;},getCurrentContent:function(){var _c=new _4();_5(this.getCurrentContext(),_2.hitch(this,function(_d){if(!this._isContentContext(_d)){_c.reject({message:"Not a content data",context:_d});return;}_5(this.getContentDataStore().get(_d.id),function(_e){_c.resolve(_e);});}));return _c;},contextChanged:function(_f,_10){this.inherited(arguments);if(!this._isContentContext(_f)){this._currentContentContext=null;return;}var _11=(_10&&_10.forceContextChange?_10.forceContextChange:false);if(!_11&&this._isSameAsCurrentContentContext(_f)){return;}this._currentContentContext=_f;this.contentContextChanged(_f,_10);},contextUpdated:function(ctx,_12){if(!this._isContentContext(ctx)){this._currentContentContext=null;return;}this._currentContentContext=ctx;this.contentContextUpdated(ctx,_12);},contentContextChanged:function(ctx,_13){},contentContextUpdated:function(ctx,_14){},itemChanged:function(id,_15){},_isContentContext:function(ctx){return ctx&&ctx.type==="epi.cms.contentdata";},_isSameAsCurrentContentContext:function(ctx){if(this._currentContentContext&&ctx){return this._currentContentContext.id===ctx.id&&(this._currentContentContext.languageContext&&ctx.languageContext&&this._currentContentContext.languageContext.preferredLanguage===ctx.languageContext.preferredLanguage);}else{return false;}},_isSameAsCurrentContext:function(uri){if(this._currentContext){return this._compareUris(uri,this._currentContext.uri);}else{return false;}},_compareUris:function(_16,_17){var _18=new _8(_16),_19=new _8(_17);if(this.ignoreVersionWhenComparingLinks&&_18.getType()==="epi.cms.contentdata"&&_19.getType()==="epi.cms.contentdata"&&_a.compareIgnoreVersion(_18.getId(),_19.getId())){return true;}else{if(_16===_17){return true;}}return false;}});});},"epi-cms/core/ContentReference":function(){define(["dojo/_base/declare","epi/epi"],function(_1a,epi){var _1b=_1a(null,{id:0,workId:0,providerName:null,isSelfReference:false,constructor:function(_1c){if(_1c){this._parse(_1c);}},_parse:function(_1d){if(typeof _1d==="object"){this.id=parseInt(_1d.ID||_1d.id||_1d.iD||_1d.Id,10);this.workId=parseInt(_1d.WorkID||_1d.workId||0,10);this.providerName=_1d.ProviderName||_1d.providerName||null;}else{if(typeof _1d==="string"){if(_1d==="-"){this.isSelfReference=true;this.id=0;this.workId=-1;}else{this.isSelfReference=false;var v=String();v.split("_");var _1e=_1d.split("_");this.id=parseInt(_1e[0],10);this.workId=parseInt(_1e[1],10)||0;this.providerName=_1e[2]||"";}}}if(typeof _1d==="number"){this.id=_1d;this.workId=0;this.providerName="";}if(typeof this.id!=="number"){throw new Error("The id parameter of a content reference must be an integer");}if(typeof this.workId!=="number"&&!this.isSelfReference){throw new Error("The workId of a content reference must be an integer");}},toString:function(){if(this.isSelfReference){return "-";}var _1f=String(this.id);if(this.workId!==0){_1f+="_"+this.workId;}if(this.providerName){_1f+=(this.workId===0?"__":"_")+this.providerName;}return _1f;},createVersionUnspecificReference:function(){return new _1b({id:this.id,providerName:this.providerName});}});_1b.toContentReference=function(obj){if(obj instanceof _1b){return obj;}else{if(typeof obj==="string"||typeof obj==="number"){return new _1b(obj);}}return _1b.emptyContentReference;};_1b.compareIgnoreVersion=function(_20,_21){var c1=_1b.toContentReference(_20);var c2=_1b.toContentReference(_21);var _22=c1.createVersionUnspecificReference();var _23=c2.createVersionUnspecificReference();return epi.areEqual(_22,_23);};_1b.emptyContentReference=new _1b({id:-1,workId:-1});return _1b;});},"epi-cms/ApplicationSettings":function(){define("epi-cms/ApplicationSettings",[],function(){return {};});},"epi-cms/CMSModule":function(){define("epi-cms/CMSModule",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","epi","epi/_Module","epi/dependency","epi/routes","epi/shell/conversion/ObjectConverterRegistry","epi/shell/store/JsonRest","epi/shell/store/Throttle","epi/shell/TypeDescriptorManager","epi/shell/ViewSettings","epi-cms/ApplicationSettings","epi-cms/BackContextHistory","epi-cms/ContextSynchronizer","epi-cms/conversion/ContentLightUriConverter","epi-cms/conversion/ContentReferenceConverter","epi-cms/conversion/PropertyDateConverter","epi-cms/core/ContentReference","epi-cms/store/CustomQueryEngine","epi-cms/store/PageVersionQueryEngine","epi-cms/component/command/GlobalToolbarCommandProvider","epi-cms/contentediting/EditorFactory","epi-cms/contentediting/InUseNotificationManager","epi-cms/contentediting/ViewSettingsManager","epi-cms/contentediting/command/Editing","epi-cms/contentediting/commandproviders/ContentDetails","epi-cms/contentediting/commandproviders/PublishMenu","epi-cms/contentediting/commandproviders/PublishMenuGlobal","epi-cms/contentediting/viewsettings/ChannelViewSetting","epi-cms/contentediting/viewsettings/ResolutionViewSetting","epi-cms/contentediting/viewsettings/ViewLanguageViewSetting","epi-cms/contentediting/viewsettings/VisitorGroupViewSetting","epi-cms/Profile"],function(_24,_25,_26,_27,epi,_28,_29,_2a,_2b,_2c,_2d,_2e,_2f,_30,_31,_32,_33,_34,_35,_36,_37,_38,_39,_3a,_3b,_3c,_3d,_3e,_3f,_40,_41,_42,_43,_44,_45){return _25([_28],{_settings:null,_hashWrapper:null,_firstTimeHashUpdated:false,constructor:function(_46){this._settings=_46;},initialize:function(){this.inherited(arguments);_25.safeMixin(_30,this._settings);this.registerDependency("epi.cms.BackContextHistory",new _31());this.registerDependency("epi.cms.ContextSynchronizer",new _32(),undefined,function(_47){_47.destroy();});this.registerDependency("epi.cms.contentEditing.command.Editing",_3d);this._hashWrapper=_29.resolve("epi.shell.HashWrapper");var _48=_29.resolve("epi.globalcommandregistry");var _49=new _40();_48.registerProvider("epi.cms.publishmenu",_49);var _4a=this.resolveDependency("epi.shell.ContextService");this.registerDependency("epi.cms.contentRepositoryDescriptors",this._settings.contentRepositoryDescriptors);_4a.registerRoute("epi.cms.contentdata",_26.hitch(this,this._redirectContentDataContext));this._initializeEditorFactory();this._initializeStores();this._setupConverters(_29);this._setupViewSettings(_4a);_48.registerProvider("epi.cms.globalToolbar",new _39());this._setupInUseNotificationManager(_48);var _4b=_29.resolve("epi.shell.Profile");var def=_4b.getContentLanguage();_27(def,function(_4c){_30.currentContentLanguage=_4b.contentLanguage=_4c;});return def;},_redirectContentDataContext:function(_4d,_4e,uri){if(_2f.viewName=="/episerver/dashboard"){var _4f=_2a.getActionPath({moduleArea:"CMS",controller:"Home",action:""});_4f=_4f.substring(0,_4f.length-1);var _50=_4f+"#"+this._hashWrapper.extractHash(_4d,_4e);this._redirect(_50);}else{if(_4d.hasSiteChanged){var _51=_4d.fullHomeUrl+"#"+this._hashWrapper.extractHash(_4d,_4e);this._redirect(_51);}else{if(_4e&&_4e.trigger=="internal"&&this._firstTimeHashUpdated){return;}this._firstTimeHashUpdated=true;this._hashWrapper.onContextChange(_4d,_4e);}}},_redirect:function(url){window.location=url;},_setupConverters:function(_52){var _53=new _33(),_54=new _34(),_55=new _35(),_56=this.resolveDependency("epi.cms.contentRepositoryDescriptors"),key;for(key in _56){var _57=_56[key];if(_57.linkableTypes){_57.linkableTypes.forEach(function(_58){_2b.registerConverter(_58,_58+".link",_53);_2b.registerConverter(_58,"link",_53);});}}for(key in _2e._uiDescriptors){var _59=_2e._uiDescriptors[key];_2b.registerConverter(_59.typeIdentifier,_59.typeIdentifier+".reference",_54);_2b.registerConverter(_59.typeIdentifier,_59.typeIdentifier+".light",_53);}_53.registerDefaultConverters(_2b);_55.registerDefaultConverters(_2b);},_setupViewSettings:function(_5a){var _5b=new _43();_5b.initialize(_5a);var _5c=new _3c({viewSettings:[new _42(),new _44(),new _41(),_5b]});this.registerDependency("epi.viewsettingsmanager",_5c);},_initializeStores:function(){var _5d=this.resolveDependency("epi.storeregistry"),_5e,_5f,_60;_5e=_5d.create("epi.cms.contentdata",this._getRestPath("contentdata"),{idProperty:"contentLink"});_5f=_5d.create("epi.cms.content.light",this._getRestPath("contentstructure"),{idProperty:"contentLink",queryEngine:_37});_60=_5d.create("epi.cms.contentversion",this._getRestPath("contentversion"),{idProperty:"contentLink",queryEngine:_38});_5d.create("epi.cms.displayoptions",this._getRestPath("displayoptions"));_5d.create("epi.cms.category",this._getRestPath("categories"));_5d.create("epi.cms.inusenotification",this._getRestPath("inusenotification")).addDependentStore(_5e);_5d.create("epi.cms.visitorgroup",this._getRestPath("visitorgroup"));_5d.create("epi.cms.language",this._getRestPath("language"),{idProperty:"languageId"});_5d.create("epi.cms.sitestructure",this._getRestPath("sitestructure"),{idProperty:"url"});_5d.create("epi.cms.displaychannels",this._getRestPath("channel"));_5d.create("epi.cms.wastebasket",this._getRestPath("wastebasket"));_5d.create("epi.cms.xform",this._getRestPath("xform"));_5d.create("epi.cms.workflowtask",this._getRestPath("workflowtask"),{idProperty:"taskId"});_5d.create("epi.cms.contenttype",this._getRestPath("contenttype"),{preventCache:false}).query();_5d.add("epi.cms.contentreferences",new _2d(new _2c({target:this._getRestPath("contentreferences"),idProperty:"contentLink"})));_5d.add("epi.cms.content.search",new _2d(new _2c({target:this._getRestPath("contentstructure"),idProperty:"contentLink"})));_5e.addDependentStore(_5f,{refreshOnPatch:true,refresh:function(_61){var id=_5e.getIdentity(_61);var _62=new _36(id).createVersionUnspecificReference().toString();_5f.refresh(_62);}});_5e.addDependentStore(_60,{transformDelegate:function(_63){if(_63.capabilities&&!_63.capabilities.supportsVersions){return null;}if(!_63.properties){return null;}var _64={"pageChangedBy":"savedBy","pageSaved":"savedDate","pageLanguageBranch":"language","pageName":"name","name":"name","icontent_name":"name"};var _65=_26.mixin({},_63);for(var p in _64){if(p in _65.properties){_65[_64[p]]=_65.properties[p];}}return _65;}});},_getRestPath:function(_66){return _2a.getRestPath({moduleArea:"cms",storeName:_66});},_initializeEditorFactory:function(){this.registerDependency("epi.cms.contentediting.EditorFactory",function(){var _67=new _3a();_67.registerEditorWrapper("inline","epi-cms.contentediting.InlineEditorWrapper",function(_68,_69){});_67.registerEditorWrapper("richtextinline","epi-cms.contentediting.RichTextInlineEditorWrapper",function(_6a,_6b){});_67.registerEditorWrapper("flyout","epi-cms.contentediting.FlyoutEditorWrapper",function(_6c,_6d){});_67.registerEditorWrapper("floating","epi-cms.contentediting.FloatingEditorWrapper",function(_6e,_6f){});_67.registerEditorWrapper("contenteditable","epi-cms.contentediting.ContentEditableWrapper",function(_70,_71){});_67.registerEditorWrapper("legacyProperty","epi-cms.contentediting.DialogEditorWrapper",function(_72,_73){_72.closeOnChange=true;_72.showButtons=false;});return _67;});},_setupInUseNotificationManager:function(_74){var _75=new _3b();this.registerDependency("epi.cms.contentediting.inUseNotificationManager",_75);_74.registerProvider("epi.cms.publishmenu",new _3f());_74.registerProvider("epi.cms.contentdetailsmenu",new _3e());}});});},"epi-cms/BackContextHistory":function(){define("epi-cms/BackContextHistory",["dojo/_base/declare","dojo/_base/lang","dojo/store/Memory","epi/shell/ContextHistory"],function(_76,_77,_78,_79){return _76([_79],{createStore:function(){return new _78({data:[],idProperty:"index"});},onContextChanged:function(_7a,_7b,_7c){if(_7b&&_7b.trigger==="back"){this._removeLastItem();return;}this.inherited(arguments);},getPrevious:function(){var _7d=this.store.query({},{count:2,sort:[{attribute:"dateAdded",descending:true}]});return (_7d&&_7d.length>1)?_7d[1]:null;},_updateStore:function(_7e){var _7f=this._getLastItem();if(_7f&&_7f.uri===_7e.versionAgnosticUri){return;}this.inherited(arguments);},_getLastItem:function(){if(this.store&&this.store.data&&this.store.data.length>0){return this.store.data[this.store.data.length-1];}return null;},_removeLastItem:function(){var _80=this._getLastItem();if(_80){this.store.remove(this.store.getIdentity(_80));}}});});},"epi-cms/ContextSynchronizer":function(){define("epi-cms/ContextSynchronizer",["dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/when","epi/shell/_ContextMixin","epi-cms/core/ContentReference"],function(_81,_82,_83,_84,_85,_86){return _81([_85],{_subscribeHandle:null,constructor:function(){this._subscribeHandle=_83.subscribe("/epi/cms/contentdata/updated",this,this._updateCurrentContext);},_updateCurrentContext:function(_87){var _88=_87.contentLink;_84(this.getCurrentContext(),function(_89){if(_89&&_86.compareIgnoreVersion(_89.id,_88)){var _8a={uri:"epi.cms.contentdata:///"+_88};if(_89.languageContext){_8a.epslanguage=_89.languageContext.preferredLanguage;}_83.publish("/epi/shell/context/updateRequest",_8a);}});},destroy:function(){_83.unsubscribe(this._subscribeHandle);}});});},"epi-cms/conversion/ContentLightUriConverter":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi/UriParser","epi-cms/core/ContentReference","epi-cms/core/PermanentLinkHelper"],function(_8b,_8c,_8d,_8e,_8f,_90,_91){return _8b(null,{_contentStore:null,constructor:function(_92){_8c.mixin(this,_92);this._contentStore=this._contentStore||_8e.resolve("epi.storeregistry").get("epi.cms.content.light");},registerDefaultConverters:function(_93){},convert:function(_94,_95,_96){if(!_96||(!_96.contentLink&&!_96.uri)){return null;}var _97=_96.contentLink||new _8f(_96.uri).getId();if(!_97){return null;}_97=new _90(_97).createVersionUnspecificReference().toString();return _8d(this._contentStore.get(_97),function(_98){return {url:_98.publicUrl,previewUrl:_98.previewUrl,permanentUrl:_91.toPermanentLink(_98),text:_98.name,typeIdentifier:_98.typeIdentifier};});}});});},"epi-cms/core/PermanentLinkHelper":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/store/Memory","dojo/when","epi/dependency","epi/Url","epi-cms/ApplicationSettings","epi-cms/core/ContentReference"],function(_99,_9a,_9b,_9c,_9d,_9e,Url,_9f,_a0){var _a1={_cacheStore:new _9c({idAttribute:"id",data:[]}),_storeCache:function(_a2){if(!_a2){return;}var _a3=this._cacheStore.get(_a2.contentLink);if(_a3){return;}this._cacheStore.put({id:_a2.contentLink,internalLink:this._toInternal(_a2)});},_tryGetContentLink:function(_a4){if(!_a4){return null;}var url=new Url(_a4),_a5=url.query["id"];if(!_a5){try{_a5=_a0.toContentReference(_a4);if(isNaN(_a5.id)){return null;}return _a5.toString();}catch(e){return null;}}return _a5;},_toInternal:function(_a6){var _a7,_a8=_9f.applicationVirtualPath||"";if(_a6){_a7=_a8+"/link/"+_a6.contentGuid.replace(/-/g,"")+".aspx";_a7=_a7.replace(/\/\//g,"/");}return _a7;},toPermanentLink:function(_a9,_aa){this._storeCache(_a9);return this._toInternal(_a9);},isPermanentLink:function(_ab){return (/(\/link\/)(?=([0-9a-z]{32})(\.aspx))/i).test(_ab);},getContent:function(_ac,_ad){if(!_ac){return null;}var dfd=new _9a(),_ae=_9e.resolve("epi.storeregistry"),_af=_ae.get("epi.cms.content.light"),_b0=_9b.mixin({"query":"getcontentbypermanentlink","permanentLink":_ac},_ad||{}),_b1;var _b2=this._cacheStore.query({internalLink:_ac}),_b3=_b2&&_b2.length>0,_b4=this.isPermanentLink(_ac),_b5=_b4?null:this._tryGetContentLink(_ac);_b1=_b3||_b5?_af.get(_b5||_b2[0].id):_af.query(_b0);_9d(_b1,_9b.hitch(this,function(_b6){var _b7=_b6&&_b6 instanceof Array?_b6[0]:_b6;if(!_b3){this._storeCache(_b7);}dfd.resolve(_b7);}));return dfd;}};return _a1;});},"epi-cms/conversion/ContentReferenceConverter":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi/UriParser","epi-cms/core/ContentReference"],function(_b8,_b9,_ba,_bb,_bc,_bd){return _b8(null,{convert:function(_be,_bf,_c0){if(!_c0){return null;}var uri=new _bc(_c0.uri);var _c1=uri.getId();var _c2=new _bd(_c1).createVersionUnspecificReference().toString();return _c2;}});});},"epi-cms/conversion/PropertyDateConverter":function(){define(["dojo/_base/declare","dojo/date/locale","epi/datetime"],function(_c3,_c4,_c5){return _c3(null,{sourceDataType:"epi.cms.propertydate",targetDataType:"runtimeType",registerDefaultConverters:function(_c6){_c6.registerConverter(this.sourceDataType,this.targetDataType,this);},convert:function(_c7,_c8,_c9){if(_c9&&_c7===this.sourceDataType&&_c8===this.targetDataType){var _ca=_c5.deserialize(_c9);var _cb=_c4.format(_ca,{});return _c4.parse(_cb,{});}return null;}});});},"epi-cms/store/CustomQueryEngine":function(){define(["dojo/_base/array"],function(_cc){return function(_cd,_ce){switch(typeof _cd){case "object":case "undefined":var _cf=_cd;_cd=function(_d0){for(var key in _cf){if(_ce&&_ce.ignore){var _d1;for(var _d2 in _ce.ignore){if(key==_ce.ignore[_d2]){_d1=true;break;}}if(_d1){_d1=false;continue;}}var _d3=_cf[key];if(_ce&&_ce.comparers&&_ce.comparers[key]){if(!_ce.comparers[key](_d3,_d0)){return false;}}else{if(_d3&&_d3.test){if(!_d3.test(_d0[key])){return false;}}else{if(_d3&&_d3!=_d0[key]){return false;}}}}return true;};break;case "string":if(!this[_cd]){throw new Error("No filter function "+_cd+" was found in store");}_cd=this[_cd];break;case "function":break;default:throw new Error("Can not query with a "+typeof _cd);}function _d4(_d5){var _d6=_cc.filter(_d5,_cd);if(_ce&&_ce.sort){_d6.sort(function(a,b){for(var _d7,i=0;_d7=_ce.sort[i];i++){var _d8=a[_d7.attribute];var _d9=b[_d7.attribute];if(typeof _d8==="string"&&typeof _d9==="string"){_d8=_d8.toLowerCase();_d9=_d9.toLowerCase();}if(_d8!=_d9){return _d7.descending==(_d8>_d9)?-1:1;}}return 0;});}if(_ce&&(_ce.start||_ce.count)){var _da=_d6.length;_d6=_d6.slice(_ce.start||0,(_ce.start||0)+(_ce.count||Infinity));_d6.total=_da;}return _d6;};_d4.matches=_cd;return _d4;};});},"epi-cms/store/PageVersionQueryEngine":function(){define(["dojo/_base/array","epi-cms/core/ContentReference"],function(_db,_dc){return function(_dd,_de){switch(typeof _dd){case "object":case "undefined":var _df=_dd;_dd=function(_e0){for(var key in _df){var _e1,_e2=_df[key],_e3=_e2.toString();if(_e3.indexOf("_")>=0){_e1=new _dc(_e3);_e2=RegExp("^"+_e1.id+"_.*$");}if(_e2&&_e2.test){if(!_e2.test(_e0[key])){return false;}}else{if(_e2!=_e0[key]){return false;}}}return true;};break;case "string":if(!this[_dd]){throw new Error("No filter function "+_dd+" was found in store");}_dd=this[_dd];break;case "function":break;default:throw new Error("Can not query with a "+typeof _dd);}function _e4(_e5){var _e6=_db.filter(_e5,_dd);if(_de&&_de.sort){_e6.sort(function(a,b){for(var _e7,i=0;_e7=_de.sort[i];i++){var _e8=a[_e7.attribute];var _e9=b[_e7.attribute];if(_e8!=_e9){return _e7.descending==(_e8>_e9)?-1:1;}}return 0;});}if(_de&&(_de.start||_de.count)){var _ea=_e6.length;_e6=_e6.slice(_de.start||0,(_de.start||0)+(_de.count||Infinity));_e6.total=_ea;}return _e6;};_e4.matches=_dd;return _e4;};});},"epi-cms/component/command/GlobalToolbarCommandProvider":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/topic","dojo/when","dijit/form/ToggleButton","dijit/layout/ContentPane","epi/dependency","epi/shell/ViewSettings","epi/shell/command/_Command","epi/shell/command/ToggleCommand","epi/shell/ViewSettings","epi/shell/widget/ExpandoButton","epi-cms/widget/ViewSettingsExpandoButton","epi-cms/widget/VisitorGroupButton","epi-cms/widget/ChannelsButton","epi-cms/widget/ViewLanguageButton","epi-cms/widget/command/CreateContentFromSelector","epi-cms/component/command/_GlobalToolbarCommandProvider","epi/i18n!epi/cms/nls/episerver.cms.contentediting"],function(_eb,_ec,_ed,_ee,_ef,_f0,_f1,_f2,_f3,_f4,_f5,_f6,_f7,_f8,_f9,_fa,_fb,_fc,_fd,_fe,_ff){var _100=_ec([_f6],{iconClass:"epi-iconTree",tooltip:_ff.toolbar.buttons.togglenavigationpane,label:_ff.toolbar.buttons.togglenavigationpane,canExecute:true,constructor:function(){_ef.subscribe("/epi/layout/pinnable/navigation/visibilitychanged",_ee.hitch(this,function(_101){this.set("active",_101);}));},_execute:function(){_ef.publish("/epi/layout/pinnable/navigation/toggle");}});var _102=_ec([_f6],{iconClass:"epi-iconFolder",tooltip:_ff.toolbar.buttons.toggleassetspane,label:_ff.toolbar.buttons.toggleassetspane,canExecute:true,constructor:function(){_ef.subscribe("/epi/layout/pinnable/tools/visibilitychanged",_ee.hitch(this,function(_103){this.set("active",_103);}));},_execute:function(){_ef.publish("/epi/layout/pinnable/tools/toggle");}});var _104=_ec([_f5],{iconClass:"epi-iconEye",canExecute:true,label:_ff.toolbar.buttons.viewsetting.viewsettingbutton,constructor:function(){_ef.subscribe("/epi/shell/action/viewchanged",_ee.hitch(this,function(view){this.set("isAvailable",typeof view!="string"||view=="epi-cms/contentediting/PageDataController");}));}});var _105=_ec([_f6],{iconClass:"epi-iconPreview",tooltip:_ff.toolbar.buttons.togglepreviewmode.label,label:_ff.toolbar.buttons.togglepreviewmode.label,canExecute:true,constructor:function(){this._profile=_f3.resolve("epi.shell.Profile");this._setPanelSettings();_ef.subscribe("/epi/cms/action/disablepreview",_ee.hitch(this,function(){this.set("active",false);this._restoreSidePanels();}));_ef.subscribe("/epi/shell/action/viewchanged",_ee.hitch(this,function(view){var _106=typeof view!="string"||view=="epi-cms/contentediting/PageDataController";if(!_106&&this.active){this.execute();}this.set("isAvailable",_106);}));},_restoreSidePanels:function(){_ef.publish("/epi/layout/pinnable/navigation/toggle",this.get("isNavigationVisible"));_ef.publish("/epi/layout/pinnable/tools/toggle",this.get("isToolsVisible"));},_hideSidePanels:function(){this._setPanelSettings();_ef.publish("/epi/layout/pinnable/navigation/toggle",false);_ef.publish("/epi/layout/pinnable/tools/toggle",false);},_setPanelSettings:function(){_f0(this._profile.get("navigation"),_ee.hitch(this,function(_107){this.set("isNavigationVisible",_107.visible);}));_f0(this._profile.get("tools"),_ee.hitch(this,function(_108){this.set("isToolsVisible",_108.visible);}));},_execute:function(){this.set("active",!this.active);if(this.active){this._hideSidePanels();_ef.publish("/epi/shell/action/changeview","view");}else{this._restoreSidePanels();_ef.publish("/epi/shell/action/changeview/back",true);}}});return _ec([_fe],{contentRepositoryDescriptors:null,viewName:null,postscript:function(){this.inherited(arguments);this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_f3.resolve("epi.cms.contentRepositoryDescriptors");this.viewName=this.viewName||_f4.viewName;this._addLeadingCommands();this._addCreateCommands();this._addViewCommands();this._addTrailingCommands();},_addLeadingCommands:function(){this.addToLeading(new _100(),{widget:_f1,"class":"epi-leadingToggleButton epi-mediumButton"});},_addCreateCommands:function(){var _109=this.viewName;var _10a=[];var _10b=function(view){return view==_109;};for(var _10c in this.contentRepositoryDescriptors){var _10d=this.contentRepositoryDescriptors[_10c];if(_eb.some(_10d.mainViews,_10b)){_10a.push(_10d);}}_eb.forEach(_10a,function(_10e){_eb.forEach(_10e.creatableTypes,function(type){this.addCommand(this._createCommand(type),{category:"create"});},this);},this);},_createCommand:function(type){return new _fd({creatingTypeIdentifier:type});},_addViewCommands:function(){this.addCommand(new _104(),{widget:_f9,showInGroup:true,buttons:[new _fc(),new _fa(),new _fb()],category:"view"});this.addCommand(new _105(),{widget:_f8,showInGroup:true,hasToggleableChildren:false,buttons:[new _f2({iconClass:"","class":"epi-expandoButtonActiveNode",content:"<span>"+_ff.toolbar.buttons.togglepreviewmode.message+"</span>"})],category:"view"});},_addTrailingCommands:function(){this.addToTrailing(new _102(),{widget:_f1,"class":"epi-trailingToggleButton epi-mediumButton"});}});});},"epi/shell/command/ToggleCommand":function(){define("epi/shell/command/ToggleCommand",["dojo/_base/declare","epi/shell/command/_Command"],function(_10f,_110){return _10f([_110],{property:null,active:false,_execute:function(){var name=this.property,_111=!this.active;this.model.set(name,_111);this.set("active",_111);},_onModelChange:function(){var _112=this.model,_113=_112&&_112[this.property],_114=typeof _113=="boolean";this.set("canExecute",_114);this.set("active",_114&&_113);}});});},"epi-cms/widget/ViewSettingsExpandoButton":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/dom-style","dojo/topic","epi/dependency","epi/shell/widget/ExpandoButton"],function(_115,lang,_116,_117,_118,_119,_11a){return _115([_11a],{_toggleStateInitialized:null,postCreate:function(){this.inherited(arguments);var _11b=_119.resolve("epi.viewsettingsmanager");var _11c=_116.filter(_11b.viewSettingsHashValue,function(item){return item.type=="active";})[0];this.isExpand=_11c?_11c.id==="true":false;_116.forEach(this.containerNode.getChildren(),lang.hitch(this,function(_11d){this.connect(_11d.childWidget,"onResize","_onChildResize");}));},onChange:function(_11e){if(this._toggleStateInitialized){_118.publish("/epi/cms/action/eyetoggle",_11e);return;}this._toggleStateInitialized=true;},_onChildResize:function(){if(this.isExpanded()){this._expand();}}});});},"epi-cms/widget/VisitorGroupButton":function(){define(["dojo","dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/_base/Deferred","dojo/dom-class","dijit/DropDownMenu","dijit/form/DropDownButton","dijit/focus","epi","epi/dependency","epi-cms/widget/VisitorGroupsSelector","epi/i18n!epi/cms/nls/episerver.cms.widget.visitorgroupsbutton"],function(dojo,_11f,lang,_120,_121,_122,_123,_124,_125,epi,_126,_127,_128){return _11f([_124],{_contextMenu:null,baseClass:"epi-mediumButton epi-chromelessButton",iconClass:"epi-iconUsers",contextMenuProperties:{},_visitorGroupsSelector:null,_viewSettingsManager:null,postMixInProperties:function(){this.inherited(arguments);lang.mixin(this.contextMenuProperties,{"class":"epi-DropDownMenu"});},postCreate:function(){this.inherited(arguments);this._viewSettingsManager=_126.resolve("epi.viewsettingsmanager");var _129=this._viewSettingsManager.getSettingProperty("visitorgroup");if(!this.dropDown){this.dropDown=dijit.DropDownMenu(this.contextMenuProperties);this._visitorGroupsSelector=new _127({checkedItem:_129});_120.connect(this._visitorGroupsSelector,"onItemSelected",this,this._onVisitorGroupSelected);this._addChildren(this._visitorGroupsSelector);_121.when(this._visitorGroupsSelector.isSetupFinished(),lang.hitch(this,function(_12a){this._activeButton(!this._isDefaultSelection());this._updateTooltip();}));}_120.connect(this.dropDown,"onOpen",this,function(e){_125.focus(this._visitorGroupsSelector.menuNode.domNode);});},_updateTooltip:function(){var _12b=null;if(this._isDefaultSelection()){_12b=_128.defaulttooltip;}else{var _12c=this._visitorGroupsSelector.currentSelectedItem;_12b=lang.replace(_128.tooltip,{visitorgroup:_12c.name});}this.set("title",_12b);},_isDefaultSelection:function(){return this._visitorGroupsSelector.isDefaultItemSelected();},_onVisitorGroupSelected:function(_12d){this._changeView(_12d);},_changeView:function(_12e){if(_12e){if(_12e.name==this._visitorGroupsSelector.defaultItem.name){_120.publish("/epi/cms/action/viewsettingvaluechanged",["visitorgroup",null]);}else{_120.publish("/epi/cms/action/viewsettingvaluechanged",["visitorgroup",_12e.id]);}}this._activeButton(!this._isDefaultSelection());this._updateTooltip();},_addChildren:function(item){this.dropDown.addChild(item);},_activeButton:function(_12f){if(!this.dropDown){return;}if(_12f){_122.add(this.domNode,"dijitChecked");}else{_122.remove(this.domNode,"dijitChecked");}}});});},"epi-cms/widget/VisitorGroupsSelector":function(){define(["dojo","dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","epi","epi/dependency","epi-cms/widget/_ItemSelectorBase","epi-cms/widget/_DropDownWidgetItemMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.visitorgroupselector"],function(dojo,lang,_130,_131,epi,_132,_133,_134,res){return dojo.declare([_133,_134],{defaultItem:{id:-1,name:res.defaultitem},_visitorGroupsHash:{},_isFinished:null,postMixInProperties:function(){this.inherited(arguments);var _135=_132.resolve("epi.storeregistry");this._store=_135.get("epi.cms.visitorgroup");},postCreate:function(){this._isFinished=new _131();this.inherited(arguments);this.set("header",res.header);dojo.when(this._store.query(),lang.hitch(this,function(_136){this._createHashMap(_136);this.checkedItem=(this.checkedItem?this._visitorGroupsHash[this.checkedItem]:this.defaultItem.name);_136.unshift(this.defaultItem);this.set("items",_136);this._isFinished.resolve({status:true});}));},isSetupFinished:function(){return this._isFinished;},_createHashMap:function(_137){_130.forEach(_137,lang.hitch(this,function(item){this._visitorGroupsHash[item.id]=item.name;}));}});});},"epi-cms/widget/_ItemSelectorBase":function(){define(["dojo","dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","dojox/html/entities","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/Menu","epi","epi/dependency","epi/shell/widget/RadioMenuItem","dojo/text!./templates/_ItemSelector.html"],function(dojo,lang,_138,_139,_13a,_13b,_13c,_13d,Menu,epi,_13e,_13f,_140){return dojo.declare([_13b,_13c,_13d],{templateString:_140,baseClass:"epi-invertedTooltip",_store:null,currentSelectedItem:null,checkedItem:null,defaultItem:null,_items:[],isDefaultItemSelected:function(){return (this.currentSelectedItem&&this.defaultItem&&this.currentSelectedItem.name==this.defaultItem.name);},postCreate:function(){this.inherited(arguments);dojo.connect(this.menuNode,"onItemHover",this,function(item){this.menuNode.focusChild(item);});},checkItem:function(item){_138.forEach(this.menuNode.getChildren(),lang.hitch(this,function(_141){_141.set("checked",false);var _142=_141.value;if(item!=null&&_142.name==item.name){_141.set("checked",true);this.currentSelectedItem=_141.value;}}));},_setupUI:function(){_138.forEach(this.menuNode.getChildren(),lang.hitch(this,function(_143){this.menuNode.removeChild(_143);}));var _144=this.get("items");_138.forEach(_144,lang.hitch(this,function(item){this.menuNode.addChild(this._createMenuItem(item));}));},_onItemSelected:function(item){this.currentSelectedItem=item.value;this.onItemSelected(item.value);},onItemSelected:function(item){},_createMenuItem:function(item){var _145=new _13f({checked:(item.name==this.checkedItem),label:_13a.encode(item.name),value:item,onClick:lang.hitch(this,function(){this._onItemSelected(_145);})});if(_145.checked){this.currentSelectedItem=_145.value;}return _145;},_setItemsAttr:function(_146){this._set("_items",_146);this._setupUI();},_getItemsAttr:function(){return this.get("_items");},_setHeaderAttr:{node:"header",type:"innerHTML"}});});},"epi/shell/widget/RadioMenuItem":function(){require({cache:{"url:epi/shell/widget/templates/RadioMenuItem.htm":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemradio\" tabIndex=\"-1\">\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\" data-dojo-attach-point=\"iconNode\"/>\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\n\t</td>\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\"><span class=\"dijitInline dijitReset dijitIcon\" data-dojo-attach-point=\"labelIconNode\"></span> <span data-dojo-attach-point=\"containerNode, labelNode\"></span></td>\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\n</tr>"}});define("epi/shell/widget/RadioMenuItem",["dojo/_base/declare","dojo/_base/array","dojo/dom-class","dijit/CheckedMenuItem","dojo/text!./templates/RadioMenuItem.htm"],function(_147,_148,_149,_14a,_14b){return _147([_14a],{baseClass:"dijitMenuItem epi-radioMenuItem",iconClass:null,templateString:_14b,_onClick:function(e){this._resetState();this.inherited(arguments);},_resetState:function(){_148.forEach(this._getChildren(),function(_14c,_14d){_14c.set("checked",false);});},_getChildren:function(){return this.getParent().getChildren();},_setIconClassAttr:function(_14e){this._set("iconClass",_14e);_149.add(this.labelIconNode,_14e);}});});},"url:epi/shell/widget/templates/RadioMenuItem.htm":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemradio\" tabIndex=\"-1\">\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\" data-dojo-attach-point=\"iconNode\"/>\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\n\t</td>\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\"><span class=\"dijitInline dijitReset dijitIcon\" data-dojo-attach-point=\"labelIconNode\"></span> <span data-dojo-attach-point=\"containerNode, labelNode\"></span></td>\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\n</tr>","url:epi-cms/widget/templates/_ItemSelector.html":"<div>\r\n    <div class=\"epi-tooltipDialogTop\">\r\n        <span data-dojo-attach-point=\"header\"></span>\r\n        <div data-dojo-attach-point=\"lastPublishedIcon\" class=\"dijitTooltipConnector\"></div>\r\n    </div>\r\n    <div class=\"epi-dropdownMenuContainer\">\r\n        <div data-dojo-type=\"dijit/Menu\" data-dojo-attach-point=\"menuNode\" contextMenuForWindow=\"false\" class=\"epi-DropDownMenu\"></div>\r\n    </div>\r\n</div>","epi-cms/widget/_DropDownWidgetItemMixin":function(){define(["dojo/dom-construct"],function(_14f){return dojo.declare(null,{buildRendering:function(){this.inherited(arguments);this.domNode=this._wrapItem(this);},_wrapItem:function(item){var tr=_14f.create("tr");var td=_14f.create("th",null,tr);item.placeAt(td,"first");return tr;}});});},"epi-cms/widget/ChannelsButton":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/connect","dojo/_base/Deferred","dojo/dom-class","dijit/DropDownMenu","dijit/form/DropDownButton","dijit/focus","epi","epi/dependency","epi-cms/widget/ChannelSelector","epi-cms/widget/ResolutionSelector","epi/i18n!epi/cms/nls/episerver.cms.widget.channelbutton"],function(_150,lang,_151,_152,_153,_154,_155,_156,_157,epi,_158,_159,_15a,_15b){return _150([_156],{_contextMenu:null,baseClass:"epi-mediumButton epi-chromelessButton",iconClass:"epi-iconDevice",contextMenuProperties:{},_channelSelector:null,_resolutionSelector:null,_viewSettingsManager:null,postMixInProperties:function(){this.inherited(arguments);lang.mixin(this.contextMenuProperties,{"class":"epi-DropDownMenu"});},postCreate:function(){this.inherited(arguments);this._viewSettingsManager=_158.resolve("epi.viewsettingsmanager");var _15c=this._viewSettingsManager.getSettingProperty("resolution");var _15d=this._viewSettingsManager.getSettingProperty("epichannel");if(!this.dropDown){this.dropDown=dijit.DropDownMenu(this.contextMenuProperties);this._channelSelector=new _159({checkedItem:_15d});_152.connect(this._channelSelector,"onItemSelected",this,this._onChannelSelected);this._resolutionSelector=new _15a({checkedItem:_15c});_152.connect(this._resolutionSelector,"onItemSelected",this,this._onResolutionSelected);this._addChildren(this._channelSelector);this._addChildren(this._resolutionSelector);_153.when(this._channelSelector.isSetupFinished(),lang.hitch(this,function(_15e){this._activeButton(!this._isDefaultSelection());this._updateTooltip();this._setupKeyboardNav();}));}},_setupKeyboardNav:function(){var _15f=[];_151.forEach([this._channelSelector,this._resolutionSelector],function(menu){_15f=_15f.concat(_151.map(menu.menuNode.getChildren(),function(item){return {menuItem:item,menu:menu.menuNode};}));});var _160=0;var _161=lang.hitch(this,function(_162){_160+=_162==="next"?1:-1;_160=_160>=_15f.length?0:_160;_160=_160<0?_15f.length-1:_160;var _163=_15f[_160];_163.menu.focusChild(_163.menuItem);});var _164=function(){_161("next");};var _165=function(){_161("prev");};_152.connect(this.dropDown,"onOpen",this,function(e){_157.focus(this._channelSelector.menuNode.domNode);});this._channelSelector.menuNode.focusNext=this._resolutionSelector.menuNode.focusNext=_164;this._channelSelector.menuNode.focusPrev=this._resolutionSelector.menuNode.focusPrev=_165;},_updateTooltip:function(){var _166=null;if(this._isDefaultSelection()){_166=_15b.defaulttooltip;}else{var _167=this._channelSelector.currentSelectedItem;var _168=this._resolutionSelector.currentSelectedItem;_166=lang.replace(_15b.tooltip,{channel:_167.name,resolution:_168.name});}this.set("title",_166);},_isDefaultSelection:function(){return (this._channelSelector.isDefaultItemSelected()&&this._resolutionSelector.isDefaultItemSelected());},_onChannelSelected:function(_169){var _16a=this._resolutionSelector.getDefaultResolution(_169);if(!this._resolutionSelector.currentSelectedItem||(this._resolutionSelector.currentSelectedItem&&this._resolutionSelector.currentSelectedItem.name!=_16a.name)){this._resolutionSelector.checkItem(_16a);}this._changeView(_16a,_169);},_onResolutionSelected:function(_16b){this._changeView(_16b);},_changeView:function(_16c,_16d){if(_16c){if(_16c.name==this._resolutionSelector.defaultItem.name){_152.publish("/epi/cms/action/viewsettingvaluechanged",["resolution",null]);}else{var _16e=_16c.width+"x"+_16c.height;_152.publish("/epi/cms/action/viewsettingvaluechanged",["resolution",_16e]);}}if(_16d){if(_16d.name==this._channelSelector.defaultItem.name){_152.publish("/epi/cms/action/viewsettingvaluechanged",["epichannel",null]);}else{_152.publish("/epi/cms/action/viewsettingvaluechanged",["epichannel",_16d.channelName]);}}this._activeButton(!this._isDefaultSelection());this._updateTooltip();},_addChildren:function(item){this.dropDown.addChild(item);},_activeButton:function(_16f){if(!this.dropDown){return;}if(_16f){_154.add(this.domNode,"dijitChecked");}else{_154.remove(this.domNode,"dijitChecked");}}});});},"epi-cms/widget/ChannelSelector":function(){define(["dojo","dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","epi","epi/dependency","epi-cms/widget/_ItemSelectorBase","epi-cms/widget/_DropDownWidgetItemMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.channelselector"],function(dojo,lang,_170,_171,epi,_172,_173,_174,res){return dojo.declare([_173,_174],{defaultItem:{name:res.defaultitem,resolutionName:res.defaultitem},_isFinished:null,_channelHashMap:{},postMixInProperties:function(){this.inherited(arguments);var _175=_172.resolve("epi.storeregistry");this._store=_175.get("epi.cms.displaychannels");},postCreate:function(){this._isFinished=new _171();this.inherited(arguments);this.set("header",res.header);dojo.when(this._store.query({query:"getallregistered"}),lang.hitch(this,function(_176){this._createHashMap(_176);this.checkedItem=(this.checkedItem?this._channelHashMap[this.checkedItem]:this.defaultItem.name);_176.unshift(this.defaultItem);this.set("items",_176);this._isFinished.resolve({status:true});}));},isSetupFinished:function(){return this._isFinished;},_createHashMap:function(_177){_170.forEach(_177,lang.hitch(this,function(item){this._channelHashMap[item.channelName]=item.name;}));}});});},"epi-cms/widget/ResolutionSelector":function(){define(["dojo","dojo/_base/lang","dojo/_base/array","epi","epi/dependency","epi-cms/ApplicationSettings","epi-cms/widget/_ItemSelectorBase","epi-cms/widget/_DropDownWidgetItemMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.resolutionselector"],function(dojo,lang,_178,epi,_179,_17a,_17b,_17c,res){return dojo.declare([_17b,_17c],{_resolutionHash:{},defaultItem:{name:res.defaultitem,width:1,height:1},postMixInProperties:function(){this.inherited(arguments);this._availableResolutions=lang.clone(_17a.displayResolutions);this._availableResolutions.unshift(this.defaultItem);_178.forEach(this._availableResolutions,lang.hitch(this,function(_17d){var _17e=_17d.width+"x"+_17d.height;this._resolutionHash[_17e]=_17d.name;}));this.checkedItem=(this.checkedItem?this._resolutionHash[this.checkedItem]:this.defaultItem.name);},postCreate:function(){this.inherited(arguments);this.set("header",res.header);this.set("items",this._availableResolutions);},getDefaultResolution:function(_17f){var _180=this.defaultItem;var _181=dojo.filter(this._availableResolutions,function(_182){if(_182.id==_17f.resolutionId){return _182;}});if(_181!=null&&lang.isArray(_181)&&_181.length>=1){_180=_181[0];}return _180;}});});},"epi-cms/widget/ViewLanguageButton":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/topic","dojo/when","dojo/dom-class","dijit/DropDownMenu","dijit/form/DropDownButton","dijit/focus","epi/dependency","epi-cms/widget/ViewLanguageSelector","epi/i18n!epi/cms/nls/episerver.cms.widget.viewlanguagebutton"],function(_183,lang,_184,_185,when,_186,_187,_188,_189,_18a,_18b,_18c){return _183([_188],{_contextMenu:null,baseClass:"epi-mediumButton epi-chromelessButton",iconClass:"",contextMenuProperties:{},_viewLanguageSelector:null,_viewSettingsManager:null,postMixInProperties:function(){this.inherited(arguments);lang.mixin(this.contextMenuProperties,{"class":"epi-DropDownMenu"});this.profile=this.profile||_18a.resolve("epi.shell.Profile");},postCreate:function(){this.inherited(arguments);when(this.profile.getContentLanguage(),lang.hitch(this,function(_18d){this._viewSettingsManager=_18a.resolve("epi.viewsettingsmanager");var _18e={languageId:_18d},_18f=this._viewSettingsManager.getSettingProperty("viewlanguage")||_18e.languageId;if(!this.dropDown){this.dropDown=_187(this.contextMenuProperties);this.own(this.dropDown);this._viewLanguageSelector=new _18b({defaultItem:_18e,checkedItem:_18f});this.own(_184.after(this._viewLanguageSelector,"onItemSelected",lang.hitch(this,"_onViewLanguageSelected"),true));this._addChildren(this._viewLanguageSelector);when(this._viewLanguageSelector.fetchData(),lang.hitch(this,function(_190){if(this._viewLanguageSelector.get("items").length===0){_186.add(this.domNode,"dijitHidden");return;}this._changeView();}));}this.own(_184.after(this.dropDown,"onOpen",lang.hitch(this,function(e){_189.focus(this._viewLanguageSelector.menuNode.domNode);}),true));this.own(_185.subscribe("/epi/cms/contentdata/updated",lang.hitch(this,function(){this._languageSettingsChanged();})));}));},_languageSettingsChanged:function(){when(this._viewLanguageSelector.fetchData(),lang.hitch(this,function(_191){var _192=this._viewLanguageSelector.get("currentSelectedItem");this._changeView(_192||this._viewLanguageSelector.defaultItem);}));},_updateButton:function(_193){var _194=_193||this._viewLanguageSelector.get("currentSelectedItem")||this._viewLanguageSelector.defaultItem;var _195=lang.replace(_18c.tooltip,{viewlanguage:_194?_194.name:null});var _196=_194&&_194.urlSegment?_194.urlSegment.toUpperCase():null;var _197=this.get("label");this.set("title",_195);this.set("label",_196);if(_197!=_196){this.onResize();}},onResize:function(){},_isDefaultSelection:function(){if(this._viewLanguageSelector.get("currentSelectedItem")){return this._viewLanguageSelector.isDefaultItemSelected();}return true;},_onViewLanguageSelected:function(_198){this._changeView(_198);this.closeDropDown();},_changeView:function(_199){if(_199){_185.publish("/epi/cms/action/viewsettingvaluechanged","viewlanguage",_199.languageId);}this._viewLanguageSelector.checkItem(_199);this._activeButton(!this._isDefaultSelection());this._updateButton(_199);},_addChildren:function(item){this.dropDown.addChild(item);},_activeButton:function(_19a){if(!this.dropDown){return;}_186.toggle(this.domNode,"dijitChecked",_19a);_186.toggle(this.domNode,"epi-expandoButtonLangSelected",_19a);}});});},"epi-cms/widget/ViewLanguageSelector":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/Deferred","dojo/when","epi/dependency","epi-cms/widget/_ItemSelectorBase","epi-cms/widget/_DropDownWidgetItemMixin","epi-cms/component/SiteTreeModel","epi/i18n!epi/cms/nls/episerver.cms.widget.viewlanguageselector"],function(_19b,lang,_19c,_19d,when,_19e,_19f,_1a0,_1a1,_1a2){return _19b([_19f,_1a0],{_viewLanguageHash:{},_isFinished:null,_siteTreeModel:null,postCreate:function(){this.inherited(arguments);this.set("header",_1a2.header);if(!this._siteTreeModel){var _1a3=_19e.resolve("epi.storeregistry"),_1a4=_1a3.get("epi.cms.sitestructure");this._siteTreeModel=new _1a1({store:_1a4});}},fetchData:function(){var _1a5=new _19d();when(this._siteTreeModel.getCurrentSite(),lang.hitch(this,function(site){if(site){when(this._siteTreeModel.getChildren({url:site.currentSite},lang.hitch(this,function(_1a6){this._createHashMap(_1a6);if(this.defaultItem){this.defaultItem.name=this._viewLanguageHash[this.defaultItem.languageId]||this.defaultItem.name;}this.set("items",_1a6);_1a5.resolve({status:true});})));}}));return _1a5.promise;},checkItem:function(item){if(!item||!this._viewLanguageHash[item.languageId]){item=this.get("currentSelectedItem");}this.inherited(arguments);},_getCurrentSelectedItemAttr:function(){var _1a7=null;_19c.some([this.currentSelectedItem,this.checkedItem,this.defaultItem],lang.hitch(this,function(_1a8){if(_1a8&&(this._viewLanguageHash[_1a8.languageId||_1a8])){_1a7=_1a8.languageId?_1a8:{languageId:_1a8,name:this._viewLanguageHash[_1a8]};return true;}return false;}));return _1a7;},_createHashMap:function(_1a9){this._viewLanguageHash={};_19c.forEach(_1a9,lang.hitch(this,function(item){this._viewLanguageHash[item.languageId]=item.name;}));}});});},"epi-cms/component/SiteTreeModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Stateful","dojo/Deferred","dojo/when","dojo/_base/lang","dojo/_base/connect","dojo/cookie","epi/dependency","epi/string"],function(_1aa,_1ab,_1ac,_1ad,when,lang,_1ae,_1af,_1b0,_1b1){return _1ab([_1ac],{query:null,showAllLanguages:true,location:document.location,profile:null,store:null,constructor:function(){this.query={allLanguages:this.showAllLanguages};},postscript:function(){this.inherited(arguments);this.profile=this.profile||_1b0.resolve("epi.shell.Profile");_1ae.subscribe("/epi/cms/contentdata/updated",lang.hitch(this,function(){when(this.getCurrentSite(),lang.hitch(this,function(_1b2){this.onItemChildrenReload({siteUrl:_1b2.currentSite});}));}));},getRoot:function(_1b3,_1b4){_1b3({});},getIdentity:function(item){var id=this.store.getIdentity(item);if(!id&&!item.isLanguageNode){id="root";}return id;},onItemChildrenReload:function(_1b5){},mayHaveChildren:function(item){if(!item.isLanguageNode){return true;}return false;},getLabel:function(item){return item.name;},getChildren:function(_1b6,_1b7){when(this.store.query(lang.mixin({siteUrl:_1b6.url},this.query)),_1b7);},_setQuery:function(q){this.query=q;this.onItemChildrenReload({});},_showAllLanguagesSetter:function(_1b8){this.showAllLanguages=_1b8;this._setQuery({allLanguages:_1b8});},getCurrentSite:function(){var def=new _1ad();when(this.profile.getContentLanguage(),lang.hitch(this,function(_1b9){var _1ba=_1b1.appendTrailingSlash(this.location.protocol+"//"+this.location.host+this.location.pathname).toLowerCase();if(_1b9){when(this.store.get(),lang.hitch(this,function(_1bb){var _1bc=null;_1aa.some(_1bb,function(site){var _1bd=_1ba.lastIndexOf(_1b1.appendTrailingSlash(site.uiUrl).toLowerCase(),0)===0;if(_1bd){_1bc={currentSite:site.url,currentEditLanguageId:site.url+_1b9};return true;}});if(_1bc){def.resolve(_1bc);}else{def.cancel();}}),function(){def.reject(null);});}else{def.reject(null);}}));return def;},getAllLanguagesForSite:function(_1be){var def=new _1ad();when(this.store.query({siteUrl:_1be,allLanguages:true}),function(_1bf){def.resolve(_1bf);});return def;},getAllLanguagesForCurrentSite:function(){var def=new _1ad();when(this.getCurrentSite(),lang.hitch(this,function(_1c0){this.getAllLanguagesForSite(_1c0.currentSite).then(function(_1c1){def.resolve(_1c1);});}),function(_1c2){def.reject(_1c2);});return def;}});});},"epi-cms/widget/command/CreateContentFromSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/on","dojo/topic","dojo/when","epi/dependency","epi/shell/command/_Command","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Dialog","epi-cms/core/ContentReference","epi-cms/ApplicationSettings","epi-cms/_ContentContextMixin","epi-cms/contentediting/_ContextualContentContextMixin","epi-cms/widget/ContentSelectorDialog","epi-cms/widget/ContentForestStoreModel","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.widget.createcontentselector"],function(_1c3,_1c4,lang,_1c5,on,_1c6,when,_1c7,_1c8,_1c9,_1ca,_1cb,_1cc,_1cd,_1ce,_1cf,_1d0,_1d1,_1d2){return _1c4([_1c8,_1cd,_1ce],{canExecute:true,canSelectOwnerContent:false,showButtons:false,value:null,showRoot:false,roots:null,creatingTypeIdentifier:null,containerTypeIdentifiers:null,modelContent:null,destroyOnHide:true,confirmActionText:_1d2.buttons.confirmation,description:null,title:null,createAsLocalAsset:false,canChangeLocalAssetName:true,addToParentsAssetsFolder:false,typeDescriptorManager:null,contentRepositoryDescriptors:null,postscript:function(){this.inherited(arguments);this._initialize();},_initialize:function(){if(!this.creatingTypeIdentifier){throw "You need to specify a creatingTypeIdentifier";}if(this._initialized){return;}var _1d3=_1c7.resolve("epi.storeregistry");this.contentStore=this.contentStore||_1d3.get("epi.cms.content.light");this.contextStore=this.contextStore||_1d3.get("epi.shell.context");this.contentTypeStore=this.contentTypeStore||_1d3.get("epi.cms.contenttype");this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_1c7.resolve("epi.cms.contentRepositoryDescriptors");var _1d4,_1d5=function(type){return type==this.creatingTypeIdentifier;};for(var _1d6 in this.contentRepositoryDescriptors){var _1d7=this.contentRepositoryDescriptors[_1d6];if(_1c3.some(_1d7.containedTypes,_1d5,this)){_1d4=_1d7;break;}}if(_1d4){var _1d8=_1c9.getValue(this.creatingTypeIdentifier,"containerTypes");this.containerTypeIdentifiers=_1d8?_1d8:[this.creatingTypeIdentifier];this.roots=this.roots||_1d4.roots;}this.modelContent=new _1d0({roots:this.roots,additionalQueryOptions:{sort:[{attribute:"name",descending:false}]}});this.preventContextualContentFor=_1d4.preventContextualContentFor;this.label=this.label||_1c9.getResourceValue(this.creatingTypeIdentifier,"create");this.title=this.title||_1c9.getResourceValue(this.creatingTypeIdentifier,"selectparent");this.description=this.description||_1c9.getResourceValue(this.creatingTypeIdentifier,"createdescription");this.iconClass=this.iconClass||_1c9.getValue(this.creatingTypeIdentifier,"commandIconClass");this._initialized=true;},_execute:function(){when(this.getCurrentContent(),lang.hitch(this,function(_1d9){if(!_1d9){return;}when(this.contextStore.get("?uri=epi.cms.contentdata:///"+_1d9.contentLink),lang.hitch(this,function(_1da){if(!_1da){return;}var _1db=_1da.languageContext;var _1dc=!_1db||(_1db.hasTranslationAccess&&_1db.isPreferredLanguageAvailable);var _1dd=_1cb.compareIgnoreVersion(_1d9.contentLink,_1cc.wastebasketPage);var _1de=!(_1dd||_1d9.isDeleted)&&_1dc&&_1d1.isActionAvailable(_1d9,_1d1.action.Create,_1d1.providerCapabilities.Create,true);when(this._getAvailableContentTypes(_1d9.contentLink),lang.hitch(this,function(_1df){var _1e0=this._isContentTypeAllowedAsChildToCurrentContext(_1df,_1d9);if((!_1e0&&!this.createAsLocalAsset)||!_1de){this._createDialog();this._setDialogButtonState(this.selector.get("value"));}else{this._switchView(_1d9);}}));}));}));},_getAvailableContentTypes:function(_1e1){return this.contentTypeStore.query({query:"getavailablecontenttypes",parentReference:_1e1});},_isContentTypeAllowedAsChildToCurrentContext:function(_1e2,_1e3){var _1e4=_1c3.some(_1e2,function(_1e5){return _1c9.isBaseTypeIdentifier(_1e5.typeIdentifier,this.creatingTypeIdentifier);},this);var _1e6=_1c3.some(this.containerTypeIdentifiers,function(type){return _1c9.isBaseTypeIdentifier(_1e3.typeIdentifier,type);});return _1e4&&_1e6;},_createDialog:function(){this.selector=new _1cf({canSelectOwnerContent:this.canSelectOwnerContent,showButtons:this.showButtons,value:this.value,showRoot:this.showRoot,multiRootsMode:true,allowedTypes:this.containerTypeIdentifiers,model:this.modelContent,showContextualContent:true,preventContextualContentFor:this.preventContextualContentFor});this.dialog=new _1ca({destroyOnHide:this.destroyOnHide,confirmActionText:this.confirmActionText,description:this.description,title:this.title,content:this.selector});on(this.selector,"change",lang.hitch(this,this._setDialogButtonState));_1c5.after(this.dialog,"hide",lang.hitch(this,function(_1e7){this.hideDeferred=_1e7;}));this.dialog.on("execute",lang.hitch(this,this._onContentSelected));this.dialog.show();},_onContentSelected:function(){var _1e8=this.selector.get("value");when(this.hideDeferred,lang.hitch(this,function(){when(this.contentStore.get(_1e8),lang.hitch(this,function(_1e9){this._switchView(_1e9);}));}));},_switchView:function(_1ea){when(this.getCurrentContent(),lang.hitch(this,function(_1eb){var _1ec=this.isPseudoContextualRoot(_1ea)||this.createAsLocalAsset;_1c6.publish("/epi/shell/action/changeview","epi-cms/contentediting/CreateContent",null,{requestedType:this.creatingTypeIdentifier,parent:_1ec?_1eb:_1ea,editAllPropertiesOnCreate:this.editAllPropertiesOnCreate,addToDestination:this.model,createAsLocalAsset:_1ec,canChangeLocalAssetName:this.canChangeLocalAssetName,treatAsSecondaryView:this.createAsLocalAsset,view:_1c9.getValue(this.creatingTypeIdentifier,"createView")});}));},_setDialogButtonState:function(_1ed){if(!_1ed){this.dialog.definitionConsumer.setItemProperty(this.dialog._okButtonName,"disabled",true);return;}when(this.contentStore.get(_1ed),lang.hitch(this,function(_1ee){when(this.isPseudoContextualRoot(_1ee)?this.contextStore.get("?uri=epi.cms.contentdata:///"+this._currentContext.id):_1ee,lang.hitch(this,function(_1ef){var _1f0=_1d1.hasLanguageAccess(_1ef),_1f1=_1f0&&_1d1.hasAccess(_1ee.accessMask,_1d1.accessLevel.Create);this.dialog.definitionConsumer.setItemProperty(this.dialog._okButtonName,"disabled",!_1f1);}));}));}});});},"epi-cms/contentediting/_ContextualContentContextMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","epi/shell/_ContextMixin","epi/shell/TypeDescriptorManager","epi-cms/ApplicationSettings","epi-cms/contentediting/PseudoContextualCommandDecorator","epi-cms/core/ContentReference","epi/i18n!epi/cms/nls/episerver.cms.widget.hierachicallist.roots"],function(_1f2,_1f3,lang,when,_1f4,_1f5,_1f6,_1f7,_1f8,_1f9){return _1f3([_1f4],{contextRootLabel:null,_commandDecorator:null,postscript:function(){this.inherited(arguments);this.contextRootLabel=this.contextRootLabel||_1f9.contextualroot.label;this._commandDecorator=this._commandDecorator||new _1f7();},destroy:function(){this._commandDecorator&&this._commandDecorator.destroy();this.inherited(arguments);},isTypeOfRoot:function(_1fa){var _1fb=this.inherited(arguments),_1fc=this.isContextualContent(_1fa);return _1fb!=null?!!(_1fb||_1fc):!!(_1fa&&_1fc);},isContextualContent:function(_1fd){return this.isContextualRoot(_1fd)||this.isPseudoContextualRoot(_1fd);},isContextualRoot:function(_1fe){return _1fe.parentLink==this._getPseudoContextualContent();},isPseudoContextualRoot:function(_1ff){var _200=_1f8.toContentReference(_1ff.contentLink);return !_200.providerName&&_200.id==this._getPseudoContextualContent();},hasContextual:function(_201){if(!(_201 instanceof Array)||_201.length<=0){return false;}return _1f2.some(_201,this.isContextualContent,this);},canHaveContextualContent:function(_202){var _203=_1f8.toContentReference(_202.contentLink);return !_1f2.some(this.notSupportContextualContents,function(id){return !_203.providerName&&_203.id==id;});},getContextualRoot:function(_204){if(typeof _204!=="object"){return null;}var _205=lang.clone(_204);_205.name=this.getContextualRootName(_205);if(this.isPseudoContextualRoot(_205)){_205.hasChildren=false;}return _205;},getContextualRootName:function(_206){var name=this.contextRootLabel||(this._currentContext&&this._currentContext.name)||"",_207=_206&&_206.ownerTypeIdentifier,_208=_1f5.getResourceValue(_207||(this._currentContext&&this._currentContext.dataType)||"","name",true);return _208?lang.replace(name,[_208]):name;},decoratePseudoContextualCommands:function(_209){when(this.getCurrentContent(),lang.hitch(this,function(_20a){this._commandDecorator.decorateCommands(_209,_20a,lang.hitch(this,this.isPseudoContextualRoot));}));},_getPseudoContextualContent:function(){return _1f6.contentAssetsFolder;}});});},"epi-cms/contentediting/PseudoContextualCommandDecorator":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin"],function(_20b,_20c,lang,_20d,_20e,_20f,_210){return _20c(null,{destroy:function(){this._clearContextualCommandHandlers();},decorateCommands:function(_211,_212,_213){this._clearContextualCommandHandlers();if(!(_211 instanceof Array)||_211.length<=0||typeof _212!=="object"){return;}this._decorateCommands(_211,_212,_213);},_decorateCommands:function(_214,_215,_216){_20b.forEach(_214,function(_217){if(!this._isValidCommand(_217)){return;}if(typeof _216==="function"&&!_216(this._isNormalCommand(_217)?_217.model:_217.get("selectionData"))){return;}this._onAroundCommandExecute(_217,_215);},this);},_onAroundCommandExecute:function(_218,_219){var self=this;self._contextualCommandHandlers.push(_20d.around(_218,"execute",function(_21a){return function(){var _21b=self._decorateCommandBeforeExecute(_218,_219);_21a.apply(_218,arguments);self._restoreCommandAfterExecute(_218,_21b);};}));},_decorateCommandBeforeExecute:function(_21c,_21d){var _21e={};lang.mixin(_21e,this._decorateCommand(_21c));if(this._isNormalCommand(_21c)){lang.mixin(_21e,this._decorateNormalCommand(_21c,_21d));return _21e;}if(_21c.isInstanceOf(_210)){lang.mixin(_21e,this._decorateSelectionCommand(_21c,_21d));}return _21e;},_decorateCommand:function(_21f){var _220={"canExecute":_21f.get("canExecute"),"isAvailable":_21f.get("isAvailable"),"createAsLocalAsset":_21f.get("createAsLocalAsset"),"canChangeLocalAssetName":_21f.get("canChangeLocalAssetName")};_21f.isInstanceOf(_20e)&&_21f.unwatchModelChange();_21f.isInstanceOf(_20f)&&_21f.unwatchClipboardChange();_21f.isInstanceOf(_210)&&_21f.unwatchSelectionChange();_21f.set("canExecute",true);_21f.set("isAvailable",true);_21f.set("createAsLocalAsset",true);_21f.set("canChangeLocalAssetName",true);return _220;},_decorateNormalCommand:function(_221,_222){var _223={"model":_221.get("model")};_221.set("model",_222);return _223;},_decorateSelectionCommand:function(_224,_225){var _226={"data":_224.get("selectionData")};var _227=_224.get("model");if(_227&&typeof _227.refreshRoots=="function"){_224.onRefreshSelection=function(){return _227.refreshRoots();};}_224.selection.set("data",[{"data":_225,"type":_224.get("selectionType")}]);return _226;},_restoreCommandAfterExecute:function(_228,_229){this._restoreCommand(_228,_229);if(this._isNormalCommand(_228)){this._restoreNormalCommand(_228,_229);return;}if(_228.isInstanceOf(_210)){this._restoreSelectionCommand(_228,_229);}},_restoreCommand:function(_22a,_22b){_22a.set("canExecute",_22b.canExecute);_22a.set("isAvailable",_22b.isAvailable);_22a.set("createAsLocalAsset",_22b.createAsLocalAsset);_22a.set("canChangeLocalAssetName",_22b.canChangeLocalAssetName);_22a.isInstanceOf(_20e)&&_22a.watchModelChange();_22a.isInstanceOf(_20f)&&_22a.watchClipboardChange();_22a.isInstanceOf(_210)&&_22a.watchSelectionChange();},_restoreNormalCommand:function(_22c,_22d){_22c.set("model",_22d.model);},_restoreSelectionCommand:function(_22e,_22f){_22e.selection.set("data",_22f.data);},_clearContextualCommandHandlers:function(){if(this._contextualCommandHandlers instanceof Array&&this._contextualCommandHandlers.length>0){_20b.forEach(this._contextualCommandHandlers,function(_230){typeof _230.remove==="function"&&_230.remove();});}this._contextualCommandHandlers=[];},_isNormalCommand:function(_231){return !(_231.isInstanceOf(_210)||_231.isInstanceOf(_20f));},_isValidCommand:function(_232){return !!(_232&&_232.isInstanceOf(_20e)&&_232.model);}});});},"epi/shell/command/_ClipboardCommandMixin":function(){define("epi/shell/command/_ClipboardCommandMixin",["dojo/_base/declare","dojo/_base/lang"],function(_233,lang){return _233(null,{clipboard:null,postscript:function(){this.inherited(arguments);this.watchClipboardChange();},onRefreshClipboard:function(){},watchClipboardChange:function(){this._clipboardChangeWatcher=this.clipboard.watch("data",lang.hitch(this,this._onModelChange));},unwatchClipboardChange:function(){this._clipboardChangeWatcher&&this._clipboardChangeWatcher.unwatch();},_clipboardDataGetter:function(){return this._getClipboardData();},_clipboardTypeGetter:function(){return this._getClipboardData().type;},_getClipboardData:function(){if(!this.clipboard||!(this.clipboard.data instanceof Array)){return null;}return this.clipboard.data;}});});},"epi/shell/command/_SelectionCommandMixin":function(){define("epi/shell/command/_SelectionCommandMixin",["dojo/_base/declare","dojo/_base/lang"],function(_234,lang){return _234(null,{selection:null,postscript:function(){this.inherited(arguments);this.watchSelectionChange();},onRefreshSelection:function(){},watchSelectionChange:function(){this._selectionChangeWatcher=this.selection.watch("data",lang.hitch(this,this._onModelChange));},unwatchSelectionChange:function(){this._selectionChangeWatcher&&this._selectionChangeWatcher.unwatch();},_selectionDataGetter:function(){var _235=this._getSelectionData();return _235!=null&&_235.type=="epi.cms.contentdata"?_235.data:null;},_selectionTypeGetter:function(){return this._getSelectionData().type;},_getSelectionData:function(){if(!this.selection||!(this.selection.data instanceof Array)){return null;}return this.selection.data[0];}});});},"epi-cms/widget/ContentSelectorDialog":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetBase","epi","epi/shell/TypeDescriptorManager","epi-cms/ApplicationSettings","epi-cms/widget/ContentTree","epi-cms/widget/ContextualContentForestStoreModel","epi/shell/widget/_ActionProviderWidget","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.widget.contentselectordialog"],function(_236,_237,lang,when,_238,_239,epi,_23a,_23b,_23c,_23d,_23e,_23f,_240){return _237([_239,_238,_23e],{_contentRef:null,res:_240,roots:null,typeIdentifiers:null,showButtons:true,model:null,canSelectOwnerContent:true,multiRootsMode:false,templateString:"<div><div data-dojo-attach-point=\"_treeNode\"></div></div>",_typesToDisplay:null,showAllLanguages:false,selectedContentType:null,buildRendering:function(){this.inherited(arguments);var _241=this._getTypesToDisplay(),_242=this.model,_243=this.roots||(_242&&_242.roots);this.preventContextualContentFor=this.preventContextualContentFor||this._getSettingFromContentType();if(!_242||this.showContextualContent){_242=new _23d({roots:_243,typeIdentifiers:_241,notSupportContextualContents:this.preventContextualContentFor,showAllLanguages:this.showAllLanguages});}_242.set("view","contentselector");this.tree=new _23c({roots:_243,typeIdentifiers:_241,allowManipulation:false,model:_242,expandExtraNodeItems:_23b.startPage},this._treeNode);this.connect(this.tree,"onClick","_onTreeNodeClick");},_getSettingFromContentType:function(){if(!this.selectedContentType){return null;}var _244=this.contentRepositoryDescriptors||_23f.resolve("epi.cms.contentRepositoryDescriptors");var _245,_246=function(type){return _23a.isBaseTypeIdentifier(this.selectedContentType,type);};for(var _247 in _244){var _248=_244[_247];if(_236.some(_248.containedTypes,_246,this)){_245=_248;break;}}return _245.preventContextualContentFor;},_getTypesToDisplay:function(){if(!this._typesToDisplay){var _249=[];this._getContainerTypesRecursive(this.allowedTypes,_249);this._typesToDisplay=_249;}return this._typesToDisplay;},_getContainerTypesRecursive:function(_24a,_24b,_24c){if(!_24c){_24c=[];}_236.forEach(_24a,lang.hitch(this,function(type){if(_236.indexOf(_24c,type)===-1){_24c.push(type);if(_236.indexOf(_24b,type)===-1){_24b.push(type);}var _24d=_23a.getValue(type,"containerTypes");if(_24d){this._getContainerTypesRecursive(_24d,_24b,_24c);}}}));},_setValueAttr:function(_24e){if(_24e){this._contentRef=_24e;var _24f=this._contentRef==="-"?null:this._contentRef;if(this.multiRootsMode){when(this.tree.onLoadDeferred,lang.hitch(this,function(){this.tree.selectContent(_24f);}));}else{if(!epi.isEmpty(_24f)){this.tree.selectContent(_24f);}}}else{this._contentRef=null;this._clearSelectedContent();}},_getValueAttr:function(){this.inherited(arguments);if(this._contentRef){return this._contentRef.toString();}else{return "";}},_clearSelectedContent:function(){this.tree.set("selectedNodes",[]);this.tree.set("selectedItems",[]);},getActions:function(){return this.canSelectOwnerContent?[{name:"selectpage",label:_240.currentpage,settings:{type:"submit"},action:lang.hitch(this,function(){this._setValueOwnerContent();})}]:[];},_onTreeNodeClick:function(_250){var _251=_250.contentLink;var _252=_236.indexOf(this.allowedTypes,_250.typeIdentifier)!==-1;if(!_252){_252=_236.some(this.allowedTypes,function(type){return _23a.isBaseTypeIdentifier(_250.typeIdentifier,type);});}if(!_252){this.tree.lastFocused.setSelected(false);_251=null;}this.set("value",_251);this.onChange(this.get("value"));},_setValueOwnerContent:function(){this.set("value","-");},onChange:function(_253){},focus:function(){this.tree.focus();}});});},"epi-cms/widget/ContentTree":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/aspect","dojo/Deferred","dojo/Evented","dojo/keys","dojo/promise/all","dojo/query","dojo/sniff","dojo/when","epi/dependency","epi/shell/dnd/tree/dndSource","epi/shell/TypeDescriptorManager","epi/shell/widget/Tree","epi-cms/core/ContentReference","epi-cms/widget/_ContentTreeNode","epi-cms/widget/ContentTreeModelConfirmation","epi-cms/widget/ContentForestStoreModel"],function(_254,_255,_256,lang,_257,_258,_259,_25a,_25b,keys,_25c,_25d,_25e,when,_25f,_260,_261,Tree,_262,_263,_264,_265){return _256([Tree,_25b],{roots:null,expandExtraNodeItems:null,nodeConstructor:null,typeIdentifiers:null,allowManipulation:true,persist:false,expandOnDnd:true,showRoot:false,handleSelection:false,postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.model=this._createTreeModel();}if(this.allowManipulation){this.dndController=_260;this.dndParams.push("accept");this.accept=this.model.containedTypes||this.containedTypes;}this.checkItemAcceptance=lang.hitch(this,this.checkItemAcceptance);this.nodeConstructor=this.nodeConstructor||_263;},getItemType:function(item){return _261.getAndConcatenateValues(item.typeIdentifier,"dndTypes");},buildRendering:function(){this.model=this._wrapModel(this.model);this.inherited(arguments);},_wrapModel:function(_266){return _264(this.model);},postCreate:function(){this.inherited(arguments);this.own(this.connect(this.model,"onSelect",lang.hitch(this,this._onSelect)),_259.before(this.model,"onToggleContentDisplay",lang.hitch(this,function(_267,_268){var _269=this.getNodesByItem(_267)[0];if(_269){_258.set(_269.domNode,{"display":_268===true?"":"none"});}})));},onLoad:function(){this.inherited(arguments);return when(this._expandRootNodes(),lang.hitch(this,this._expandExtraNodes));},_expandRootNodes:function(){var _26a=this.showRoot?[this.rootNode]:this.rootNode.getChildren();return _25c(_254.map(_26a,this.tree._expandNode,this));},_expandExtraNodes:function(){if(!this.expandExtraNodeItems){return;}var _26b=this.expandExtraNodeItems instanceof Array?this.expandExtraNodeItems:[this.expandExtraNodeItems];var _26c=_254.map(_26b,function(item){return this.tree.getNodesByItem(item)[0];},this);_26c=_254.filter(_26c,Boolean);return _25c(_254.map(_26c,this.tree._expandNode,this));},checkItemAcceptance:function(_26d,_26e,_26f){var _270=true;var _271=dijit.getEnclosingWidget(_26d),_272=_271&&_271.item;if(!_272){return false;}_26e.forInSelectedItems(function(item){if(!_270){return;}var data=item.data;if(data.dndData){data=data.dndData;}_270=this.model.canPaste(data,_272);},this);return _270;},_setAllowManipulationAttr:function(_273){this._set("allowManipulation",_273);if(_273){this.dndController=_260;}},_createTreeModel:function(){return new _265({roots:this.roots,typeIdentifiers:this.typeIdentifiers});},_onItemDelete:function(item,_274){function _275(node,_276){_254.forEach(node.getChildren(),function(_277){_276.push(_277.item);_275(_277,_276);});return _276;};if(_274){var _278=this._itemNodesMap[this.model.getIdentity(item)];if(_278){_254.forEach(_278,function(_279){_254.forEach(_275(_279,[]).reverse(),function(_27a){this._onItemDelete(_27a);},this);},this);}}this.inherited(arguments);},_setTypeIdentifiersAttr:function(_27b){this._set("typeIdentifiers",_27b);if(this.model){this.model.typeIdentifiers=_27b;}},buildNodeFromTemplate:function(args){return new this.nodeConstructor(args);},_createTreeNode:function(args){var _27c=lang.mixin({},args,{dndData:args.item});return this.buildNodeFromTemplate(_27c);},getIconClass:function(item,_27d){if(!item){return this.inherited(arguments);}var _27e=_261.getValue(item.typeIdentifier,"iconClass");if(this.model.isTypeOfRoot(item)){return this.model.getObjectIconClass(item,_27e);}var _27f=_261.getValue(item.typeIdentifier,"supportsOpenCssClass");if(_27d&&!item.isSubRoot&&_27f){_27e=_27e+"Open";}return _27e;},focus:function(){this.focusNode(this.get("selectedNode")||this.rootNode);},_getTargetPath:function(_280){var _281=this.model,_282=new _25a();_281.getAncestors(_280,function(_283){_283.push(_280);var _284=_254.map(_283,function(item){return _281.getIdentity(item).toString();});if(typeof _281.filterAncestors==="function"){_284=_281.filterAncestors(_284);}_282.resolve(_284);});return _282.promise;},_isValidTargetContent:function(_285){if(!_285){return false;}return !_285.isDeleted&&!_285.isWastebasket;},_onSelect:function(id,_286,_287){var _288=this.get("selectedNode");this.tree.model.set("previousContextualSelection",{"selectedContent":_288});this.selectContent(id,_286,true,_287).then(lang.hitch(this,function(){_288=this.get("selectedNode");if(_288&&_288.item&&_288.item.contentLink){this.emit("select",_288.item,_288);}}));},selectContent:function(_289,_28a,_28b,_28c){var self=this,_28d=self.model,_28e=new _25a(),_28f=function(_290){self._preparePathNodes(_290);self._setRecursivePaths(_290,_28e,_28a,_28c);};when(_28d.store.get(_289),function(_291){if(!self._isValidTargetContent(_291)){self.set("paths",[]);_28e.resolve(null);}else{self._getTargetPath(_291).then(function(_292){self._onSetTargetPath();_28f(_292);});}});return _28e.promise;},_onSetTargetPath:function(){this.model.set("handleSelection",this.handleSelection);if(!this.handleSelection){return;}var _293=this.get("selectedNode");if(_293){_293=this.getNodesByItem(_293.item)[0];if(_293){this.model.set("previousSelection",{selectedContent:_293,selectedAncestors:_293.getTreePath()});}}},_preparePathNodes:function(_294){},_setRecursivePaths:function(_295,_296,_297,_298){if(!_295||_295.length===0){return;}this.set("paths",[_295]).then(lang.hitch(this,function(){var _299=this.get("selectedNode");if(!_299){this._setRecursivePaths(_295.slice(0,-1),_296,_297,_298);return;}if(_297){this.focus();}if(_298){_298(_299);}_296.resolve(_299);},_296.reject));},_onKeyDown:function(item,e){this.inherited(arguments);if(!this.allowManipulation){return;}if(_255.isCopyKey(e)){var _29a=e.keyCode?String.fromCharCode(e.keyCode).toLowerCase():"";switch(_29a){case "c":this.emit("copyOrCut",true);break;case "x":this.emit("copyOrCut",false);break;case "v":this.emit("paste");break;default:break;}}if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey){return;}if(e.keyCode==keys.DELETE){this.emit("delete");}},_onNodeMouseLeave:function(node,evt){this.inherited(arguments);if(_25e("ie")){_254.forEach(_25d(".dijitTreeRow.dijitTreeRowHover",this.tree.domNode),function(node){_257.remove(node,"dijitTreeRowHover");});}}});});},"epi/shell/dnd/tree/dndSource":function(){define("epi/shell/dnd/tree/dndSource",["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/dom-class","dojo/dom-geometry","dojo/_base/lang","dojo/on","dojo/touch","dojo/topic","dojo/dnd/Manager","dojo/when","dijit/tree/dndSource","../_DndDataMixin"],function(_29b,_29c,_29d,_29e,_29f,lang,on,_2a0,_2a1,_2a2,when,_2a3,_2a4){return _29d([_2a3,_2a4],{generateText:false,singular:true,deleteSelectedNodes:function(){},userSelect:function(node){this.inherited(arguments,[node,false,false]);},onDndDrop:function(_2a5,_2a6,copy,_2a7){if(this.containerState=="Over"){var tree=this.tree,_2a8=tree.model,_2a9=this.targetAnchor;this.isDragging=false;var _2aa;var _2ab=(_2a9&&_2a9.item)||tree.item;if(this.dropPosition=="Before"||this.dropPosition=="After"){_2ab=(_2a9.getParent()&&_2a9.getParent().item)||tree.item;_2aa=_2a9.getIndexInParent();if(this.dropPosition=="After"){_2aa=_2a9.getIndexInParent()+1;}}var _2ac=this.itemCreator(_2a6,_2a9.rowNode,_2a5,_2a7);if(_2a5==this){if(_2a8.pasteItems){_2a8.pasteItems(_2ac,_2ab,copy,_2aa);}else{_29b.forEach(_2ac,function(item){if(item.dndData){var _2ad=item.dndData.options;var _2ae=_2ad?_2ad.oldParentItem:null;var _2af=_2ad?_2ad.indexInParent:0;if(typeof _2aa=="number"){if(_2ab==_2ae&&_2af<_2aa){_2aa-=1;}}_2a8.pasteItem(item.dndData.data,_2ae,_2ab,copy,_2aa);}});}}else{if(_2a8.newItems){_2a8.newItems(_2ac,_2ab,_2aa);}else{_29b.forEach(_2ac,function(item){_2a8.newItem(item,_2ab,_2aa);});}}if(!_2a5.isDragging&&!_2a7.isDragging){this.onDndEnd();}}if(_2a5!==_2a7&&!copy&&_2a5.onDndItemRemoved){var _2b0=_29b.map(_2a6,function(node){return this._getDndData(_2a5.getItem(node.id),this.accept,this===_2a5);},this);_2a5.onDndItemRemoved(_2b0,_2a5,_2a6,copy,_2a7);}this.onDndCancel();},onMouseOut:function(){this.inherited(arguments);if(this._expandOnDndTimeout){clearTimeout(this._expandOnDndTimeout);}},_onDragMouse:function(e,_2b1){this.inherited(arguments);var m=_2a2.manager();if(m.canDropFlag){when(this.checkItemAcceptance(this.current.rowNode,m.source,null),function(_2b2){m.canDrop(_2b2);});}if(this._expandOnDndTimeout){clearTimeout(this._expandOnDndTimeout);}if(this.tree&&this.tree.expandOnDnd===true&&this.targetAnchor){this._expandOnDndTimeout=setTimeout(lang.hitch(this,function(){this.isDragging&&this.tree._expandNode(this.targetAnchor);}),500);}},onDndEnd:function(){},onDndItemRemoved:function(_2b3,_2b4,_2b5,copy,_2b6){},itemCreator:function(_2b7,_2b8,_2b9,_2ba){return _29b.map(_2b7,function(node){return {id:node.id,name:node.textContent||node.innerText||"",dndData:this._getDndData(_2b9.getItem(node.id),this.accept,this===_2b9)};},this);},getItem:function(key){var item=this.inherited(arguments);if(this.tree.getItemType&&item&&item.data&&item.data.item){item.type=this.tree.getItemType(item.data.item);}item.options=this.getItemOptions(item);return item;},getItemOptions:function(item){var opts={};if(item.data){if(item.data.getParent){var _2bb=item.data.getParent();opts.oldParentItem=_2bb?_2bb.item:null;}if(item.data.getIndexInParent){opts.indexInParent=item.data.getIndexInParent();}}return opts;},onMouseDown:function(e){var _2bc=_29e.contains(e.target,"dojoDndContainerOver");if(_2bc){return;}this.inherited(arguments);},checkAcceptance:function(_2bd,_2be){if(this.readOnly){return false;}var _2bf=_29b.map(_2be,function(node){return _2bd.getItem(node.id);});return this._checkAcceptanceForItems(_2bf,this.accept);}});});},"dijit/tree/dndSource":function(){define("dijit/tree/dndSource",["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/dom-class","dojo/dom-geometry","dojo/_base/lang","dojo/on","dojo/touch","dojo/topic","dojo/dnd/Manager","./_dndSelector"],function(_2c0,_2c1,_2c2,_2c3,_2c4,lang,on,_2c5,_2c6,_2c7,_2c8){var _2c9=_2c2("dijit.tree.dndSource",_2c8,{isSource:true,accept:["text","treeNode"],copyOnly:false,dragThreshold:5,betweenThreshold:0,generateText:true,constructor:function(tree,_2ca){if(!_2ca){_2ca={};}lang.mixin(this,_2ca);var type=_2ca.accept instanceof Array?_2ca.accept:["text","treeNode"];this.accept=null;if(type.length){this.accept={};for(var i=0;i<type.length;++i){this.accept[type[i]]=1;}}this.isDragging=false;this.mouseDown=false;this.targetAnchor=null;this.targetBox=null;this.dropPosition="";this._lastX=0;this._lastY=0;this.sourceState="";if(this.isSource){_2c3.add(this.node,"dojoDndSource");}this.targetState="";if(this.accept){_2c3.add(this.node,"dojoDndTarget");}this.topics=[_2c6.subscribe("/dnd/source/over",lang.hitch(this,"onDndSourceOver")),_2c6.subscribe("/dnd/start",lang.hitch(this,"onDndStart")),_2c6.subscribe("/dnd/drop",lang.hitch(this,"onDndDrop")),_2c6.subscribe("/dnd/cancel",lang.hitch(this,"onDndCancel"))];},checkAcceptance:function(){return true;},copyState:function(_2cb){return this.copyOnly||_2cb;},destroy:function(){this.inherited(arguments);var h;while(h=this.topics.pop()){h.remove();}this.targetAnchor=null;},_onDragMouse:function(e,_2cc){var m=_2c7.manager(),_2cd=this.targetAnchor,_2ce=this.current,_2cf=this.dropPosition;var _2d0="Over";if(_2ce&&this.betweenThreshold>0){if(!this.targetBox||_2cd!=_2ce){this.targetBox=_2c4.position(_2ce.rowNode,true);}if((e.pageY-this.targetBox.y)<=this.betweenThreshold){_2d0="Before";}else{if((e.pageY-this.targetBox.y)>=(this.targetBox.h-this.betweenThreshold)){_2d0="After";}}}if(_2cc||_2ce!=_2cd||_2d0!=_2cf){if(_2cd){this._removeItemClass(_2cd.rowNode,_2cf);}if(_2ce){this._addItemClass(_2ce.rowNode,_2d0);}if(!_2ce){m.canDrop(false);}else{if(_2ce==this.tree.rootNode&&_2d0!="Over"){m.canDrop(false);}else{var _2d1=false;if(m.source==this){for(var _2d2 in this.selection){var _2d3=this.selection[_2d2];if(_2d3.item===_2ce.item){_2d1=true;break;}}}if(_2d1){m.canDrop(false);}else{if(this.checkItemAcceptance(_2ce.rowNode,m.source,_2d0.toLowerCase())&&!this._isParentChildDrop(m.source,_2ce.rowNode)){m.canDrop(true);}else{m.canDrop(false);}}}}this.targetAnchor=_2ce;this.dropPosition=_2d0;}},onMouseMove:function(e){if(this.isDragging&&this.targetState=="Disabled"){return;}this.inherited(arguments);var m=_2c7.manager();if(this.isDragging){this._onDragMouse(e);}else{if(this.mouseDown&&this.isSource&&(Math.abs(e.pageX-this._lastX)>=this.dragThreshold||Math.abs(e.pageY-this._lastY)>=this.dragThreshold)){var _2d4=this.getSelectedTreeNodes();if(_2d4.length){if(_2d4.length>1){var seen=this.selection,i=0,r=[],n,p;nextitem:while((n=_2d4[i++])){for(p=n.getParent();p&&p!==this.tree;p=p.getParent()){if(seen[p.id]){continue nextitem;}}r.push(n);}_2d4=r;}_2d4=_2c0.map(_2d4,function(n){return n.domNode;});m.startDrag(this,_2d4,this.copyState(_2c1.isCopyKey(e)));this._onDragMouse(e,true);}}}},onMouseDown:function(e){this.mouseDown=true;this.mouseButton=e.button;this._lastX=e.pageX;this._lastY=e.pageY;this.inherited(arguments);},onMouseUp:function(e){if(this.mouseDown){this.mouseDown=false;this.inherited(arguments);}},onMouseOut:function(){this.inherited(arguments);this._unmarkTargetAnchor();},checkItemAcceptance:function(){return true;},onDndSourceOver:function(_2d5){if(this!=_2d5){this.mouseDown=false;this._unmarkTargetAnchor();}else{if(this.isDragging){var m=_2c7.manager();m.canDrop(false);}}},onDndStart:function(_2d6,_2d7,copy){if(this.isSource){this._changeState("Source",this==_2d6?(copy?"Copied":"Moved"):"");}var _2d8=this.checkAcceptance(_2d6,_2d7);this._changeState("Target",_2d8?"":"Disabled");if(this==_2d6){_2c7.manager().overSource(this);}this.isDragging=true;},itemCreator:function(_2d9){return _2c0.map(_2d9,function(node){return {"id":node.id,"name":node.textContent||node.innerText||""};});},onDndDrop:function(_2da,_2db,copy){if(this.containerState=="Over"){var tree=this.tree,_2dc=tree.model,_2dd=this.targetAnchor;this.isDragging=false;var _2de;var _2df;var _2e0;_2de=(_2dd&&_2dd.item)||tree.item;if(this.dropPosition=="Before"||this.dropPosition=="After"){_2de=(_2dd.getParent()&&_2dd.getParent().item)||tree.item;_2df=_2dd.getIndexInParent();if(this.dropPosition=="After"){_2df=_2dd.getIndexInParent()+1;_2e0=_2dd.getNextSibling()&&_2dd.getNextSibling().item;}else{_2e0=_2dd.item;}}else{_2de=(_2dd&&_2dd.item)||tree.item;}var _2e1;_2c0.forEach(_2db,function(node,idx){var _2e2=_2da.getItem(node.id);if(_2c0.indexOf(_2e2.type,"treeNode")!=-1){var _2e3=_2e2.data,_2e4=_2e3.item,_2e5=_2e3.getParent().item;}if(_2da==this){if(typeof _2df=="number"){if(_2de==_2e5&&_2e3.getIndexInParent()<_2df){_2df-=1;}}_2dc.pasteItem(_2e4,_2e5,_2de,copy,_2df,_2e0);}else{if(_2dc.isItem(_2e4)){_2dc.pasteItem(_2e4,_2e5,_2de,copy,_2df,_2e0);}else{if(!_2e1){_2e1=this.itemCreator(_2db,_2dd.rowNode,_2da);}_2dc.newItem(_2e1[idx],_2de,_2df,_2e0);}}},this);this.tree._expandNode(_2dd);}this.onDndCancel();},onDndCancel:function(){this._unmarkTargetAnchor();this.isDragging=false;this.mouseDown=false;delete this.mouseButton;this._changeState("Source","");this._changeState("Target","");},onOverEvent:function(){this.inherited(arguments);_2c7.manager().overSource(this);},onOutEvent:function(){this._unmarkTargetAnchor();var m=_2c7.manager();if(this.isDragging){m.canDrop(false);}m.outSource(this);this.inherited(arguments);},_isParentChildDrop:function(_2e6,_2e7){if(!_2e6.tree||_2e6.tree!=this.tree){return false;}var root=_2e6.tree.domNode;var ids=_2e6.selection;var node=_2e7.parentNode;while(node!=root&&!ids[node.id]){node=node.parentNode;}return node.id&&ids[node.id];},_unmarkTargetAnchor:function(){if(!this.targetAnchor){return;}this._removeItemClass(this.targetAnchor.rowNode,this.dropPosition);this.targetAnchor=null;this.targetBox=null;this.dropPosition=null;},_markDndStatus:function(copy){this._changeState("Source",copy?"Copied":"Moved");}});return _2c9;});},"epi/shell/widget/Tree":function(){define("epi/shell/widget/Tree",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom","dijit/focus","dijit/Tree"],function(_2e8,_2e9,lang,dom,_2ea,Tree){return _2e9(Tree,{postCreate:function(){this.inherited(arguments);this.connect(this.model,"onItemChildrenReload","_onChildrenReload");},_onChildrenReload:function(_2eb){var _2ec=this.model.getIdentity(_2eb),_2ed=this._itemNodesMap[_2ec];if(_2ed){if(_2e8.some(_2ed,function(node){return node.state==="LOADED";})){this.model.getChildren(_2eb,lang.hitch(this,function(_2ee){_2e8.forEach(_2ed,function(_2ef){_2ef.setChildItems(_2ee);});_2e8.forEach(_2ee,function(_2f0){this.model.onChange(_2f0);this._onChildrenReload(_2f0);},this);}));}else{_2e8.forEach(_2ed,function(node){node.isExpandable=this.model.mayHaveChildren(node.item);node._setExpando(false);},this);}}},_onItemChildrenChange:function(){var _2f1=null;if(_2ea.curNode&&dom.isDescendant(_2ea.curNode,this.domNode)){_2f1=_2ea.curNode;}this.inherited(arguments);if(_2f1){if(dom.isDescendant(_2f1,this.domNode)){_2f1.focus();}else{var node=this._getRootOrFirstNode();if(node){this.focusNode(node);}}}}});});},"epi-cms/widget/_ContentTreeNode":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/dom-construct","dojo/string","dijit/Tree","dijit/_TemplatedMixin","dojox/html/ellipsis","epi-cms/widget/_ContentTreeNodeMixin","dojo/text!./templates/_ContentTreeNode.html"],function(_2f2,_2f3,_2f4,_2f5,Tree,_2f6,_2f7,_2f8,_2f9){return _2f2([Tree._TreeNode,_2f6,_2f8],{templateString:_2f9,buildRendering:function(){this.inherited(arguments);_2f3.add(this.labelNode,"dojoxEllipsis");},_setItemAttr:function(item){this._set("item",item);this.set("dndData",item);if(item&&item.thumbnailUrl){var _2fa=_2f4.create("img",{src:item.thumbnailUrl+_2f5.substitute("?${0}",[new Date().getTime()]),"class":"epi-thumbnail"});this.thumbnailNode.appendChild(_2fa);_2f3.add(this.contentNode,"epi-mediaContent");}this.inherited(arguments);}});});},"dojox/html/ellipsis":function(){define("dojox/html/ellipsis",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/Color","dojo/colors"],function(d){if(d.isFF<7){var _2fb=1;if("dojoxFFEllipsisDelay" in d.config){_2fb=Number(d.config.dojoxFFEllipsisDelay);if(isNaN(_2fb)){_2fb=1;}}try{var _2fc=(function(){var sNS="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul";var xml=document.createElementNS(sNS,"window");var _2fd=document.createElementNS(sNS,"description");_2fd.setAttribute("crop","end");xml.appendChild(_2fd);return function(n){var x=xml.cloneNode(true);x.firstChild.setAttribute("value",n.textContent);n.innerHTML="";n.appendChild(x);};})();}catch(e){}var _2fe=d.create;var dd=d.doc;var dp=d.place;var _2ff=_2fe("iframe",{className:"dojoxEllipsisIFrame",src:"javascript:'<html><head><script>if(\"loadFirebugConsole\" in window){window.loadFirebugConsole();}</script></head><body></body></html>'",style:{display:"none"}});var _300=function(r,cnt){if(r.collapsed){return;}if(cnt>0){do{_300(r);cnt--;}while(cnt);return;}if(r.endContainer.nodeType==3&&r.endOffset>0){r.setEnd(r.endContainer,r.endOffset-1);}else{if(r.endContainer.nodeType==3){r.setEndBefore(r.endContainer);_300(r);return;}else{if(r.endOffset&&r.endContainer.childNodes.length>=r.endOffset){var _301=r.endContainer.childNodes[r.endOffset-1];if(_301.nodeType==3){r.setEnd(_301,_301.length-1);}else{if(_301.childNodes.length){r.setEnd(_301,_301.childNodes.length);_300(r);return;}else{r.setEndBefore(_301);_300(r);return;}}}else{r.setEndBefore(r.endContainer);_300(r);return;}}}};var _302=function(n){var c=_2fe("div",{className:"dojoxEllipsisContainer"});var e=_2fe("div",{className:"dojoxEllipsisShown",style:{display:"none"}});n.parentNode.replaceChild(c,n);c.appendChild(n);c.appendChild(e);var i=_2ff.cloneNode(true);var ns=n.style;var es=e.style;var _303;var _304=function(){ns.display="";es.display="none";if(n.scrollWidth<=n.offsetWidth){return;}var r=dd.createRange();r.selectNodeContents(n);ns.display="none";es.display="";var done=false;do{var _305=1;dp(r.cloneContents(),e,"only");var sw=e.scrollWidth,ow=e.offsetWidth;done=(sw<=ow);var pct=(1-((ow*1)/sw));if(pct>0){_305=Math.max(Math.round(e.textContent.length*pct)-1,1);}_300(r,_305);}while(!r.collapsed&&!done);};i.onload=function(){i.contentWindow.onresize=_304;_304();};c.appendChild(i);};var hc=d.hasClass;var doc=d.doc;var s,fn,opt;if(doc.querySelectorAll){s=doc;fn="querySelectorAll";opt=".dojoxEllipsis";}else{if(doc.getElementsByClassName){s=doc;fn="getElementsByClassName";opt="dojoxEllipsis";}else{s=d;fn="query";opt=".dojoxEllipsis";}}fx=function(){d.forEach(s[fn].apply(s,[opt]),function(n){if(!n||n._djx_ellipsis_done){return;}n._djx_ellipsis_done=true;if(_2fc&&n.textContent==n.innerHTML&&!hc(n,"dojoxEllipsisSelectable")){_2fc(n);}else{_302(n);}});};d.addOnLoad(function(){var t=null;var c=null;var _306=function(){if(c){d.disconnect(c);c=null;}if(t){clearTimeout(t);}t=setTimeout(function(){t=null;fx();c=d.connect(d.body(),"DOMSubtreeModified",_306);},_2fb);};_306();});}});},"dojo/colors":function(){define("dojo/colors",["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(dojo,lang,_307,_308){var _309={};lang.setObject("dojo.colors",_309);var _30a=function(m1,m2,h){if(h<0){++h;}if(h>1){--h;}var h6=6*h;if(h6<1){return m1+(m2-m1)*h6;}if(2*h<1){return m2;}if(3*h<2){return m1+(m2-m1)*(2/3-h)*6;}return m1;};dojo.colorFromRgb=_307.fromRgb=function(_30b,obj){var m=_30b.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(m){var c=m[2].split(/\s*,\s*/),l=c.length,t=m[1],a;if((t=="rgb"&&l==3)||(t=="rgba"&&l==4)){var r=c[0];if(r.charAt(r.length-1)=="%"){a=_308.map(c,function(x){return parseFloat(x)*2.56;});if(l==4){a[3]=c[3];}return _307.fromArray(a,obj);}return _307.fromArray(c,obj);}if((t=="hsl"&&l==3)||(t=="hsla"&&l==4)){var H=((parseFloat(c[0])%360)+360)%360/360,S=parseFloat(c[1])/100,L=parseFloat(c[2])/100,m2=L<=0.5?L*(S+1):L+S-L*S,m1=2*L-m2;a=[_30a(m1,m2,H+1/3)*256,_30a(m1,m2,H)*256,_30a(m1,m2,H-1/3)*256,1];if(l==4){a[3]=c[3];}return _307.fromArray(a,obj);}}return null;};var _30c=function(c,low,high){c=Number(c);return isNaN(c)?high:c<low?low:c>high?high:c;};_307.prototype.sanitize=function(){var t=this;t.r=Math.round(_30c(t.r,0,255));t.g=Math.round(_30c(t.g,0,255));t.b=Math.round(_30c(t.b,0,255));t.a=_30c(t.a,0,1);return this;};_309.makeGrey=_307.makeGrey=function(g,a){return _307.fromArray([g,g,g,a]);};lang.mixin(_307.named,{"aliceblue":[240,248,255],"antiquewhite":[250,235,215],"aquamarine":[127,255,212],"azure":[240,255,255],"beige":[245,245,220],"bisque":[255,228,196],"blanchedalmond":[255,235,205],"blueviolet":[138,43,226],"brown":[165,42,42],"burlywood":[222,184,135],"cadetblue":[95,158,160],"chartreuse":[127,255,0],"chocolate":[210,105,30],"coral":[255,127,80],"cornflowerblue":[100,149,237],"cornsilk":[255,248,220],"crimson":[220,20,60],"cyan":[0,255,255],"darkblue":[0,0,139],"darkcyan":[0,139,139],"darkgoldenrod":[184,134,11],"darkgray":[169,169,169],"darkgreen":[0,100,0],"darkgrey":[169,169,169],"darkkhaki":[189,183,107],"darkmagenta":[139,0,139],"darkolivegreen":[85,107,47],"darkorange":[255,140,0],"darkorchid":[153,50,204],"darkred":[139,0,0],"darksalmon":[233,150,122],"darkseagreen":[143,188,143],"darkslateblue":[72,61,139],"darkslategray":[47,79,79],"darkslategrey":[47,79,79],"darkturquoise":[0,206,209],"darkviolet":[148,0,211],"deeppink":[255,20,147],"deepskyblue":[0,191,255],"dimgray":[105,105,105],"dimgrey":[105,105,105],"dodgerblue":[30,144,255],"firebrick":[178,34,34],"floralwhite":[255,250,240],"forestgreen":[34,139,34],"gainsboro":[220,220,220],"ghostwhite":[248,248,255],"gold":[255,215,0],"goldenrod":[218,165,32],"greenyellow":[173,255,47],"grey":[128,128,128],"honeydew":[240,255,240],"hotpink":[255,105,180],"indianred":[205,92,92],"indigo":[75,0,130],"ivory":[255,255,240],"khaki":[240,230,140],"lavender":[230,230,250],"lavenderblush":[255,240,245],"lawngreen":[124,252,0],"lemonchiffon":[255,250,205],"lightblue":[173,216,230],"lightcoral":[240,128,128],"lightcyan":[224,255,255],"lightgoldenrodyellow":[250,250,210],"lightgray":[211,211,211],"lightgreen":[144,238,144],"lightgrey":[211,211,211],"lightpink":[255,182,193],"lightsalmon":[255,160,122],"lightseagreen":[32,178,170],"lightskyblue":[135,206,250],"lightslategray":[119,136,153],"lightslategrey":[119,136,153],"lightsteelblue":[176,196,222],"lightyellow":[255,255,224],"limegreen":[50,205,50],"linen":[250,240,230],"magenta":[255,0,255],"mediumaquamarine":[102,205,170],"mediumblue":[0,0,205],"mediumorchid":[186,85,211],"mediumpurple":[147,112,219],"mediumseagreen":[60,179,113],"mediumslateblue":[123,104,238],"mediumspringgreen":[0,250,154],"mediumturquoise":[72,209,204],"mediumvioletred":[199,21,133],"midnightblue":[25,25,112],"mintcream":[245,255,250],"mistyrose":[255,228,225],"moccasin":[255,228,181],"navajowhite":[255,222,173],"oldlace":[253,245,230],"olivedrab":[107,142,35],"orange":[255,165,0],"orangered":[255,69,0],"orchid":[218,112,214],"palegoldenrod":[238,232,170],"palegreen":[152,251,152],"paleturquoise":[175,238,238],"palevioletred":[219,112,147],"papayawhip":[255,239,213],"peachpuff":[255,218,185],"peru":[205,133,63],"pink":[255,192,203],"plum":[221,160,221],"powderblue":[176,224,230],"rosybrown":[188,143,143],"royalblue":[65,105,225],"saddlebrown":[139,69,19],"salmon":[250,128,114],"sandybrown":[244,164,96],"seagreen":[46,139,87],"seashell":[255,245,238],"sienna":[160,82,45],"skyblue":[135,206,235],"slateblue":[106,90,205],"slategray":[112,128,144],"slategrey":[112,128,144],"snow":[255,250,250],"springgreen":[0,255,127],"steelblue":[70,130,180],"tan":[210,180,140],"thistle":[216,191,216],"tomato":[255,99,71],"turquoise":[64,224,208],"violet":[238,130,238],"wheat":[245,222,179],"whitesmoke":[245,245,245],"yellowgreen":[154,205,50]});return _307;});},"epi-cms/widget/_ContentTreeNodeMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","epi-cms/ContentLanguageHelper"],function(_30d,lang,when,_30e,_30f,_310,_311){return _30d(null,{_missingLanguageCssClass:"epi-ct-missingLanguageRow",_updateItemClasses:function(item){this.inherited(arguments);this._updateLayout();},_updateLayout:function(){this.inherited(arguments);this._updateLanguageIndicator();this._updateIndividualLayout();},_updateIndividualLayout:function(){},_addLanguageIndicator:function(){var _312=this.item.missingLanguageBranch;if(this.iconNodeLanguage){this.iconNodeLanguage.innerHTML=_312.language||"";when(_311.getMissingLanguageMessage(this.item),lang.hitch(this,function(_313){_30e.set(this.iconNodeLanguage,"title",_313||"");}));}_30f.add(this.rowNode,this._missingLanguageCssClass);},_removeLanguageIndicator:function(){if(this.iconNodeLanguage){_310.empty(this.iconNodeLanguage);_30e.remove(this.iconNodeLanguage,"title");}_30f.remove(this.rowNode,this._missingLanguageCssClass);},_updateLanguageIndicator:function(){if(!this._isTypeOfRoot()&&this.item.missingLanguageBranch){this._addLanguageIndicator();}else{this._removeLanguageIndicator();}},_isTypeOfRoot:function(){if(!this.tree.model||typeof this.tree.model.isTypeOfRoot!=="function"){return false;}return this.tree.model.isTypeOfRoot(this.item);}});});},"epi-cms/ContentLanguageHelper":function(){define("epi-cms/ContentLanguageHelper",["dojo/_base/lang","dojo/_base/declare","dojo/_base/Deferred","dojo/promise/all","epi/dependency","epi/shell/TypeDescriptorManager"],function(lang,_314,_315,all,_316,_317){return {getMissingLanguageMessage:function(_318){if(!_318||!_318.missingLanguageBranch){return "";}this._languageStore=this._languageStore||_316.resolve("epi.storeregistry").get("epi.cms.language");var def=new _315();var _319=_318.missingLanguageBranch;all([this._languageStore.get(_319.preferredLanguage),this._languageStore.get(_319.language)]).then(lang.hitch(this,function(_31a){var _31b=_319.reason;var _31c="languagenotifications.";if(_31b===6){_31c+="missing";}else{if(_31b===3||_31b===5){_31c+="replacement";}else{if(_31b===4){_31c+="fallback";}}}var _31d=_317.getResourceValue(_318.typeIdentifier,_31c);_31d=lang.replace(_31d,[_31a[0].name,_31a[1].name]);def.resolve(_31d);}),function(){def.resolve("");});return def;}};});},"url:epi-cms/widget/templates/_ContentTreeNode.html":"<div class=\"dijitTreeNode\" role=\"presentation\">\r\n    <a href=\"#\" tabindex=\"-1\" data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>            \r\n            <span data-dojo-attach-point=\"thumbnailNode\" class=\"epi-thumbnailIcon\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"iconNodeLanguage\" class=\"epi-extraIcon epi-pt-currentLanguageMissing\" role=\"presentation\">&nbsp;</span>\r\n            </span>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n        </span>\r\n    </a>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>","epi-cms/widget/ContentTreeModelConfirmation":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/string","dojo/when","dojo/_base/json","dojox/html/entities","epi/dependency","epi/string","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Alert","epi/shell/widget/dialog/Confirmation","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/sharedContentDialogHandler","epi/i18n!epi/cms/nls/episerver.cms.components.pagetree"],function(_31e,lang,_31f,_320,_321,when,json,_322,_323,_324,_325,_326,_327,_328,_329,res){return function(_32a){var _32b=function(_32c){return _32c&&typeof _32c=="function";};var _32d=function(_32e,_32f){var _330=new _326({destroyOnHide:true,description:_324.toHTML(_32e),onAction:function(){if(_32b(_32f)){_32f();}}});_330.show();};var _331=function(_332,_333){var _334=new _320();when(_333,function(_335){var _336=new _327({destroyOnHide:true,description:_324.toHTML(_335),title:_332,onAction:function(_337){_337?_334.resolve():_334.cancel();}});_336.show();});return _334;};var _338=function(_339,_33a){when(_339,function(_33b){if(_33b&&(_33b.message||_33b.statusDescription)){var _33c=_33b.message||_33b.statusDescription;_32d(_33c,_33a);}else{if(_32b(_33a)){_33a();}}},function(e){_32d(_322.encode(json.fromJson(e.xhr.responseText)));});return _339;};_31f.around(_32a,"pasteItem",function(_33d){return function(_33e,_33f,_340,copy,_341){var _342=_325.getResourceValue(_33e.typeIdentifier,"move");var _343=true;if(_340.isWastebasket){_343=_329({contentData:_33e});}else{if(_341!==undefined&&(_340.properties.pageChildOrderRule!==_328.sortOrder.Index)){var _344=_321.substitute(res.changepeerorderconfirmation,[_32a.getLabel(_340)]);_343=_331(_342,_344);}else{if(!copy){if(!_32a.canCut(_33e)){_32d(_325.getResourceValue(_33e.typeIdentifier,"moverequiresdeleteaccess"),function(){return false;});return;}_343=_331(_342,_325.getResourceValue(_33e.typeIdentifier,"moveconfirmation"));}else{if(!_32a.canCopy(_33e)){_32d(_325.getResourceValue(_33e.typeIdentifier,"copynotsupported"));return;}}}}var _345=arguments;return when(_343,function(){return _33d.apply(_32a,_345);},function(){return false;});};});_31f.after(_32a,"pasteItem",function(_346){return _346&&_338(_346);});_31f.after(_32a,"remove",function(_347){return _347&&_338(_347);});return _32a;};});},"epi-cms/contentediting/ContentActionSupport":function(){define(["epi/i18n!epi/cms/nls/episerver.cms.versionstatus"],function(res){var _348=[];if(res){_348=[res.notcreated,res.rejected,res.checkedout,res.checkedin,res.published,res.previouslypublished,res.delayedpublish,res.expired];}var _349={versionStatus:{NotCreated:0,Rejected:1,CheckedOut:2,CheckedIn:3,Published:4,PreviouslyPublished:5,DelayedPublish:6,Expired:7},versionLocalizations:_348,getVersionStatus:function(_34a){return this.versionLocalizations[_34a];},action:{Create:"Create",Edit:"Edit",Delete:"Delete",CheckIn:"CheckIn",Save:"Save",Reject:"Reject",Publish:"Publish",Administer:"Administer"},accessLevel:{NoAccess:0,Read:1,Create:2,Edit:4,CheckIn:4,Delete:8,Publish:16,Administer:32,FullAccess:63},saveAction:{None:0,Save:1,CheckIn:2,Publish:3,Reject:4,ForceNewVersion:128,ForceCurrentVersion:256,SkipValidation:512,DelayedPublish:1024},sortOrder:{None:0,CreatedDescending:1,CreatedAscending:2,Alphabetical:3,Index:4,ChangedDescending:5,Rank:6,PublishedAscending:7,PublishedDescending:8},providerCapabilities:{None:0,Create:1,Edit:2,Delete:4,Move:8,Copy:16,MultiLanguage:32,Security:64,Search:128,PageFolder:256,Wastebasket:512},isActionAvailable:function(_34b,_34c,_34d,_34e,_34f){if(!_34b){return false;}if(!_34e&&_34b.capabilities&&_34b.capabilities.language&&_34b.missingLanguageBranch&&_34b.missingLanguageBranch.isTranslationNeeded){return false;}var _350=_34f?_34b.accessRights:_34b.accessMask;var _351=_349.hasAccess(_350,_349.accessLevel[_34c])&&_349.canPerformAction(_34b,_34c);if(_34d){_351=_351&&_349.hasProviderCapability(_34b.providerCapabilityMask,_34d);}return _351;},canPerformAction:function(_352,_353){if(_352.status===_349.versionStatus.DelayedPublish&&(_353===_349.action.Edit||_353===_349.action.Publish)){return false;}if(_353===_349.action.Publish){return !(_352.status===_349.versionStatus.Published||_352.status===_349.versionStatus.Expired);}if(_353===_349.action.CheckIn){return _352.status===_349.versionStatus.CheckedOut||_352.status===_349.versionStatus.Rejected;}if(_353===_349.action.Edit){var _354=(_352.status===_349.versionStatus.Published&&!_352.isCommonDraft)||(_352.status===_349.versionStatus.Expired&&!_352.isCommonDraft)||_352.status===_349.versionStatus.PreviouslyPublished||_352.status===_349.versionStatus.CheckedIn||_352.status===_349.versionStatus.DelayedPublish;return !(_354||_352.isDeleted||_352.isWastebasket);}return true;},hasAccess:function(_355,_356){return (_355&_356)==_356;},hasLanguageAccess:function(item){if(!item){return false;}var _357=item.languageContext||item.missingLanguageBranch||item;return !_357||(_357.hasTranslationAccess&&_357.isPreferredLanguageAvailable);},getPermissionMap:function(_358){var map={};for(var al in _349.accessLevel){map[al]=_349.hasAccess(_358,_349.accessLevel[al]);}return map;},hasProviderCapability:function(_359,_35a){return (_359&_35a)==_35a;}};return _349;});},"epi-cms/widget/sharedContentDialogHandler":function(){define(["dojo/_base/lang","dojo/Deferred","dojo/when","dojox/html/entities","epi","epi/dependency","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Dialog","epi/shell/widget/DelayableStandby","epi-cms/widget/ContentReferences","epi/i18n!epi/cms/nls/episerver.cms.widget.contentreferences"],function(lang,_35b,when,_35c,epi,_35d,_35e,_35f,_360,_361,_362){var _363=function(_364){var _365=new _35b(),_366=_364.contentData.contentLink,_367=_35d.resolve("epi.storeregistry"),_368=_367.get("epi.cms.content.search"),_369=new _360({target:document.body,zIndex:999}).placeAt(document.body);_369.show(50,0);when(_368.get(_366),function(_36a){var mode=_364.mode||_363.mode.confirm,_36b=mode===_363.mode.confirm,_36c=new _361({model:{contentData:_36a,mode:mode}});var _36d=_36c.watch("numberOfReferences",function(_36e,_36f,_370){_36d.remove();var _371;if(_36b){var key=_36a.hasChildren?"movetotrashwithsubcontentdescription":"movetotrashdescription";_371=_35e.getResourceValue(_36a.typeIdentifier,key);}else{_371=_35e.getResourceValue(_36a.typeIdentifier,"referencesdescription");}_371=lang.replace(_371,[_35c.encode(_36a.name)]);var _372=_364.title;if(!_372){var _373=_36b?"movetotrash":"references";_372=_35e.getResourceValue(_36a.typeIdentifier,_373);}var _374=new _35f({focusActionsOnLoad:true,destroyOnHide:true,defaultActionsVisible:_36b,dialogClass:"epi-dialog-contentReferences",title:_372,description:_371,cancelActionText:epi.resources.action.cancel,confirmActionText:_370===0?_362.buttons.movetotrash:_362.buttons.movetotrashanyway,setFocusOnConfirmButton:_370===0});if(!_36b){_374.definitionConsumer.add({name:"close",label:epi.resources.action.close,action:_374.onCancel});}_374.connect(_374,"onExecute",_365.resolve);_374.connect(_374,"onCancel",_365.cancel);_374.set("content",_36c);var _375=_36c.on("viewReference",function(){_374.hide();_375.remove();});_369.hide();_374.show();});_36c.startup();});return _365.promise;};_363.mode={confirm:"confirm",show:"show"};return _363;});},"epi-cms/widget/ContentReferences":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/keys","dojo/when","epi-cms/dgrid/formatters","epi/shell/TypeDescriptorManager","./_GridWidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojo/Evented","dojo/text!./templates/ContentReferences.html","epi/i18n!epi/cms/nls/episerver.cms.widget.contentreferences","dijit/form/Button"],function(_376,lang,_377,_378,_379,keys,when,_37a,_37b,_37c,_37d,_37e,_37f,_380,_381){return _376([_37c,_37d,_37e,_37f],{res:_381,templateString:_380,storeKeyName:"epi.cms.contentreferences",contextChangeEvent:"dblclick",trackActiveItem:false,ignoreVersionWhenComparingLinks:false,_setTotalLinksAttr:{node:"totalLinksNode",type:"innerText"},_setNotificationAttr:{node:"contentReferencesNotificationNode",type:"innerText"},_setNotificationBarStyleAttr:function(_382){switch(_382){case 1:_377.add(this.contentReferencesNotificationBar,"epi-statusIndicator epi-statusIndicatorOk");break;case 2:_377.add(this.contentReferencesNotificationBar,"epi-statusIndicator epi-statusIndicatorWarning");break;}},_setNumberOfReferencesAttr:function(_383){var _384=this.model.contentData,_385=_383>0;var _386=lang.hitch(this,function(_387,_388){var text=_37b.getResourceValue(_384.typeIdentifier,_387);this.set("notification",text);this.set("notificationBarStyle",_388);});if(_385){if(_384.hasChildren){_386("referenceswithsubcontentwarning",2);}else{_386("referenceswarning",2);}}else{if(_384.hasChildren){_386("noreferenceswithsubcontentwarning",null);}else{if(_384.publicUrl){_386("publicreferencesnote",null);}else{_386("noreferencesnote",1);}}}if(_385){var _389=_383===1?_381.totallink:_381.totallinks;var _38a=lang.replace(_389,[_383]);this.set("totalLinks",_38a);}this._set("numberOfReferences",_383);},_setShowToolbarAttr:function(_38b){_379.set(this.captionPanelNode,"display",_38b?"":"none");},buildRendering:function(){var _38c=this._getLinkTemplate();var _38d=lang.mixin({columns:{name:{renderCell:lang.hitch(this,"_renderContentItem")},treePath:{className:"epi-width50",get:function(item){return item.treePath.join("<span class=\"epi-breadCrumbsSeparator\">&gt;</span>");},ellipsisNoTooltip:true},view:{className:"epi-width10",label:" ",formatter:function(){return _38c;},sortable:false}},store:this.store,query:{id:this.model.contentData.contentLink},showHeader:false},this.defaultGridMixin);this.inherited(arguments);this.grid=new this._gridClass(_38d,this.gridNode);_377.toggle(this.contentReferencesNotificationBar,"dijitHidden",this.model.mode=="show");},startup:function(){this.inherited(arguments);this.grid.on(".dgrid-column-view a:click",lang.hitch(this,"_onChangeContext"));this.grid.on("dgrid-refresh-complete",lang.hitch(this,"_afterDataFetched"));},fetchData:function(){this.grid.refresh();},_afterDataFetched:function(e){when(e.results.total,lang.hitch(this,function(_38e){this.set("numberOfReferences",_38e);this.set("showToolbar",_38e>0);_379.set(this.grid.domNode,"visibility",(_38e>0)?"visible":"hidden");}));},_onChangeContext:function(e){var row=this.grid.row(e),_38f={uri:row.data.uri};this._requestNewContext(_38f,{sender:this});this.emit("viewReference");},_getLinkTemplate:function(){var node=_378.create("a",{"class":"epi-visibleLink",innerHTML:_381.view.label,title:_381.view.tooltip});return node.outerHTML;}});});},"epi-cms/dgrid/formatters":function(){define(["dojo/_base/lang","dojo/dom-class","dojo/string","epi/datetime","epi/dependency","epi/username","epi/shell/dgrid/Formatter","epi/shell/dgrid/util/misc","epi/shell/TypeDescriptorManager","epi-cms/contentediting/ContentActionSupport"],function(lang,_390,_391,_392,_393,_394,_395,misc,_396,_397){var _398={defaultIconClass:"epi-iconObjectUnknown",thumbnail:function(_399){var _39a="<image src=\"{0}?{1}\" class=\"epi-floatLeft epi-thumbnail\"/>";return _399?lang.replace(_39a,[_399,new Date().getTime()]):"";},contentIcon:function(_39b){var _39c=_396.getValue(_39b,"iconClass");return misc.icon(_39c+" epi-objectIcon");},languageBranch:function(_39d){return _39d?"<span class=\"epi-missingLanguageIndicator\">"+_39d.language+"</span>":"";},menu:function(_39e){return lang.replace("<span class=\"dijitInline dijitIcon epi-iconContextMenu epi-floatRight\" title=\"{title}\">&nbsp;</span>",_39e);},userName:function(_39f){return _394.toUserFriendlyHtml(_39f);},localizedDate:function(date){return _392.toUserFriendlyHtml(date);},friendlyBoolean:function(_3a0){var _3a1=_3a0?"epi-iconCheckmark":"epi-iconStop";return "<div class=\""+_3a1+"\" />";},versionStatus:function(_3a2){return _397.getVersionStatus(_3a2);},visibleLink:function(_3a3,_3a4){if(!_3a3){return "";}var text=!_3a4?misc.htmlEncode(_3a3):_3a3;return "<span class=\"epi-visibleLink\">"+text+"</span>";},secondaryText:function(_3a5,_3a6){if(!_3a5){return "";}var text=!_3a6?misc.htmlEncode(_3a5):_3a5;return "<span class=\"epi-secondaryText\">"+text+"</span>";},contentItemFactory:function(_3a7,_3a8,_3a9,_3aa,_3ab,_3ac,_3ad){return function(_3ae,_3af,node,_3b0){var _3b1,_3b2,text,_3b3,_3b4,_3b5,_3b6;function get(name){if(typeof _3af.get==="function"){return _3af.get(name);}return _3af[name];};function _3b7(_3b8){if(_3b8){if(typeof _3b8==="function"){return _3b8(_3af);}else{return get(_3b8);}}return _3ae;};_3b5=typeof _3ae==="string";_3b2=_3b7(_3a9||(_3b5?false:"typeIdentifier"));text=_3b7(_3a7||(_3b5?false:"text"));_3b3=_3b7(_3a8||(_3b5?false:"title"));_3b4=(_3ac&&_3b7(_3ac))||_3af.missingLanguageBranch;_3b6=_3ab&&_3b7(_3ab);_3b1=_398.contentItem(_3b2,_3b4,text,_3b3,_3aa,_3b6,_3ad);node.innerHTML=_3b1;if(node.nodeName!=="TD"&&_3b4){_390.add(node,"epi-ct-missingLanguageRow");}return _3b1;};},contentItem:function(_3b9,_3ba,text,_3bb,_3bc,_3bd,_3be){var menu=(_3bc&&_3bc.hasMenu)?_398.menu(_3bc.settings):"",_3bf=_398.languageBranch(_3ba);_3be=(_3be===null||_3be===undefined)?true:_3be;_3bb=_3be?misc.attributeEncode(_3bb||text):(_3bb||text);text=_3be?misc.htmlEncode(text):text;return (_3bd?_398.thumbnail(_3bd):_398.contentIcon(_3b9))+menu+_3bf+misc.ellipsis(text,_3bb);}};_395.addFormatter("contentIcon",_398.contentIcon);_395.addFormatter("userName",_398.userName);_395.addFormatter("versionStatus",_398.versionStatus);_395.addFormatter("localizedDate",_398.localizedDate);_395.addFormatter("contentItem",_398.contentItemFactory,true);return _398;});},"epi/username":function(){define("epi/username",["dojo/_base/declare","dojox/html/entities","epi/dependency"],function(_3c0,_3c1,_3c2){var _3c3={toUserFriendlyString:function(_3c4,_3c5,_3c6,_3c7){if(!_3c5){_3c5=this._getCurrentUsername();}var _3c8=_3c7?"":epi.resources.text.installer,_3c9=_3c4&&_3c5.toLowerCase()===_3c4.toLowerCase()?epi.resources.text.you:_3c4||_3c8;if(_3c6){_3c9=_3c9.charAt(0).toUpperCase()+_3c9.slice(1);}return _3c9;},toUserFriendlyHtml:function(_3ca,_3cb,_3cc,_3cd){var _3ce=this.toUserFriendlyString(_3ca,_3cb,_3cc,_3cd);if(_3ce===""){return _3ce;}return "<span class='epi-username'>"+_3c1.encode(_3ce)+"</span>";},_getCurrentUsername:function(){if(!this.currentUsername){var _3cf=_3c2.resolve("epi.shell.Profile");this.currentUsername=_3cf.get("userName");}return this.currentUsername;}};return _3c3;});},"epi/shell/dgrid/Formatter":function(){define("epi/shell/dgrid/Formatter",["dojo/_base/declare","dojo/_base/array","dojo/when","dgrid/Grid","epi/shell/dgrid/TemplateColumn"],function(_3d0,_3d1,when,Grid,_3d2){var _3d3=_3d0(null,{_isGrid:false,configStructure:function(){this.inherited(arguments);this._isGrid=this instanceof Grid;if(this._isGrid){this._setupTemplateColumns();}else{this._setupList();}},_setupTemplateColumns:function(){if(!this.subRows){return;}var _3d4;_3d1.forEach(this.subRows,function(_3d5){_3d1.forEach(_3d5,function(_3d6){_3d4=[];_3d1.forEach(_3d3.shorthands,function(_3d7){var _3d8=_3d6[_3d7],_3d9=_3d3.formatters[_3d7];if(!!_3d8){if(_3d9){_3d4.push(_3d9.isFactory?_3d9.handler(_3d8):_3d9.handler);}else{throw new Error("Formatter with key "+_3d7+" not found");}}});if(_3d6.formatters){this._findFormatters(_3d6.formatters,_3d4);}if(_3d4.length>0){_3d6=_3d2(_3d6,_3d4);}},this);},this);},_setupList:function(){if(this.formatters){this._resolvedFormatters=this._findFormatters(this.formatters);}else{if(this.field){this._resolvedFormatters=[function(data,_3da,row){return data;}];}}},renderRow:function(_3db,_3dc){if(this._isGrid){return this.inherited(arguments);}var row=this.inherited(arguments,["",_3dc]),data=this.field?_3db[this.field]:_3db,_3dd=this._resolvedFormatters,i=-1;function _3de(_3df){var _3e0=_3dd[i],_3e1;if(_3e0){row.innerHTML=_3df;data=_3df;}i++;if(_3dd.length>i){_3e0=_3dd[i];_3e1=_3e0(data,_3db,row);when(_3e1,_3de);}};if(_3dd.length>0){_3de();}return row;},_findFormatters:function(_3e2,_3e3){_3e3=_3e3||[];_3d1.forEach(_3e2,function(_3e4){var type=typeof _3e4,item,_3e5;if(type==="string"){item=_3d3.formatters[_3e4];if(item){_3e5=item.isFactory?item.handler():item.handler;_3e5.allParameters=item.allParameters;}}else{if(type==="function"){_3e5=_3e4;}}if(_3e5){_3e3.push(_3e5);}else{throw new Error("Formatter with key "+_3e4+"not found");}});return _3e3;}});_3d3.formatters={};_3d3.shorthands=[];_3d3.addFormatter=function(name,_3e6,_3e7,_3e8){_3d3.formatters[name]={handler:_3e6,isFactory:!!_3e7};if(_3e8){_3d3.shorthands.push(name);}};return _3d3;});},"epi/shell/dgrid/TemplateColumn":function(){define("epi/shell/dgrid/TemplateColumn",["dojo/_base/array"],function(_3e9){return function(_3ea,_3eb){var _3ec=_3ea.renderCell;_3ea.formatters=_3eb||_3ea.formatters;if(_3ea.formatters&&_3ea.formatters.length>0){_3ea.renderCell=function(_3ed,_3ee,cell,_3ef){_3e9.forEach(_3ea.formatters,function(_3f0){_3ee=_3f0(_3ee,_3ed,cell,_3ef);});if(_3ee){cell.innerHTML=_3ee;}};}return _3ec?_3ec.call(_3ea,object,value,cell,options):_3ea;};});},"epi/shell/dgrid/util/misc":function(){require({cache:{"url:dojox/html/resources/ellipsis.css":".dojoxEllipsis,.dojoxEllipsisShown {white-space: nowrap; width: 100%; overflow: hidden; text-overflow: ellipsis; -o-text-overflow: ellipsis; -webkit-text-overflow: ellipsis;}.dojoxEllipsis window {width:100%; -moz-user-focus:normal; -moz-user-select:text;}.dojoxEllipsis description{-moz-user-focus:normal; -moz-user-select:text;}.dojoxEllipsisIFrame{white-space: normal; border: none; width: 100%; display: block; height: 1px; margin-top: -1px; clear: both;}.dojoxEllipsisContainer{width: 100%;}.dojoxEllipsisShown:after{content: \"\\2026\"}"}});define("epi/shell/dgrid/util/misc",["dojo/_base/declare","dojo/_base/lang","dojox/html/entities","epi/shell/dgrid/Formatter","dojo/text!dojox/html/resources/ellipsis.css"],function(_3f1,lang,_3f2,_3f3,_3f4){var _3f5={_attributeEncodeMap:[["&","amp"],["\"","quot"]],htmlEncode:function(text){return _3f2.encode(text);},attributeEncode:function(text){return _3f2.encode(text,_3f5._attributeEncodeMap);},ellipsis:function(text,_3f6){if(!_3f6||!lang.isString(_3f6)){_3f6=text;}return lang.replace("<div class=\"dojoxEllipsis\" title=\"{0}\">{1}</div>",[_3f6,text]);},ellipsisNoTooltip:function(text){return lang.replace("<div class=\"dojoxEllipsis\">{0}</div>",[text]);},icon:function(icon,text){text=text||"";return lang.replace("<span class=\"dijitInline dijitIcon {0}\"></span>{1}",[icon,text]);}};_3f3.addFormatter("htmlEncode",_3f5.htmlEncode,false,true);_3f3.addFormatter("icon",function(icon){return function(_3f7){return _3f5.icon(icon,_3f7);};},true,true);_3f3.addFormatter("ellipsis",_3f5.ellipsis,false,true);_3f3.addFormatter("ellipsisNoTooltip",_3f5.ellipsisNoTooltip,false,true);return _3f5;});},"url:dojox/html/resources/ellipsis.css":".dojoxEllipsis,.dojoxEllipsisShown {white-space: nowrap; width: 100%; overflow: hidden; text-overflow: ellipsis; -o-text-overflow: ellipsis; -webkit-text-overflow: ellipsis;}.dojoxEllipsis window {width:100%; -moz-user-focus:normal; -moz-user-select:text;}.dojoxEllipsis description{-moz-user-focus:normal; -moz-user-select:text;}.dojoxEllipsisIFrame{white-space: normal; border: none; width: 100%; display: block; height: 1px; margin-top: -1px; clear: both;}.dojoxEllipsisContainer{width: 100%;}.dojoxEllipsisShown:after{content: \"\\2026\"}","epi-cms/widget/_GridWidgetBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-construct","dojo/keys","dojo/topic","dojo/when","dgrid/Keyboard","dgrid/OnDemandGrid","dgrid/Selection","dijit/layout/_LayoutWidget","epi","epi/datetime","epi/UriParser","epi/username","epi/shell/dgrid/Formatter","epi/shell/TypeDescriptorManager","epi-cms/_ContentContextMixin","epi-cms/core/ContentReference","epi-cms/dgrid/DnD","epi-cms/dgrid/formatters","epi-cms/dgrid/WithContextMenu","epi/dependency"],function(_3f8,lang,_3f9,_3fa,keys,_3fb,when,_3fc,_3fd,_3fe,_3ff,epi,_400,_401,_402,_403,_404,_405,_406,DnD,_407,_408,_409){return _3f8([_3ff,_405],{_gridClass:_3f8([_3fd,_403,_3fe,DnD,_3fc,_408]),storeKeyName:null,grid:null,store:null,ignoreVersionWhenComparingLinks:true,trackActiveItem:true,defaultGridMixin:null,currentItem:null,contextChangeEvent:"click",postMixInProperties:function(){this.inherited(arguments);this.defaultGridMixin={selectionMode:"single",dndParams:{creator:lang.hitch(this,this._dndNodeCreator),copyOnly:true,selfAccept:false}};if(!this.store&&this.storeKeyName){var _40a=_409.resolve("epi.storeregistry");this.store=_40a.get(this.storeKeyName);}},startup:function(){this.inherited(arguments);if(this.contextChangeEvent){var _40b=lang.hitch(this,"_onChangeContext");this.grid.on(".dgrid-row:"+this.contextChangeEvent,_40b);if(typeof this.grid.addKeyHandler=="function"){this.grid.addKeyHandler(keys.ENTER,_40b);this.grid.addKeyHandler(keys.SPACE,_40b);}}this.grid.on("dgrid-select",lang.hitch(this,"_onSelect"));this.grid.on("dgrid-error",lang.hitch(this,"_onError"));if(this.trackActiveItem){this.own(_3f9.after(this.grid,"insertRow",lang.hitch(this,this._selectActiveItem)));}this.own(this.connect(this,"layout",lang.hitch(this,function(){this.grid.resize();})));this.grid.startup();},destroy:function(){if(this.grid){this.grid.destroy();}this.inherited(arguments);},select:function(item){this.grid.clearSelection();if(item){this.grid.select(item.createVersionUnspecificReference().toString());}},_forceKeepContext:function(uri){return this._isSameAsCurrentContext(uri);},_onChangeContext:function(e){var row=this.grid.row(e),uri=row.data.uri,_40c={uri:uri};if(this._forceKeepContext(uri)){return;}this._requestNewContext(_40c,{sender:this});},_onSelect:function(e){},_onError:function(_40d){var _40e=this.grid.errorMessage;if(_40d.status&&_40d.status===403){_40e=epi.resources.messages.nopermissiontoviewdata;}this._showErrorMessage(_40e);},_requestNewContext:function(_40f,_410){_3fb.publish("/epi/shell/context/request",_40f,_410);},restore:function(){this.resize();},_isActiveItem:function(row){return when(this.getCurrentContext(),lang.hitch(this,function(_411){var _412=row.data.uri;return _411&&this._compareUris(_412,_411.uri);}));},_selectActiveItem:function(node){var row=this.grid.row(node);if(!row){return node;}when(this._isActiveItem(row),lang.hitch(this,function(_413){if(_413){if(this.grid.selectionMode==="single"){this.grid.clearSelection();}this.grid.select(row,null);}}));return node;},contextChanged:function(_414,_415){this.inherited(arguments);if(_414.type!=="epi.cms.contentdata"){return;}if(!_415||_415.sender!=this){this.onContextChanged(_414);}},onContextChanged:function(_416){this.fetchData();},fetchData:function(){},_showErrorMessage:function(_417){this.grid.cleanup();this.grid.contentNode.innerHTML=_417||"";},contextChangeFailed:function(_418,_419,_41a){this.inherited(arguments);if(_41a&&_41a.sender===this){this._selectActiveItem();}},_renderContentItem:function(_41b,_41c,node,_41d){node.innerHTML=_407.contentItem(_41b.typeIdentifier,_41b.missingLanguageBranch,_41c);},_localizeDate:function(_41e){return _407.localizedDate(_41e);},_createUserFriendlyUsername:function(name){return _407.userName(name);},_dndNodeCreator:function(item,hint){var _41f=_404.getAndConcatenateValues(item.typeIdentifier,"dndTypes");if(!_41f&&this.dndTypes){_41f=this.dndTypes;}var node=_3fa.create("div").appendChild(document.createTextNode(item.name));return {"node":node,"type":_41f,"data":item};},_aroundInsertRow:function(_420){return lang.hitch(this,function(_421,_422,_423,i,_424){var row=_420.apply(this.grid,arguments);var _425=this.get("currentItem");if(_425&&_425.createVersionUnspecificReference().toString()===_421.contentLink){this.select(_425);}return row;});},_getCurrentItem:function(){return when(this.getCurrentContext(),function(_426){return {"id":(new _406(_426.id)).id};});}});});},"epi-cms/dgrid/DnD":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/NodeList","epi/shell/dnd/Source","dojo/dom-construct","epi/dependency","epi/shell/TypeDescriptorManager","put-selector/put"],function(_427,lang,_428,_429,_42a,_42b,_42c,put){var _42d=_427(_429,{_legalMouseDown:function(evt){var _42e=this.inherited(arguments);return _42e&&evt.target!=this.grid.bodyNode;},getSelectedNodes:function(){var _42f=this.inherited(arguments);if(!this.grid.selection||Object.keys(this.grid.selection).length===0){this.grid.select(_42f[0]);return _42f;}var _430=false;var _431=new _428();for(var id in this.grid.selection){if(this.grid.row(id).element!=_42f[0]){_431.push(this.grid.row(id).element);}else{_430=true;_431.push(_42f[0]);}}if(_430){return _431;}else{this.grid.clearSelection();this.grid.select(_42f[0]);return _42f;}}});return _427([],{dndSourceTypes:null,dndParams:null,dndConstructor:_42d,dndDisabled:false,postCreate:function(){this.inherited(arguments);if(!this.dndDisabled){this._setupDnD();}},insertRow:function(_432){var row=this.inherited(arguments);if(this.dndDisabled){return row;}put(row,".dojoDndItem");this._setupDnD();var opts={};if(this.query){opts.oldParentItem={contentLink:this.query.referenceId};}this.dndSource.setItem(row.id,{data:_432,type:this._getDndType(_432),options:opts});return row;},_getDndType:function(_433){var _434=_42c.getAndConcatenateValues(_433.typeIdentifier,"dndTypes");if((!_434||_434.length<=0)&&this.dndSourceTypes){_434=this.dndSourceTypes;}return _434;},_setupDnD:function(){if(this.dndSource){return;}if(!this.dndParams.creator){this.dndParams.creator=lang.hitch(this,this._dndNodeCreator);}this.dndSource=new (this.dndConstructor)(this.bodyNode,lang.mixin(this.dndParams,{grid:this,dropParent:this.contentNode}));this.dndSource.singular=true;},_dndNodeCreator:function(item,hint){var _435,node;if(item.typeIdentifier){_435=_42c.getAndConcatenateValues(item.typeIdentifier,"dndTypes");}if(!_435&&this.dndTypes){_435=this.dndTypes;}node=_42a.create("div").appendChild(document.createTextNode(item.name));return {"node":node,"type":_435,"data":item};}});});},"epi-cms/dgrid/WithContextMenu":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","epi/shell/widget/ContextMenu","epi/shell/DestroyableByKey"],function(_436,lang,_437,_438,_439){return _436([_439],{contextMenu:null,postCreate:function(){this.inherited(arguments);this.contextMenu=this.contextMenu||new _438({category:"context"});this.ownByKey(this.contextMenu,this.contextMenu);this._setupGridEvents();},startup:function(){this.inherited(arguments);this.contextMenu.startup();},_setupGridEvents:function(){this.ownByKey("contextMenuClick",this.on(".epi-iconContextMenu:click",lang.hitch(this,this.onContextMenuClick)));},onContextMenuClick:function(e){this.contextMenu.scheduleOpen(this,null,{x:e.pageX,y:e.pageY});}});});},"epi/shell/widget/ContextMenu":function(){define("epi/shell/widget/ContextMenu",["dojo/_base/declare","dijit/Menu","epi/shell/command/_CommandConsumerMixin","epi/shell/command/builder/MenuAssembler","epi/shell/command/builder/MenuBuilder","epi/shell/command/builder/MenuWithSeparatorBuilder"],function(_43a,Menu,_43b,_43c,_43d,_43e){return _43a([Menu,_43b],{category:null,leftClickToOpen:true,postCreate:function(){this.inherited(arguments);var _43f={builder:new _43d(),target:this,category:this.category},_440,_441;_440=[_43f,{builder:new _43e(),target:this,category:"menuWithSeparator"},{builder:new _43d(),target:this,category:"popup"}],_441=new _43c({configuration:_440,commandSource:this});_441.build();},scheduleOpen:function(_442,_443,_444){this._scheduleOpen(_442,_443,_444);}});});},"epi/shell/command/builder/MenuWithSeparatorBuilder":function(){define("epi/shell/command/builder/MenuWithSeparatorBuilder",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/MenuSeparator","./MenuBuilder"],function(_445,_446,lang,on,_447,_448){return _446([_448],{_addToContainer:function(_449,_44a){var _44b=new _447();_44a.addChild(_449);_44a.addChild(_44b);}});});},"url:epi-cms/widget/templates/ContentReferences.html":"<div class=\"epi-contentReferences\">\r\n    <div data-dojo-attach-point=\"contentReferencesNotificationBar\" class=\"epi-notificationBar epi-notificationBarWithBorders epi-notificationBarItem\">\r\n        <div data-dojo-attach-point=\"contentReferencesNotificationNode\" class=\"epi-notificationBarText\" ></div>\r\n    </div>\r\n    <div class=\"epi-captionPanel\" data-dojo-attach-point=\"captionPanelNode\">\r\n        <strong data-dojo-attach-point=\"totalLinksNode\"></strong>\r\n        <div class=\"epi-floatRight\">\r\n            <button class=\"epi-chromelessButton\"\r\n                    data-dojo-type=\"dijit/form/Button\"\r\n                    data-dojo-attach-event=\"onClick:fetchData\"\r\n                    data-dojo-props=\"iconClass:'epi-iconReload'\">${res.buttons.refresh}</button>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"gridNode\"></div>\r\n</div>\r\n","epi-cms/widget/ContentForestStoreModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","epi-cms/widget/ContentTreeStoreModel"],function(_44c,_44d,lang,_44e,when,_44f){return _44d([_44f],{root:null,constructor:function(){this.root={id:"0",name:"ROOT"};},isRoot:function(_450){var _451=this.inherited(arguments);return _451||!!(_450&&this.roots&&(_44c.indexOf(this.roots,this.getIdentity(_450))>=0));},getRoot:function(_452){_452(this.root);},mayHaveChildren:function(item){return item===this.root||this.inherited(arguments);},getChildren:function(_453,_454,_455){if(_453===this.root){var _456=_44c.map(this.roots,function(item){return this.store.get(item);},this);when(_44e(_456),_454,_455);}else{this.inherited(arguments);}},getAncestors:function(item,_457){if(this.roots.some(function(_458){return this.getIdentity(item)===_458;},this)){_457([this.root]);return;}var root=this.root,_459=lang.hitch(this,function(_45a){if(_44c.some(this.roots,function(_45b){return this.getIdentity(_45a[0])===_45b;},this)){_45a.unshift(root);}_457(_45a);});this.inherited(arguments,[item,_459]);},getIdentity:function(item){return (item===this.root)?this.root.id:this.inherited(arguments);},canCopy:function(item){return !this.isRoot(item)&&this.inherited(arguments);},canCut:function(item){return !this.isRoot(item)&&this.inherited(arguments);},canDelete:function(item){return !this.isTypeOfRoot(item)&&this.inherited(arguments);},canEdit:function(item){return !this.isRoot(item)&&this.inherited(arguments);}});});},"epi-cms/widget/ContentTreeStoreModel":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/promise/all","dojo/when","dojo/topic","epi/dependency","epi/shell/_StatefulGetterSetterMixin","epi/shell/TypeDescriptorManager","epi/shell/_ContextMixin","epi/shell/ViewSettings","epi-cms/ApplicationSettings","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/widget/_HierarchicalModelMixin","epi-cms/widget/viewmodel/_UpdateableStoreModelMixin"],function(_45c,_45d,_45e,lang,_45f,_460,_461,when,_462,_463,_464,_465,_466,_467,_468,_469,_46a,_46b,_46c){return _45e([_464,_46b,_46c,_466],{store:null,root:null,notAllowToDelete:null,notAllowToCopy:null,typeIdentifiers:null,showAllLanguages:true,getChildrenQuery:"getchildren",getRootChildrenQuery:null,_observers:null,_defaultDataStoreName:"epi.cms.content.light",additionalQueryOptions:{},createAsLocalAsset:false,constructor:function(args){_45e.safeMixin(this,args);this._observers={};this.store=this.store||_463.resolve("epi.storeregistry").get(this._defaultDataStoreName);this._queryOptions=lang.mixin({ignore:["query"],comparers:{"typeIdentifiers":lang.hitch(this,function(_46d,_46e){return _45c.some(_46d,lang.hitch(this,function(item){return item===_46e.typeIdentifier||_465.isBaseTypeIdentifier(_46e.typeIdentifier,item);}));}),"referenceId":function(_46f,_470){return _46a.compareIgnoreVersion(_46f,_470.parentLink);},"allLanguages":function(_471,_472){if(_471||!_472.currentLanguageBranch){return true;}return epi.areEqual(_468.currentContentLanguage,_472.currentLanguageBranch.languageId);}},sort:this._getSortSettings(this.typeIdentifiers)},this.additionalQueryOptions);var _473=_45d.subscribe("/epi/cms/contentdata/updated",this,function(_474){this.store.refresh(_474.contentLink).then(lang.hitch(this,function(){if(_474.recursive){this.onItemChildrenReload(_474);}}));});var _475=_45d.subscribe("/epi/cms/contentdata/childrenchanged",lang.hitch(this,this._childrenChanged));var _476=_45d.subscribe("/epi/cms/contentdata/restored",this,function(_477){this._childrenChanged(_477);});var _478=_45f.after(this.store,"onItemChanged",lang.hitch(this,function(id,item){this.onChange(item);}),true);this._handles=[_473,_475,_476,_478];},destroy:function(){for(var id in this._observers){this._observers[id].cancel();this._observers[id]=null;}if(this._handles){_45c.forEach(this._handles,function(_479){_479.remove();});this._handles=null;}},isSupportedType:function(_47a){return _45c.some(this.typeIdentifiers,function(type){return type===_47a||_465.isBaseTypeIdentifier(_47a,type);});},_setShowAllLanguagesAttr:function(_47b){this._set("showAllLanguages",_47b);this.onItemChildrenReload(this.root);},getRoot:function(_47c,_47d){if(lang.isArray(this.root)){_47c({});}else{when(this.store.get(this.root),_47c,_47d);}},mayHaveChildren:function(item){return item.hasChildren;},getChildren:function(_47e,_47f){var id=this.getIdentity(_47e),_480=id==this.root,_481=_480&&this.getRootChildrenQuery?this.getRootChildrenQuery:this.getChildrenQuery,_482=this._createQuery({referenceId:id,query:_481}),_483=this.store.query(_482,this._queryOptions),_484=lang.hitch(this,function(item){this.onChange(item);when(this.store.query(_482,this._queryOptions),lang.hitch(this,function(_485){this.onChildrenChange(_47e,_485);}));});var _486=this._observers[id];if(_486){_486.cancel();delete this._observers[id];}this._observers[id]=_483.observe(_484,true);when(_483,_47f);},_getSortSettings:function(_487){if(!_487){return {};}if(_487 instanceof String){_487=[_487];}var self=this,_488,_489=[];_487.map(function(type){_488=_465.getValue(type,"sortKey");if(_488){_489.push(_488.sortDescending?{attribute:_488.columnName,descending:true}:{attribute:_488.columnName});}});return _489;},_createQuery:function(_48a,_48b){var _48c=this.typeIdentifiers&&(lang.isArray(this.typeIdentifiers)?this.typeIdentifiers:this.typeIdentifiers.split(","));var _48d=this.showAllLanguages?{allLanguages:true}:{},_48e=_48b?{}:{typeIdentifiers:_48c};var _48f=lang.mixin(_48a,_48e,_48d);return _48f;},_createChildrenQuery:function(_490,_491){var _492=lang.mixin(_490,{query:"getchildren"});return this._createQuery(_492,_491);},move:function(_493,_494){if(!_494.contentLink){_494=this.store.get(_494);}var _495=_45c.map(_493,function(item){return when(this.store.get(item.data.parentLink),lang.hitch(this,function(_496){return this.pasteItem(item.data,_496,_494,false);}));},this);return _461(_495).then(lang.hitch(this,function(_497){if(_494.contentLink===_468.wastebasketPage){var _498=_493.filter(function(i,_499){return !!_497[_499];});if(_498.length){this.onDeleted(_498);}}}));},remove:function(_49a){var _49b=_49a.map(function(item){return this.store.remove(item.data.contentLink);},this);return _461(_49b).then(lang.hitch(this,function(){this.onDeleted(_49a);}));},copy:function(_49c,_49d){var _49e=_45c.map(_49c,function(item){return when(this.store.get(item.data.parentLink),lang.hitch(this,function(_49f){return this.pasteItem(item.data,_49f,_49d,true);}));},this);return _461(_49e);},pasteItem:function(_4a0,_4a1,_4a2,copy,_4a3){var id=this.getIdentity(_4a0),_4a4=_4a2&&_4a2.isWastebasket,_4a5=copy?this.store.copy:this.store.move,_4a6={targetId:this.getIdentity(_4a2),createAsLocalAsset:this.createAsLocalAsset,sortIndex:_4a3};return _4a5.call(this.store,id,_4a6).then(lang.hitch(this,function(_4a7){if(_4a4){this.onDelete(_4a0,true);}else{_462.publish("/epi/cms/contentdata/childrenchanged",_4a2.contentLink);}var _4a8=copy?_4a7.extraInformation:_4a0.contentLink;var _4a9=_46a.toContentReference(_4a8).createVersionUnspecificReference().toString();return when(this.store.refresh(_4a9),lang.hitch(this,function(item){this._onPasteComplete(item,copy,_4a4,_4a1,_4a2);return _4a7;}));}));},onPasteComplete:function(){},_onPasteComplete:function(item,copy,_4aa,_4ab,_4ac){this.onPasteComplete();this._selectItemOnPasteComplete(item,copy,_4aa,_4ab,_4ac);this.inherited(arguments);},_selectItemOnPasteComplete:function(item,copy,_4ad,_4ae,_4af){if(item&&item.contentLink&&!_4ad){this.onSelect(item.contentLink,true);}},newItem:function(args,_4b0){if(args.dndData&&args.dndData.data){var _4b1=this.getParentItem(args.dndData);this._pasteNewItem(args.dndData.data,_4b1,_4b0);}},getParentItem:function(_4b2){if(_4b2&&_4b2.data){var _4b3=_4b2.data["parentLink"];if(_4b3){_4b3=new _46a(_4b3).createVersionUnspecificReference().toString();}return {contentLink:_4b3};}},_pasteNewItem:function(_4b4,_4b5,_4b6){this.pasteItem(_4b4,_4b5,_4b6,false);},_updateItemChanged:function(_4b7){when(this.store.refresh(_4b7),lang.hitch(this,function(_4b8){this._childrenChanged(_4b8);}));},_childrenChanged:function(_4b9){var dfd=new _460();this.getChildren(_4b9,lang.hitch(this,function(_4ba){this.onChildrenChange(_4b9,_4ba);dfd.resolve(_4ba);}));return dfd;},getIdentity:function(item){if(lang.isObject(item)){return this.store.getIdentity(item);}return item;},getObjectIconClass:function(item,_4bb){var _4bc=_465.getValue(item.typeIdentifier,"iconClass");if(!_4bc){return _4bb;}var _4bd="";switch(parseInt(item.contentLink,10)){case _468.globalAssetsFolder:_4bd="AllSites";break;case _468.siteAssetsFolder:_4bd="ThisSite";break;default:break;}return (_4bd===""&&_4bc===_4bb)?_4bc:(_4bb+" "+_4bc+_4bd);},getLabel:function(item){return item.name;},canExpandTo:function(item){var _4be=new _460();this.getAncestors(item,lang.hitch(this,function(_4bf){_4be.resolve(this.getIdentity(_4bf[0])===this.root.id);}));return _4be.promise;},canCopy:function(item){if(!item){return false;}var _4c0=item.contentLink,_4c1=_4c0===this.root||(_45c.indexOf(this.notAllowToCopy,_4c0)>=0);return !_4c1&&_469.hasAccess(item.accessMask,_469.accessLevel.Read)&&_469.hasProviderCapability(item.providerCapabilityMask,_469.providerCapabilities.Copy);},canCut:function(item){if(!item){return false;}var _4c2=item.contentLink,_4c3=_4c2===this.root||(_45c.indexOf(this.notAllowToDelete,_4c2)>=0);return !_4c3&&_469.isActionAvailable(item,_469.action.Delete,_469.providerCapabilities.Move,true);},canDelete:function(item){if(!item){return false;}var _4c4=item.contentLink,_4c5=_4c4===this.root||(_45c.indexOf(this.notAllowToDelete,_4c4)>=0);return !_4c5&&_469.isActionAvailable(item,_469.action.Delete,_469.providerCapabilities.Delete,true);},canPaste:function(item,_4c6,_4c7){if(!item||!_4c6){return false;}var _4c8=_4c7&&_4c6.isWastebasket,_4c9=!_4c7&&(this.getIdentity(item)===this.getIdentity(_4c6)),_4ca=!_4c7&&(item.parentLink===this.getIdentity(_4c6)),_4cb=_469.isActionAvailable(_4c6,_469.action.Create,_469.providerCapabilities.Create,true);return !_4c6.isDeleted&&!_4c8&&!_4c9&&!_4ca&&_4cb;},canEdit:function(item){if(!item){return false;}var _4cc=item.contentLink,_4cd=_4cc===this.root;return !_4cd&&_469.hasAccess(item.accessMask,_469.accessLevel.Edit);},onItemChildrenReload:function(_4ce){},onChange:function(){},onChildrenChange:function(){},onDelete:function(){},onDeleted:function(_4cf){var item=_4cf[0].data;if(item){when(this.getCurrentContext(),lang.hitch(this,function(ctx){var _4d0=item.capabilities.isPage,_4d1=_46a.compareIgnoreVersion(item.contentLink,ctx.id);if(_4d0&&!_4d1){return;}if(!_4d0&&_4d1){_462.publish("/epi/shell/context/request",{uri:_467.settings.defaultContext});return;}this.onSelect(item.parentLink,true);}));}},onSelect:function(item,_4d2,_4d3){}});});},"epi-cms/widget/_HierarchicalModelMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/shell/_HierarchicalModelMixin"],function(_4d4,lang,_4d5){return _4d4([_4d5],{isTypeOfRoot:function(_4d6){return !!(_4d6&&(this.isRoot(_4d6)||_4d6.isSubRoot));},isRoot:function(_4d7){return !!(_4d7&&this.root&&_4d7===this.root);}});});},"epi/shell/_HierarchicalModelMixin":function(){define("epi/shell/_HierarchicalModelMixin",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","dojo/when"],function(_4d8,_4d9,lang,_4da,all,when){return _4d9([],{parentProperty:"parentLink",store:null,constructor:function(_4db){_4d9.safeMixin(this,_4db);},getParentIdentity:function(item){return lang.getObject(this.parentProperty,false,item);},isAncestor:function(_4dc,_4dd){var _4de=this.store.getIdentity(_4dc),_4df=this.store.getIdentity(_4dd),_4e0=this.getParentIdentity(_4dd);if(_4de==_4df||(_4dd.parentLink&&_4dc.contentLink==_4dd.parentLink)){return true;}if(_4e0){return false;}return when(this.store.get(_4e0),lang.hitch(this,function(_4e1){return this.isAncestor(_4dc,_4e1);}));},getAncestors:function(item,_4e2){if(!this.store){_4e2([]);return;}var obj=typeof item==="object"?item:this.store.get(item);when(obj,lang.hitch(this,function(_4e3){when(this._getAncestors([_4e3]),_4e2);}));},_getAncestors:function(_4e4){if(this._hasRoot(_4e4)){return _4e4.slice(0,-1);}var _4e5=this.getParentIdentity(_4e4[0]);if(!_4e5){return _4e4.slice(0,-1);}return when(this.store.get(_4e5),lang.hitch(this,function(_4e6){if(_4e6){_4e4.unshift(_4e6);return this._getAncestors(_4e4);}return _4e4.slice(0,-1);}));},_hasRoot:function(_4e7){var _4e8=this.roots||[this.root];if(!_4e7.length||!_4e8.length||typeof this.getIdentity!=="function"){return false;}var _4e9=this.getIdentity(_4e7[0]);return _4d8.some(_4e8,function(root){return root==_4e9;},this);},refreshAncestors:function(item,_4ea){var _4eb=this.store,_4ec=new _4da(),_4ed=[],_4ee=[];this.getAncestors(item,function(_4ef){_4d8.forEach(_4ef,function(_4f0){if(!_4ea||_4ea(_4f0)){_4ed.push(when(_4eb.refresh(_4eb.getIdentity(_4f0)),function(item){_4ee.push(item);}));}});all(_4ed).then(function(){_4ec.resolve(_4ee);});});return _4ec.promise;}});});},"epi-cms/widget/viewmodel/_UpdateableStoreModelMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/Evented","dojo/json","dojo/topic","dojo/when","epi/dependency","epi-cms/ApplicationSettings","epi-cms/_ContentContextMixin","epi-cms/core/ContentReference"],function(_4f1,_4f2,lang,_4f3,_4f4,json,_4f5,when,_4f6,_4f7,_4f8,_4f9){return _4f2(_4f4,{updateableStore:null,updateableStoreKey:"epi.cms.contentdata",currentContentService:null,propertyNames:{name:"icontent_name",nameInUrl:"iroutable_routesegment"},refreshTranslatedAncestors:true,onAddDelegate:null,postscript:function(){this._setupStore();this.currentContentService=new _4f8();},_setupStore:function(){if(!this.updateableStore&&this.updateableStoreKey){this.updateableStore=_4f6.resolve("epi.storeregistry").get(this.updateableStoreKey);}},rename:function(id,name){var self=this,_4fa=new _4f3();when(self.patch(id,{name:name,nameInUrl:null}),function(item){when(self.refreshTranslated(id),function(){_4fa.resolve(item);},function(e){_4fa.reject(e);});},function(e){_4fa.reject(e);});return _4fa;},translate:function(item){var self=this,id=self.getIdentity(item),_4fb={masterLanguageVersionId:id,name:item.name,contentTypeId:item.contentTypeID};return when(self.updateableStore.put(_4fb),function(){when(self.store.refresh(id),function(){when(self.refreshTranslated(id),function(){self.onSelect(id,true,self.onAddDelegate);});});});},add:function(item,_4fc){var self=this;var def=new _4f3();when(self.updateableStore.add(item),function(_4fd){var id=self.getContentId(_4fd),_4fe=self.getParentIdentity(item),_4ff=null;when(self.updateableStore.get(id),function(_500){if(self.getParentIdentity(_500)!=_4fe){_4ff=typeof _4fc=="function"&&_4fc();}when(_4ff,function(){when(self._childrenChanged(_4fe),function(){when(self.refreshTranslated(id),function(){self.onSelect(id,true,self.onAddDelegate);def.resolve(_500);});});});});});return def.promise;},patch:function(id,_501){var self=this,_502=new _4f3(),_503={id:id,properties:{}};for(var key in _501){if(_501.hasOwnProperty(key)){_503.properties[this._convertPropertyName(key)]=json.stringify(_501[key]);}}when(self.updateableStore.patch(_503,{id:_503.id}),function(item){if(item&&item.successful){var _504={contentLink:id,properties:_503.properties,capabilities:{supportsVersions:false}};lang.mixin(_504,_501);when(self.updateableStore.patchCache(_504),_502.resolve,_502.reject);}else{return _502.reject(item&&item.validationErrors);}});return _502;},_convertPropertyName:function(name){return this.propertyNames[name]||name;},refreshTranslated:function(_505){var self=this,_506=new _4f3(),_507;function _508(item){var id=self.getIdentity(item),_509=self.getParentIdentity(item);if(_509==self.root||id==self.root||!item.missingLanguageBranch){return false;}return true;};if(!self.refreshTranslatedAncestors){return _506.resolve();}when(self.refreshAncestors(_505,_508),function(_50a){if(!(_50a instanceof Array)||_50a.length===0){_506.resolve();return;}_50a.reverse();var _50b=_4f1.some(_50a,function(item){if(!!item.missingLanguageBranch){_507=self.getLabel(item);return true;}return false;});when(self.store.get(_505),function(_50c){if(_50b&&_50c&&!_50c.missingLanguageBranch){self.emit("translationFailed",_507);}_506.resolve();});});return _506;},getContentId:function(_50d){return _4f9.toContentReference(_50d).id.toString();},_onPasteComplete:function(item,copy,_50e,_50f,_510){if(!item){return;}if(!_50e){this.refreshTranslated(this.getIdentity(item));}else{this.currentContentService.getCurrentContent().then(lang.hitch(this,function(_511){var _512=_4f9.compareIgnoreVersion(item,_511)&&_511.isDeleted;if(!_512){return;}var _513=this._createQuery({referenceId:this.getIdentity(_50f),query:this.getChildrenQuery},true);when(this.store.query(_513,this._queryOptions),lang.hitch(this,function(_514){var _515=_50f?_50f.contentLink:null;if(!_514||!(_514 instanceof Array)||_514.length<=0){_515=_4f7.startPage;}if(_515){var _516={uri:"epi.cms.contentdata:///"+_515};_4f5.publish("/epi/shell/context/request",_516);}}));}));}}});});},"epi-cms/widget/ContextualContentForestStoreModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/promise/all","dojo/topic","dojo/when","epi/shell/TypeDescriptorManager","epi-cms/_ContentContextMixin","epi-cms/contentediting/_ContextualContentContextMixin","epi-cms/core/ContentReference","epi-cms/widget/ContentForestStoreModel"],function(_517,_518,lang,_519,_51a,_51b,_51c,when,_51d,_51e,_51f,_520,_521){return _518([_521,_51e,_51f],{handleSelection:null,previousSelection:null,postscript:function(){this.inherited(arguments);this._handles.push(_51c.subscribe("/epi/cms/action/createlocalasset",lang.hitch(this,this.refreshRoots)));this._handles.push(_51c.subscribe("/epi/cms/action/togglecreatemode",lang.hitch(this,this._toggleContextualContent)));this._handles.push(_519.around(this,"pasteItem",lang.hitch(this,this._aroundPasteItem)));this._handles.push(_519.after(this.store,"get",lang.hitch(this,this._afterStoreGet)));},contentContextChanged:function(_522,_523){this.inherited(arguments);this.refreshRoots();},getChildren:function(_524,_525,_526){if(_524===this.root){when(this._getRootItems(),_525,_526);}else{if(this.isPseudoContextualRoot(_524)){_525([]);return;}this.inherited(arguments);}},getAncestors:function(item,_527){var _528=this.getInherited(arguments);when(this.getCurrentContent(),lang.hitch(this,function(_529){var _52a=this.roots.concat(_529.assetsFolderLink),_52b=lang.hitch(this,function(_52c){var _52d;for(var i=_52c.length-1;i>=0;i--){_52d=_52c[i];if(this.isContextualRoot(_52d)){_52c[i]=this.getContextualRoot(_52d);}if(_517.indexOf(_52a,this.getIdentity(_52d))>=0){_52c=_52c.slice(i);_52c.unshift(this.root);_527(_52c);return;}}_527([this.root]);});if(_517.indexOf(_52a,this.getIdentity(item))>=0){_527([this.root]);}_528.apply(this,[item,_52b]);}));},getObjectIconClass:function(_52e,_52f){var _530=this._currentContext&&this._currentContext.dataType;if(!_530){return this.inherited(arguments);}var _531=_51d.getValue(_530,"iconClass");return this.isContextualContent(_52e)?(_531?_52f+" "+_531+"Contextual":_52f):this.inherited(arguments);},onToggleContentDisplay:function(_532,_533){},onRefreshRoots:function(_534){},refreshRoots:function(_535){if(_535===this){return true;}var self=this;return self._refreshPromise=when(self._refreshPromise,function(){return when(self._getRootItems(),function(_536){self.onChildrenChange(self.root,_536);if(self.get("handleSelection")===true){return self._setSelection(lang.clone(_536).pop());}});});},canCopy:function(item){return this.isContextualContent(item)?false:this.inherited(arguments);},canCut:function(item){return this.isContextualContent(item)?false:this.inherited(arguments);},canPaste:function(item,_537,_538){var self=this,_539=self.getInherited(arguments),_53a=new _51a();if(_538){_53a.resolve(_539.apply(self,[item,_537,_538]));}else{when(self.getCurrentContent(),function(_53b){self.getAncestors(_537,function(_53c){var _53d=self.isContextualContent(_537)||self.hasContextual(_53c);if(_53d){if(_520.compareIgnoreVersion(item.contentLink,_53b.contentLink)){_53a.resolve(false);}else{self.getAncestors(_53b.contentLink,function(_53e){_53a.resolve(_517.some(_53e,function(_53f){return item.contentLink===_53f.contentLink;},this)?false:_539.apply(self,[item,_537,_538]));});}}else{_53a.resolve(_539.apply(self,[item,_537,_538]));}});});}return _53a;},filterAncestors:function(_540){if(!(_540 instanceof Array)){return _540;}var _541=_540.indexOf(this._getPseudoContextualContent().toString());if(_541!==-1&&_541<_540.length-1){_540.splice(_541,1);}return _540;},_toggleContextualContent:function(_542){when(this.getCurrentContent(),lang.hitch(this,function(_543){this.onToggleContentDisplay(_543.assetsFolderLink,!_542);this._setSelection(null);}));},_setSelection:function(_544){var _545=this.roots[0].toString(),_546=_544!=null?_544.contentLink:_545,_547=this.get("previousSelection"),_548=this.get("previousContextualSelection"),_549=new _51a();if(!(_546&&_547)){_549.resolve();return _549;}var _54a=false,_54b=_547.selectedContent,_54c=_547.selectedAncestors,_54d=_54b.item&&!_54b.item.contentLink;var _54e=function(_54f){_549.resolve();};if(_54d||this.hasContextual(_54c)){this.onSelect(_546,_54a,_54e);}else{if(_54b.item.contentLink==_545&&_548&&_548.selectedContent&&_548.selectedContent.item&&_548.selectedContent.item.contentLink){this.onSelect(_548.selectedContent.item.contentLink,_54a,_54e);}else{_549.resolve();}}return _549;},_getRootItems:function(){var self=this,_550=self.store,_551=_517.map(self.roots,function(item){return _550.get(item);});var _552=when(_51b([self.getCurrentContent(),self.getCurrentContext()]),function(_553){var _554=_553[0],_555=_553.length>1?_553[1]:null;return when(_550.get(_554.contentLink),function(_556){var _557=_555&&_555.currentMode==="create";if((_557&&self.get("view")==="contentselector")||!self.canHaveContextualContent(_556)){return null;}var _558=_556.assetsFolderLink;if(_558){var _559=function(_55a){return when(_550.get(_55a),function(_55b){var _55c={"id":_55b.contentLink,"typeIdentifiers":self.typeIdentifiers,"allLanguages":self.showAllLanguages};return when(_550.query(_55c),function(_55d){if(typeof self.isSupportedType==="function"&&!self.isSupportedType(_55d.typeIdentifier)){return null;}if(!self.isPseudoContextualRoot(_55d)){return self.getContextualRoot(_55d);}else{return when(self.onRefreshRoots(_55d),function(){return self._modifyContentAccess(_55d,_556);});}});});};if(_558==self._getPseudoContextualContent()){return when(_550.refresh(_556.contentLink),function(_55e){return _559(_55e.assetsFolderLink);});}else{return _559(_558);}}return null;});},function(_55f){return null;});_551.push(_552);return when(_51b(_551),function(_560){return _517.filter(_560,Boolean);});},_aroundPasteItem:function(_561){var self=this;return function(_562,_563,_564,copy,_565){var _566=_564,_567=self.get("createAsLocalAsset");return when(self.getCurrentContent(),function(_568){if(!_567){_567=self.isPseudoContextualRoot(_566);self.set("createAsLocalAsset",_567);}_567&&(_566=_568);return when(_561.apply(self,[_562,_563,_566,copy,_565]),function(_569){if(_567){self.set("createAsLocalAsset",false);return when(self.refreshRoots(),function(){_51c.publish("/epi/cms/action/createlocalasset",self);return _569;});}else{return _569;}});});};},_afterStoreGet:function(_56a){var self=this;return when(_56a,function(_56b){return when(self.getCurrentContent(),function(_56c){return self._modifyContentAccess(_56b,_56c);},function(_56d){return _56b;});});},_modifyContentAccess:function(_56e,_56f){if(this.isContextualContent(_56e)){var _570=this.getContextualRoot(_56e);return this.isPseudoContextualRoot(_56e)?lang.mixin(_570,{isPreferredLanguageAvailable:_56f.isPreferredLanguageAvailable,accessMask:_56f.accessRights}):_570;}return _56e;}});});},"epi-cms/component/command/_GlobalToolbarCommandProvider":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/form/Button","epi/shell/command/_CommandProviderMixin"],function(_571,lang,_572,_573){return _571([_573],{addToLeading:function(_574,_575){this.addCommand(_574,_575);},addToCenter:function(_576,_577){_577=lang.mixin({category:"center"},_577);this.addCommand(_576,_577);},addToTrailing:function(_578,_579){_579=lang.mixin({category:"trailing"},_579);this.addCommand(_578,_579);},addCommand:function(_57a,_57b){_57b=lang.mixin({"class":"epi-mediumButton",iconClass:_57a.iconClass,category:"leading",label:_57a.label,tooltip:_57a.tooltip,showLabel:false,widget:_572,model:_57a},_57b);_57a=lang.delegate(_57a,{settings:_57b});this.add("commands",_57a);}});});},"epi-cms/contentediting/EditorFactory":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","epi/string"],function(_57c,_57d,lang,_57e){return _57c(null,{defaultWrapperType:"flyout",_registeredEditorWrappers:null,onEditorCreated:function(_57f){},onEditorResolved:function(data,_580){},constructor:function(){this._registeredEditorWrappers={};},registerEditorWrapper:function(_581,_582,_583){this._registeredEditorWrappers[_581]={wrapperClassType:_582,initializer:_583};},_getWrapperAndEditor:function(_584){var type=_584.type;var name=_584.name;var _585=_584.wrapperType;var _586=_584.editorParams||{};var _587=_584.editorWidgetType;if(!_585){if(_584.metadata.customEditorSettings&&_584.metadata.customEditorSettings.uiWrapperType){_585=_584.metadata.customEditorSettings.uiWrapperType;}else{_585=this.defaultWrapperType;}}if(!_587){if(_584.metadata.customEditorSettings&&_584.metadata.customEditorSettings.uiType){_587=_584.metadata.customEditorSettings.uiType;}else{if(_584.metadata.uiType){_587=_584.metadata.uiType;}else{_587="epi/shell/widget/FormContainer";lang.mixin(_586,{metadata:_584.metadata,onFieldCreated:function(_588,_589){}});}}}if(!_587){throw ("Could not resolve editor widget for property: "+_584.name);}if(_584.metadata.customEditorSettings&&_584.metadata.customEditorSettings.uiParams){lang.mixin(_586,_584.metadata.customEditorSettings.uiParams);}var _58a=this._registeredEditorWrappers[_585];if(!_58a){throw ("No suitable editor wrapper found for type: "+_585);}var data={wrapperInitializer:_58a.initializer,wrapperType:_58a.wrapperClassType,editorWidgetType:_587,editorParams:_586};this.onEditorResolved(data,_584);if(_585){return data;}throw ("No suitable editor found");},createEditor:function(_58b,node,_58c,_58d){var def=new _57d();var _58e=this._getWrapperAndEditor(_58b);var _58f=_57e.slashName(_58e.wrapperType);var _590=_57e.slashName(_58e.editorWidgetType);require([_58f,_590],lang.hitch(this,function(_591){var _592=_58d||{};if(_58b.metadata){lang.mixin(_592,_58b.metadata.settings);lang.mixin(_592,_58e.editorParams);_592.selections=_58b.metadata.selections;}var _593={wrapperType:_58e.wrapperType,editorWidgetType:_58e.editorWidgetType,editorParams:_592,blockDisplayNode:node,overlayItem:_592.overlayItem,property:_58b,propertyName:_58b.name,propertyDisplayName:_58b.metadata.displayName,value:_58c,contentModel:_58b.contentModel};var _594=new _591(_593);var _595=_58e.wrapperInitializer;if(_595){lang.mixin(_593.editorParams,{parent:_594});_595(_594,_593);}this.onEditorCreated(_594.getEditorWidget());def.resolve(_594);}));return def;}});});},"epi-cms/contentediting/InUseNotificationManager":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/when","dojo/date","dojo/aspect","epi","epi/dependency","epi/datetime","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi/i18n!epi/cms/nls/episerver.cms.contentediting.permanenteditindication"],function(lang,_596,_597,when,_598,_599,epi,_59a,_59b,_59c,_59d,res){return _597([],{contextTypeName:"",_postFlag:false,_inUseNotificationStore:null,_currentUsername:null,_messageService:null,currentModel:null,_eventHandlers:null,ignoreOthersNotifications:null,constructor:function(_59e){this.inherited(arguments);lang.mixin(this,_59e);this._inUseNotificationStore=this.store||_59a.resolve("epi.storeregistry").get("epi.cms.inusenotification");this._currentUsername=this.username||_59c.userName;this._messageService=this.messageService||_59a.resolve("epi.shell.MessageService");this._eventHandlers=[];},updateCommandModel:function(_59f){this.inherited(arguments);if(this.currentModel&&!_59d.compareIgnoreVersion(this.currentModel.contentData.contentLink,_59f.contentData.contentLink)){this.ignoreOthersNotifications=false;}this.currentModel=_59f;_596.forEach(this._eventHandlers,function(_5a0){_5a0.remove();});this.updateMessageService(this.currentModel.contentData);this._eventHandlers=[_599.after(_59f,"suspend",lang.hitch(this,this._onViewModelSuspended)),_599.after(_59f,"destroyed",lang.hitch(this,this._onViewModelSuspended)),_599.after(_59f,"onPropertyEdited",lang.hitch(this,this._onPropertyEdited)),_599.around(_59f,"canChangeContent",lang.hitch(this,this._canChangeContentAdvisor))];},_canChangeContentAdvisor:function(_5a1){return lang.hitch(this,function(){if(!this.ignoreOthersNotifications){var _5a2=this.getOtherUsersInUseNotifications(this.currentModel.contentData.inUseNotifications);if(_5a2&&_5a2.length){return false;}}return _5a1.apply(this.currentModel,arguments);});},_onViewModelSuspended:function(){var _5a3=this.currentModel.contentData;this.removeAutomaticInUseNotification(_5a3);},_onPropertyEdited:function(){var _5a4=this.currentModel.contentData;this.ensureAutomaticInUseNotification(_5a4);},ensureAutomaticInUseNotification:function(_5a5){var _5a6;_596.some(_5a5.inUseNotifications,function(item){if(item.userName.toLowerCase()===this._currentUsername.toLowerCase()){_5a6=item;return true;}},this);if(!_5a6){return this.put(this._createNotification(_5a5,false),_5a5.inUseNotifications);}else{if(_5a6.addedManually){return;}else{var _5a7=_59b.deserialize(_5a6.modified);if(_598.difference(_5a7,new Date(),"minute")>30){return this.put(_5a6,_5a5.inUseNotifications);}}}},removeAutomaticInUseNotification:function(_5a8){_596.forEach(_5a8.inUseNotifications,function(item){if(item.userName.toLowerCase()===this._currentUsername.toLowerCase()&&!item.addedManually){this.remove(item,_5a8.inUseNotifications);}},this);},_createNotification:function(_5a9,_5aa){var _5ab=_59b.serialize(new Date());return {userName:this._currentUsername,contentLink:_5a9.contentLink,languageBranch:_5a9.currentLanguageBranch&&_5a9.currentLanguageBranch.languageId,addedManually:_5aa,created:_5ab,modified:_5ab};},put:function(_5ac,_5ad){_5ac.modified=_59b.serialize(new Date());if(!this._postFlag){this._postFlag=true;return when(this._inUseNotificationStore.put(_5ac),lang.hitch(this,function(_5ae){var _5af=_596.indexOf(_5ad,_5ac);if(_5af>=0){_5ad[_5af]=_5ac;}else{_5ad.push(_5ac);}this._updateDependentStores(_5ac.contentLink,_5ad);this._postFlag=false;}));}},remove:function(_5b0,_5b1){return when(this._inUseNotificationStore.remove(_5b0.id),lang.hitch(this,function(){var _5b2=_596.indexOf(_5b1,_5b0);_5b1.splice(_5b2,1);this._updateDependentStores(_5b0.contentLink,_5b1);}));},_updateDependentStores:function(_5b3,_5b4){var _5b5={contentLink:_5b3,inUseNotifications:_5b4};this._inUseNotificationStore.updateDependentStores(_5b5);},togglePermanentEditIndication:function(_5b6,_5b7){var _5b8;var _5b9=_596.some(_5b6.inUseNotifications,function(item){if(item.userName.toLowerCase()===this._currentUsername.toLowerCase()){_5b8=item;if(item.addedManually){return true;}}},this);if(_5b9){if(_5b7&&_5b8.convertedFromAutomaticNotification){_5b8.addedManually=false;return this.put(_5b8,_5b6.inUseNotifications);}else{return this.remove(_5b8,_5b6.inUseNotifications);}}else{if(_5b8&&_5b7){_5b8.convertedFromAutomaticNotification=true;_5b8.addedManually=true;}else{_5b8=this._createNotification(_5b6,true);}return this.put(_5b8,_5b6.inUseNotifications);}},updateMessageService:function(_5ba){var _5bb=_5ba.contentLink+"_permanentEdit";this._messageService.remove({externalItemId:_5bb});var _5bc=this._getManualInUseNotification(_5ba.inUseNotifications);if(_5bc){this._notificationHandlerId=this._messageService.put("note",res.permanenteditison,this.contextTypeName,_5ba.contentLink,_5bb,null);}},_getManualInUseNotification:function(_5bd){var _5be;var _5bf=_596.forEach(_5bd,function(item){if(item.userName.toLowerCase()===this._currentUsername.toLowerCase()&&item.addedManually){_5be=item;}},this);return _5be;},currentUserHasInUseNotification:function(_5c0,_5c1){return _596.some(_5c0,function(item){return item.userName.toLowerCase()===this._currentUsername.toLowerCase()&&(!_5c1||item.addedManually);},this);},getOtherUsersInUseNotifications:function(_5c2){var _5c3=[];_596.forEach(_5c2,function(item){if(item.userName.toLowerCase()!==this._currentUsername.toLowerCase()){_5c3.push(item.userName);}},this);return _5c3;},hasInUseNotificationWarning:function(_5c4){if(this.ignoreOthersNotifications){return false;}return this.getOtherUsersInUseNotifications(_5c4).length;}});});},"epi-cms/contentediting/ViewSettingsManager":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/topic","dojo/Stateful","epi/epi","epi/dependency","epi/UriParser"],function(_5c5,_5c6,lang,_5c7,_5c8,epi,_5c9,_5ca){return _5c5([_5c8],{_hashWrapper:null,viewSettings:null,_viewSettingsMap:null,viewSettingsHashValue:[],_activeKey:"active",enabled:false,previewParams:null,postscript:function(){this.inherited(arguments);this._hashWrapper=_5c9.resolve("epi.shell.HashWrapper");this.previewParams={};this._viewSettingsMap={};_5c6.forEach(this.viewSettings,lang.hitch(this,function(_5cb){if(!this._viewSettingsMap[_5cb.key]){this._viewSettingsMap[_5cb.key]=_5cb;}else{throw "Duplicated view settings key.";}}));_5c7.subscribe("/epi/cms/action/viewsettingvaluechanged",lang.hitch(this,this._viewSettingChanged));_5c7.subscribe("/epi/cms/action/eyetoggle",lang.hitch(this,this._viewSettingEnabledChanged));var obj=this._hashWrapper.getHash();if(obj&&obj.viewsetting){this.viewSettingsHashValue=this._toObjects(obj.viewsetting);}this.enabled=this._loadProperty(this._activeKey)==="true";_5c6.forEach(this.viewSettingsHashValue,lang.hitch(this,function(item){var _5cc=this._viewSettingsMap[item.type];if(_5cc){_5cc.set("enabled",this.get("enabled"));_5cc.value=item.id;_5cc.beforePreviewLoad(this.previewParams,this.get("enabled"));}}));},onPreviewReady:function(_5cd){this._preview=_5cd;_5c6.forEach(this.viewSettings,lang.hitch(this,function(_5ce){_5ce.afterPreviewLoad(_5cd,this.get("enabled"));}));},getSettingProperty:function(_5cf){var _5d0=_5c6.filter(this.viewSettingsHashValue,function(_5d1){return _5d1.type==_5cf;});return _5d0.length>0?_5d0[0].id:null;},hasVisitorGroup:function(){return this.getSettingProperty("visitorgroup")!==null&&this.getSettingProperty("visitorgroup").id!==null;},_enabledGetter:function(){return this.enabled;},_enabledSetter:function(_5d2){this.enabled=_5d2;var _5d3={};_5c6.forEach(this.viewSettings,lang.hitch(this,function(_5d4){_5d4.set("enabled",_5d2);_5d4.beforePreviewLoad(_5d3,_5d2);}));if(!epi.areEqual(this.previewParams,_5d3)){this.previewParams=_5d3;}else{_5c6.forEach(this.viewSettings,lang.hitch(this,function(_5d5){_5d5.afterPreviewLoad(this._preview,_5d2);}));}},_applyViewSettingValue:function(key,_5d6){var _5d7,_5d8=this._viewSettingsMap[key];if(_5d8){_5d7=lang.clone(this.previewParams);_5d8.value=_5d6;_5d8.beforePreviewLoad(_5d7,true);if(!epi.areEqual(this.previewParams,_5d7)){this.previewParams=_5d7;}else{_5d8.afterPreviewLoad(this._preview,true);}}},_viewSettingChanged:function(key,_5d9){this._saveProperty(key,_5d9);this._applyViewSettingValue(key,_5d9);},_viewSettingEnabledChanged:function(_5da){var _5db=this._hasSetting();if(_5da){this._saveProperty(this._activeKey,"true");}else{this._saveProperty(this._activeKey,_5db?false:null);}this.set("enabled",_5da);},_addProperty:function(_5dc,_5dd){this.viewSettingsHashValue.push({type:_5dc,id:_5dd});},_updateProperty:function(_5de,_5df){var _5e0=-1;_5c6.forEach(this.viewSettingsHashValue,function(item,_5e1){if(item.type==_5de){_5e0=_5e1;return;}});if(_5e0>-1){this.viewSettingsHashValue[_5e0].id=_5df;}else{this._addProperty(_5de,_5df);}},_toObjects:function(url){var _5e2=[];_5c6.forEach(url.split("|"),function(item,_5e3){var uri=new _5ca(item);_5e2.push({type:uri.getType(),id:uri.getId()});});return _5e2;},_deleteProperty:function(_5e4){var _5e5=-1;_5c6.forEach(this.viewSettingsHashValue,function(item,_5e6){if(item.type==_5e4){_5e5=_5e6;return;}});if(_5e5>-1){this.viewSettingsHashValue.splice(_5e5,1);}},_updateHash:function(){var obj=this._hashWrapper.getHash();var _5e7=[];_5c6.forEach(this.viewSettingsHashValue,function(item,_5e8){_5e7.push(item.type+":///"+item.id);});if(_5e7.length>0){obj.viewsetting=_5e7.join("|");}else{delete obj.viewsetting;}this._hashWrapper.setHash(obj);},_saveProperty:function(_5e9,_5ea){var obj=this._hashWrapper.getHash();if(obj&&obj.viewsetting){this.viewSettingsHashValue=this._toObjects(obj.viewsetting);if(_5ea!=null){this._updateProperty(_5e9,_5ea);}else{this._deleteProperty(_5e9);}this._updateHash();}else{if(_5ea!=null){this._updateProperty(_5e9,_5ea);this._updateHash();}}},_loadProperty:function(_5eb){var obj=this._hashWrapper.getHash();var _5ec=null;if(obj&&obj.viewsetting){var _5ed=this._toObjects(obj.viewsetting);var _5ee=_5c6.filter(_5ed,function(item){return item.type==_5eb;})[0];if(_5ee){_5ec=_5ee.id;}}return _5ec;},_hasSetting:function(){var obj=this._hashWrapper.getHash();if(obj&&obj.viewsetting){if(obj.viewsetting.split("|").length>1){return true;}}return false;},getRenderingViewSettings:function(){return _5c6.filter(this.viewSettings,lang.hitch(this,function(_5ef){return _5ef.usedForRendering;}));}});});},"epi-cms/contentediting/command/Editing":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","epi","epi/shell/_StatefulGetterSetterMixin","epi-cms/command/TranslateContent","epi-cms/contentediting/command/RevertToPublished","epi-cms/contentediting/command/Reject","epi-cms/contentediting/command/SendForReview","epi-cms/contentediting/command/Publish","epi-cms/contentediting/command/CreateDraft","epi-cms/contentediting/command/Withdraw","epi-cms/contentediting/command/ManageExpiration"],function(_5f0,lang,_5f1,epi,_5f2,_5f3,_5f4,_5f5,_5f6,_5f7,_5f8,_5f9,_5fa){var _5fb=_5f0([_5f1,_5f2],{model:null,revertToPublished:null,reject:null,translate:null,createDraft:null,sendForReview:null,publish:null,withdraw:null,manageExpiration:null,constructor:function(_5fc){lang.mixin(this,_5fc);this.revertToPublished=new _5f4();this.reject=new _5f5();this.translate=new _5f3();this.createDraft=new _5f8();this.sendForReview=new _5f6();this.publish=new _5f7();this.withdraw=new _5f9();this.manageExpiration=new _5fa();},_setModelAttr:function(_5fd){this._set("model",_5fd);this.revertToPublished.set("model",_5fd);this.reject.set("model",_5fd);this.translate.set("model",_5fd);this.createDraft.set("model",_5fd);this.sendForReview.set("model",_5fd);this.publish.set("model",_5fd);this.withdraw.set("model",_5fd);this.manageExpiration.set("model",_5fd);}});return new _5fb();});},"epi-cms/command/TranslateContent":function(){define(["dojo/_base/declare","dojo/topic","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.translate","epi/shell/command/_Command"],function(_5fe,_5ff,_600,_601){return _5fe([_601],{label:_600.label,executingLabel:_600.executinglabel,tooltip:_600.title,category:"context",_execute:function(){var _602=this._getNormalizedModel();if(typeof this.executeDelegate==="function"){this.executeDelegate(this.model);}else{var data={contentData:_602.content,languageBranch:_602.language.preferredLanguage};_5ff.publish("/epi/shell/action/changeview","epi-cms/contentediting/CreateLanguageBranch",null,data);}},_onModelChange:function(){var _603=this._getNormalizedModel(),_604=_603&&_603.language,_605=_603&&_603.content.isDeleted,_606=_604&&_604.isTranslationNeeded&&!_605,_607=_606&&_604.hasTranslationAccess&&_604.isPreferredLanguageAvailable;if(_603&&typeof _603.content.canTranslateContent==="function"){var _608=_603.content.canTranslateContent();_606=_606&&_608;_607=_607&&_608;}this.set("isAvailable",!!_606);this.set("canExecute",!!_607);},_getNormalizedModel:function(){var _609=this.model;if(_609){return {content:_609.contentData||_609,language:_609.languageContext||_609.missingLanguageBranch};}}});});},"epi-cms/contentediting/command/RevertToPublished":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/command/_ContentCommandBase","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_60a,lang,_60b,_60c,_60d){return _60a([_60b],{name:"reverttopublished",tooltip:_60d.reverttopublished.title,label:_60d.reverttopublished.label,iconClass:"epi-iconRevert",_hasPendingChangeWatch:null,_execute:function(){this.model.revertToPublished();},_onModelChange:function(){this.inherited(arguments);var _60e=this.model.contentData,_60f=_60e.status,_610=_60c.versionStatus;var _611=(_60f===_610.CheckedOut)||(_60f===_610.Rejected)||((_60f===_610.Published||_60f===_610.Expired)&&_60e.isCommonDraft);this.set("isAvailable",_611);if(this._hasPendingChangeWatch){this._hasPendingChangeWatch.unwatch();}this._hasPendingChangeWatch=this.model.watch("hasPendingChanges",lang.hitch(this,function(name,_612,_613){var _614=this._getCanExecute(_60e,_610);this.set("canExecute",!_613&&_614);}));this.set("canExecute",_611&&this._getCanExecute(_60e,_610));},_getCanExecute:function(_615,_616){return _615.publishedBy!==null&&_615.publishedBy!==undefined&&_615.status!==_616.Published&&_615.status!==_616.Expired&&this.model.canChangeContent()&&_60c.hasAccess(_615.accessMask,_60c.accessLevel.Delete);}});});},"epi-cms/contentediting/command/_ContentCommandBase":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/shell/command/_Command"],function(_617,lang,_618){return _617([_618],{_isChangingContentStatusHandle:null,checkDeleted:true,destroy:function(){if(this._isChangingContentStatusHandle){this._isChangingContentStatusHandle.unwatch();}this.inherited(arguments);},_canExecuteGetter:function(){if(!this.model||!this.model.contentData){return false;}var _619=this.model.contentData;return this.canExecute&&(!this.checkDeleted||(_619&&!_619.isDeleted));},_onModelChange:function(){this.inherited(arguments);if(this._isChangingContentStatusHandle){this._isChangingContentStatusHandle.unwatch();}var _61a;this._isChangingContentStatusHandle=this.model.watch("isChangingContentStatus",lang.hitch(this,function(name,_61b,_61c){if(_61c){_61a=this.canExecute;this.set("canExecute",false);}else{this.set("canExecute",_61a);}}));}});});},"epi-cms/contentediting/command/Reject":function(){define(["dojo/_base/declare","epi/shell/command/_Command","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_61d,_61e,_61f,_620,_621){return _61d([_620],{name:"reject",label:_621.reject.label,tooltip:_621.reject.title,iconClass:"epi-iconStop",action:_61f.action.Reject,_execute:function(){return this.inherited(arguments);},_onModelChange:function(){this.inherited(arguments);var _622=this.model.contentData,_623=_622.status,_624=_61f.versionStatus,_625=(_623==_624.CheckedIn)&&this.model.canChangeContent(_61f.action.Publish);this.set("canExecute",_625);this.set("isAvailable",_625);}});});},"epi-cms/contentediting/command/_ChangeContentStatus":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/topic","epi-cms/core/ContentReference","epi-cms/contentediting/command/_ContentCommandBase"],function(_626,lang,_627,_628,_629,_62a){return _626([_62a],{action:null,viewName:null,_execute:function(){return this._changeContentStatus();},_changeContentStatus:function(){var def=new _627(),_62b=lang.hitch(this,function(_62c){this._requestContextChange(_62c.id,true);def.resolve(_62c);}),_62d=function(){def.cancel();};_627.when(this.model.changeContentStatus(this.action),_62b,_62d);return def;},_requestContextChange:function(id,_62e){id=new _629(id).createVersionUnspecificReference().toString();var _62f={uri:"epi.cms.contentdata:///"+id};var _630={sender:this,trigger:"internal",forceContextChange:_62e};if(this.viewName){lang.mixin(_630,{viewName:this.viewName});}_628.publish("/epi/shell/context/request",_62f,_630);}});});},"epi-cms/contentediting/command/SendForReview":function(){define(["dojo/_base/declare","dojo/topic","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_631,_632,_633,_634,_635){return _631([_634],{name:"sendforreview",label:_635.sendforreview.label,executingLabel:_635.sendforreview.executinglabel,tooltip:_635.sendforreview.title,iconClass:"epi-iconCheckmark",action:_633.action.CheckIn,_execute:function(){_632.publish("/epi/cms/action/disableundoredoactions");return this.inherited(arguments);},_onModelChange:function(){this.inherited(arguments);var _636=this.model.contentData,_637=((_636.status===_633.versionStatus.CheckedOut)||(_636.status===_633.versionStatus.Rejected)||(_636.status===_633.versionStatus.Published&&_636.isCommonDraft))&&this.model.canChangeContent(this.action),_638=_637&&(_636.status!==_633.versionStatus.Published);this.set("canExecute",_638);this.set("isAvailable",_637);}});});},"epi-cms/contentediting/command/Publish":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/topic","epi/datetime","epi/shell/command/_Command","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_639,_63a,_63b,_63c,_63d,_63e,_63f,_640,_641,_642){return _639([_641],{name:"publish",label:_642.publish.label,executingLabel:_642.publish.executinglabel,tooltip:_642.publish.title,action:_640.action.Publish,_execute:function(){var def=new _63a();_63a.when(this.inherited(arguments),function(_643){var _644=new _63f(_643.oldId).createVersionUnspecificReference().toString();_63b.publish("/epi/cms/contentdata/childrenchanged",_644);def.resolve();},function(){def.reject();});return def;},_onModelChange:function(){this.inherited(arguments);var _645=this.model.contentData,_646=_645.status,_647=this.model.canChangeContent(_640.action.Publish),_648=_647&&!(_646===_640.versionStatus.Published&&!_645.isCommonDraft),res=null;switch(_646){case _640.versionStatus.CheckedIn:res=_642.approveandpublish;break;case _640.versionStatus.PreviouslyPublished:res=_642.republish;break;case _640.versionStatus.CheckedOut:if(_645.isMasterVersion){res=_642.publish;}else{res=_642.publishchanges;}break;default:res=_642.publishchanges;}var _649=_63e.getValue(_645.typeIdentifier,"publishView");this.set("label",res.label);this.set("title",res.title);this.set("executingLabel",res.executinglabel);this.set("canExecute",_648);this.set("isAvailable",_647);this.set("viewName",_649);}});});},"epi-cms/contentediting/command/CreateDraft":function(){define(["dojo/_base/declare","epi-cms/contentediting/command/_ContentCommandBase","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_64a,_64b,_64c,_64d){return _64a([_64b],{name:"createdraft",label:_64d.createdraft.label,tooltip:_64d.createdraft.title,iconClass:"epi-iconPage",contentActionSupport:null,postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_64c;},_execute:function(){this.model.createDraft();},_onModelChange:function(){this.inherited(arguments);var _64e=this.model.contentData,_64f=_64e.status,_650=_64c.versionStatus,_651=this.contentActionSupport.isActionAvailable(_64e,_64c.action.Create,_64c.providerCapabilities.Create)&&this.contentActionSupport.hasAccess(_64e.accessMask,_64c.accessLevel[_64c.action.Edit]);var _652=_651&&(((_64f==_650.Published||_64f==_650.PreviouslyPublished)&&!_64e.isCommonDraft)||_64f==_650.DelayedPublish);this.set("canExecute",_652);this.set("isAvailable",_652);}});});},"epi-cms/contentediting/command/Withdraw":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_653,_654,_655,_656){return _653([_655],{name:"withdraw",label:_656.withdraw.label,tooltip:_656.withdraw.title,iconClass:"epi-iconPen",action:_654.action.Save,contentActionSupport:null,postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_654;},_execute:function(){return this.inherited(arguments);},_onModelChange:function(){this.inherited(arguments);var _657=this.model.contentData,_658=_657.status,_659=_654.versionStatus,_65a=this.contentActionSupport.isActionAvailable(_657,_654.action.Create)&&!this.contentActionSupport.isActionAvailable(_657,_654.action.Publish),_65b=_65a&&(_658==_659.CheckedIn);this.set("canExecute",_65b);this.set("isAvailable",_65b);}});});},"epi-cms/contentediting/command/ManageExpiration":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","epi","epi/datetime","epi-cms/contentediting/ExpirationDialog","epi-cms/contentediting/viewmodel/ExpirationDialogViewModel","epi-cms/contentediting/ContentActionSupport","epi/dependency","epi/shell/command/_Command","epi/shell/widget/dialog/Dialog","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/nls/episerver.shared"],function(_65c,_65d,_65e,lang,epi,_65f,_660,_661,_662,_663,_664,_665,_666,_667){return _65d([_664],{label:_666.dialogtitle,tooltip:_666.dialogtitle,viewModel:null,cssClass:"epi-chromelessButton epi-visibleLink",constructor:function(){this._metadataManager=_663.resolve("epi.shell.MetadataManager");},_execute:function(){if(!this._metadata){return;}var _668=this.get("viewModel");var _669=new _660({metadata:this._metadata,value:_668.get("value"),model:_668});var _66a=new _665({destroyOnHide:true,defaultActionsVisible:false,confirmActionText:_667.action.save,content:_669,title:_666.dialogtitle});_66a.connect(_66a,"onExecute",lang.hitch(this,function(){this._onSave(_66a);}));_66a.connect(_66a,"onCancel",lang.hitch(this,function(){this._onCancel(_66a);}));_66a.show();},_onModelChange:function(){var _66b=this.get("model");if(!_66b||!_66b.contentData){this.set("canExecute",false);return;}var _66c=_66b.contentData.properties,_66d=_66c.iversionable_expire;this.set("viewModel",new _661({contentLink:_66b.contentLink,contentName:_66b.contentData.name,value:_66d,minimumExpireDate:_66c.iversionable_startpublish}));var _66e=_66b.canChangeContent()&&_662.hasAccess(_66b.contentData.accessMask,_662.accessLevel.Publish);_65e.when(_66b.getPropertyMetaData("iversionable_expire"),lang.hitch(this,function(_66f){this._metadata=_66f;}));this.set("canExecute",_66e);},_onSave:function(_670){var _671=_670.content.model,_672=_671.get("intermediateValue");_671.set("value",_672);var _673=this.get("model");_673.publishProperty("iversionable_expire",_672);},_onCancel:function(_674){var _675=_674.content.model;_675.set("intermediateValue",_675.get("value"));}});});},"epi-cms/contentediting/ExpirationDialog":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dijit/_CssStateMixin","epi-cms/widget/Breadcrumb","epi/shell/widget/dialog/_DialogContentMixin","epi/shell/widget/FormContainer","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/_ActionProviderWidget","dojo/text!./templates/ExpirationDialog.html","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/nls/episerver.shared"],function(_676,lang,_677,_678,_679,_67a,_67b,_67c,_67d,_67e,res,_67f){return _676([_67b,_67d,_67a,_678,_67c],{templateString:_67e,res:res,contentLink:null,contentName:null,baseClass:"epi-statusIndicator",modelBindingMap:{"contentLink":["contentLink"],"contentName":["contentName"],"infoText":["infoText"],"state":["state"],"enableSaveButton":["enableSaveButton"],"showRemoveButton":["showRemoveButton"]},postMixInProperties:function(){this.inherited(arguments);this.doLayout=false;},_archiveLinkSelector:null,_setContentLinkAttr:function(_680){this.breadcrumb.set("contentLink",_680);},_setContentNameAttr:{node:"contentNameNode",type:"innerText"},_setInfoTextAttr:{node:"infoTextNode",type:"innerText"},_setEnableSaveButtonAttr:function(_681){if(this._actions&&this._actions.length){this.setActionProperty("save","disabled",!_681);}},_setShowRemoveButtonAttr:function(_682){_677.set(this.removeButton.domNode,"display",_682?"":"none");},_onRemoveButtonClick:function(){var _683={stopPublish:null,archiveLink:null};this.set("value",_683);this.onChange(_683);},onFieldCreated:function(_684,_685){if(_684==="stopPublish"){_685.set("minimumValue",this.model.get("minimumExpireDate"));_685.set("minimumValueMessage",this.model.get("minimumExpireDateMessage"));}else{if(_684==="archiveLink"){this._archiveLinkSelector=_685;if(this._archiveLinkSelector.readOnly){this._archiveLinkSelector._keepReadOnly=true;}this._archiveLinkSelector.set("contentLink",this.model.get("contentLink"));}}},onChange:function(_686){this.inherited(arguments);this.model.set("intermediateValue",_686);},getActions:function(){this._actions=[{name:"save",label:_67f.action.save,settings:{type:"button",disabled:true},action:lang.hitch(this,function(){if(this.validate()){this.executeDialog();}})},{name:"cancel",label:_67f.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}];return this._actions;}});});},"epi-cms/widget/Breadcrumb":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/on","dojo/when","dojo/query","dojo/NodeList-manipulate","dojo/topic","dijit/_Widget","dijit/layout/_LayoutWidget","epi/dependency","epi-cms/core/ContentReference","epi-cms/_ContentContextMixin","epi-cms/contentediting/_ContextualContentContextMixin","epi-cms/widget/_HierarchicalModelMixin"],function(_687,_688,lang,_689,_68a,_68b,_68c,_68d,_68e,on,when,_68f,_690,_691,_692,_693,_694,_695,_696,_697,_698){return _688([_693,_698,_696,_697],{contentLink:null,store:null,showCurrentNode:true,showLastBracket:false,displayAsText:true,minimumItemCount:null,baseClass:"epi-breadCrumbs",_resizeListener:null,_visibleItems:[],_currentContent:null,_ancestors:null,postMixInProperties:function(){var _699=_694.resolve("epi.storeregistry");this.store=this.store||_699.get("epi.cms.content.light");this.minimumItemCount=this.minimumItemCount||2;},buildRendering:function(){this.domNode=this.ownerDocument.createElement("ul");this.inherited(arguments);},startup:function(){this._addResizeListener();},destroy:function(){if(this._resizeListener){this._resizeListener.remove();}this.destroyDescendants();this.inherited(arguments);},_addResizeListener:function(){if(this._resizeListener){return;}var _69a=this.getParent(),_69b=_69a;while(_69b&&!_69b.isLayoutContainer&&_69b.getParent()){_69b=_69b.getParent();}if(_69b&&_69b!==_69a){this._resizeListener=_689.after(_69b,"resize",lang.hitch(this,function(){var _69c=_68d.getMarginBox(this.domNode);this.resize(_69c);}));}},resize:function(_69d){if(!_69d&&this._resizeListener){return;}else{this.layout();}},layout:function(){this._visibleItems=[];when(this._buildPath(),lang.hitch(this,function(){var _69e=_68d.getContentBox(this.domNode).w;if(_69e>this._availableWidth){var _69f=this._leadingItem?_68d.getMarginBox(this._leadingItem.domNode).w:0;var _6a0=this._availableWidth-_69f;this._ellipsisize(0,_6a0);}}));},_setContentLinkAttr:function(_6a1){this._set("contentLink",_6a1);this._currentContent=null;this._ancestors=null;this.layout();},_buildPath:function(){var _6a2=this.get("contentLink"),def=new _68a(),path="";if(this._currentContent&&this._ancestors){this._createAllItems();def.resolve(path);}else{if(_6a2){var _6a3=new _695(_6a2);var _6a4=_6a3.createVersionUnspecificReference().toString();when(this.getCurrentContext(),lang.hitch(this,function(ctx){when(this.store.get(_6a4),lang.hitch(this,function(_6a5){this.getAncestors(_6a4,lang.hitch(this,function(_6a6){this._currentContent=_6a5;this._ancestors=_6a6;this._createAllItems();def.resolve(path);}));}));}));}else{def.resolve(path);}}return def.promise;},_createAllItems:function(){this._cleanUp();if(!this.isTypeOfRoot(this._currentContent)){var _6a7=[],_6a8=null;for(var i=this._ancestors.length-1;i>=0;i--){_6a8=this._ancestors[i];if(!_6a8.parentLink){continue;}_6a7.push(_6a8);if(this.isTypeOfRoot(_6a8)){break;}}_6a7.reverse();var _6a9=_68d.getContentBox(this.domNode).w;this._availableWidth=_6a9>=0?_6a9:0;_687.forEach(_6a7,lang.hitch(this,function(_6aa){this._createItem(_6aa,true);}));}if(this.showCurrentNode){this._createItem(this._currentContent,this.showLastBracket);}},_cleanUp:function(){this.destroyDescendants();this._leadingItem=null;this._visibleItems=[];},_createItem:function(_6ab,_6ac){var node,_6ad=_68c.create("li"),_6ae=this.displayAsText||!_6ab.hasTemplate;if(_6ae){node=_68c.create("span",null,_6ad);}else{node=_68c.create("a",{href:"#"},_6ad);this.own(on(node,"click",lang.hitch(this,function(e){this.onNodeClick(e,_6ab);})));}node.textContent=this.isContextualContent(_6ab)?this.getContextualRootName(_6ab):_6ab.name;if(_6ac){_68c.create("span",{innerHTML:"&gt;","class":"epi-breadCrumbsSeparator"},_6ad);}this._addAndLayout(_6ad);},onNodeClick:function(e,_6af){e.preventDefault();_691.publish("/epi/shell/context/request",{uri:_6af.uri},{sender:this});},_addAndLayout:function(node){var _6b0=new _692({},node);this._visibleItems.push(_6b0);this.addChild(_6b0);var _6b1=this._getTotalVisibleItemsSize();if(_6b1>this._availableWidth){this._ensureLeadingItem();while(_6b1>this._availableWidth&&this._visibleItems.length>this.minimumItemCount){var _6b2=this._visibleItems.splice(0,1)[0];_68e.set(_6b2.domNode,"display","none");_6b1=this._getTotalVisibleItemsSize();}}},_getTotalVisibleItemsSize:function(){var _6b3=0;if(this._leadingItem){_6b3+=_68d.getMarginBox(this._leadingItem.domNode).w;}_687.forEach(this._visibleItems,function(item){_6b3+=_68d.getMarginBox(item.domNode).w;});return _6b3;},_ensureLeadingItem:function(){if(this._leadingItem){return;}var _6b4=_68c.create("li"),_6b5=_68c.create("span",{innerHTML:"..."}),_6b6=_68c.create("span",{innerHTML:" &gt; ","class":"epi-breadCrumbsSeparator"});_68c.place(_6b5,_6b4,"last");_68c.place(_6b6,_6b4,"last");this._leadingItem=new _692({},_6b4);this.addChild(this._leadingItem,0);},_ellipsisize:function(_6b7,_6b8){if(_6b7>=this._visibleItems.length){return;}var _6b9=this._visibleItems.length-_6b7,_6ba=Math.floor(_6b8/_6b9),item=this._visibleItems[_6b7],_6bb=_68d.getMarginBox(item.domNode).w;if(_6bb<=_6ba){this._ellipsisize(_6b7+1,_6b8-_6bb);}else{var _6bc=_68f(this.displayAsText?"span":"a",item.domNode)[0],_6bd=_68f("span.epi-breadCrumbsSeparator",item.domNode)[0],_6be=_6ba-_68d.getMarginBox(_6bd).w;if(_6be<0){_6be=0;}_68e.set(_6bc,"width",_6be+"px");_68b.add(_6bc,"dojoxEllipsis");this._ellipsisize(_6b7+1,_6b8-_6ba);}}});});},"dojo/NodeList-manipulate":function(){define("dojo/NodeList-manipulate",["./query","./_base/lang","./_base/array","./dom-construct","./NodeList-dom"],function(_6bf,lang,_6c0,_6c1){var _6c2=_6bf.NodeList;function _6c3(node){var text="",ch=node.childNodes;for(var i=0,n;n=ch[i];i++){if(n.nodeType!=8){if(n.nodeType==1){text+=_6c3(n);}else{text+=n.nodeValue;}}}return text;};function _6c4(node){while(node.childNodes[0]&&node.childNodes[0].nodeType==1){node=node.childNodes[0];}return node;};function _6c5(html,_6c6){if(typeof html=="string"){html=_6c1.toDom(html,(_6c6&&_6c6.ownerDocument));if(html.nodeType==11){html=html.childNodes[0];}}else{if(html.nodeType==1&&html.parentNode){html=html.cloneNode(false);}}return html;};lang.extend(_6c2,{_placeMultiple:function(_6c7,_6c8){var nl2=typeof _6c7=="string"||_6c7.nodeType?_6bf(_6c7):_6c7;var _6c9=[];for(var i=0;i<nl2.length;i++){var _6ca=nl2[i];var _6cb=this.length;for(var j=_6cb-1,item;item=this[j];j--){if(i>0){item=this._cloneNode(item);_6c9.unshift(item);}if(j==_6cb-1){_6c1.place(item,_6ca,_6c8);}else{_6ca.parentNode.insertBefore(item,_6ca);}_6ca=item;}}if(_6c9.length){_6c9.unshift(0);_6c9.unshift(this.length-1);Array.prototype.splice.apply(this,_6c9);}return this;},innerHTML:function(_6cc){if(arguments.length){return this.addContent(_6cc,"only");}else{return this[0].innerHTML;}},text:function(_6cd){if(arguments.length){for(var i=0,node;node=this[i];i++){if(node.nodeType==1){_6c1.empty(node);node.appendChild(node.ownerDocument.createTextNode(_6cd));}}return this;}else{var _6ce="";for(i=0;node=this[i];i++){_6ce+=_6c3(node);}return _6ce;}},val:function(_6cf){if(arguments.length){var _6d0=lang.isArray(_6cf);for(var _6d1=0,node;node=this[_6d1];_6d1++){var name=node.nodeName.toUpperCase();var type=node.type;var _6d2=_6d0?_6cf[_6d1]:_6cf;if(name=="SELECT"){var opts=node.options;for(var i=0;i<opts.length;i++){var opt=opts[i];if(node.multiple){opt.selected=(_6c0.indexOf(_6cf,opt.value)!=-1);}else{opt.selected=(opt.value==_6d2);}}}else{if(type=="checkbox"||type=="radio"){node.checked=(node.value==_6d2);}else{node.value=_6d2;}}}return this;}else{node=this[0];if(!node||node.nodeType!=1){return undefined;}_6cf=node.value||"";if(node.nodeName.toUpperCase()=="SELECT"&&node.multiple){_6cf=[];opts=node.options;for(i=0;i<opts.length;i++){opt=opts[i];if(opt.selected){_6cf.push(opt.value);}}if(!_6cf.length){_6cf=null;}}return _6cf;}},append:function(_6d3){return this.addContent(_6d3,"last");},appendTo:function(_6d4){return this._placeMultiple(_6d4,"last");},prepend:function(_6d5){return this.addContent(_6d5,"first");},prependTo:function(_6d6){return this._placeMultiple(_6d6,"first");},after:function(_6d7){return this.addContent(_6d7,"after");},insertAfter:function(_6d8){return this._placeMultiple(_6d8,"after");},before:function(_6d9){return this.addContent(_6d9,"before");},insertBefore:function(_6da){return this._placeMultiple(_6da,"before");},remove:_6c2.prototype.orphan,wrap:function(html){if(this[0]){html=_6c5(html,this[0]);for(var i=0,node;node=this[i];i++){var _6db=this._cloneNode(html);if(node.parentNode){node.parentNode.replaceChild(_6db,node);}var _6dc=_6c4(_6db);_6dc.appendChild(node);}}return this;},wrapAll:function(html){if(this[0]){html=_6c5(html,this[0]);this[0].parentNode.replaceChild(html,this[0]);var _6dd=_6c4(html);for(var i=0,node;node=this[i];i++){_6dd.appendChild(node);}}return this;},wrapInner:function(html){if(this[0]){html=_6c5(html,this[0]);for(var i=0;i<this.length;i++){var _6de=this._cloneNode(html);this._wrap(lang._toArray(this[i].childNodes),null,this._NodeListCtor).wrapAll(_6de);}}return this;},replaceWith:function(_6df){_6df=this._normalize(_6df,this[0]);for(var i=0,node;node=this[i];i++){this._place(_6df,node,"before",i>0);node.parentNode.removeChild(node);}return this;},replaceAll:function(_6e0){var nl=_6bf(_6e0);var _6e1=this._normalize(this,this[0]);for(var i=0,node;node=nl[i];i++){this._place(_6e1,node,"before",i>0);node.parentNode.removeChild(node);}return this;},clone:function(){var ary=[];for(var i=0;i<this.length;i++){ary.push(this._cloneNode(this[i]));}return this._wrap(ary,this,this._NodeListCtor);}});if(!_6c2.prototype.html){_6c2.prototype.html=_6c2.prototype.innerHTML;}return _6c2;});},"epi/shell/widget/dialog/_DialogContentMixin":function(){define("epi/shell/widget/dialog/_DialogContentMixin",["dojo/_base/declare"],function(_6e2){return dojo.declare(null,{executeDialog:function(){},cancelDialog:function(){}});});},"url:epi-cms/contentediting/templates/ExpirationDialog.html":"<div class=\"epi-formContainer\">\r\n    <div data-dojo-type=\"epi-cms/widget/Breadcrumb\" data-dojo-attach-point=\"breadcrumb\" data-dojo-props=\"showCurrentNode: false\"></div>\r\n    <h1 data-dojo-attach-point=\"contentNameNode\" class=\"epi-breadCrumbsCurrentItem dijitInline dojoxEllipsis\"></h1>\r\n    <div data-dojo-attach-point=\"stateNode\" class=\"epi-notificationBar epi-notificationBarItem\">\r\n        <div class=\"epi-notificationBarText\" data-dojo-attach-point=\"infoTextNode\"></div>\r\n        <div class=\"epi-notificationBarButtonContainer\">\r\n            <button data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"removeButton\" data-dojo-attach-event=\"onClick: _onRemoveButtonClick\">${res.removebutton}</button>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-type=\"dijit/form/Form\" class=\"epi-formArea\" data-dojo-attach-point=\"form\"></div>\r\n</div>","epi-cms/contentediting/viewmodel/ExpirationDialogViewModel":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/string","epi/epi","epi/datetime","epi/shell/_StatefulGetterSetterMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/cms/nls/episerver.cms.contentediting.versionstatus"],function(_6e3,_6e4,_6e5,epi,_6e6,_6e7,_6e8,_6e9){return _6e3([_6e4,_6e7],{value:null,intermediateValue:null,contentLink:null,contentName:null,enableSaveButton:null,showRemoveButton:null,infoText:null,state:null,postscript:function(){this.inherited(arguments);this.set("intermediateValue",this.value);this.set("minimumExpireDate",this.minimumExpireDate);},_setIntermediateValueAttr:function(_6ea){this._set("intermediateValue",_6ea);this.set("enableSaveButton",!epi.areEqual(this.intermediateValue,this.value));if(_6ea&&_6ea.stopPublish){var _6eb=_6ea.stopPublish instanceof Date?_6ea.stopPublish:_6e6.deserialize(_6ea.stopPublish);this.set("showRemoveButton",true);this.set("infoText",_6eb<_6e6.serverTime()?_6e9.expired:_6e5.substitute(_6e8.expiretimetext,[_6e6.timeToGo(_6eb)]));this.set("state","Expiring");}else{this.set("showRemoveButton",false);this.set("infoText",_6e8.neverexpiretext);this.set("state","NotExpiring");}},_setValueAttr:function(_6ec){this._set("value",_6ec);this.set("enableSaveButton",false);},_setMinimumExpireDateAttr:function(_6ed){var date=new Date(_6ed);this._set("minimumExpireDate",_6e6.isDateValid(date)?date:null);this._set("minimumExpireDateMessage",_6e8.minimumdatevalidation);},save:function(){this.set("value",this.intermediateValue);}});});},"epi-cms/contentediting/commandproviders/ContentDetails":function(){define(["dojo","dojo/_base/declare","epi/shell/command/_CommandProviderMixin","../command/PermanentInUseToggle","../command/StartWorkflow"],function(dojo,_6ee,_6ef,_6f0,_6f1){return _6ee([_6ef],{constructor:function(){this.inherited(arguments);this.add("commands",new _6f0());this.add("commands",new _6f1());}});});},"epi-cms/contentediting/command/PermanentInUseToggle":function(){define(["dojo/_base/declare","epi/dependency","epi/shell/command/ToggleCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting.permanenteditindication"],function(_6f2,_6f3,_6f4,_6f5){return _6f2([_6f4],{name:"PermanentInUseNotification",label:_6f5.title,tooltip:_6f5.tooltip,inUseNotificationManager:null,postscript:function(){this.inherited(arguments);if(this.inUseNotificationManager===null){this.inUseNotificationManager=_6f3.resolve("epi.cms.contentediting.inUseNotificationManager");}this.set("canExecute",true);this.set("isAvailable",true);},_execute:function(){this.inherited(arguments);var _6f6=this.model.contentData;this.inUseNotificationManager.togglePermanentEditIndication(_6f6,true);this._updateCanExecute();},_onModelChange:function(){var _6f7=this.model.contentData,_6f8=this.model.canChangeContent(),_6f9=this.inUseNotificationManager.currentUserHasInUseNotification(_6f7.inUseNotifications,true);this.set("active",_6f9);this._updateCanExecute();},_updateCanExecute:function(){this.set("canExecute",this.active||this.model.canChangeContent());}});});},"epi-cms/contentediting/command/StartWorkflow":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","epi-cms/contentediting/command/_LegacyDialogCommandBase","epi/i18n!epi/cms/nls/episerver.cms.contentediting.command.startworkflow"],function(_6fa,lang,_6fb,_6fc,_6fd){return _6fa([_6fc],{label:_6fd.label,dialogPath:"Edit/StartWorkflow.aspx",raiseCloseEvent:true,_onModelChange:function(){var _6fe=lang.getObject("model.contentData.capabilities.isPage",false,this);this.set("canExecute",!!_6fe);},getDialogParams:function(){return {dialogTitle:_6fd.label,legacyButtonQuery:"div.epi-buttonContainer span.epi-cmsButton, span.epi-cmsButton>input.epi-cmsButton-Cancel",onMapDialogButton:function(_6ff){return !(_6ff&&_6fb.contains(_6ff,"epi-cmsButton-Cancel"));},showCloseButton:true};}});});},"epi-cms/contentediting/command/_LegacyDialogCommandBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/topic","epi/routes","epi/shell/command/_Command","epi/UriParser","epi-cms/core/ContentReference","epi-cms/legacy/LegacyDialogPopup"],function(_700,lang,_701,_702,_703,_704,_705,_706,_707){return _700([_704],{dialogPath:null,raiseCloseEvent:null,routeParams:null,dialogParams:null,canExecute:true,getContentReference:function(){var _708=lang.getObject("model.contentData.contentLink",false,this);return _708?new _706(_708).createVersionUnspecificReference().toString():null;},getRouteParams:function(){return {id:this.getContentReference(),path:this.dialogPath,moduleArea:"LegacyCMS",IsInLegacyWrapper:true};},getDialogParams:function(){return {};},_createDialog:function(_709,_70a){var _70b={url:_703.getActionPath(_70a),dialogArguments:window.document,autoFit:true,destroyOnHide:true,onClose:lang.hitch(this,function(){var _70c=this.getContentReference();if(this.raiseCloseEvent&&_70c){_702.publish("/epi/cms/contentdata/updated",{contentLink:_70c,recursive:true});}})};return new _707(lang.mixin({},_70b,_709));},_execute:function(){_701([this.getDialogParams(),this.getRouteParams()]).then(lang.hitch(this,function(_70d){var _70e=this._createDialog.apply(this,_70d);_70e.show();}));}});});},"epi-cms/legacy/LegacyDialogPopup":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/Deferred","dojo/DeferredList","epi","epi/shell/widget/dialog/Dialog"],function(_70f,lang,_710,_711,_712,_713,epi,_714){return _70f([_714],{url:null,dialogArguments:null,callbackArguments:null,features:null,autoFit:false,showLoadingOverlay:false,legacyDialogObject:null,defaultActionsVisible:false,legacyButtonQuery:null,contentClass:"epi-dialog-fullWidth",dialogClass:"",dialogTitle:null,_legacyDialogContainer:null,_legacyDialogLoadDeferred:null,wrapper:null,buildRendering:function(){this.inherited(arguments);_710.add(this.domNode,"epi-legacyDialog");},postCreate:function(){this.inherited(arguments);this._legacyDialogContainer=_711.create("div");this.set("content",this._legacyDialogContainer);},onCallback:function(_715,_716){},onClose:function(){},onLoad:function(_717){},onMapDialogButton:function(_718){return true;},onBeforePerformAction:function(_719){},show:function(){var _71a=new _713([this._loadLegacyDialog(),this.inherited(arguments)]);return _71a.then(lang.hitch(this,function(_71b){var _71c=_71b[1];if(this.features&&this.features.left&&this.features.top){this.dialog._relativePosition={x:this.features.left,y:this.features.top};}return _71c;}));},_loadLegacyDialog:function(){if(this._legacyDialogLoadDeferred){return this._legacyDialogLoadDeferred;}this._legacyDialogLoadDeferred=new _712();require(["epi-cms/legacy/LegacyDialogWrapper"],lang.hitch(this,function(_71d){var _71e=new _71d({url:this.url,dialogArguments:this.dialogArguments,callbackArguments:this.callbackArguments,features:this.features,autoFit:this.autoFit,showLoadingOverlay:this.showLoadingOverlay,dialogTitle:this.dialogTitle,legacyButtonQuery:this.legacyButtonQuery,showCloseButton:this.showCloseButton},this._legacyDialogContainer);if(this._started&&!_71e._started){_71e.startup();}this.legacyDialogObject=_71e.getLegacyDialog();this.connect(_71e,"onMapDialogButton",this.onMapDialogButton);this.connect(_71e,"onBeforePerformAction",this.onBeforePerformAction);this.connect(_71e,"onCallback",function(_71f,_720){this.onCallback(_71f,_720);setTimeout(lang.hitch(this,function(){this.hide();}),1);});this.connect(_71e,"onLoad",function(){this.set("title",_71e.title);this.onLoad(_71e);});this.connect(_71e,"onCancel",function(){this.hide();});this.connect(_71e,"onResize",function(){this.resize();});this.connect(this,"onHide",function(){this.onClose();});this.wrapper=_71e;this._legacyDialogLoadDeferred.resolve();}));return this._legacyDialogLoadDeferred;}});});},"epi-cms/contentediting/commandproviders/PublishMenu":function(){define(["dojo","dojo/_base/declare","epi/shell/command/_CommandProviderMixin","epi-cms/contentediting/command/ForPublishMenu","epi-cms/contentediting/command/IgnoreInUseNotification"],function(dojo,_721,_722,_723,_724){return _721([_722],{constructor:function(){this.inherited(arguments);this.add("commands",_723(new _724(),{priority:10000}));}});});},"epi-cms/contentediting/command/ForPublishMenu":function(){define(["dojo/_base/lang"],function(lang){return function(_725,_726){_726=lang.mixin({isMain:false,priority:0,resetLabelAfterExecution:true,mainButtonClass:null,keepMenuOpen:false,successStatus:null},_726);_725.options=_726;return _725;};});},"epi-cms/contentediting/command/IgnoreInUseNotification":function(){define(["dojo/_base/declare","epi/dependency","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_727,_728,_729,_72a){return _727([_729],{name:"IgnoreInUseNotification",label:_72a.ignoreinusenotification.label,tooltip:_72a.ignoreinusenotification.title,iconClass:"epi-iconPen",inUseNotificationManager:null,postscript:function(){this.inherited(arguments);if(this.inUseNotificationManager===null){this.inUseNotificationManager=_728.resolve("epi.cms.contentediting.inUseNotificationManager");}this.set("canExecute",true);this.set("isAvailable",true);},_execute:function(){this.inUseNotificationManager.ignoreOthersNotifications=true;this.model.viewName=null;this._requestContextChange(this.model.contentData.uri,true);},_onModelChange:function(){var _72b=this.model.contentData,_72c=this.inUseNotificationManager.hasInUseNotificationWarning(_72b.inUseNotifications),_72d,_72e;_72d=this.inUseNotificationManager.ignoreOthersNotifications;this.inUseNotificationManager.ignoreOthersNotifications=true;_72e=this.model.canChangeContent();this.inUseNotificationManager.ignoreOthersNotifications=_72d;this.set("isAvailable",_72c&&_72e);},_requestContextChange:function(uri,_72f){var _730={uri:uri};var _731={sender:this,forceContextChange:_72f};dojo.publish("/epi/shell/context/request",[_730,_731]);}});});},"epi-cms/contentediting/commandproviders/PublishMenuGlobal":function(){define(["dojo","dojo/_base/declare","epi/shell/command/withConfirmation","epi/shell/command/_CommandProviderMixin","epi-cms/command/TranslateContent","epi-cms/contentediting/command/ForPublishMenu","epi-cms/contentediting/command/RevertToPublished","epi-cms/contentediting/command/Reject","epi-cms/contentediting/command/SendForReview","epi-cms/contentediting/command/Publish","epi-cms/contentediting/command/CreateDraft","epi-cms/contentediting/command/EditCommonDraft","epi-cms/contentediting/command/Withdraw","epi-cms/contentediting/command/ScheduleForPublish","epi-cms/contentediting/command/CancelAndEdit","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu"],function(dojo,_732,_733,_734,_735,_736,_737,_738,_739,_73a,_73b,_73c,_73d,_73e,_73f,res){return _732([_734],{constructor:function(){this.inherited(arguments);this.add("commands",_736(new _73a(),{resetLabelAfterExecution:true,isMain:true,priority:9000,mainButtonClass:"Sweet",keepMenuOpen:true,successStatus:res.successfullypublished}));this.add("commands",_736(new _735(),{isMain:true,priority:10000,mainButtonClass:"Salt"}));this.add("commands",_736(new _73e()));this.add("commands",_736(new _73f()));this.add("commands",_736(new _739(),{isMain:true,priority:8000,mainButtonClass:"Sweet",keepMenuOpen:true}));this.add("commands",_736(new _738(),{resetLabelAfterExecution:false,keepMenuOpen:true}));this.add("commands",_736(new _73d(),{resetLabelAfterExecution:false,keepMenuOpen:true}));this.add("commands",_736(new _73c()));this.add("commands",_736(new _73b()));this.add("commands",_736(_733(new _737(),null,{title:res.reverttopublishconfirmation.dialogtitle,heading:res.reverttopublishconfirmation.confirmquestion,description:res.reverttopublishconfirmation.description})));}});});},"epi/shell/command/withConfirmation":function(){define("epi/shell/command/withConfirmation",["dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","epi/shell/widget/dialog/Confirmation"],function(_740,lang,_741,_742){function _743(_744){var _745=new _741(),_746=new _742(_744);_746.connect(_746,"onAction",function(_747){if(_747){_745.resolve();}else{_745.cancel();}});_746.show();return _745;};return function(_748,_749,_74a){var _74b=_748._execute;_748._execute=function(){function _74c(){_741.when(_74b.apply(_748,arguments),_74d.resolve,_74d.cancel);};var _74d=new _741();_749=_749||_743;_741.when(_749(_74a),_74c,_74d.cancel);return _74d;};return _748;};});},"epi-cms/contentediting/command/EditCommonDraft":function(){define(["dojo/_base/declare","epi-cms/contentediting/command/_ContentCommandBase","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_74e,_74f,_750,_751){return _74e([_74f],{name:"editcommondraft",label:_751.editcommondraft.label,tooltip:_751.editcommondraft.title,iconClass:"epi-iconPen",contentActionSupport:null,postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_750;},_execute:function(){this.model.editCommonDraft();},_onModelChange:function(){this.inherited(arguments);var _752=this.model.contentData,_753=_752.status,_754=_750.versionStatus,_755=this.contentActionSupport.hasAccess(_752.accessMask,_750.accessLevel.Edit),_756=(_753==_754.Published||_753==_754.PreviouslyPublished)&&!_752.isCommonDraft&&_755&&this.contentActionSupport.hasProviderCapability(_752.providerCapabilityMask,_750.providerCapabilities.Edit);this.set("canExecute",_756&&this.model.canEditCurrentLanguage());this.set("isAvailable",_756);}});});},"epi-cms/contentediting/command/ScheduleForPublish":function(){define(["dojo/_base/declare","dojo/aspect","dojo/on","dojo/topic","epi/shell/widget/dialog/Dialog","epi-cms/contentediting/command/_ChangeContentStatus","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/ScheduledPublishSelector","epi-cms/contentediting/ScheduledPublishSelectorViewModel","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons","epi/i18n!epi/cms/nls/episerver.cms.widget.scheduledpublishselector"],function(_757,_758,on,_759,_75a,_75b,_75c,_75d,_75e,_75f,_760){return _757([_75b],{name:"reject",label:_75f.scheduleforpublish.label,tooltip:_75f.scheduleforpublish.title,iconClass:"epi-iconClock",_execute:function(){var _761=new _75e();_761.set("contentData",this.model.contentData);var _762=new _75d({model:_761});var self=this,_763=_75c.saveAction;self.set("action",_763.CheckIn|_763.DelayedPublish|_763.ForceCurrentVersion);var _764=new _75a({content:_762,title:_760.title,defaultActionsVisible:false});on(_764,"execute",function(){self.model.setProperty("iversionable_startpublish",_761.dateValue);self._changeContentStatus();});_764.show(true);_758.after(_764,"_onSubmit",function(){_759.publish("/epi/cms/action/disableundoredoactions");});},_onModelChange:function(){this.inherited(arguments);var _765=this.model.contentData,_766=(_765.status===_75c.versionStatus.CheckedOut)||(_765.status===_75c.versionStatus.Rejected)||(_765.status===_75c.versionStatus.Published&&_765.isCommonDraft),_767=_766&&this.model.canChangeContent(_75c.action.Publish);this.set("canExecute",_767);this.set("isAvailable",_766);}});});},"epi-cms/contentediting/ScheduledPublishSelector":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ActionProviderWidget","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/DateTimeSelectorDropDown","epi/shell/widget/dialog/_DialogContentMixin","epi-cms/widget/Breadcrumb","./ScheduledPublishSelectorViewModel","dojo/text!./templates/ScheduledPublishSelector.html","epi/i18n!epi/cms/nls/episerver.cms.widget.scheduledpublishselector","epi/i18n!epi/nls/episerver.shared"],function(_768,lang,_769,_76a,_76b,_76c,_76d,_76e,_76f,_770,_771,_772,_773,_774){return _768([_769,_76a,_76b,_76d,_76c,_76f],{templateString:_772,modelData:null,_setTitleAttr:{node:"contentNameNode",type:"innerText"},_setDateLabelAttr:{node:"publishChangesCaptionNode",type:"innerHTML"},_setDateValueAttr:function(date){this.dateTimeSelector.set("value",date);},_setBreadcrumbModelAttr:function(_775){this.breadcrumbNode.set("contentLink",_775);},_setScheduleButtonEnabledAttr:function(_776){if(this._actions&&this._actions.length){this.setActionProperty("save","disabled",!_776);}},modelBindingMap:{"title":["title"],"dateLabel":["dateLabel"],"dateValue":["dateValue"],"breadcrumbModel":["breadcrumbModel"],"scheduleButtonEnabled":["scheduleButtonEnabled"]},postMixInProperties:function(){this.inherited(arguments);this.model=this.model||new _771(this.modelData);},postCreate:function(){this.inherited(arguments);this.connect(this.dateTimeSelector,"onChange","dateTimeSelectorChanged");},dateTimeSelectorChanged:function(_777){this.model.set("dateValue",_777);},getActions:function(){this._actions=[{name:"save",label:_773.confirmtext,settings:{type:"button","class":"Salt",disabled:true},action:lang.hitch(this,function(){if(this.dateTimeSelector.validate()){this.executeDialog();}})},{name:"cancel",label:_774.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}];return this._actions;}});});},"epi-cms/contentediting/ScheduledPublishSelectorViewModel":function(){define(["dojo/_base/declare","dojo/Stateful","epi/shell/_StatefulGetterSetterMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.scheduledpublishselector"],function(_778,_779,_77a,_77b){return _778([_779,_77a],{breadcrumbModel:null,title:"",dateLabel:"",dateValue:null,scheduleButtonEnabled:false,constructor:function(){var _77c=new Date();_77c.setDate(_77c.getDate()+1);_77c.setHours(12,0,0,0);this.set("dateValue",_77c);},_setIsPublishedAttr:function(_77d){this.set("dateLabel",_77d?_77b.publishchangeson:_77b.publishon);},_setContentDataAttr:function(_77e){this.set("title",_77e.name);this.set("isPublished",!_77e.isPendingPublish);this.set("breadcrumbModel",_77e.contentLink);},_setDateValueAttr:function(_77f){this._set("dateValue",_77f);this.set("scheduleButtonEnabled",!!_77f);}});});},"url:epi-cms/contentediting/templates/ScheduledPublishSelector.html":"<div>\r\n    <div data-dojo-type=\"epi-cms/widget/Breadcrumb\" data-dojo-attach-point=\"breadcrumbNode\" data-dojo-props=\"showCurrentNode: false\"></div>\r\n    <h1 data-dojo-attach-point=\"contentNameNode\" class=\"epi-breadCrumbsCurrentItem dijitInline dojoxEllipsis\"></h1>\r\n    <div data-dojo-attach-point=\"publishChangesCaptionNode\"></div>\r\n    <div data-dojo-type=\"epi/shell/widget/DateTimeSelectorDropDown\" data-dojo-attach-point=\"dateTimeSelector\" data-dojo-props=\"required:true\"></div>\r\n</div>","epi-cms/contentediting/command/CancelAndEdit":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/date","epi/shell/command/_Command","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.cancelandedit"],function(_780,_781,lang,_782,_783,_784,_785,_786,_787){return _780([_786],{name:"cancelAndEdit",label:_787.label,tooltip:_787.title,iconClass:"epi-iconPen",action:_785.action.Reject,_execute:function(){this.inherited(arguments).then(lang.hitch(this,function(){var _788=this.model.contentData;this.model.setProperty("iversionable_startpublish",_788.isPendingPublish?_788.created:_788.lastPublished);}));},_onModelChange:function(){this.inherited(arguments);var _789=this.model.contentData,_78a=_789.status,_78b=_785.hasAccess(_789.accessMask,_785.accessLevel.Edit),_78c=_78b&&(_78a===_785.versionStatus.DelayedPublish);this.set("canExecute",_78c);this.set("isAvailable",_78c);}});});},"epi-cms/contentediting/viewsettings/ChannelViewSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/_ViewSetting"],function(_78d,lang,_78e){return _78d([_78e],{key:"epichannel",usedForRendering:true,isTagItem:false,beforePreviewLoad:function(_78f,_790){this.inherited(arguments);if(_790&&this.value){_78f.epichannel=this.value;}else{delete _78f.epichannel;}}});});},"epi-cms/contentediting/_ViewSetting":function(){define(["dojo/_base/declare","epi/shell/_StatefulGetterSetterMixin"],function(_791,_792){return _791(_792,{key:null,value:null,enabled:null,beforePreviewLoad:function(_793,_794){},afterPreviewLoad:function(_795,_796){}});});},"epi-cms/contentediting/viewsettings/ResolutionViewSetting":function(){define(["dojo/_base/declare","epi-cms/contentediting/_ViewSetting"],function(_797,_798){return _797([_798],{key:"resolution",usedForRendering:false,afterPreviewLoad:function(_799,_79a){this.inherited(arguments);if(_799){var size=_79a?this._getPreviewResolution():null;_799.set("previewSize",size);_799.set("devicePreviewClass",this.value?"epi-editorViewport--device-preview epi-viewPort-"+this.value:"");}return null;},_getPreviewResolution:function(){var size=null;var _79b=this.value;if(_79b){var _79c=_79b.split("x");if(_79c.length==2){size={"w":_79c[0],"h":_79c[1]};}}return size;}});});},"epi-cms/contentediting/viewsettings/ViewLanguageViewSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","epi-cms/contentediting/_ViewSetting"],function(_79d,lang,_79e,_79f){return _79d([_79f],{key:"viewlanguage",usedForRendering:true,isTagItem:false,initialize:function(_7a0){_7a0.registerRequestInterceptor(lang.hitch(this,this._onContextChange));},_onContextChange:function(_7a1,_7a2){var dfd=new _79e();dfd.resolve();if(this.get("enabled")&&this.value){_7a1.epslanguage=this.value;}return dfd;}});});},"epi-cms/contentediting/viewsettings/VisitorGroupViewSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/_ViewSetting"],function(_7a3,lang,_7a4){return _7a3([_7a4],{key:"visitorgroup",usedForRendering:true,isTagItem:false,beforePreviewLoad:function(_7a5,_7a6){this.inherited(arguments);if(_7a6&&this.value){_7a5.visitorgroupsByID=this.value;}else{delete _7a5.visitorgroupsByID;}}});});},"epi-cms/Profile":function(){define("epi-cms/Profile",["dojo/_base/lang","dojo/Deferred","dojo/when","epi/dependency","epi/shell/Profile","epi-cms/ApplicationSettings"],function(lang,_7a7,when,_7a8,_7a9,_7aa){var _7ab=function(host){return "editlanguage_"+host.replace(":","");};lang.extend(_7a9,{getContentLanguage:function(host){host=host||window.location.host;return when(this.get(_7ab(host)),function(_7ac){return _7ac||_7aa.currentContentLanguage;});},setContentLanguage:function(_7ad,host){return this.set(_7ab(host),_7ad,{location:"server"});}});return _7a9;});},"epi-cms/component/ContextHistory":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","epi/dependency","epi/UriParser","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi-cms/widget/_GridWidgetBase"],function(_7ae,_7af,lang,_7b0,_7b1,_7b2,_7b3,_7b4,_7b5){return _7af([_7b5],{ignoreVersionWhenComparingLinks:false,postMixInProperties:function(){this.inherited(arguments);this.store=this.store||_7b1.resolve("epi.shell.ContextHistory").store;},buildRendering:function(){this.inherited(arguments);var _7b6=lang.mixin({columns:{name:{renderCell:lang.hitch(this,this._renderContentItem)}},store:this.store,selectionMode:"single"},this.defaultGridMixin);this.grid=new this._gridClass(_7b6,this.domNode);this.grid.set("showHeader",false);},postCreate:function(){this.inherited(arguments);_7b0.subscribe("/epi/cms/trash/empty",lang.hitch(this,function(_7b7){if(_7b7){_7b7.forEach(function(_7b8){this.store.remove("epi.cms.contentdata:///"+_7b8);},this);}}));},startup:function(){this.inherited(arguments);this.fetchData();},_dndNodeCreator:function(item,hint){var _7b9=this.inherited(arguments);_7b9.data.contentLink=new _7b2(_7b9.data.uri).getId();return _7b9;},contextChanged:function(){this.inherited(arguments);this.grid.set("sort","dateAdded",true);},fetchData:function(){var _7ba=_7b3.wastebasketPage;this.grid.set("query",{uri:new RegExp("epi\\.cms\\.contentdata:///([^"+_7ba+"]|\\d{2,})")});this.grid.set("sort","dateAdded",true);}});});},"epi-cms/component/GlobalToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/store/Memory","dijit/registry","dijit/Toolbar","epi/shell/command/_CommandModelBindingMixin","epi/shell/command/_WidgetCommandConsumerMixin","epi/shell/command/builder/_Builder","epi/shell/command/builder/GroupedButtonBuilder","epi/shell/command/builder/MenuAssembler","epi/shell/command/builder/DropDownButtonBuilder","dojo/text!./templates/GlobalToolbar.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_7bb,lang,_7bc,_7bd,_7be,_7bf,_7c0,_7c1,_7c2,_7c3,_7c4,_7c5,_7c6,_7c7){var _7c8=_7bb([_7c2],{_create:function(_7c9){var _7ca=_7bb([_7c9.settings.widget,_7c0]),_7cb=new _7ca(_7c9.settings);return _7cb;},_addToContainer:function(_7cc,_7cd){_7cc.placeAt(_7cd);_7cc.startup();}});var _7ce=_7bb([_7c4],{_getBuildInfo:function(_7cf){if(_7cf.settings.category){var i=this.configuration.length-1;for(;i>0;i--){if(this.configuration[i].category==_7cf.settings.category){return this.configuration[i];}}}return this.configuration[0];}});return _7bb([_7bf,_7c1],{templateString:_7c6,commandKey:"epi.cms.globalToolbar",postCreate:function(){this.inherited(arguments);var _7d0=new _7c8();var _7d1=new _7c5({settings:{title:_7c7.createcontent.title,"class":"epi-mediumButton epi-disabledDropdownArrow",iconClass:"epi-iconPlus",showLabel:false}});var _7d2=new _7c3({settings:{baseClass:"epi-mediumButton epi-expandoButton"}});var _7d3=[{category:"leading",builder:_7d0,target:this.leadingContainerNode},{category:"view",builder:_7d2,target:this.leadingContainerNode},{category:"center",builder:_7d0,target:this.centerContainerNode},{category:"trailing",builder:_7d0,target:this.trailingContainerNode},{category:"create",builder:_7d1,target:this.leadingContainerNode}];var _7d4=new _7ce({configuration:_7d3,commandSource:this});_7d4.build();},_getNextFocusableChild:function(_7d5,dir){var _7d6=this.getChildren();var _7d7=_7d6.indexOf(_7d5);_7d7=(dir>0)?_7d7+1:_7d7-1;if(_7d7<0){_7d7=_7d6.length-1;}else{if(_7d7>=_7d6.length){_7d7=0;}}return _7d6[_7d7];}});});},"epi/shell/command/_WidgetCommandConsumerMixin":function(){define("epi/shell/command/_WidgetCommandConsumerMixin",["dojo/_base/declare","epi/shell/command/_CommandConsumerMixin","epi/shell/command/_WidgetCommandProviderMixin"],function(_7d8,_7d9,_7da){return _7d8([_7d9,_7da],{});});},"epi/shell/command/_WidgetCommandProviderMixin":function(){define("epi/shell/command/_WidgetCommandProviderMixin",["dojo/_base/declare","epi/shell/command/_WidgetCommandBinderMixin","epi/shell/command/_GlobalCommandProviderMixin"],function(_7db,_7dc,_7dd){return _7db([_7dd,_7dc],{postMixInProperties:function(){this.inherited(arguments);this.commandProvider=this.commandProvider||this;}});});},"epi/shell/command/_WidgetCommandBinderMixin":function(){define("epi/shell/command/_WidgetCommandBinderMixin",["dojo/_base/declare","epi/shell/command/_CommandConsumerMixin"],function(_7de,_7df){return _7de(null,{commandProvider:null,_consumerHandle:null,startup:function(){if(this._started){return;}this.inherited(arguments);var _7e0=this.getConsumer();if(!_7e0){return;}this._consumerHandle=_7e0.addProvider(this.commandProvider||this);this.commandProvider.initializeCommandProviders&&this.commandProvider.initializeCommandProviders();},getConsumer:function(){if(this.isInstanceOf(_7df)){return this;}var _7e1=this.getParent();while(_7e1){if(_7e1.isInstanceOf(_7df)){return _7e1;}_7e1=_7e1.getParent();}},destroy:function(){this._consumerHandle&&this._consumerHandle.removeProvider();this.inherited(arguments);}});});},"epi/shell/command/_GlobalCommandProviderMixin":function(){define("epi/shell/command/_GlobalCommandProviderMixin",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","epi/shell/command/_CommandProviderMixin","epi/dependency"],function(_7e2,_7e3,lang,_7e4,_7e5){return _7e3([_7e4],{commandKey:null,commandProviders:null,_consumer:null,_currentCommandModel:null,_providerWatch:null,_initialized:false,initializeCommandProviders:function(){if(this.initialized||!this.commandKey||!this.getConsumer){return;}this._consumer=this.getConsumer();if(!this._consumer){return;}this.commandRegistry=this.commandRegistry||_7e5.resolve("epi.globalcommandregistry");this.commandProviders=this.commandRegistry.get(this.commandKey,true);_7e2.forEach(this.commandProviders.providers,function(_7e6){this._consumer.addProvider(_7e6);},this);this._providerWatch=this.commandProviders.watch("providers",lang.hitch(this,this.onProvidersChanged));this.initialized=true;},updateCommandModel:function(_7e7){this._currentCommandModel=_7e7;_7e2.forEach(this.commandProviders.providers,function(_7e8){if(_7e8.updateCommandModel){_7e8.updateCommandModel(_7e7);}},this);},onProvidersChanged:function(name,_7e9,_7ea){if(_7e9){_7e2.forEach(_7e9,this._consumer.removeProvider,this._consumer);}if(_7ea){_7e2.forEach(_7ea,function(item){this._consumer.addProvider(item);if(item.updateCommandModel){item.updateCommandModel(this._currentCommandModel);}},this);}},destroy:function(){if(this._consumer&&this.commandProviders){_7e2.forEach(this.commandProviders.providers,this._consumer.removeProvider,this);}this._providerWatch&&this._providerWatch.unwatch();this.inherited(arguments);}});});},"epi/shell/command/builder/GroupedButtonBuilder":function(){define("epi/shell/command/builder/GroupedButtonBuilder",["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","epi/shell/command/_CommandModelBindingMixin","epi/shell/command/builder/_Builder","epi/shell/widget/ListContainer","epi/shell/widget/ExpandoButton"],function(_7eb,lang,_7ec,_7ed,_7ee,_7ef,_7f0){return _7eb([_7ee],{_create:function(_7f1){var d={declare:_7eb};var _7f2=d["declare"]([_7f1.settings.widget,_7ed]),_7f3=new _7f2(lang.mixin(_7f1.settings,this.itemSettings));return _7f3;},_addToContainer:function(_7f4,_7f5){this._createListContainer(_7f4,_7f5);if(this._containerAdded){if(_7f4.model){_7f4.model.watch("isAvailable",lang.hitch(this,function(){if(this._listContainer.updateVisibility){this._listContainer.updateVisibility();}}));}}this.inherited(arguments,[_7f4,this._listContainer]);if(this._listContainer.getChildren().length>1){_7ec.add(_7f4.getParent().domNode,"epi-leftSeparator");}},_createListContainer:function(_7f6,_7f7){if(this._containerAdded){return;}this._listContainer=new _7ef(this.settings);this._listContainer._commandCategory=_7f6._commandCategory;if(_7f7.addChild){_7f7.addChild(this._listContainer);}else{this._listContainer.placeAt(_7f7);this._listContainer.startup();}this._containerAdded=true;}});});},"url:epi-cms/component/templates/GlobalToolbar.html":"<div class=\"dijit epi-globalToolbar\" role=\"toolbar\" tabIndex=\"${tabIndex}\" data-dojo-attach-point=\"containerNode\">\r\n    <div class=\"epi-toolbarGroupContainer\">\r\n        <div data-dojo-attach-point=\"leadingContainerNode\" class=\"epi-toolbarLeading epi-toolbarGroup\"></div>\r\n        <div data-dojo-attach-point=\"centerContainerNode\" class=\"epi-toolbarCenter epi-toolbarGroup\"></div>\r\n        <div data-dojo-attach-point=\"trailingContainerNode\" class=\"epi-toolbarTrailing epi-toolbarGroup\"></div>\r\n    </div>\r\n</div>","epi-cms/component/MainNavigationComponent":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dijit/layout/_LayoutWidget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/dependency","epi-cms/widget/SearchBox"],function(_7f8,_7f9,lang,_7fa,_7fb,_7fc,_7fd,_7fe,_7ff,_800){return _7f9([_7fb,_7fc,_7fd],{templateString:"<div>                            <div data-dojo-type=\"epi-cms/widget/SearchBox\" data-dojo-attach-point=\"search\" class=\"epi-gadgetInnerToolbar\"></div>                            <div data-dojo-attach-point=\"navigation\" style=\"overflow:auto;\">                            </div>                        </div>",contentRepositoryDescriptors:null,postCreate:function(){this.inherited(arguments);this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_7fe.resolve("epi.cms.contentRepositoryDescriptors");var _801=this.contentRepositoryDescriptors[this.repositoryKey];var _802=this.roots?this.roots:_801.roots;this.search.set("area",_801.searchArea);this.search.set("searchRoots",_802);var _803=_801.customNavigationWidget||"epi-cms/component/ContentNavigationTree";require([_803],lang.hitch(this,function(_804){var _805=new _804({typeIdentifiers:_801.mainNavigationTypes?_801.mainNavigationTypes:_801.containedTypes,containedTypes:_801.containedTypes,settings:_801,roots:_802,repositoryKey:this.repositoryKey});_805.placeAt(this.navigation);this.tree=_805;this.own(this.tree.watch("showAllLanguages",lang.hitch(this,function(){this.search.set("filterOnCulture",!this.tree.get("showAllLanguages"));})));}));},layout:function(){var cb=this._contentBox,sb=_7fa.getMarginBox(this.search.domNode);_7fa.setMarginBox(this.navigation,{w:cb.w,h:cb.h-sb.h});if(this.tree){this.tree.resize();}}});});},"epi-cms/widget/SearchBox":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/connect","dojo/_base/json","dojo/_base/lang","dojo/dom-construct","dijit/_Widget","epi/shell/SearchManager","epi-cms/widget/ContentSearchBox"],function(_806,_807,_808,json,lang,_809,_80a,_80b,_80c){return _806([_80a],{area:null,searchRoots:null,filterOnCulture:null,triggerContextChange:true,_searchBox:null,_searchManager:null,postCreate:function(){this.inherited(arguments);this._searchManager=new _80b();_807.when(this._searchManager.getStore(),lang.hitch(this,function(_80d){this._searchBox=new _80c({"searchAttr":"searchQuery","store":_80d});var _80e={filterOnDeleted:true};lang.mixin(this._searchBox.query,{parameters:json.toJson(_80e)});this._searchBox.on("select",lang.hitch(this,function(_80f){this._searchBox.set("value","");this._searchBox.focus();this._searchBox.toggleClearButton();this.onItemAction(_80f);}));this.set("filterOnCulture",false);_809.place(this._searchBox.domNode,this.domNode);}));},_setAreaAttr:function(_810){this._set("area",_810);if(this._searchBox){_807.when(this._searchManager.getProviderQuery(_810),lang.hitch(this,function(_811){lang.mixin(this._searchBox.query,_811);}));}},_setSearchRootsAttr:function(_812){this._set("searchRoots",_812);if(this._searchBox){lang.mixin(this._searchBox.query,{searchRoots:_812});}},_setFilterOnCultureAttr:function(_813){this._set("filterOnCulture",_813);if(this._searchBox){lang.mixin(this._searchBox.query,{filterOnCulture:_813});}},onItemAction:function(item){if(this.triggerContextChange){var _814={uri:"epi.cms.contentdata:///"+item.metadata.id};if(item.metadata.isUntranslatedContent=="false"){_814.epslanguage=item.metadata.languageBranch;}_808.publish("/epi/shell/context/request",[_814,{sender:null}]);}}});});},"epi/shell/SearchManager":function(){define("epi/shell/SearchManager",["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/array","dojo/_base/lang","dojo/DeferredList","epi/dependency"],function(_815,_816,_817,lang,_818,_819){return _815(null,{_providersStore:null,_resultsStore:null,constructor:function(){this._setupStores();},getProviderQuery:function(area){var _81a=new _816();_816.when(this.getProviders(area),dojo.hitch(this,function(_81b){if(_81b&&_81b.length>0){_81a.resolve(this._getQuery(_81b[0],{}));}else{_81a.resolve();}}));return _81a;},getProviders:function(area){var _81c=new _816();_816.when(this._providersStore.query({searchArea:area}),function(_81d){if(_81d&&_81d.length>0){_81c.resolve(_81d);}else{_81c.resolve();}});return _81c;},getStore:function(){return this._resultsStore;},search:function(area,_81e){var _81f=new _816();_816.when(this.getProviders(area),lang.hitch(this,function(_820){if(_820&&_820.length>0){var _821=[];_817.forEach(_820,function(_822,_823){_821.push(this._getData(_822,_81e));},this);var _824=new _818(_821),data=[];_824.then(function(_825){_817.forEach(_825,function(item){if(lang.isArray(item[1])){data=data.concat(item[1]);}});_81f.resolve(data);});}}));return _81f;},_setupStores:function(){var _826=_819.resolve("epi.storeregistry");this._providersStore=_826.get("epi.shell.searchproviders");this._resultsStore=_826.get("epi.shell.searchresults");},_getQuery:function(_827,_828){var _829={providerId:_827.id};lang.mixin(_829,_828||{});return _829;},_getData:function(_82a,_82b){var _82c=new _816();_816.when(this._resultsStore.query(this._getQuery(_82a,_82b)),function(_82d){if(_82d&&_82d.length>0){_82c.resolve(_82d);}else{_82c.resolve();}});return _82c;}});});},"epi-cms/widget/ContentSearchBox":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/event","dojo/aspect","dojo/Evented","dojo/keys","dojo/dom-attr","dojo/dom-style","epi/shell/widget/SuggestionBox","epi-cms/widget/SearchResultList","epi/i18n!epi/cms/nls/episerver.cms.widget.contentlist"],function(_82e,lang,_82f,_830,_831,keys,_832,_833,_834,_835,_836){return _82e([_834,_831],{res:_836,autoComplete:false,dropDownClass:_835,queryExpr:"${0}",minimumNumberOfChar:1,postCreate:function(){this.inherited(arguments);this.searchDelay=this.defaultDelay;this.on("beforeSearch",lang.hitch(this,function(){if(this.dropDown){this.dropDown.showStandby(true);}}));this.on("searchComplete",lang.hitch(this,function(_837){if(this.dropDown){this.dropDown.showStandby(false);}}));_830.before(this,"_startSearch",function(_838,args){this.emit("beforeSearch",{});return [_838,args];});},_openResultList:function(_839,_83a,_83b){this.emit("searchComplete",_839);this._fetchHandle=null;this.dropDown.clearResultList();var _83c=_839.length>0||_83b.start!==0;this.dropDown.showErrorMessage(!_83c,this.res.contentnotfound);this.dropDown.showGrid(_83c);if(_83c){this.dropDown.createOptions(_839,_83b,lang.hitch(this,"_getMenuLabelFromItem"));}this._showResultList();},_onDropDownMouseDown:function(e){e.stopPropagation();},_onKey:function(evt){switch(evt.keyCode){case keys.ENTER:if(this.dropDown&&this.dropDown.selected){this.dropDown.handleKey(evt);this.closeDropDown();}else{if(!this._fetchHandle){this._startSearchFromInput();_82f.stop(evt);}}break;case keys.PAGE_DOWN:case keys.DOWN_ARROW:case keys.PAGE_UP:case keys.UP_ARROW:if(this.dropDown){this.dropDown.handleKey(evt);}_82f.stop(evt);break;case keys.LEFT_ARROW:case keys.RIGHT_ARROW:break;default:this.inherited(arguments);}},_startSearchFromInput:function(){var key=this.focusNode.value;if(!key||key.length<this.minimumNumberOfChar){this.closeDropDown();return;}if(!this.dropDown){var _83d=this.id+"_popup",_83e=lang.isString(this.dropDownClass)?lang.getObject(this.dropDownClass,false):this.dropDownClass;this.dropDown=new _83e({id:_83d,dir:this.dir,textDir:this.textDir});_832.remove(this.textbox,"aria-activedescendant");_832.set(this.textbox,"area-owns",_83d);this.dropDown.on("select",lang.hitch(this,function(_83f){this.closeDropDown();this.emit("select",_83f);}));_833.set(this.dropDown.domNode,"width",this.textbox.clientWidth+"px");}this._showResultList();var _840=key.replace(new RegExp("\\W+"),"").length===0;this.dropDown.showErrorMessage(_840,this.res.notsearchspecialcharacter);if(!_840){this._startSearch(key);}},_startSearchAll:function(){}});});},"epi/shell/widget/SuggestionBox":function(){define("epi/shell/widget/SuggestionBox",["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dijit/_HasDropDown","dijit/form/_ComboBoxMenu","dijit/form/_AutoCompleterMixin","epi/shell/widget/SearchBox"],function(_841,lang,_842,_843,_844,_845,_846){return _841([_846,_843,_845],{dropDownClass:_844,buildRendering:function(){this.inherited(arguments);_842.set(this.textbox,"autocomplete","off");_842.set(this.textbox,"aria-haspopup","true");},postCreate:function(){this.inherited(arguments);this.connect(this.clearButton,"onclick",lang.hitch(this,function(){this.closeDropDown();}));}});});},"dijit/form/_ComboBoxMenu":function(){define("dijit/form/_ComboBoxMenu",["dojo/_base/declare","dojo/dom-class","dojo/dom-style","dojo/keys","../_WidgetBase","../_TemplatedMixin","./_ComboBoxMenuMixin","./_ListMouseMixin"],function(_847,_848,_849,keys,_84a,_84b,_84c,_84d){return _847("dijit.form._ComboBoxMenu",[_84a,_84b,_84d,_84c],{templateString:"<div class='dijitReset dijitMenu' data-dojo-attach-point='containerNode' style='overflow: auto; overflow-x: hidden;' role='listbox'>"+"<div class='dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point='previousButton' role='option'></div>"+"<div class='dijitMenuItem dijitMenuNextButton' data-dojo-attach-point='nextButton' role='option'></div>"+"</div>",baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);if(!this.isLeftToRight()){_848.add(this.previousButton,"dijitMenuItemRtl");_848.add(this.nextButton,"dijitMenuItemRtl");}},_createMenuItem:function(){var item=this.ownerDocument.createElement("div");item.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");item.setAttribute("role","option");return item;},onHover:function(node){_848.add(node,"dijitMenuItemHover");},onUnhover:function(node){_848.remove(node,"dijitMenuItemHover");},onSelect:function(node){_848.add(node,"dijitMenuItemSelected");},onDeselect:function(node){_848.remove(node,"dijitMenuItemSelected");},_page:function(up){var _84e=0;var _84f=this.domNode.scrollTop;var _850=_849.get(this.domNode,"height");if(!this.getHighlightedOption()){this.selectNextNode();}while(_84e<_850){var _851=this.getHighlightedOption();if(up){if(!_851.previousSibling||_851.previousSibling.style.display=="none"){break;}this.selectPreviousNode();}else{if(!_851.nextSibling||_851.nextSibling.style.display=="none"){break;}this.selectNextNode();}var _852=this.domNode.scrollTop;_84e+=(_852-_84f)*(up?-1:1);_84f=_852;}},handleKey:function(evt){switch(evt.keyCode){case keys.DOWN_ARROW:this.selectNextNode();return false;case keys.PAGE_DOWN:this._page(false);return false;case keys.UP_ARROW:this.selectPreviousNode();return false;case keys.PAGE_UP:this._page(true);return false;default:return true;}}});});},"dijit/form/_ComboBoxMenuMixin":function(){define("dijit/form/_ComboBoxMenuMixin",["dojo/_base/array","dojo/_base/declare","dojo/dom-attr","dojo/i18n","dojo/i18n!./nls/ComboBox"],function(_853,_854,_855,i18n){return _854("dijit.form._ComboBoxMenuMixin",null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=i18n.getLocalization("dijit.form","ComboBox",this.lang);},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages["previousMessage"];this.nextButton.innerHTML=this._messages["nextMessage"];},_setValueAttr:function(_856){this.value=_856;this.onChange(_856);},onClick:function(node){if(node==this.previousButton){this._setSelectedAttr(null);this.onPage(-1);}else{if(node==this.nextButton){this._setSelectedAttr(null);this.onPage(1);}else{this.onChange(node);}}},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null);},_createOption:function(item,_857){var _858=this._createMenuItem();var _859=_857(item);if(_859.html){_858.innerHTML=_859.label;}else{_858.appendChild(_858.ownerDocument.createTextNode(_859.label));}if(_858.innerHTML==""){_858.innerHTML="&#160;";}this.applyTextDir(_858,(_858.innerText||_858.textContent||""));return _858;},createOptions:function(_85a,_85b,_85c){this.items=_85a;this.previousButton.style.display=(_85b.start==0)?"none":"";_855.set(this.previousButton,"id",this.id+"_prev");_853.forEach(_85a,function(item,i){var _85d=this._createOption(item,_85c);_85d.setAttribute("item",i);_855.set(_85d,"id",this.id+i);this.nextButton.parentNode.insertBefore(_85d,this.nextButton);},this);var _85e=false;if(_85a.total&&!_85a.total.then&&_85a.total!=-1){if((_85b.start+_85b.count)<_85a.total){_85e=true;}else{if((_85b.start+_85b.count)>_85a.total&&_85b.count==_85a.length){_85e=true;}}}else{if(_85b.count==_85a.length){_85e=true;}}this.nextButton.style.display=_85e?"":"none";_855.set(this.nextButton,"id",this.id+"_next");},clearResultList:function(){var _85f=this.containerNode;while(_85f.childNodes.length>2){_85f.removeChild(_85f.childNodes[_85f.childNodes.length-2]);}this._setSelectedAttr(null);},highlightFirstOption:function(){this.selectFirstNode();},highlightLastOption:function(){this.selectLastNode();},selectFirstNode:function(){this.inherited(arguments);if(this.getHighlightedOption()==this.previousButton){this.selectNextNode();}},selectLastNode:function(){this.inherited(arguments);if(this.getHighlightedOption()==this.nextButton){this.selectPreviousNode();}},getHighlightedOption:function(){return this.selected;}});});},"dijit/form/_ListMouseMixin":function(){define("dijit/form/_ListMouseMixin",["dojo/_base/declare","dojo/mouse","dojo/on","dojo/touch","./_ListBase"],function(_860,_861,on,_862,_863){return _860("dijit.form._ListMouseMixin",_863,{postCreate:function(){this.inherited(arguments);this.own(on(this.domNode,_862.press,function(evt){evt.preventDefault();}));this._listConnect(_862.press,"_onMouseDown");this._listConnect(_862.release,"_onMouseUp");this._listConnect(_861.enter,"_onMouseOver");this._listConnect(_861.leave,"_onMouseOut");},_onMouseDown:function(evt,_864){if(this._hoveredNode){this.onUnhover(this._hoveredNode);this._hoveredNode=null;}this._isDragging=true;this._setSelectedAttr(_864);},_onMouseUp:function(evt,_865){this._isDragging=false;var _866=this.selected;var _867=this._hoveredNode;if(_866&&_865==_866){this.onClick(_866);}else{if(_867&&_865==_867){this._setSelectedAttr(_867);this.onClick(_867);}}},_onMouseOut:function(evt,_868){if(this._hoveredNode){this.onUnhover(this._hoveredNode);this._hoveredNode=null;}if(this._isDragging){this._cancelDrag=(new Date()).getTime()+1000;}},_onMouseOver:function(evt,_869){if(this._cancelDrag){var time=(new Date()).getTime();if(time>this._cancelDrag){this._isDragging=false;}this._cancelDrag=null;}this._hoveredNode=_869;this.onHover(_869);if(this._isDragging){this._setSelectedAttr(_869);}}});});},"dijit/form/_ListBase":function(){define("dijit/form/_ListBase",["dojo/_base/declare","dojo/on","dojo/window"],function(_86a,on,_86b){return _86a("dijit.form._ListBase",null,{selected:null,_listConnect:function(_86c,_86d){var self=this;return self.own(on(self.containerNode,on.selector(function(_86e,_86f,_870){return _86e.parentNode==_870;},_86c),function(evt){evt.preventDefault();self[_86d](evt,this);}));},selectFirstNode:function(){var _871=this.containerNode.firstChild;while(_871&&_871.style.display=="none"){_871=_871.nextSibling;}this._setSelectedAttr(_871);},selectLastNode:function(){var last=this.containerNode.lastChild;while(last&&last.style.display=="none"){last=last.previousSibling;}this._setSelectedAttr(last);},selectNextNode:function(){var _872=this.selected;if(!_872){this.selectFirstNode();}else{var next=_872.nextSibling;while(next&&next.style.display=="none"){next=next.nextSibling;}if(!next){this.selectFirstNode();}else{this._setSelectedAttr(next);}}},selectPreviousNode:function(){var _873=this.selected;if(!_873){this.selectLastNode();}else{var prev=_873.previousSibling;while(prev&&prev.style.display=="none"){prev=prev.previousSibling;}if(!prev){this.selectLastNode();}else{this._setSelectedAttr(prev);}}},_setSelectedAttr:function(node){if(this.selected!=node){var _874=this.selected;if(_874){this.onDeselect(_874);this.selected=null;}if(node){this.selected=node;_86b.scrollIntoView(node);this.onSelect(node);}}else{if(node){this.onSelect(node);}}}});});},"dijit/form/_AutoCompleterMixin":function(){define("dijit/form/_AutoCompleterMixin",["dojo/data/util/filter","dojo/_base/declare","dojo/dom-attr","dojo/_base/event","dojo/keys","dojo/_base/lang","dojo/query","dojo/regexp","dojo/sniff","dojo/string","./DataList","../registry","./_TextBoxMixin","./_SearchMixin"],function(_875,_876,_877,_878,keys,lang,_879,_87a,has,_87b,_87c,_87d,_87e,_87f){return _876("dijit.form._AutoCompleterMixin",_87f,{item:null,autoComplete:true,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:false,_getCaretPos:function(_880){var pos=0;if(typeof (_880.selectionStart)=="number"){pos=_880.selectionStart;}else{if(has("ie")){var tr=_880.ownerDocument.selection.createRange().duplicate();var ntr=_880.createTextRange();tr.move("character",0);ntr.move("character",0);try{ntr.setEndPoint("EndToEnd",tr);pos=String(ntr.text).replace(/\r/g,"").length;}catch(e){}}}return pos;},_setCaretPos:function(_881,_882){_882=parseInt(_882);_87e.selectInputText(_881,_882,_882);},_setDisabledAttr:function(_883){this.inherited(arguments);this.domNode.setAttribute("aria-disabled",_883?"true":"false");},_onKey:function(evt){if(evt.charCode>=32){return;}var key=evt.charCode||evt.keyCode;if(key==keys.ALT||key==keys.CTRL||key==keys.META||key==keys.SHIFT){return;}var pw=this.dropDown;var _884=null;this._abortQuery();this.inherited(arguments);if(evt.altKey||evt.ctrlKey||evt.metaKey){return;}if(this._opened){_884=pw.getHighlightedOption();}switch(key){case keys.PAGE_DOWN:case keys.DOWN_ARROW:case keys.PAGE_UP:case keys.UP_ARROW:if(this._opened){this._announceOption(_884);}_878.stop(evt);break;case keys.ENTER:if(_884){if(_884==pw.nextButton){this._nextSearch(1);_878.stop(evt);break;}else{if(_884==pw.previousButton){this._nextSearch(-1);_878.stop(evt);break;}}_878.stop(evt);}else{this._setBlurValue();this._setCaretPos(this.focusNode,this.focusNode.value.length);}case keys.TAB:var _885=this.get("displayedValue");if(pw&&(_885==pw._messages["previousMessage"]||_885==pw._messages["nextMessage"])){break;}if(_884){this._selectOption(_884);}case keys.ESCAPE:if(this._opened){this._lastQuery=null;this.closeDropDown();}break;}},_autoCompleteText:function(text){var fn=this.focusNode;_87e.selectInputText(fn,fn.value.length);var _886=this.ignoreCase?"toLowerCase":"substr";if(text[_886](0).indexOf(this.focusNode.value[_886](0))==0){var cpos=this.autoComplete?this._getCaretPos(fn):fn.value.length;if((cpos+1)>fn.value.length){fn.value=text;_87e.selectInputText(fn,cpos);}}else{fn.value=text;_87e.selectInputText(fn);}},_openResultList:function(_887,_888,_889){var _88a=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();if(!_887.length&&_889.start==0){this.closeDropDown();return;}this._nextSearch=this.dropDown.onPage=lang.hitch(this,function(_88b){_887.nextPage(_88b!==-1);this.focus();});this.dropDown.createOptions(_887,_889,lang.hitch(this,"_getMenuLabelFromItem"));this._showResultList();if("direction" in _889){if(_889.direction){this.dropDown.highlightFirstOption();}else{if(!_889.direction){this.dropDown.highlightLastOption();}}if(_88a){this._announceOption(this.dropDown.getHighlightedOption());}}else{if(this.autoComplete&&!this._prev_key_backspace&&!/^[*]+$/.test(_888[this.searchAttr].toString())){this._announceOption(this.dropDown.containerNode.firstChild.nextSibling);}}},_showResultList:function(){this.closeDropDown(true);this.openDropDown();this.domNode.setAttribute("aria-expanded","true");},loadDropDown:function(){this._startSearchAll();},isLoaded:function(){return false;},closeDropDown:function(){this._abortQuery();if(this._opened){this.inherited(arguments);this.domNode.setAttribute("aria-expanded","false");this.focusNode.removeAttribute("aria-activedescendant");}},_setBlurValue:function(){var _88c=this.get("displayedValue");var pw=this.dropDown;if(pw&&(_88c==pw._messages["previousMessage"]||_88c==pw._messages["nextMessage"])){this._setValueAttr(this._lastValueReported,true);}else{if(typeof this.item=="undefined"){this.item=null;this.set("displayedValue",_88c);}else{if(this.value!=this._lastValueReported){this._handleOnChange(this.value,true);}this._refreshState();}}},_setItemAttr:function(item,_88d,_88e){var _88f="";if(item){if(!_88e){_88e=this.store._oldAPI?this.store.getValue(item,this.searchAttr):item[this.searchAttr];}_88f=this._getValueField()!=this.searchAttr?this.store.getIdentity(item):_88e;}this.set("value",_88f,_88d,_88e,item);},_announceOption:function(node){if(!node){return;}var _890;if(node==this.dropDown.nextButton||node==this.dropDown.previousButton){_890=node.innerHTML;this.item=undefined;this.value="";}else{var item=this.dropDown.items[node.getAttribute("item")];_890=(this.store._oldAPI?this.store.getValue(item,this.searchAttr):item[this.searchAttr]).toString();this.set("item",item,false,_890);}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",_877.get(node,"id"));this._autoCompleteText(_890);},_selectOption:function(_891){this.closeDropDown();if(_891){this._announceOption(_891);}this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,true);},_startSearchAll:function(){this._startSearch("");},_startSearchFromInput:function(){this.item=undefined;this.inherited(arguments);},_startSearch:function(key){if(!this.dropDown){var _892=this.id+"_popup",_893=lang.isString(this.dropDownClass)?lang.getObject(this.dropDownClass,false):this.dropDownClass;this.dropDown=new _893({onChange:lang.hitch(this,this._selectOption),id:_892,dir:this.dir,textDir:this.textDir});this.focusNode.removeAttribute("aria-activedescendant");this.textbox.setAttribute("aria-owns",_892);}this._lastInput=key;this.inherited(arguments);},_getValueField:function(){return this.searchAttr;},postMixInProperties:function(){this.inherited(arguments);if(!this.store){var _894=this.srcNodeRef;this.store=new _87c({},_894);if(!("value" in this.params)){var item=(this.item=this.store.fetchSelectedItem());if(item){var _895=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(item,_895):item[_895];}}}},postCreate:function(){var _896=_879("label[for=\""+this.id+"\"]");if(_896.length){if(!_896[0].id){_896[0].id=this.id+"_label";}this.domNode.setAttribute("aria-labelledby",_896[0].id);}this.inherited(arguments);this.connect(this,"onSearch","_openResultList");},_getMenuLabelFromItem:function(item){var _897=this.labelFunc(item,this.store),_898=this.labelType;if(this.highlightMatch!="none"&&this.labelType=="text"&&this._lastInput){_897=this.doHighlight(_897,this._lastInput);_898="html";}return {html:_898=="html",label:_897};},doHighlight:function(_899,find){var _89a=(this.ignoreCase?"i":"")+(this.highlightMatch=="all"?"g":""),i=this.queryExpr.indexOf("${0}");find=_87a.escapeString(find);return this._escapeHtml(_899.replace(new RegExp((i==0?"^":"")+"("+find+")"+(i==(this.queryExpr.length-4)?"$":""),_89a),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,"<span class=\"dijitComboBoxHighlightMatch\">$1</span>");},_escapeHtml:function(str){str=String(str).replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;");return str;},reset:function(){this.item=null;this.inherited(arguments);},labelFunc:function(item,_89b){return (_89b._oldAPI?_89b.getValue(item,this.labelAttr||this.searchAttr):item[this.labelAttr||this.searchAttr]).toString();},_setValueAttr:function(_89c,_89d,_89e,item){this._set("item",item||null);if(_89c==null){_89c="";}this.inherited(arguments);},_setTextDirAttr:function(_89f){this.inherited(arguments);if(this.dropDown){this.dropDown._set("textDir",_89f);}}});});},"dojo/data/util/filter":function(){define("dojo/data/util/filter",["../../_base/lang"],function(lang){var _8a0={};lang.setObject("dojo.data.util.filter",_8a0);_8a0.patternToRegExp=function(_8a1,_8a2){var rxp="^";var c=null;for(var i=0;i<_8a1.length;i++){c=_8a1.charAt(i);switch(c){case "\\":rxp+=c;i++;rxp+=_8a1.charAt(i);break;case "*":rxp+=".*";break;case "?":rxp+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":rxp+="\\";default:rxp+=c;}}rxp+="$";if(_8a2){return new RegExp(rxp,"mi");}else{return new RegExp(rxp,"m");}};return _8a0;});},"dijit/form/DataList":function(){define("dijit/form/DataList",["dojo/_base/declare","dojo/dom","dojo/_base/lang","dojo/query","dojo/store/Memory","../registry"],function(_8a3,dom,lang,_8a4,_8a5,_8a6){function _8a7(_8a8){return {id:_8a8.value,value:_8a8.value,name:lang.trim(_8a8.innerText||_8a8.textContent||"")};};return _8a3("dijit.form.DataList",_8a5,{constructor:function(_8a9,_8aa){this.domNode=dom.byId(_8aa);lang.mixin(this,_8a9);if(this.id){_8a6.add(this);}this.domNode.style.display="none";this.inherited(arguments,[{data:_8a4("option",this.domNode).map(_8a7)}]);},destroy:function(){_8a6.remove(this.id);},fetchSelectedItem:function(){var _8ab=_8a4("> option[selected]",this.domNode)[0]||_8a4("> option",this.domNode)[0];return _8ab&&_8a7(_8ab);}});});},"dijit/form/_SearchMixin":function(){define("dijit/form/_SearchMixin",["dojo/data/util/filter","dojo/_base/declare","dojo/_base/event","dojo/keys","dojo/_base/lang","dojo/query","dojo/sniff","dojo/string","dojo/when","../registry"],function(_8ac,_8ad,_8ae,keys,lang,_8af,has,_8b0,when,_8b1){return _8ad("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:true,_abortQuery:function(){if(this.searchTimer){this.searchTimer=this.searchTimer.remove();}if(this._queryDeferHandle){this._queryDeferHandle=this._queryDeferHandle.remove();}if(this._fetchHandle){if(this._fetchHandle.abort){this._cancelingQuery=true;this._fetchHandle.abort();this._cancelingQuery=false;}if(this._fetchHandle.cancel){this._cancelingQuery=true;this._fetchHandle.cancel();this._cancelingQuery=false;}this._fetchHandle=null;}},_processInput:function(evt){if(this.disabled||this.readOnly){return;}var key=evt.charOrCode;if(evt.altKey||((evt.ctrlKey||evt.metaKey)&&(key!="x"&&key!="v"))||key==keys.SHIFT){return;}var _8b2=false;this._prev_key_backspace=false;switch(key){case keys.DELETE:case keys.BACKSPACE:this._prev_key_backspace=true;this._maskValidSubsetError=true;_8b2=true;break;default:_8b2=typeof key=="string"||key==229;}if(_8b2){if(!this.store){this.onSearch();}else{this.searchTimer=this.defer("_startSearchFromInput",1);}}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value.replace(/([\\\*\?])/g,"\\$1"));},_startSearch:function(text){this._abortQuery();var _8b3=this,_8af=lang.clone(this.query),_8b4={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:true}},qs=_8b0.substitute(this.queryExpr,[text]),q,_8b5=function(){var _8b6=_8b3._fetchHandle=_8b3.store.query(_8af,_8b4);if(_8b3.disabled||_8b3.readOnly||(q!==_8b3._lastQuery)){return;}when(_8b6,function(res){_8b3._fetchHandle=null;if(!_8b3.disabled&&!_8b3.readOnly&&(q===_8b3._lastQuery)){when(_8b6.total,function(_8b7){res.total=_8b7;var _8b8=_8b3.pageSize;if(isNaN(_8b8)||_8b8>res.total){_8b8=res.total;}res.nextPage=function(_8b9){_8b4.direction=_8b9=_8b9!==false;_8b4.count=_8b8;if(_8b9){_8b4.start+=res.length;if(_8b4.start>=res.total){_8b4.count=0;}}else{_8b4.start-=_8b8;if(_8b4.start<0){_8b4.count=Math.max(_8b8+_8b4.start,0);_8b4.start=0;}}if(_8b4.count<=0){res.length=0;_8b3.onSearch(res,_8af,_8b4);}else{_8b5();}};_8b3.onSearch(res,_8af,_8b4);});}},function(err){_8b3._fetchHandle=null;if(!_8b3._cancelingQuery){console.error(_8b3.declaredClass+" "+err.toString());}});};lang.mixin(_8b4,this.fetchProperties);if(this.store._oldAPI){q=qs;}else{q=_8ac.patternToRegExp(qs,this.ignoreCase);q.toString=function(){return qs;};}this._lastQuery=_8af[this.searchAttr]=q;this._queryDeferHandle=this.defer(_8b5,this.searchDelay);},constructor:function(){this.query={};this.fetchProperties={};},postMixInProperties:function(){if(!this.store){var list=this.list;if(list){this.store=_8b1.byId(list);}}this.inherited(arguments);}});});},"epi/shell/widget/SearchBox":function(){require({cache:{"url:epi/shell/widget/templates/SearchBox.html":"<div class=\"dijit dijitReset dijitInline dijitLeft dijitTextBox epi-searchInput epi-contentSearchBox\" id=\"widget_${id}\">\r\n    <span data-dojo-attach-point=\"clearButton\" class=\"dijitReset dijitRight epi-clearButton\" role=\"presentation\"></span>\r\n    <div class=\"dijitReset dijitInputField dijitInputContainer\">\r\n        <input data-dojo-attach-point=\"textbox,focusNode\" type=\"text\" class=\"dijitReset dijitInputInner\" role=\"textbox\" />\r\n        <span class=\"dijitPlaceHolder dijitInputField\" data-dojo-attach-point=\"_phspan,placeHolderNode\"></span>\r\n    </div>\r\n</div>"}});define("epi/shell/widget/SearchBox",["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/dom-style","dojo/Evented","dojo/keys","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/focus","dijit/form/TextBox","dojox/html/entities","dgrid/util/misc","dojo/text!./templates/SearchBox.html","epi/i18n!epi/shell/ui/nls/EPiServer.Shell.UI.Resources.SearchBox"],function(_8ba,lang,_8bb,_8bc,_8bd,_8be,keys,_8bf,_8c0,_8c1,_8c2,_8c3,_8c4,_8c5,_8c6,_8c7){return _8ba([_8c3,_8be],{templateString:_8c6,placeHolder:epi.resources.action.search,commonRes:epi.resources,defaultDelay:500,encodeSearchText:false,postCreate:function(){this.inherited(arguments);_8bb.set(this.clearButton,"title",_8c7.clear);this.connect(this.clearButton,"onclick",lang.hitch(this,function(){this.set("value","");this.focus();this.toggleClearButton();this._valueChanged();}));this.toggleClearButton();this.connect(this,"_onInput",_8c5.debounce(lang.hitch(this,function(_8c8){this.toggleClearButton();this._valueChanged(_8c8);}),null,this.defaultDelay));},toggleClearButton:function(){_8bd.set(this.clearButton,"visibility",this.textbox.value?"visible":"hidden");},focus:function(){_8c2.focus(this.textbox);},_setValueAttr:function(_8c9){this.textbox.value=_8c9;},_valueChanged:function(_8ca){if(_8ca&&_8ca.keyCode){switch(_8ca.keyCode){case keys.PAGE_DOWN:case keys.DOWN_ARROW:case keys.PAGE_UP:case keys.UP_ARROW:case keys.LEFT_ARROW:case keys.RIGHT_ARROW:return;}}this.emit("searchBoxChange",this.encodeSearchText?_8c4.encode(this.textbox.value):this.textbox.value);}});});},"url:epi/shell/widget/templates/SearchBox.html":"<div class=\"dijit dijitReset dijitInline dijitLeft dijitTextBox epi-searchInput epi-contentSearchBox\" id=\"widget_${id}\">\r\n    <span data-dojo-attach-point=\"clearButton\" class=\"dijitReset dijitRight epi-clearButton\" role=\"presentation\"></span>\r\n    <div class=\"dijitReset dijitInputField dijitInputContainer\">\r\n        <input data-dojo-attach-point=\"textbox,focusNode\" type=\"text\" class=\"dijitReset dijitInputInner\" role=\"textbox\" />\r\n        <span class=\"dijitPlaceHolder dijitInputField\" data-dojo-attach-point=\"_phspan,placeHolderNode\"></span>\r\n    </div>\r\n</div>","epi-cms/widget/SearchResultList":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Evented","dojo/dom-construct","dojo/dom-class","dojo/dom-style","dojox/widget/Standby","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/form/_ListMouseMixin","dijit/form/_ComboBoxMenuMixin","epi/dependency","epi-cms/widget/_ContentListKeyMixin","epi-cms/widget/_ContentListMouseMixin","epi-cms/dgrid/formatters","epi/shell/dgrid/Formatter","dgrid/OnDemandList","dgrid/Selection","dgrid/Keyboard","dojo/text!./templates/SearchResultList.html"],function(_8cb,lang,_8cc,_8cd,_8ce,_8cf,_8d0,_8d1,_8d2,_8d3,_8d4,_8d5,_8d6,_8d7,_8d8,_8d9,_8da,_8db,_8dc,_8dd){return _8cb([_8d1,_8d2,_8cc,_8d3,_8d4,_8d6,_8d7],{templateString:_8dd,_standby:null,_messages:{nextMessage:"",previousMessage:""},postCreate:function(){this.inherited(arguments);var self=this,_8de=_8d5.resolve("epi.shell.Profile"),_8df=_8cb([_8da,_8db,_8dc,_8d9]),_8e0=function(item){return item.title;},_8e1=function(item){return item.metadata.typeIdentifier;},_8e2=function(item){var _8e3=self.grid.domNode,_8e4="epi-thumbnailContentList";(item.metadata.thumbnailUrl&&!_8ce.contains(_8e3,_8e4))&&_8ce.add(_8e3,_8e4);return item.metadata.thumbnailUrl;},_8e5=function(item){if(item.metadata&&item.metadata.languageBranch!=_8de.contentLanguage){return {language:item.metadata.languageBranch};}};this.grid=new _8df({formatters:[_8d8.contentItemFactory("title",_8e0,_8e1,null,_8e2,_8e5,false)],selectionMode:"single",cellNavigation:false});this.grid.set("showHeader",false);_8cd.place(this.grid.domNode,this.containerNode);this.grid.on(".dgrid-row:click",lang.hitch(this,function(_8e6){var row=this.grid.row(_8e6);if(row){this._onSelect(row.data);}}));this._standby=new _8d0({target:this.domNode,color:"#fff"}).placeAt(document.body);this.own(this._standby);this.containerNode=this._getGridContainer();},startup:function(){this.inherited(arguments);this._standby.startup();},showStandby:function(show){if(!this._standby){return;}if(show){if(!this._standby.isVisible()){this._standby.show();}}else{this._standby.hide();}},showGrid:function(show){_8cf.set(this.grid.domNode,"display",show?"block":"none");},_onSelect:function(_8e7){this.emit("select",_8e7);},_getGridContainer:function(){return this.grid.contentNode;},createOptions:function(_8e8,_8e9,_8ea){this.grid.renderArray(_8e8);return this.containerNode.childNodes;},clearResultList:function(){this.grid.refresh();},getHighlightedOption:function(){return null;},showErrorMessage:function(show,_8eb){this.clearResultList();this.showStandby(false);if(show&&_8eb){this.errorMessage.innerHTML=_8eb;}_8cf.set(this.errorMessage,"display",show?"block":"none");}});});},"epi-cms/widget/_ContentListKeyMixin":function(){define(["dojo/_base/declare","dojo/keys"],function(_8ec,keys){return _8ec(null,{handleKey:function(evt){switch(evt.keyCode){case keys.DOWN_ARROW:this.selectNextNode();return false;case keys.UP_ARROW:this.selectPreviousNode();return false;case keys.ENTER:if(this.selected&&this.grid.row(this.selected)){this._onSelect(this.grid.row(this.selected).data);}return false;default:return true;}}});});},"epi-cms/widget/_ContentListMouseMixin":function(){define(["dojo/_base/declare","dojo/dom-class"],function(_8ed,_8ee){return _8ed(null,{onHover:function(node){},onUnhover:function(node){},onSelect:function(node){_8ee.add(node,"dgrid-selected ui-state-active dgrid-focus");},onDeselect:function(node){_8ee.remove(node,"dgrid-selected ui-state-active dgrid-focus");}});});},"url:epi-cms/widget/templates/SearchResultList.html":"<div class=\"epi-searchResultList\">\r\n    <div data-dojo-attach-point=\"containerNode\">\r\n        <div data-dojo-attach-point=\"errorMessage\" class=\"epi-searchResultListEmptyMessage\"></div>\r\n    </div>\r\n    <div class=\"dijitReset epi-searchResultListNavigation\">\r\n        <div data-dojo-attach-point=\"previousButton\" role=\"option\"></div>\r\n        <div data-dojo-attach-point=\"nextButton\" role=\"option\"></div>\r\n    </div>\r\n</div>","epi-cms/component/Media":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/on","dojo/topic","epi-cms/component/MediaViewModel","epi-cms/widget/HierarchicalList","epi/i18n!epi/cms/nls/episerver.cms.widget.hierachicallist","epi/i18n!epi/cms/nls/episerver.cms.components.media"],function(_8ef,lang,_8f0,_8f1,on,_8f2,_8f3,_8f4,_8f5,_8f6){return _8ef([_8f4],{res:_8f6,enableDndFileDropZone:true,showCreateContentArea:true,modelClassName:_8f3,noDataMessage:_8f6.nocontent,hierarchicalListClass:"epi-mediaList",createContentText:_8f6.dropareatitle,postCreate:function(){this.inherited(arguments);this.list.set("noDataMessage",this.res.nocontent);this.own(this.model.getCommand("upload").watch("canExecute",lang.hitch(this,function(name,_8f7,_8f8){this._toggleCreateContentArea(_8f8);})));},_setupList:function(){this.inherited(arguments);_8f0.add(this.list.grid.domNode,"epi-thumbnailContentList");this.own(on(this.list,"createItemAction",lang.hitch(this,function(){this.model._commandRegistry.uploadDefault.command.execute();})),on(this.list,"itemAction",lang.hitch(this,function(item){_8f2.publish("/epi/shell/context/request",{uri:item.uri},{sender:this});})));}});});},"epi-cms/component/MediaViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/when","epi/shell/widget/dialog/Dialog","epi-cms/core/ContentReference","epi-cms/widget/ContextualContentForestStoreModel","epi-cms/widget/viewmodel/HierarchicalListViewModel","epi-cms/widget/viewmodel/MultipleFileUploadViewModel","epi-cms/widget/MultipleFileUpload","epi-cms/widget/UploadUtil","epi-cms/command/UploadContent","epi-cms/command/EditImage","epi-cms/command/DownloadMedia","epi/i18n!epi/cms/nls/episerver.cms.components.media"],function(_8f9,_8fa,lang,_8fb,when,_8fc,_8fd,_8fe,_8ff,_900,_901,_902,_903,_904,_905,_906){return _8fa([_8ff],{treeStoreModelClass:_8fe,_dialog:null,_getTypesToCreate:function(){return [];},_setupCommands:function(){this.inherited(arguments);var _907={selection:this.selection,model:this};var _908={uploadDefault:{command:new _903(lang.mixin({iconClass:"epi-iconPlus",label:_906.command.label,resources:_906,viewModel:this},_907))},upload:{command:new _903(lang.mixin({category:"context",iconClass:"epi-iconUpload",label:_906.linktocreateitem,viewModel:this},_907)),isAvailable:this.menuType.ROOT|this.menuType.TREE,order:2},editImage:{command:new _904(lang.mixin({category:"context",forceContextChange:true,label:_906.command.openineditor},_907)),isAvailable:this.menuType.LIST,order:3},download:{command:new _905(lang.mixin({category:"context",label:_906.command.download},_907)),isAvailable:this.menuType.LIST,order:4}};this._commandRegistry=lang.mixin(this._commandRegistry,_908);this.pseudoContextualCommands.push(this._commandRegistry.uploadDefault.command);this.pseudoContextualCommands.push(this._commandRegistry.upload.command);},_updateTreeContextCommandModels:function(_909){this.inherited(arguments);this._commandRegistry.uploadDefault.command.set("model",_909);this._commandRegistry.upload.command.set("model",_909);},upload:function(_90a,_90b,_90c){var _90d=new _901({model:new _900({store:this.get("store"),query:this.get("listQuery")})});_90d.on("beforeUploaderChange",lang.hitch(this,function(){this._uploading=true;}));_90d.on("close",lang.hitch(this,function(_90e){this._dialog&&(_90e?this._dialog.hide():this._dialog.destroy());}));_90d.on("uploadComplete",lang.hitch(this,function(_90f){if(_90d.createAsLocalAsset){when(this.treeStoreModel&&typeof this.treeStoreModel.refreshRoots==="function"&&this.treeStoreModel.refreshRoots(this),lang.hitch(this,function(){_90d.set("createAsLocalAsset",false);_90d.set("uploadDirectory",this.get("currentTreeItem").id);_90d.model.set("query",this.get("listQuery"));}));}else{this.onListItemUpdated(_90f);this.set("currentTreeItem",this.get("currentTreeItem"));}if(this._dialog&&!this._dialog.open){this._dialog.destroy();}this._uploading=false;}));this._dialog=new _8fc({title:_906.linktocreateitem,content:_90d,autofocus:_902.supportNativeDndFiles(),defaultActionsVisible:false,closeIconVisible:false});_8fb.add(this._dialog.domNode,"epi-multiFileUploadDialog");this._dialog.definitionConsumer.add({name:"close",label:"Close",action:function(){_90d.close();}});this._dialog.resize({w:700});this._dialog.show();var _910=_90c?this.selection.data[0].data:this.store.get(_90b);when(_910,lang.hitch(this,function(_911){this._buildBreadcrumb(_911,_90d);_90d.set("uploadDirectory",_90b||this.get("currentTreeItem").id);_90d.set("createAsLocalAsset",_90c);_90d.upload(_90a);}));},onListItemUpdated:function(_912){var _913=this.store;return when(this.getCurrentContext(),function(_914){var _915=(new _8fd(_914.id)).createVersionUnspecificReference().toString();return when(_913.get(_915),function(_916){var _917=_8f9.filter(_912,function(_918){return _916.name.toLowerCase()===_918.fileName.toLowerCase();})[0];return _917?_916:null;});});},_buildBreadcrumb:function(_919,_91a){if(!_91a){return;}if(this.treeStoreModel.isTypeOfRoot(_919)){_91a.set("breadcrumb",[_919]);return;}this.treeStoreModel.getAncestors(_919.contentLink,lang.hitch(this,function(_91b){var _91c,_91d=[_919];for(var i=_91b.length-1;i>=0;i--){_91c=_91b[i];_91d.unshift(_91c);if(this.treeStoreModel.isTypeOfRoot(_91c)){break;}}_91a.set("breadcrumb",_91d);}));}});});},"epi-cms/widget/viewmodel/HierarchicalListViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/Stateful","dojo/when","epi","epi/dependency","epi/shell/ClipboardManager","epi/shell/command/_CommandProviderMixin","epi/shell/selection","epi/shell/TypeDescriptorManager","epi-cms/_ContentContextMixin","epi-cms/_MultilingualMixin","epi-cms/contentediting/_ContextualContentContextMixin","epi-cms/core/ContentReference","epi-cms/widget/ContentForestStoreModel","epi-cms/widget/command/NewFolder","epi-cms/command/RenameFolder","epi-cms/widget/CreateCommandsMixin","epi-cms/command/NewContent","epi-cms/command/CopyContent","epi-cms/command/CutContent","epi-cms/command/DeleteContent","epi-cms/command/PasteContent","epi-cms/command/TranslateContent","epi-cms/component/command/ViewTrash","epi-cms/component/command/ChangeContext"],function(_91e,_91f,lang,_920,_921,when,epi,_922,_923,_924,_925,_926,_927,_928,_929,_92a,_92b,_92c,_92d,_92e,_92f,_930,_931,_932,_933,_934,_935,_936){return _91f([_921,_927,_929,_928,_92e],{menuType:{ROOT:1,TREE:2,LIST:4},searchArea:"",searchRoots:"",clipboardManager:null,selection:null,commands:null,createCommands:null,createHierarchyCommands:null,pseudoContextualCommands:null,currentTreeItem:null,currentListItem:null,listQuery:null,listQueryOptions:null,showAllLanguages:true,treeStoreModelClass:_92b,treeStoreModel:null,store:null,storeKey:"epi.cms.content.light",mainNavigationTypes:null,containedTypes:null,_showAllLanguagesSetter:function(_937){this.showAllLanguages=_937;this._updateListQuery(this.currentTreeItem);this.treeStoreModel.set("showAllLanguages",_937);},_currentTreeItemSetter:function(_938){this.currentTreeItem=_938;this._updateListQuery(_938);},postscript:function(args){this.inherited(arguments);this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_922.resolve("epi.cms.contentRepositoryDescriptors");_91f.safeMixin(this,this.contentRepositoryDescriptors[args.repositoryKey]);this.clipboardManager=this.clipboardManager||new _923();this.selection=this.selection||new _925();this.store=this.store||_922.resolve("epi.storeregistry").get(this.storeKey);this._setupTreeStoreModel();this._setupCommands();this.set("commands",this._commandRegistry.toArray());this._setupSearchRoots();this.set("listQueryOptions",this.treeStoreModel._queryOptions);},startup:function(){this.inherited(arguments);this._setupSelection();},getCommand:function(_939){return this._commandRegistry[_939]?this._commandRegistry[_939].command:null;},contentContextChanged:function(_93a,_93b){this._setupSearchRoots();if(!this._isSupportedContent(_93a)){return;}var self=this,_93c=self.get("currentListItem"),_93d=self.treeStoreModel.get("previousSelection"),_93e=_92a.toContentReference(_93a.id);when(self.store.get(_93e.createVersionUnspecificReference()),function(_93f){var _940=_93d&&self.hasContextual(_93d.selectedAncestors)?_93f.assetsFolderLink:_93a.parentLink,_941=_92a.toContentReference(_93d?_940:self.roots[0]);self.set("editingListItem",_93e);if(_93b&&_93b.forceReload||!_92a.compareIgnoreVersion(_93c,_93e)){when(self.store.get(_941.createVersionUnspecificReference()),function(_942){self.treeStoreModel&&when(self.treeStoreModel.canExpandTo(_942),function(_943){if(_943){self.set("currentTreeItem",_941);self.set("currentListItem",_93e);self._updateCommands(_942,self.menuType.LIST);}});});}});},onSearch:function(_944){when(this.store.get(_944.id),lang.hitch(this,function(_945){var _946=_92a.toContentReference(_945.contentLink);this.set("editingListItem",_946);this.set("currentListItem",_946);this.set("currentTreeItem",_92a.toContentReference(_945.parentLink));this._updateCommands(_945,this.menuType.LIST);}));},onTreeItemSelected:function(_947,_948){var _949=this.get("currentTreeItem"),_94a=_92a.toContentReference(_947.contentLink),_94b=_948?this.menuType.ROOT:this.menuType.TREE;this._updateCommands(_947,_94b);if(!_92a.compareIgnoreVersion(_949,_94a)&&_92a.emptyContentReference!=_94a){this.set("currentTreeItem",_94a);}},onListItemSelected:function(_94c){var _94d=this.get("currentListItem"),_94e=_92a.toContentReference(_94c.contentLink);this._updateCommands(_94c,this.menuType.LIST);if(!_92a.compareIgnoreVersion(_94d,_94e)){this.set("currentListItem",_94e);}},onListItemUpdated:function(_94f){},_isSupportedContent:function(_950){return !!(_950&&_950.id)&&this.containedTypes.some(function(type){return _926.isBaseTypeIdentifier(_950.dataType,type);});},_setupSelection:function(){when(this.getCurrentContext(),lang.hitch(this,function(ctx){var _951;if(!this._isContentContext(ctx)||!this._isSupportedContent(ctx)){_951=_92a.toContentReference(this.roots[0]).toString();when(this.store.get(_951),lang.hitch(this,function(_952){this.onTreeItemSelected(_952,true);}));}else{this.contentContextChanged(ctx,null);}}));},_setupTreeStoreModel:function(){var _953=new this.treeStoreModelClass({store:this.store,roots:this.roots,typeIdentifiers:this.mainNavigationTypes,containedTypes:this.containedTypes,notAllowToCopy:this.preventCopyingFor,notAllowToDelete:this.preventDeletionFor,notSupportContextualContents:this.preventContextualContentFor,onAddDelegate:lang.hitch(this,function(node){var _954=dijit.getEnclosingWidget(node.domNode),_955=_954&&_954.item,_956=(typeof (this.treeStoreModel.canEdit)==="function")&&this.treeStoreModel.canEdit(_955);if(_956){node.edit();var _957=function(){_920.publish("/epi/cms/contentdata/childrenchanged",_955.parentLink);};var _958=node.on("rename",function(){_958.remove();_957();});var _959=node.on("cancelEdit",function(){_959.remove();_957();});}}),onRefreshRoots:lang.hitch(this,this._setupSearchRoots),additionalQueryOptions:{sort:this._getSortSettings()}});this.set("treeStoreModel",_953);},_getSortSettings:function(){return [{attribute:"name",descending:false}];},_setupSearchRoots:function(){when(this.getCurrentContent(),lang.hitch(this,function(_95a){var _95b=this.roots instanceof Array&&this.roots.length>0?lang.clone(this.roots):[],_95c=_95a&&_95a.assetsFolderLink;if(_95c&&typeof this._getPseudoContextualContent==="function"&&_95c!=this._getPseudoContextualContent()){_95b.push(_95c);}this.set("searchRoots",_95b.join(","));}));},_setupCommands:function(){var _95d=this.menuType;var _95e={category:"context",model:this.treeStoreModel,selection:this.selection,clipboard:this.clipboardManager};this.createHierarchyCommands={};var _95f=1;_91e.forEach(this.mainNavigationTypes,function(type){this.createHierarchyCommands[type]={command:new _92c(lang.mixin({typeIdentifier:type},_95e)),isAvailable:_95d.ROOT|_95d.TREE,order:_95f};_95f=_95f+1;},this);this.createCommands=this.getCreateCommands(_95f);var _960={rename:{command:new _92d({category:"context"}),isAvailable:_95d.TREE,order:10},cut:{command:new _931(_95e),isAvailable:_95d.TREE|_95d.LIST,order:20},copy:{command:new _930(_95e),isAvailable:_95d.TREE|_95d.LIST,order:30},paste:{command:new _933(_95e),isAvailable:_95d.ROOT|_95d.TREE,order:40},edit:{command:new _936({category:"context",forceContextChange:true}),isAvailable:this.menuType.LIST,order:3},translate:{command:new _934(),isAvailable:this.menuType.TREE|this.menuType.LIST},"delete":{command:new _932(_95e),isAvailable:_95d.TREE|_95d.LIST,order:50},trash:{command:new _935({typeIdentifiers:this.mainNavigationTypes}),order:60},sort:function(){var _961=[];for(var key in this){if(key!=="toArray"&&key!=="sort"&&this.hasOwnProperty(key)){var _962=this[key].order;if(!_962){_962=100;}_961.push([_962,this[key].command]);}}_961.sort(function(a,b){return a[0]-b[0];});return _961;},toArray:function(){var _963=this.sort();var _964=[];_91e.forEach(_963,function(key){_964.push(key[1]);});return _964;}};this._commandRegistry=lang.mixin(this._commandRegistry,this.createHierarchyCommands,this.createCommands,_960);this.pseudoContextualCommands=this._getPseudoContextualCommands();},_updateListQuery:function(_965){var id,_966=null;var _967=_91e.filter(this.containedTypes,function(item){return this.mainNavigationTypes.indexOf(item)<0;},this);if(_965){id=_965.toString(),_966=this._createListChildrenQuery(id,this.showAllLanguages,_967);}this.set("listQuery",_966);},_createListChildrenQuery:function(id,_968,_969){return {referenceId:id,query:"getchildren",allLanguages:_968,typeIdentifiers:_969};},_updateSelection:function(_96a){this.selection.set("data",_96a?[{type:"epi.cms.contentdata",data:_96a}]:[]);},_updateCommands:function(_96b,_96c){this._updateSelection(_96b);if(typeof this.treeStoreModel.isSupportedType==="function"&&this.treeStoreModel.isSupportedType(_96b.typeIdentifier)){this._updateTreeContextCommandModels(_96b);this.decoratePseudoContextualCommands(this.pseudoContextualCommands);}this._commandRegistry.translate.command.set("model",_96b);this._commandRegistry.translate.command.set("executeDelegate",null);this._commandRegistry.edit.command.set("model",_96b);this._updateCommandAvailability(_96c);},_updateTreeContextCommandModels:function(_96d){this._updateCreateCommandModels(_96d);this._commandRegistry.rename.command.set("model",_96d);},_updateCreateCommandModels:function(_96e){var _96f=this.createCommands;for(var key in _96f){_96f[key].command.set("model",_96e);}},_getPseudoContextualCommands:function(){var key,_970=[];for(key in this.createCommands){_970.push(this.createCommands[key].command);}for(key in this.createHierarchyCommands){_970.push(this.createHierarchyCommands[key].command);}_970.push(this._commandRegistry.paste.command);return _970;},_updateCommandAvailability:function(_971){var _972=this._commandRegistry,_973;for(var key in _972){if(key!=="toArray"&&_972.hasOwnProperty(key)){_973=_972[key].isAvailable;if(_973){var _974=_972[key].command;this._updateAvailabilityForSpecificCommand(_974,_971,_973);}}}},_updateAvailabilityForSpecificCommand:function(_975,_976,_977){if(!_975.isInstanceOf(_934)){_975.set("isAvailable",!!(_977&_976));}},upload:function(_978){}});});},"epi/shell/ClipboardManager":function(){define("epi/shell/ClipboardManager",["dojo/_base/declare","dojo/Stateful"],function(_979,_97a){return _979(_97a,{copy:true,data:null,constructor:function(){this.data=[];},clear:function(){this.set("data",null);},isCopy:function(){return this.get("copy");},setDataObject:function(_97b,copy){this.set("copy",copy);this.set("data",_97b);},getDataObject:function(){return this.data;},containsData:function(){return !!this.data;}});});},"epi/shell/selection":function(){define("epi/shell/selection",["dojo/_base/declare","./StatefulArray"],function(_97c,_97d){return _97c(_97d,{data:null,constructor:function(){this.data=[];}});});},"epi-cms/_MultilingualMixin":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/when","dojo/_base/lang","epi/dependency","epi-cms/ApplicationSettings","epi-cms/component/SiteTreeModel"],function(_97e,_97f,when,lang,_980,_981,_982){return _97e([],{isMultilingual:false,_application:null,_siteTreeModel:null,_cachedValue:undefined,constructor:function(_983){lang.mixin(this,_983);},_isSiteMultilingual:function(){var _984=new _97f();if(this._cachedValue!==undefined){_984.resolve(this._cachedValue);}if(!this._siteTreeModel){var _985=_980.resolve("epi.storeregistry"),_986=_985.get("epi.cms.sitestructure");this._siteTreeModel=new _982({store:_986});}when(this._siteTreeModel.getAllLanguagesForCurrentSite(),lang.hitch(this,function(_987){this._cachedValue=_987.length>=2;_984.resolve(this._cachedValue);}));return _984;},_contentExistsInCurrentLanguage:function(_988){if(!_988){return false;}if(_988.capabilities&&!_988.capabilities.language){return true;}if(!_988.currentLanguageBranch){return false;}return _981.currentContentLanguage===_988.currentLanguageBranch.languageId;}});});},"epi-cms/widget/command/NewFolder":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi/shell/command/_Command","epi/shell/command/_SelectionCommandMixin","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport"],function(_989,_98a,lang,_98b,when,_98c,_98d,_98e,_98f,_990){return _98a([_98c,_98d],{iconClass:"epi-iconFolder",typeIdentifier:null,createAsLocalAsset:false,_defaultName:null,postscript:function(){this.inherited(arguments);var _991=this.typeIdentifier;this._defaultName=_98e.getResourceValue(_991,"newitemdefaultname");var _992=_98e.getResourceValue(_991,"create");this.set("label",_992);this.set("tooltip",_992);},_execute:function(){var self=this,_993=self.get("selectionData"),_994=(new _98f(_993.contentLink)).createVersionUnspecificReference().toString(),_995=self.createAsLocalAsset;var _996=function(_997){self.model.getChildren(_997,function(_998){when(self.model.add({parentLink:_994,name:self._getUniqueFolderName(_998,self._defaultName),contentTypeIdentifier:self.typeIdentifier,createAsLocalAsset:_995},self.onRefreshSelection),function(_999){if(_999.parentLink!=_994){_98b.publish("/epi/cms/action/createlocalasset");}});});};if(_995){when(self.model.store.refresh(_994),function(_99a){when(self.model.store.get(_99a.assetsFolderLink),_996);});}else{_996(_993);}},_onModelChange:function(){var _99b=this.get("selectionData"),_99c=_990.action.Create,_99d=_990.providerCapabilities.Create,_99e=this.model&&_99b&&_990.isActionAvailable(_99b,_99c,_99d,true);this.set("canExecute",!!_99e);},_getUniqueFolderName:function(arr,_99f){var _9a0=function(_9a1){var name=_9a1>0?lang.replace(_99f+" {0}",[_9a1]):_99f;if(_9a1>1000){return name;}var _9a2=_989.some(arr,function(_9a3){return lang.trim(_9a3.name).toLowerCase()===lang.trim(name).toLowerCase();});if(_9a2){_9a1=_9a1+1;return _9a0(_9a1);}return name;};return _9a0(0);}});});},"epi-cms/command/RenameFolder":function(){define(["dojo/_base/declare","epi","epi-cms/_MultilingualMixin","epi-cms/contentediting/ContentActionSupport","epi/shell/command/_Command"],function(_9a4,epi,_9a5,_9a6,_9a7){return _9a4([_9a7,_9a5],{label:epi.resources.action.rename,contentActionSupport:null,renameDelegate:null,typeIdentifier:"episerver.core.contentfolder",postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_9a6;},_execute:function(){this.renameDelegate(this.model);},_onModelChange:function(){var _9a8=this.renameDelegate&&this.model&&this.model.typeIdentifier===this.typeIdentifier&&this.contentActionSupport.hasAccess(this.model.accessMask,_9a6.accessLevel[_9a6.action.Edit])&&this._contentExistsInCurrentLanguage(this.model);this.set("canExecute",_9a8);}});});},"epi-cms/widget/CreateCommandsMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","epi/dependency","../command/PopupCommand","../command/NewContent","epi/i18n!epi/nls/episerver.shared"],function(_9a9,_9aa,lang,_9ab,_9ac,_9ad,_9ae){return _9aa([],{contentRepositoryDescriptors:null,typeDescriptorManager:null,createCommandClass:_9ad,repositoryKey:null,category:null,isAvailableFlags:null,postscript:function(){this.inherited(arguments);if(!this.repositoryKey){throw "You need to specify the repositoryKey field";}this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_9ab.resolve("epi.cms.contentRepositoryDescriptors");_9aa.safeMixin(this,this.contentRepositoryDescriptors[this.repositoryKey]);this.commandCategory=this.commandCategory||"context";var _9af={ROOT:1,TREE:2,LIST:4};this.isAvailableFlags=this.isAvailableFlags||_9af.ROOT|_9af.TREE;},getCreateCommands:function(_9b0){var _9b1={};var _9b2=_9b0||1;if(!this.creatableTypes){return _9b1;}_9a9.forEach(this.creatableTypes,function(type){_9b1[type]={command:this._createCommand(type),isAvailable:this.isAvailableFlags,order:_9b2};_9b2=_9b2+1;},this);if(this.creatableTypes.length<2){return _9b1;}var _9b3=new _9ac({label:_9ae.action["new"],commands:_9b1});return {popupCommand:{command:_9b3,order:_9b0}};},_createCommand:function(type){return new this.createCommandClass({contentType:type,category:this.commandCategory});}});});},"epi-cms/command/PopupCommand":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Stateful","epi/shell/command/_Command","epi/shell/command/_CommandProviderMixin","epi/shell/widget/ContextMenu"],function(_9b4,_9b5,_9b6,_9b7,_9b8,_9b9){return _9b5([_9b7,_9b8],{category:"popup",canExecute:true,popup:null,popupClass:_9b9,popupCategory:"context",_commandsSetter:function(_9ba){if(!_9ba){return;}var _9bb=[];if(_9ba instanceof Array){_9bb=_9ba;}else{for(var _9bc in _9ba){_9bb.push(_9ba[_9bc].command);}}this.commands=_9bb;this._updateIsAvailable();},_popupSetter:function(_9bd){this.popup=_9bd;_9bd.addProvider(this);},_updateIsAvailable:function(){var _9be=_9b4.some(this.get("commands"),function(_9bf){return _9bf.get("isAvailable");});this.set("isAvailable",_9be);},_onModelChange:function(){this.updateCommandModel(this.model);this._updateIsAvailable();}});});},"epi-cms/command/NewContent":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/topic","dojo/when","dojo/promise/all","epi/dependency","epi/shell/command/_Command","epi/shell/TypeDescriptorManager","epi-cms/contentediting/ContentActionSupport"],function(_9c0,_9c1,lang,_9c2,_9c3,when,all,_9c4,_9c5,_9c6,_9c7){return _9c1([_9c5],{contentType:null,createAsLocalAsset:false,canChangeLocalAssetName:true,postscript:function(){this.inherited(arguments);var _9c8=this.contentType;this.label=this.label||_9c6.getResourceValue(_9c8,"create");this.tooltip=this.tooltip||_9c6.getResourceValue(_9c8,"createdescription");this.iconClass=this.iconClass||_9c6.getValue(_9c8,"commandIconClass");if(!this.store){var _9c9=_9c4.resolve("epi.storeregistry");this.store=_9c9.get("epi.cms.contenttype");}},_execute:function(){_9c3.publish("/epi/shell/action/changeview","epi-cms/contentediting/CreateContent",null,{requestedType:this.contentType,parent:this.model,createAsLocalAsset:this.createAsLocalAsset,canChangeLocalAssetName:this.canChangeLocalAssetName,view:_9c6.getValue(this.contentType,"createView")});},_onModelChange:function(){if(this.model&&this.model instanceof Array){if(this.model.length==1){this.model=this.model[0];}else{this.model=null;}}var _9ca=this.model,_9cb=_9c7.action.Create,_9cc=_9c7.providerCapabilities.Create,_9cd=_9ca&&!(_9ca.isWastebasket||_9ca.isDeleted)&&_9c7.hasLanguageAccess(_9ca)&&_9c7.isActionAvailable(_9ca,_9cb,_9cc,true);this.set("canExecute",!!_9cd);if(!_9ca){return;}when(this._getContentType(_9ca),lang.hitch(this,function(_9ce){if(!_9ce){this.set("isAvailable",false);return;}when(this._checkAvailability(_9ce.availableContentTypes),lang.hitch(this,function(_9cf){this.set("isAvailable",_9cf);}));}));},_getContentType:function(_9d0){if(!_9d0){return null;}return this.store.get(_9d0.contentTypeID);},_checkAvailability:function(_9d1){if(_9d1.length===0){return false;}var _9d2=new _9c2();var _9d3=_9c0.map(_9d1,lang.hitch(this,function(_9d4){return this.store.get(_9d4);}));when(all(_9d3),lang.hitch(this,function(_9d5){var _9d6=_9c0.some(_9d5,lang.hitch(this,function(_9d7){return _9c6.isBaseTypeIdentifier(_9d7.typeIdentifier,this.contentType);}));_9d2.resolve(_9d6);}));return _9d2;}});});},"epi-cms/command/CopyContent":function(){define(["dojo/_base/declare","dojo/_base/array","epi","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin"],function(_9d8,_9d9,epi,_9da,_9db,_9dc){return _9d8([_9da,_9db,_9dc],{label:epi.resources.action.copy,iconClass:"epi-iconCopy",_execute:function(){this.clipboard.set("copy",true);this.clipboard.set("data",this.selection.data.concat());},_onModelChange:function(){var _9dd=this.model,_9de=this.selection.data,_9df=false;if(_9dd&&_9de.length){_9df=_9d9.every(_9de,function(item){return _9dd.canCopy(item.data);});}this.set("canExecute",_9df);}});});},"epi-cms/command/CutContent":function(){define(["dojo/_base/array","dojo/_base/declare","epi","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin"],function(_9e0,_9e1,epi,_9e2,_9e3,_9e4){return _9e1([_9e2,_9e3,_9e4],{label:epi.resources.action.cut,iconClass:"epi-iconCut",_execute:function(){this.clipboard.set("copy",false);this.clipboard.set("data",this.selection.data.concat());},_onModelChange:function(){var _9e5=this.model,_9e6=this.selection.data,_9e7=false;if(_9e5&&_9e6.length){_9e7=_9e0.every(_9e6,function(item){return _9e5.canCut(item.data);});}this.set("canExecute",_9e7);}});});},"epi-cms/command/DeleteContent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/topic","dojo/when","epi-cms/ApplicationSettings","epi-cms/contentediting/ContentActionSupport","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin","epi/i18n!epi/cms/nls/episerver.cms.command","epi/i18n!epi/nls/episerver.shared"],function(_9e8,lang,_9e9,_9ea,when,_9eb,_9ec,_9ed,_9ee,_9ef,_9f0,_9f1){return _9e8([_9ed,_9ee,_9ef],{label:_9f0.movetotrash,iconClass:"epi-iconTrash",hasWastebasket:true,_execute:function(){var _9f2=this.model,_9f3=this.clipboard,_9f4=this.selection.data,_9f5=this.hasWastebasket?_9f2.move(_9f4,{contentLink:_9eb.wastebasketPage,isWastebasket:true}):_9f2.remove(_9f4);return when(_9f5,lang.hitch(this,function(){var _9f6=[];if(_9f3&&_9f3.data){_9f4.forEach(function(_9f7){var map=_9f3.data.map(function(_9f8){return _9f2.isAncestor(_9f7.data,_9f8.data);});_9f6=_9f6.concat(map);});}when(_9e9(_9f6),function(_9f9){var _9fa=_9f9.every(function(_9fb){return _9fb;});if(_9fa){_9f3.clear();}});}),lang.hitch(this,function(){_9ea.publish("/epi/cms/action/delete/error");}));},_hasWastebasketSetter:function(_9fc){this.hasWastebasket=_9fc;this.set("iconClass",_9fc?"epi-iconTrash":"epi-iconClose");this.set("label",_9fc?_9f0.movetotrash:_9f1.action.deletelabel);},_onModelChange:function(){var _9fd=this.model,_9fe=this.selection.data,_9ff=function(item){var _a00=item.data;return _a00&&!_a00.isDeleted&&_9fd.canDelete(_a00);},_a01=function(item){var _a02=item.data;return _a02&&_9ec.hasProviderCapability(_a02.providerCapabilityMask,_9ec.providerCapabilities.Wastebasket);};this.set("hasWastebasket",!!_9fe.length&&_9fe.every(_a01));this.set("canExecute",!!(_9fd&&_9fe.length)&&_9fe.every(_9ff)&&(this.hasWastebasket||!_9fe.some(_a01)));}});});},"epi-cms/command/PasteContent":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","epi","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin"],function(_a03,_a04,lang,_a05,when,epi,_a06,_a07,_a08){return _a04([_a06,_a07,_a08],{label:epi.resources.action.paste,iconClass:"epi-iconPaste",createAsLocalAsset:false,_execute:function(){var _a09=this.get("clipboardData"),_a0a=this.get("selectionData");this.model.set("createAsLocalAsset",this.createAsLocalAsset);if(this.clipboard.copy){return this.model.copy(_a09,_a0a);}else{return when(this.model.move(_a09,_a0a),lang.hitch(this,function(){this.clipboard.clear();}));}},_onModelChange:function(){var self=this,_a0b=self.model,_a0c=self.get("clipboardData"),_a0d=self.get("selectionData");self.set("canExecute",false);if(_a0b&&_a0c&&_a0c.length&&_a0d){var _a0e=_a03.map(_a0c,function(item){return _a0b.canPaste(item.data,_a0d,self.clipboard.copy);});when(_a05(_a0e),function(_a0f){var _a10=_a03.every(_a0f,function(_a11){return _a11;});if(self.clipboard.copy){self.set("canExecute",_a10);return;}_a0b.getAncestors(_a0d,function(_a12){var _a13=_a03.some(_a0c,function(item){return _a03.indexOf(_a12,item.data)>=0;});self.set("canExecute",_a10&&!_a13);});});}}});});},"epi-cms/component/command/ViewTrash":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/topic","epi/dependency","epi/shell/command/_Command","epi-cms/ApplicationSettings","epi/i18n!epi/cms/nls/episerver.cms.command"],function(_a14,lang,_a15,_a16,_a17,_a18,_a19,_a1a){return _a14([_a18],{label:_a1a.viewtrash,category:"setting",_wasteBasketId:null,typeIdentifiers:null,postscript:function(){this.inherited(arguments);this.set("canExecute",false);this._wasteBasketId=_a19.wastebasketPage;var _a1b=_a17.resolve("epi.storeregistry").get("epi.cms.content.light");_a15.when(_a1b.get(this._wasteBasketId),lang.hitch(this,function(_a1c){this.set("canExecute",(_a1c.statusCode!="401"));}));},_execute:function(){_a16.publish("/epi/shell/context/request",{uri:"epi.cms.contentdata:///"+this._wasteBasketId},{sender:this,typeIdentifiers:this.typeIdentifiers});}});});},"epi-cms/component/command/ChangeContext":function(){define(["dojo/_base/declare","dojo/topic","epi-cms/contentediting/ContentActionSupport","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_a1d,_a1e,_a1f,_a20,_a21){return _a1d([_a20],{contentActionSupport:null,forceContextChange:false,viewType:null,viewName:null,postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_a1f;},_execute:function(){_a1e.publish("/epi/shell/context/request",{uri:this.model.uri},{sender:null,forceContextChange:this.forceContextChange,viewType:this.viewType,viewName:this.viewName});},_onModelChange:function(){if(this.model&&this.model.length==1){this.model=this.model[0];}var _a22=this.model&&this.model.contentLink;this.set("canExecute",!!_a22);if(_a22&&this.model.accessMask){if(this.contentActionSupport.hasAccess(this.model.accessMask,this.contentActionSupport.accessLevel[this.contentActionSupport.action.Edit])){this.set("label",_a21.edit);this.set("iconClass","epi-iconPen");}else{this.set("label",_a21.view);this.set("iconClass","epi-iconSearch");}}}});});},"epi-cms/widget/viewmodel/MultipleFileUploadViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/when","dojo/Stateful","epi/shell/_StatefulGetterSetterMixin"],function(_a23,_a24,when,_a25,_a26){return _a24([_a25,_a26],{upload:function(_a27){return when(this._filterUploadingFiles(_a27),function(_a28){if(!_a28||!(_a28.existingContents instanceof Array)||_a28.existingContents.length===0){return {showConfirmation:false,uploadingFiles:_a27};}return {showConfirmation:true,uploadingFiles:_a27,newFiles:_a28.newFiles,existingContents:_a28.existingContents};});},_filterUploadingFiles:function(_a29){var self=this;if(!self.store){return null;}return when(self.store.query(self.get("query")),function(_a2a){var _a2b=_a23.filter(_a2a,function(_a2c){return _a23.some(_a29,function(file){return file.name.toLowerCase()===_a2c.name.toLowerCase();});});var _a2d=_a23.filter(_a29,function(file){return _a23.every(_a2a,function(_a2e){return file.name.toLowerCase()!==_a2e.name.toLowerCase();});});return {existingContents:_a2b,newFiles:_a2d};});}});});},"epi-cms/widget/MultipleFileUpload":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/aspect","dojo/when","dojo/Evented","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/Toolbar","dojox/form/Uploader","dojox/form/uploader/plugins/Flash","epi/routes","epi/shell/widget/dialog/Alert","epi-cms/widget/Breadcrumb","epi-cms/widget/FileList","epi-cms/widget/MultipleFileUploadConfirmation","epi-cms/widget/UploadUtil","epi-cms/widget/viewmodel/FileListViewModel","dojo/text!./templates/MultipleFileUpload.html","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles"],function(_a2f,_a30,lang,_a31,_a32,_a33,_a34,when,_a35,_a36,_a37,_a38,_a39,_a3a,_a3b,_a3c,_a3d,_a3e,_a3f,_a40,_a41,_a42,_a43,_a44){return _a30([_a36,_a37,_a38,_a35],{res:_a44,_isCompleted:true,_uploadStatus:[],templateString:_a43,postCreate:function(){this.inherited(arguments);this._setupUploader();this._setupFileList();this._confirmationDialog=this._confirmationDialog||new _a40();},upload:function(_a45){var self=this,_a46=self.uploaderInput,_a47=self._getUploadSettings();when(self.model.upload(_a45),function(_a48){when(self._confirm(_a48),function(_a49){self._resetUploader();if(!(_a49 instanceof Array)||_a49.length===0){return;}self._fileListModel.set("uploadFiles",_a49);_a46._files=_a49;_a46.upload(_a47);});});},close:function(){var self=this,_a4a=self.uploaderInput._files,_a4b=function(_a4c){self.emit("close",_a4c);self.set("disableToolbar",false);};if(self._isCompleted||!_a4a||_a4a.length<=0){_a4b(false);}else{var _a4d=new _a3d({description:_a44.confirmdialog.description,onAction:function(){_a4b(true);}});_a4d.show();}},_setUploadStatusAttr:function(_a4e,_a4f,_a50){this._uploadStatus=_a41.addStatus(this._uploadStatus,_a4e,_a4f,_a50);},_getUploadStatusAttr:function(){return this._uploadStatus;},_setBreadcrumbAttr:function(_a51){this.breadcrumbBar._cleanUp();this.breadcrumbBar._availableWidth=_a32.getContentBox(this.breadcrumbBar.domNode).w;var i=0,_a52=_a51?_a51.length:0;if(_a52>0){for(i;i<_a52-1;i++){this.breadcrumbBar._createItem(_a51[i],true);}this.breadcrumbBar._createItem(_a51[_a52-1],false);}},_setDisableToolbarAttr:function(_a53){var _a54=this.uploaderInput;if(_a41.supportNativeDndFiles()){_a54.set("disabled",_a53);!_a53&&_a54.set("tabindex",0);}else{_a31.toggle(this.toolbarDisableLayer,"epi-uploadToolbarOverlay",_a53);_a41.toggleVisibility(this.toolbarDisableLayer,_a53);_a54.flashMovie&&(_a53===false?_a54.flashMovie.focus():_a54.flashMovie.blur());if(_a53===true&&!this._toolbarSize){this._toolbarSize=_a32.position(this.uploadToolbar);_a33.set(this.toolbarDisableLayer,{"width":this._toolbarSize.w+"px","height":this._toolbarSize.h+"px"});}}},_setupUploader:function(){this._setupUploaderDefault();this._setupUploaderHtml5Plugin();this._setupUploaderFlashPlugin();},_setupUploaderDefault:function(){var self=this,_a55=self.uploaderInput;_a55.uploadUrl=_a3c.getActionPath({moduleArea:"CMS",controller:"FileUpload",action:"Upload"});self.own(_a34.before(_a55,"onChange",function(_a56){self._isCompleted=false;self.set("disableToolbar",true);return [self._getUploadSettings()];}));},_setupUploaderHtml5Plugin:function(){if(!_a41.supportNativeDndFiles()){return;}var self=this;self.own(self.uploaderInput.on("error",function(err){self.set("uploadStatus",_a41.StatusScope.All,"",_a44.uploadform.errormessage);self._onUploadComplete();}));},_setupUploaderFlashPlugin:function(){if(_a41.supportNativeDndFiles()){return;}var self=this;self.own(self.uploaderInput.on("error",function(err){self.set("uploadStatus",_a41.StatusScope.Single,err.target&&err.target.name,_a44.uploadform.errormessage);}));self._setFlashUploaderSize();self._setFocusOnFlash();},_setFlashUploaderSize:function(){this.own(_a34.around(this.uploaderInput,"_createInput",function(_a57){return function(){var _a58=lang.clone(this.btnSize);this.btnSize.w+=10;this.btnSize.h+=10;_a57.apply(this,arguments);this.btnSize=_a58;};}));},_setFocusOnFlash:function(){var _a59=this.uploaderInput;["focus","load"].forEach(function(_a5a){_a59.on(_a5a,function(){setTimeout(function(){var swf=_a59.flashMovie;if(swf){swf.focus();}return;},1);});},this);},_getUploadSettings:function(){return {"useFlash":!_a41.supportNativeDndFiles(),"uploadDirectory":this.get("uploadDirectory"),"createAsLocalAsset":this.get("createAsLocalAsset")};},_setupFileList:function(){var self=this,_a5b=this.uploaderInput;self._fileListModel=new _a42();self.fileList.set("model",self._fileListModel);this.own(_a5b.on("begin",function(_a5c){if(_a5c&&_a5c.length>0){self._fileListModel.set("showProgressBar",true);}}),_a5b.on("progress",function(_a5d){self._fileListModel.set("progress",_a5d);}),_a5b.on("complete",lang.hitch(self,self._onUploadComplete)),_a34.after(_a5b,"reset",lang.hitch(self,self._fileListModel.clear)),_a34.around(_a5b,"onChange",function(_a5e){return function(_a5f){var _a60=_a5b._files;return when(self.model.upload(_a60),function(_a61){return when(self._confirm(_a61),function(_a62){self._clearUploadStatus();_a62=_a41.getFileArray(_a62);if(!(_a62 instanceof Array)||_a62.length===0){self._resetUploader();return _a5e.apply(_a5b,[_a5f]);}self._fileListModel.set("uploadFiles",_a62);_a5b._files=_a62;_a5b.upload(self._getUploadSettings());return _a5e.apply(_a5b,[_a5f]);});});};}));},_confirm:function(_a63){return _a63.showConfirmation===true?this._confirmationDialog.showConfirmation(_a63.existingContents,_a63.uploadingFiles,_a63.newFiles):_a63.uploadingFiles;},_clearUploadStatus:function(){this._uploadStatus=[];},_clearUploadFiles:function(){this.uploaderInput._files=[];},_resetUploader:function(){var self=this,_a64=self.uploaderInput,_a65=function(){self._fileListModel.set("showProgressBar",false);_a64.reset();self.set("disableToolbar",false);};if(_a41.supportNativeDndFiles()){_a65();return;}(_a64.flashMovie&&_a64.flashMovie["reset"])&&_a65();},_onUploadComplete:function(evt){this._isCompleted=true;if(evt){if(evt instanceof Array){var _a66="";_a2f.forEach(evt,function(item){_a66=item.errorMessage||item.error;if(_a66!=="server timeout"){if(!_a41.supportNativeDndFiles()&&item.additionalParams&&item.additionalParams.replaceChar){_a41.setAltCommaChar(item.additionalParams.replaceChar);}this.set("uploadStatus",item.index?_a41.StatusScope.Single:_a41.StatusScope.All,item.fileName||item.name,_a66);}},this);}else{if(evt.isValid===false&&evt.saved===false){this.set("uploadStatus",_a41.StatusScope.All,"",evt.errorMessage);}}}this._fileListModel.set("uploadStatus",this.get("uploadStatus"));this.set("disableToolbar",false);this._clearUploadFiles();this.emit("uploadComplete",!this._fileListModel.uploadStatus?this._fileListModel.uploadFiles:null);}});});},"dojox/form/uploader/plugins/Flash":function(){define("dojox/form/uploader/plugins/Flash",["dojo/dom-form","dojo/dom-style","dojo/dom-construct","dojo/dom-attr","dojo/_base/declare","dojo/_base/config","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojox/form/uploader/plugins/HTML5","dojox/embed/Flash"],function(_a67,_a68,_a69,_a6a,_a6b,_a6c,_a6d,lang,_a6e,_a6f,_a70){var _a71=_a6b("dojox.form.uploader.plugins.Flash",[],{swfPath:_a6c.uploaderPath||require.toUrl("dojox/form/resources/uploader.swf"),skipServerCheck:true,serverTimeout:2000,isDebug:false,devMode:false,deferredUploading:0,force:"",postMixInProperties:function(){if(!this.supports("multiple")){this.uploadType="flash";this._files=[];this._fileMap={};this._createInput=this._createFlashUploader;this.getFileList=this.getFlashFileList;this.reset=this.flashReset;this.upload=this.uploadFlash;this.fieldname="flashUploadFiles";}this.inherited(arguments);},onReady:function(_a72){},onLoad:function(_a73){},onFileChange:function(_a74){},onFileProgress:function(_a75){},getFlashFileList:function(){return this._files;},flashReset:function(){this.flashMovie.reset();this._files=[];},uploadFlash:function(_a76){this.onBegin(this.getFileList());_a76.returnType="F";this.flashMovie.doUpload(_a76);},_change:function(_a77){this._files=this._files.concat(_a77);_a6e.forEach(_a77,function(f){f.bytesLoaded=0;f.bytesTotal=f.size;this._fileMap[f.name+"_"+f.size]=f;},this);this.onChange(this._files);this.onFileChange(_a77);},_complete:function(_a78){var o=this._getCustomEvent();o.type="load";this.onComplete(_a78);},_progress:function(f){this._fileMap[f.name+"_"+f.bytesTotal].bytesLoaded=f.bytesLoaded;var o=this._getCustomEvent();this.onFileProgress(f);this.onProgress(o);},_error:function(err){this.onError(err);},_onFlashBlur:function(_a79){},_getCustomEvent:function(){var o={bytesLoaded:0,bytesTotal:0,type:"progress",timeStamp:new Date().getTime()};for(var nm in this._fileMap){o.bytesTotal+=this._fileMap[nm].bytesTotal;o.bytesLoaded+=this._fileMap[nm].bytesLoaded;}o.decimal=o.bytesLoaded/o.bytesTotal;o.percent=Math.ceil((o.bytesLoaded/o.bytesTotal)*100)+"%";return o;},_connectFlash:function(){this._subs=[];this._cons=[];var _a7a=lang.hitch(this,function(s,_a7b){this._subs.push(_a6d.subscribe(this.id+s,this,_a7b));});_a7a("/filesSelected","_change");_a7a("/filesUploaded","_complete");_a7a("/filesProgress","_progress");_a7a("/filesError","_error");_a7a("/filesCanceled","onCancel");_a7a("/stageBlur","_onFlashBlur");this.connect(this.domNode,"focus",function(){this.flashMovie.focus();this.flashMovie.doFocus();});if(this.tabIndex>=0){_a6a.set(this.domNode,"tabIndex",this.tabIndex);}},_createFlashUploader:function(){var w=this.btnSize.w;var h=this.btnSize.h;if(!w){setTimeout(dojo.hitch(this,function(){this._getButtonStyle(this.domNode);this._createFlashUploader();}),200);return;}var url=this.getUrl();if(url){if(url.toLowerCase().indexOf("http")<0&&url.indexOf("/")!=0){var loc=window.location.href.split("/");loc.pop();loc=loc.join("/")+"/";url=loc+url;}}else{}this.inputNode=_a69.create("div",{className:"dojoxFlashNode"},this.domNode,"first");_a68.set(this.inputNode,{position:"absolute",top:"-2px",width:w+"px",height:h+"px",opacity:0});var args={expressInstall:true,path:(this.swfPath.uri||this.swfPath)+"?cb_"+(new Date().getTime()),width:w,height:h,allowScriptAccess:"always",allowNetworking:"all",vars:{uploadDataFieldName:this.flashFieldName||this.name+"Flash",uploadUrl:url,uploadOnSelect:this.uploadOnSelect,deferredUploading:this.deferredUploading||0,selectMultipleFiles:this.multiple,id:this.id,isDebug:this.isDebug,noReturnCheck:this.skipServerCheck,serverTimeout:this.serverTimeout},params:{scale:"noscale",wmode:"transparent",wmode:"opaque",allowScriptAccess:"always",allowNetworking:"all"}};this.flashObject=new _a70(args,this.inputNode);this.flashObject.onError=lang.hitch(function(msg){console.error("Flash Error: "+msg);});this.flashObject.onReady=lang.hitch(this,function(){this.onReady(this);});this.flashObject.onLoad=lang.hitch(this,function(mov){this.flashMovie=mov;this.flashReady=true;this.onLoad(this);});this._connectFlash();}});dojox.form.addUploaderPlugin(_a71);return _a71;});},"dojox/embed/Flash":function(){define("dojox/embed/Flash",["dojo"],function(dojo){var _a7c,_a7d;var _a7e=9;var _a7f="dojox-embed-flash-",_a80=0;var _a81={expressInstall:false,width:320,height:240,swLiveConnect:"true",allowScriptAccess:"sameDomain",allowNetworking:"all",style:null,redirect:null};function prep(_a82){_a82=dojo.delegate(_a81,_a82);if(!("path" in _a82)){console.error("dojox.embed.Flash(ctor):: no path reference to a Flash movie was provided.");return null;}if(!("id" in _a82)){_a82.id=(_a7f+_a80++);}return _a82;};if(dojo.isIE){_a7c=function(_a83){_a83=prep(_a83);if(!_a83){return null;}var p;var path=_a83.path;if(_a83.vars){var a=[];for(p in _a83.vars){a.push(p+"="+_a83.vars[p]);}_a83.params.FlashVars=a.join("&");delete _a83.vars;}var s="<object id=\""+_a83.id+"\" "+"classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" "+"width=\""+_a83.width+"\" "+"height=\""+_a83.height+"\""+((_a83.style)?" style=\""+_a83.style+"\"":"")+">"+"<param name=\"movie\" value=\""+path+"\" />";if(_a83.params){for(p in _a83.params){s+="<param name=\""+p+"\" value=\""+_a83.params[p]+"\" />";}}s+="</object>";return {id:_a83.id,markup:s};};_a7d=(function(){var _a84=10,_a85=null;while(!_a85&&_a84>7){try{_a85=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+_a84--);}catch(e){}}if(_a85){var v=_a85.GetVariable("$version").split(" ")[1].split(",");return {major:(v[0]!=null)?parseInt(v[0]):0,minor:(v[1]!=null)?parseInt(v[1]):0,rev:(v[2]!=null)?parseInt(v[2]):0};}return {major:0,minor:0,rev:0};})();dojo.addOnUnload(function(){var _a86=function(){};var objs=dojo.query("object").reverse().style("display","none").forEach(function(i){for(var p in i){if((p!="FlashVars")&&dojo.isFunction(i[p])){try{i[p]=_a86;}catch(e){}}}});});}else{_a7c=function(_a87){_a87=prep(_a87);if(!_a87){return null;}var p;var path=_a87.path;if(_a87.vars){var a=[];for(p in _a87.vars){a.push(p+"="+_a87.vars[p]);}_a87.params.flashVars=a.join("&");delete _a87.vars;}var s="<embed type=\"application/x-shockwave-flash\" "+"src=\""+path+"\" "+"id=\""+_a87.id+"\" "+"width=\""+_a87.width+"\" "+"height=\""+_a87.height+"\""+((_a87.style)?" style=\""+_a87.style+"\" ":"")+"pluginspage=\""+window.location.protocol+"//www.adobe.com/go/getflashplayer\" ";if(_a87.params){for(p in _a87.params){s+=" "+p+"=\""+_a87.params[p]+"\"";}}s+=" />";return {id:_a87.id,markup:s};};_a7d=(function(){var _a88=navigator.plugins["Shockwave Flash"];if(_a88&&_a88.description){var v=_a88.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split(".");return {major:(v[0]!=null)?parseInt(v[0]):0,minor:(v[1]!=null)?parseInt(v[1]):0,rev:(v[2]!=null)?parseInt(v[2]):0};}return {major:0,minor:0,rev:0};})();}var _a89=function(_a8a,node){if(location.href.toLowerCase().indexOf("file://")>-1){throw new Error("dojox.embed.Flash can't be run directly from a file. To instatiate the required SWF correctly it must be run from a server, like localHost.");}this.available=dojox.embed.Flash.available;this.minimumVersion=_a8a.minimumVersion||_a7e;this.id=null;this.movie=null;this.domNode=null;if(node){node=dojo.byId(node);}setTimeout(dojo.hitch(this,function(){if(_a8a.expressInstall||this.available&&this.available>=this.minimumVersion){if(_a8a&&node){this.init(_a8a,node);}else{this.onError("embed.Flash was not provided with the proper arguments.");}}else{if(!this.available){this.onError("Flash is not installed.");}else{this.onError("Flash version detected: "+this.available+" is out of date. Minimum required: "+this.minimumVersion);}}}),100);};dojo.extend(_a89,{onReady:function(_a8b){},onLoad:function(_a8c){},onError:function(msg){},_onload:function(){clearInterval(this._poller);delete this._poller;delete this._pollCount;delete this._pollMax;this.onLoad(this.movie);},init:function(_a8d,node){this.destroy();node=dojo.byId(node||this.domNode);if(!node){throw new Error("dojox.embed.Flash: no domNode reference has been passed.");}var p=0,_a8e=false;this._poller=null;this._pollCount=0;this._pollMax=15;this.pollTime=100;if(dojox.embed.Flash.initialized){this.id=dojox.embed.Flash.place(_a8d,node);this.domNode=node;setTimeout(dojo.hitch(this,function(){this.movie=this.byId(this.id,_a8d.doc);this.onReady(this.movie);this._poller=setInterval(dojo.hitch(this,function(){try{p=this.movie.PercentLoaded();}catch(e){}if(p==100){this._onload();}else{if(p==0&&this._pollCount++>this._pollMax){clearInterval(this._poller);throw new Error("Building SWF failed.");}}}),this.pollTime);}),1);}},_destroy:function(){try{this.domNode.removeChild(this.movie);}catch(e){}this.id=this.movie=this.domNode=null;},destroy:function(){if(!this.movie){return;}var test=dojo.delegate({id:true,movie:true,domNode:true,onReady:true,onLoad:true});for(var p in this){if(!test[p]){delete this[p];}}if(this._poller){dojo.connect(this,"onLoad",this,"_destroy");}else{this._destroy();}},byId:function(_a8f,doc){doc=doc||document;if(doc.embeds[_a8f]){return doc.embeds[_a8f];}if(doc[_a8f]){return doc[_a8f];}if(window[_a8f]){return window[_a8f];}if(document[_a8f]){return document[_a8f];}return null;}});dojo.mixin(_a89,{minSupported:8,available:_a7d.major,supported:(_a7d.major>=_a7d.required),minimumRequired:_a7d.required,version:_a7d,initialized:false,onInitialize:function(){_a89.initialized=true;},__ie_markup__:function(_a90){return _a7c(_a90);},proxy:function(obj,_a91){dojo.forEach((dojo.isArray(_a91)?_a91:[_a91]),function(item){this[item]=dojo.hitch(this,function(){return (function(){return eval(this.movie.CallFunction("<invoke name=\""+item+"\" returntype=\"javascript\">"+"<arguments>"+dojo.map(arguments,function(item){return __flash__toXML(item);}).join("")+"</arguments>"+"</invoke>"));}).apply(this,arguments||[]);});},obj);}});_a89.place=function(_a92,node){var o=_a7c(_a92);node=dojo.byId(node);if(!node){node=dojo.doc.createElement("div");node.id=o.id+"-container";dojo.body().appendChild(node);}if(o){node.innerHTML=o.markup;return o.id;}return null;};_a89.onInitialize();dojo.setObject("dojox.embed.Flash",_a89);return _a89;});},"epi-cms/widget/FileList":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-construct","dojo/dom-class","dojo/dom-style","dojox/form/uploader/Base","dgrid/OnDemandGrid","dgrid/Selection","dgrid/Keyboard","dijit/ProgressBar","epi/shell/widget/_ModelBindingMixin","epi/shell/dgrid/Formatter","epi-cms/widget/UploadUtil","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles.uploadform","dojo/text!./templates/FileList.html"],function(_a93,lang,_a94,_a95,_a96,_a97,_a98,_a99,_a9a,_a9b,_a9c,_a9d,_a9e,_a9f,_aa0,_aa1){return _a93([_a98,_a9d],{templateString:_aa1,modelBindingMap:{"showProgressBar":["showProgressBar"],"progress":["progress"],"uploadFiles":["uploadFiles"]},postCreate:function(){this.inherited(arguments);this._buildGrid();},_setUploadFilesAttr:function(_aa2){this._bindData(_aa2);},_setShowProgressBarAttr:function(show){_a9f.toggleVisibility(this.progressBar.domNode,show);},_setProgressAttr:function(_aa3){if(!_aa3){return;}this.progressBar.update({progress:_aa3.percent.replace("%","")});},_bindData:function(data){data=data||[];this._grid.refresh();this._grid.renderArray(data);},_buildGrid:function(){var _aa4=_a93([_a99,_a9b,_a9e]);this._grid=new _aa4({columns:{fileName:{label:_aa0.uploadfilename,field:"fileName",htmlEncode:true},size:{label:_aa0.uploadfilesize,field:"size",get:lang.hitch(this,function(file){var _aa5=this.convertBytes(file.size).value;if(isNaN(_aa5)){return _aa5;}var _aa6=_aa5===0?_aa0.bytetext:_aa0.bytestext;return lang.replace("{0} {1}",[_aa5,_aa6]);})},status:{label:_aa0.uploadfilestatus,field:"status",renderCell:lang.hitch(this,function(item,_aa7,node,_aa8){_a94.set(node,"title",item.statusMessage?item.statusMessage:"");_a96.toggle(node,"epi-failedStatus",item.status===_aa0.failed);node.innerHTML=item.status;})}}});this.own(this._grid);_a95.place(this._grid.domNode,this.domNode);}});});},"dijit/ProgressBar":function(){require({cache:{"url:dijit/templates/ProgressBar.html":"<div class=\"dijitProgressBar dijitProgressBarEmpty\" role=\"progressbar\"\n\t><div  data-dojo-attach-point=\"internalProgress\" class=\"dijitProgressBarFull\"\n\t\t><div class=\"dijitProgressBarTile\" role=\"presentation\"></div\n\t\t><span style=\"visibility:hidden\">&#160;</span\n\t></div\n\t><div data-dojo-attach-point=\"labelNode\" class=\"dijitProgressBarLabel\" id=\"${id}_label\"></div\n\t><img data-dojo-attach-point=\"indeterminateHighContrastImage\" class=\"dijitProgressBarIndeterminateHighContrastImage\" alt=\"\"\n/></div>\n"}});define("dijit/ProgressBar",["require","dojo/_base/declare","dojo/dom-class","dojo/_base/lang","dojo/number","./_Widget","./_TemplatedMixin","dojo/text!./templates/ProgressBar.html"],function(_aa9,_aaa,_aab,lang,_aac,_aad,_aae,_aaf){return _aaa("dijit.ProgressBar",[_aad,_aae],{progress:"0",value:"",maximum:100,places:0,indeterminate:false,label:"",name:"",templateString:_aaf,_indeterminateHighContrastImagePath:_aa9.toUrl("./themes/a11y/indeterminate_progress.gif"),postMixInProperties:function(){this.inherited(arguments);if(!(this.params&&"value" in this.params)){this.value=this.indeterminate?Infinity:this.progress;}},buildRendering:function(){this.inherited(arguments);this.indeterminateHighContrastImage.setAttribute("src",this._indeterminateHighContrastImagePath.toString());this.update();},update:function(_ab0){lang.mixin(this,_ab0||{});var tip=this.internalProgress,ap=this.domNode;var _ab1=1;if(this.indeterminate){ap.removeAttribute("aria-valuenow");}else{if(String(this.progress).indexOf("%")!=-1){_ab1=Math.min(parseFloat(this.progress)/100,1);this.progress=_ab1*this.maximum;}else{this.progress=Math.min(this.progress,this.maximum);_ab1=this.maximum?this.progress/this.maximum:0;}ap.setAttribute("aria-valuenow",this.progress);}ap.setAttribute("aria-describedby",this.labelNode.id);ap.setAttribute("aria-valuemin",0);ap.setAttribute("aria-valuemax",this.maximum);this.labelNode.innerHTML=this.report(_ab1);_aab.toggle(this.domNode,"dijitProgressBarIndeterminate",this.indeterminate);tip.style.width=(_ab1*100)+"%";this.onChange();},_setValueAttr:function(v){this._set("value",v);if(v==Infinity){this.update({indeterminate:true});}else{this.update({indeterminate:false,progress:v});}},_setLabelAttr:function(_ab2){this._set("label",_ab2);this.update();},_setIndeterminateAttr:function(_ab3){this.indeterminate=_ab3;this.update();},report:function(_ab4){return this.label?this.label:(this.indeterminate?"&#160;":_aac.format(_ab4,{type:"percent",places:this.places,locale:this.lang}));},onChange:function(){}});});},"url:dijit/templates/ProgressBar.html":"<div class=\"dijitProgressBar dijitProgressBarEmpty\" role=\"progressbar\"\n\t><div  data-dojo-attach-point=\"internalProgress\" class=\"dijitProgressBarFull\"\n\t\t><div class=\"dijitProgressBarTile\" role=\"presentation\"></div\n\t\t><span style=\"visibility:hidden\">&#160;</span\n\t></div\n\t><div data-dojo-attach-point=\"labelNode\" class=\"dijitProgressBarLabel\" id=\"${id}_label\"></div\n\t><img data-dojo-attach-point=\"indeterminateHighContrastImage\" class=\"dijitProgressBarIndeterminateHighContrastImage\" alt=\"\"\n/></div>\n","epi-cms/widget/UploadUtil":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/dom-style"],function(_ab5,lang,_ab6){return {_altCommaChar:null,StatusScope:{Single:0,All:1},setAltCommaChar:function(_ab7){this._altCommaChar=_ab7;},getAltCommaChar:function(){return this._altCommaChar;},validUploadFiles:function(_ab8){if(!_ab8||!(_ab8 instanceof Array)||_ab8.length===0){return false;}return !_ab5.some(_ab8,function(item){return (item.name==null||item.size==null);});},addStatus:function(_ab9,_aba,_abb,_abc){var _abd=[];if(_ab9 instanceof Array){_abd=lang.clone(_ab9);}if(!this.supportNativeDndFiles()){_abc=this.replaceComma(_abc);}var _abe=_ab5.some(_abd,function(item){return (item.scope===_aba&&item.itemName===_abb&&item.message===_abc);});if(!_abe){_abd.push({scope:_aba,itemName:_abb,message:_abc});}return _abd;},supportNativeDndFiles:function(){return !!window.FileReader;},filterFileOnly:function(_abf){return _ab5.filter(_abf,function(file){if(file.type===""&&(file.size===0||file.size%4096===0)){return false;}return true;});},replaceComma:function(data){return data.replace(new RegExp("\\"+this.getAltCommaChar(),"gim"),",");},toggleVisibility:function(_ac0,_ac1){_ab6.set(_ac0,"display",(_ac1?"block":"none"));},getFileArray:function(_ac2){if(!_ac2){return null;}if(_ac2 instanceof Array){return _ac2;}if(typeof _ac2.item!=="function"){return null;}var i=0,_ac3=_ac2.length,_ac4=[];for(i;i<_ac3;i++){_ac4.push(_ac2.item(i));}return _ac4;}};});},"url:epi-cms/widget/templates/FileList.html":"<div class=\"epi-multiFileUpload-list\">\r\n    <div data-dojo-type=\"dijit/ProgressBar\" data-dojo-attach-point=\"progressBar\" data-dojo-props=\"maximum:100\"></div>\r\n</div>","epi-cms/widget/MultipleFileUploadConfirmation":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/aspect","dojo/Deferred","dojo/when","epi/string","epi/shell/widget/dialog/Dialog","epi-cms/widget/ReadOnlyContentList","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles.replaceconfirmdialog"],function(_ac5,_ac6,lang,_ac7,_ac8,_ac9,when,_aca,_acb,_acc,_acd){return _ac6(null,{showConfirmation:function(_ace,_acf,_ad0){var _ad1=new _ac9(),_ad2=this._getDialog(_ace.length),_ad3=this._getContentList();_ad2.set("content",_ad3);_ad2.set("onAction",function(_ad4){_ad1.resolve(_ad4?_acf:_ad0);});when(_ad2.show(),function(){_ad3.grid.renderArray(_ace);});return _ad1;},_getDialog:function(_ad5){var self=this,_ad6=_aca.toHTML(_ad5>1?lang.replace(_acd.multiple.heading,[_ad5]):_acd.single.heading),_ad7=_aca.toHTML(_ad5>1?_acd.multiple.description:_acd.single.description);var _ad8=new _acb({closeIconVisible:false,destroyOnHide:true,title:_acd.title,heading:_ad6,description:_ad7,getActions:function(){return self._getActions(this,_ad5===1);}});_ac7.add(_ad8.domNode,"epi-readOnlyContentListDialog");return _ad8;},_getActions:function(_ad9,_ada){return [{name:"replaceFiles",label:_ada?_acd.single.buttons.replace:_acd.multiple.buttons.replace,title:null,action:function(){when(_ad9.hide(),function(){return _ad9.onAction(true);});}},{name:"skipFiles",label:_ada?_acd.single.buttons.skip:_acd.multiple.buttons.skip,title:null,action:function(){when(_ad9.hide(),function(){return _ad9.onAction(false);});}}];},_getContentList:function(){var _adb=new _acc();_ac7.add(_adb.domNode,"epi-thumbnailContentList");return _adb;}});});},"epi-cms/widget/ReadOnlyContentList":function(){define(["dojo/_base/declare","dgrid/OnDemandList","epi/shell/dgrid/Formatter","epi-cms/core/ContentReference","epi-cms/dgrid/formatters","epi-cms/widget/_ContentListBase"],function(_adc,_add,_ade,_adf,_ae0,_ae1){return _adc([_ae1],{_gridClass:_adc([_add,_ade]),query:null,queryOptions:null,onPostCreateSettings:function(){},postCreate:function(){this.inherited(arguments);this.onPostCreateSettings();},destroy:function(){if(this.grid){this.grid.destroy();this.grid=null;}this.inherited(arguments);},getContextMenu:function(){},createList:function(){this.inherited(arguments);this.grid.set("showHeader",false);},getListSettings:function(){return this._getBaseSettings();},_setQueryAttr:function(_ae2){this._set("query",_ae2);this._updateQuery(_ae2);},_getBaseSettings:function(_ae3){var _ae4=function(item){var _ae5=new _adf(item.contentLink);var _ae6=item.name+", ID: "+_ae5.id+" (Type: "+item.contentTypeName+")";return _ae6;};var _ae7=function(item){return item.thumbnailUrl;};return {store:this.store,queryOptions:this.queryOptions,formatters:[_ae0.contentItemFactory("name",_ae4,null,_ae3,_ae7)],deselectOnRefresh:true};},_updateQuery:function(_ae8){if(_ae8){this.grid.set("query",_ae8);}else{this.grid.cleanup();}}});});},"epi-cms/widget/_ContentListBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/when","epi/shell/widget/ContextMenu","./_GridWidgetBase"],function(_ae9,lang,_aea,when,_aeb,_aec){return _ae9([_aec],{storeKeyName:"epi.cms.content.search",trackActiveItem:false,gridAttachNode:null,contextChangeEvent:"dblclick",postMixInProperties:function(){this.inherited(arguments);this.model=this.model||this.createModel();},postCreate:function(){this.inherited(arguments);this.createList();},createModel:function(){},createList:function(){var _aed=this.getListSettings();_aed=lang.mixin(_aed,this.defaultGridMixin);this.grid=new this._gridClass(_aed,this.gridAttachNode||this.domNode);var _aee=this.model&&this.model.commands&&this.model.commands.length>0;if(_aee){this.grid.contextMenu.addProvider(this.model);}if(this.contextMenu){this.grid.contextMenu=this.contextMenu;}this.own(this.grid);this.setupEvents();},getListSettings:function(){return {};},setupEvents:function(){},onContextChanged:function(){},_onSelect:function(e){when(this.getCurrentContext(),lang.hitch(this,function(_aef){var grid=this.grid;var _af0={contextId:_aef.id,data:[]};if(this.model){for(var id in grid.selection){if(grid.selection[id]){var row=grid.row(id);_af0.data.push(row.data);}}this.model.set("model",_af0);}}));}});});},"epi-cms/widget/viewmodel/FileListViewModel":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/Stateful","epi/shell/_StatefulGetterSetterMixin","epi-cms/widget/UploadUtil","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles"],function(_af1,_af2,lang,_af3,_af4,_af5,_af6){return _af1([_af3,_af4],{progress:null,uploadFiles:null,uploadStatus:null,showProgressBar:false,_setUploadFilesAttr:function(_af7){if(!_af5.validUploadFiles(_af7)){return;}var _af8=[];_af2.forEach(_af7,function(file){_af8.push({fileName:file.name,size:file.size,status:_af6.uploadform.uploading});},this);this._set("uploadFiles",_af8);},_setUploadStatusAttr:function(_af9){var _afa=this.get("uploadFiles");if(_af2.some(_afa,function(item){return item.status!==_af6.uploadform.uploading;})){return;}_af2.forEach(_afa,function(item){if(!_af9||_af9.length<=0){item.status=_af6.uploadform.uploaded;return false;}if(_af9[0]&&_af9[0].scope===_af5.StatusScope.All&&_af9[0].itemName===""){item.status=_af6.uploadform.failed;item.statusMessage=_af9[0].message;return false;}var _afb=_af2.filter(_af9,function(_afc){return item.fileName===_afc.itemName;});if(_afb&&_afb.length>0){item.status=_af6.uploadform.failed;item.statusMessage=_afb[0].message;}else{item.status=_af6.uploadform.uploaded;}},this);this._set("uploadFiles",_afa);},clear:function(){this._set("uploadFiles",null);}});});},"url:epi-cms/widget/templates/MultipleFileUpload.html":"<div class=\"epi-multiFileUpload\">\r\n    <form method=\"post\" action=\"\" enctype=\"multipart/form-data\">\r\n        <div data-dojo-attach-point=\"breadcrumbBar\" data-dojo-type=\"epi-cms/widget/Breadcrumb\"></div>\r\n        <div data-dojo-attach-point=\"uploadToolbar\" class=\"epi-toolbar-unwrapped\">\r\n            <span title=\"${res.uploadform.addfiles}\" >\r\n                <input type=\"file\" multiple=\"multiple\" data-dojo-type=\"dojox.form.Uploader\" data-dojo-attach-point=\"uploaderInput\" \r\n                    data-dojo-props=\"iconClass:'epi-iconPlus', showLabel: false, multiple: true\" />\r\n            </span>\r\n            <div data-dojo-attach-point=\"toolbarDisableLayer\"></div>\r\n        </div>\r\n        <div data-dojo-attach-point=\"fileList\" data-dojo-type=\"epi-cms/widget/FileList\"></div>\r\n    </form>\r\n</div>","epi-cms/command/UploadContent":function(){define(["dojo/_base/declare","epi/shell/command/_Command","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference"],function(_afd,_afe,_aff,_b00){return _afd([_afe],{fileList:null,createAsLocalAsset:false,_execute:function(){var _b01=_b00.toContentReference(this.model.contentLink).createVersionUnspecificReference();this.viewModel.upload(this.fileList,_b01.toString(),this.createAsLocalAsset);this.fileList=null;},_onModelChange:function(){var _b02=this.model,_b03=_b02&&_aff.hasProviderCapability(_b02.providerCapabilityMask,_aff.providerCapabilities.Create)&&_aff.hasAccess(_b02.accessMask,_aff.accessLevel.Create);this.set("canExecute",!!(_b03&&this.viewModel));}});});},"epi-cms/command/EditImage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/topic","epi/dependency","epi/routes","epi/Url","epi/shell/TypeDescriptorManager","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi-cms/core/PermanentLinkHelper","epi-cms/legacy/LegacyDialogPopup","epi-cms/contentediting/command/_LegacyDialogCommandBase","epi/shell/command/_SelectionCommandMixin","epi-cms/contentediting/ContentActionSupport"],function(_b04,lang,when,_b05,_b06,_b07,Url,_b08,_b09,_b0a,_b0b,_b0c,_b0d,_b0e,_b0f){return _b04([_b0d,_b0e],{canExecute:false,iconClass:"epi-iconNewWindow",_segmentIdSeperator:",,",getRouteParams:function(){var _b10=this._getTarget();return {moduleArea:"LegacyCMS",path:"Edit/ImageEditor/ImageEditor.aspx",IsInLegacyWrapper:false,imageId:_b10?_b10.contentLink:""};},_createDialog:function(_b11,_b12){var _b13=this._getTarget(),_b14=this.model;if(_b13){var _b15=function(_b16){if(_b16){_b05.publish("/epi/shell/context/request",{url:_b16.src},{forceReload:true});}};lang.mixin(_b11,{url:_b07.getActionPath(_b12),dialogArguments:{src:_b0b.toPermanentLink(_b13)},destroyOnHide:true,onCallback:_b15});}return new _b0c(_b11);},_onModelChange:function(){if(!_b09.imageEditorEnabled){if(this.get("isAvailable")){this.set("isAvailable",false);}return;}var _b17=this._getTarget(),_b18=this.model&&_b17&&_b08.isBaseTypeIdentifier(_b17.typeIdentifier,"episerver.core.icontentimage");this.set("canExecute",!!_b18);},_getTarget:function(){var _b19=this.selection&&this.selection.data,_b1a=_b19&&_b19.length==1&&_b19[0];return _b1a&&(_b1a.type=="epi.cms.contentdata")?_b1a.data:null;}});});},"epi-cms/command/DownloadMedia":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/dom-construct","dojo/has","dojo/sniff","dojo/when","epi/shell/Downloader","epi/shell/TypeDescriptorManager","epi/shell/command/_Command","epi/shell/command/_SelectionCommandMixin","epi/i18n!epi/cms/nls/episerver.cms.command"],function(_b1b,_b1c,_b1d,has,_b1e,when,_b1f,_b20,_b21,_b22,_b23){return _b1b([_b21,_b22],{label:_b23.download,tooltip:_b23.download,iconClass:"epi-iconDownload",_execute:function(){var _b24=this._getContentData();if(!_b24){return;}_b1f.download(_b24.downloadUrl,_b24.name);},_onModelChange:function(){var _b25=this._getContentData(),_b26=_b25&&_b25.downloadUrl,_b27=_b25&&_b25.typeIdentifier,_b28=_b27&&_b20.getValue(_b27,"actAsAnAsset");this.set("canExecute",!!(_b28&&_b26));},_getContentData:function(){var _b29=null;if(this.selection&&this.selection.data&&this.selection.data instanceof Array&&this.selection.data.length===1){_b29=this.selection.data[0].data;}return _b29;}});});},"epi/shell/Downloader":function(){define("epi/shell/Downloader",["dojo/_base/lang","dojo/dom-construct"],function(lang,_b2a){return {_classicalDownload:function(url,name){var _b2b=document.getElementsByTagName("body")[0],_b2c={href:url,download:name,target:"_blank",style:{display:"none;"}},_b2d=_b2a.create("a",_b2c,_b2b,"last");_b2d.click();_b2a.destroy(_b2d);},download:function(url,name){if(url){return this._classicalDownload(url,name);}}};});},"epi-cms/widget/HierarchicalList":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/on","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","dijit/layout/BorderContainer","dojox/html/entities","epi/string","epi/shell/command/_WidgetCommandBinderMixin","epi/shell/widget/_FocusableMixin","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/dialog/Alert","epi/shell/widget/ContextMenu","epi-cms/widget/SearchBox","epi-cms/widget/FolderTree","epi-cms/widget/ContentList","epi-cms/widget/FilesUploadDropZone","epi-cms/widget/UploadUtil","epi-cms/widget/viewmodel/HierarchicalListViewModel","dojo/text!./templates/HierarchicalList.html","dojo/text!./templates/AssetsDropZone.html","epi/i18n!epi/cms/nls/episerver.cms.widget.hierachicallist"],function(_b2e,_b2f,lang,_b30,_b31,_b32,_b33,_b34,on,when,_b35,_b36,_b37,_b38,_b39,_b3a,_b3b,_b3c,_b3d,_b3e,_b3f,_b40,_b41,_b42,_b43,_b44,_b45,_b46,_b47,res){return _b2f([_b37,_b35,_b36,_b3d,_b3b],{contextMenu:null,templateString:_b46,showRoot:false,enableDndFileDropZone:false,showCreateContentArea:false,triggerContextChange:false,res:res,modelClassName:_b45,hierarchicalListClass:"",noDataMessage:"",createContentIcon:"",createContentText:"",_dropZoneCreated:false,modelBindingMap:{"searchRoots":["searchRoots"],"searchArea":["searchArea"],"listQuery":["listQuery"],"currentTreeItem":["currentTreeItem"],"currentListItem":["currentListItem"],"editingListItem":["editingListItem"],"showAllLanguages":["showAllLanguages"]},_setSearchAreaAttr:function(_b48){this.searchBox.set("area",_b48);},_setSearchRootsAttr:function(_b49){this.searchBox.set("searchRoots",_b49);},_setListQueryAttr:function(_b4a){this.list.set("query",_b4a);},_setShowAllLanguagesAttr:function(_b4b){this.searchBox.set("filterOnCulture",!_b4b);},_setCurrentTreeItemAttr:function(_b4c){if(_b4c){this._toggleActive(this.tree,this.list);when(this.tree.selectContent(_b4c.toString()),lang.hitch(this,function(){var _b4d=this.tree.getNodesByItem(_b4c.toString())[0];if(_b4d){this.tree.model.set("previousSelection",{selectedContent:_b4d,selectedAncestors:_b4d.getTreePath()});}}));}},_setCurrentListItemAttr:function(_b4e){this.list.set("currentItem",_b4e);this._toggleActive(this.list,this.tree);},_setEditingListItemAttr:function(_b4f){this.list.set("editingItem",_b4f);},_setShowRootAttr:function(_b50){this.tree.set("showRoot",_b50);},postMixInProperties:function(){this.inherited(arguments);if(!this.model&&!this.commandProvider&&this.modelClassName){var _b51=_b2f(this.modelClassName);this.model=this.commandProvider=new _b51({repositoryKey:this.repositoryKey});}this.setupContextMenu();},setupContextMenu:function(){this.own(this.contextMenu=new _b3f({category:"context"}));this.contextMenu.addProvider(this.model);},postCreate:function(){this.inherited(arguments);_b31.add(this.domNode,this.hierarchicalListClass);this._setupTree();this._setupCreateContentArea();this._setupList();if(this.enableDndFileDropZone){this._setupDropZone();}this._toggleCreateContentArea(this.showCreateContentArea);this.model.startup();this.own(this.model.clipboardManager.watch("data",lang.hitch(this,this._updateClipboardIndicators)));},startup:function(){this.inherited(arguments);if(this.contextMenu){this.contextMenu.startup();}},destroy:function(){this.model.destroy();this.inherited(arguments);},layout:function(){if(this.enableDndFileDropZone){var grid=this.list.grid;if(grid){_b31.add(grid.bodyNode,"epi-drop-area");}}var _b52=_b33.getMarginBox(this.list.domNode),_b53=_b33.getMarginBox(this.searchBox.domNode),_b54=this._contentBox.h-_b53.h-32;if(_b52.h>_b54){this.list.resize({h:_b54});}this.container.resize(this._contentBox);},_toggleCreateContentArea:function(_b55){_b34.set(this.createContentArea,{"display":_b55?"":"none"});},_toggleActive:function(_b56,_b57){_b31.remove(_b57.domNode,"epi-focused");_b31.add(_b56.domNode,"epi-focused");},_showNotification:function(_b58){var _b59=new _b3e({destroyOnHide:true,description:_b3a.toHTML(_b58)});_b59.show();},_onDrop:function(evt,_b5a){_b5a=_b44.filterFileOnly(_b5a);if(!_b5a||_b5a.length<=0){return;}var _b5b=this.model.getCommand("uploadDefault");if(!_b5b){return;}_b5b.set("fileList",_b5a);_b5b.execute();},_setupDropZone:function(){if(!(_b44.supportNativeDndFiles()&&!this._dropZoneCreated)){return;}var _b5c=new _b43({"templateString":_b47,"res":res,"outsideDomNode":this.container.domNode});_b32.place(_b5c.domNode,this.domNode,"first");this.connect(_b5c,"onDrop",this._onDrop);this._dropZoneCreated=true;var _b5d=this.model.getCommand("uploadDefault");if(_b5d){this.own(_b5d.watch("canExecute",function(name,_b5e,_b5f){_b5c.set("enabled",_b5f);}));}},_setupTree:function(){var _b60=this.model._commandRegistry;function _b61(item,node,e){this.model.onTreeItemSelected(item,this.tree.model.isTypeOfRoot(item));};function _b62(copy){copy?_b60.copy.command.execute():_b60.cut.command.execute();};this.own(on(this.tree,"copyOrCut",_b62),on(this.tree,"select",lang.hitch(this,_b61)),on(this.tree,"paste",function(){_b60.paste.command.execute();}),on(this.tree,"delete",function(){_b60["delete"].command.execute();}),_b30.after(this.tree,"onClick",lang.hitch(this,_b61),true));this.model._commandRegistry.rename.command.set("renameDelegate",lang.hitch(this,function(_b63){this.tree.getNodesByItem(_b63)[0].edit();}));},_setupCreateContentArea:function(){_b31.add(this.createContentAreaIcon,this.createContentIcon);this.createContentAreaText.innerHTML=this.createContentText;this.list.set("noDataMessage",this.noDataMessage);},_setupList:function(){this.own(on(this.list,"itemSelected",lang.hitch(this.model,this.model.onListItemSelected)),_b30.after(this.model,"onListItemUpdated",lang.hitch(this.list,function(_b64){when(_b64,lang.hitch(this,this.editContent));})));},_onSearchAction:function(_b65){this.model.onSearch(_b65.metadata);},_updateClipboardIndicators:function(name,_b66,_b67){var _b68=this.model.clipboardManager.isCopy();if(_b66 instanceof Array){_b2e.forEach(_b66,function(clip){this.tree.toggleCut(clip.data,false);this.list.toggleCut(clip.data,false);},this);}if(!_b68&&_b67 instanceof Array){_b2e.forEach(_b67,function(clip){this.tree.toggleCut(clip.data,true);this.list.toggleCut(clip.data,true);},this);}}});});},"epi-cms/widget/FolderTree":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/aspect","dojo/json","dojo/when","dojox/html/entities","dijit/tree/_dndSelector","epi/dependency","epi/string","epi-cms/widget/_FolderTreeNode","epi-cms/widget/ContentTree","epi-cms/widget/ContentTreeStoreModel"],function(_b69,_b6a,lang,_b6b,_b6c,_b6d,json,when,_b6e,_b6f,_b70,_b71,_b72,_b73,_b74){return _b6a([_b73],{handleSelection:true,postCreate:function(){var self=this;self.inherited(arguments);self.own(self.connect(self.model,"onDeleted",lang.hitch(self,self._onDeleted)),_b6d.around(self.model,"onRefreshRoots",function(_b75){return function(_b76){if(_b76&&typeof self._onItemDelete==="function"){self._onItemDelete(_b76);}return _b75.apply(self.model,[_b76]);};}));},toggleCut:function(item,_b77){var node=this.tree.getNodesByItem(item)[0];if(node){_b6c.toggle(node.rowNode,"epi-opacity50",_b77);}},_createTreeModel:function(){return new _b74({store:this.store});},_updateItemDeletedHierachy:function(node){if(!node){return;}_b69.forEach(node.getChildren(),function(_b78){_b78.set({item:lang.mixin(_b78.item,{isDeleted:true})});this._updateItemDeletedHierachy(_b78);},this);},_onDeleted:function(item){var _b79=this.getNodesByItem(item);_b69.forEach(_b79,function(node){this._updateItemDeletedHierachy(node);},this);},_renameFolder:function(item,name){var _b7a=lang.trim(name),_b7b=this.getNodesByItem(item)[0];if(_b7a){when(this.model.rename(item.contentLink,_b7a),function(item){_b6b.set(_b7b.contentNode,"title",item.name);},function(ex){_b7b.rollbackLabel(item.name,ex);_b7b.edit();});}else{_b7b.rollbackLabel(item.name);}},buildNodeFromTemplate:function(args){var _b7c=new _b72(args);_b7c.bindContextMenu(this.contextMenu);this.own(_b7c.on("rename",lang.hitch(this,function(val){this._renameFolder(_b7c.item,val);})));return _b7c;},_onNodeMouseEnter:function(node,evt){this.inherited(arguments);node._handleMouseEnter();},_onNodeMouseLeave:function(node,evt){this.inherited(arguments);node._handleMouseLeave();},_onClick:function(node,evt){this.inherited(arguments);node._onClick();}});});},"epi-cms/widget/_FolderTreeNode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/Evented","dojo/Deferred","dojo/keys","dojo/on","dojo/when","dojox/html/entities","dojo/text!./templates/_FolderTreeNode.html","dijit/form/TextBox","dijit/form/ValidationTextBox","dijit/InlineEditBox","epi","epi-cms/widget/_ContentTreeNode"],function(_b7d,lang,_b7e,_b7f,_b80,_b81,_b82,_b83,keys,on,when,_b84,_b85,_b86,_b87,_b88,epi,_b89){_b7d("_TreeInlineEditor",[dijit._InlineEditor],{postCreate:function(){this.inherited(arguments);this.own(on(this.domNode,"mousedown, mouseup, click, keydown, keypress, selectstart",function(e){e.stopPropagation();}));}});var _b8a={normal:0,root:1};return _b7d([_b89,_b82],{templateString:_b85,_blockFolderMenu:"epi-iconContextMenu",_blockFolderDnDIcon:"epi-iconDnD",_blockFolderExpand:"epi-iconObjectFolderOpen",_blockFolderCollapse:"epi-iconObjectFolder",_isResetValue:false,_menuTooltip:undefined,contextMenu:null,_editWidget:null,_rowStates:{NORMAL:1,EXPANDED:2,ENTERED:4,SELECTED:8},_currentRowState:1,postMixInProperties:function(){this.inherited(arguments);this._menuTooltip=epi.resources.action.options;},postCreate:function(){this.inherited(arguments);_b81.set(this.iconNodeMenu,"zIndex",_b80.position(this.rowNode).zIndex+1);this._updateStyle();},buildRendering:function(){this.inherited(arguments);this.labelWidget=new _b88({value:this.label,editorWrapper:"_TreeInlineEditor",editor:"dijit/form/ValidationTextBox",width:"auto",editorParams:{maxLength:255},_onMouseOver:function(){},_onClick:function(){},onChange:lang.hitch(this,this._onChangeLabelValue),onCancel:lang.hitch(this,function(){this.emit("cancelEdit",this.item.contentLink);this._resetValue();this._setEditorState();})},this.labelNode);},edit:function(){this.labelWidget.value=this.label;this.labelWidget.edit();this._editWidget=this.labelWidget.wrapperWidget.editWidget;this.own(on(this._editWidget.domNode,"keydown",lang.hitch(this,function(e){if(!this._editWidget.isValid()&&e.keyCode!=keys.ENTER){this._setEditorState();}})));},_resetValue:function(val){this._isResetValue=true;this.labelWidget.set("value",val||this.label);},_onChangeLabelValue:function(val){if(!val){this._resetValue();return;}if(!this._isResetValue){this.emit("rename",val);}this._isResetValue=false;},_onClick:function(evt){this.inherited(arguments);_b7f.remove(this.labelNode,"dijitInlineEditBoxDisplayModeHover");this.emit("nodeSelected",this);},rollbackLabel:function(val,_b8b){if(!this.labelWidget.value){this._resetValue(val);}if(_b8b&&_b8b.length>0){this._setEditorState(_b8b[0].errorMessage);}},bindContextMenu:function(menu){this.contextMenu=menu;this.connect(this.iconNodeMenu,"onclick","_onIconNodeMenuClick");},collapse:function(){var self=this,def=new _b83();when(self.inherited(arguments),function(){self._currentRowState=self._currentRowState^self._rowStates.EXPANDED;self._updateStyle();def.resolve(true);});return def;},expand:function(){var self=this,def=new _b83();when(self.inherited(arguments),function(){self._currentRowState=self._currentRowState|self._rowStates.EXPANDED;self._updateStyle();def.resolve();});return def;},setSelected:function(_b8c){if(!this.tree.getNodesByItem(this.item)[0]){return;}this.inherited(arguments);var _b8d=this._currentRowState;this._currentRowState=_b8c?(this._currentRowState|this._rowStates.SELECTED):parseInt(this._currentRowState&this._rowStates.SELECTED,10)>0?(this._currentRowState^this._rowStates.SELECTED):_b8d;this._updateStyle();if(_b8c){this.emit("nodeSelected",this);}},_updateIndividualLayout:function(){_b7e.set(this.contentNode,"title",this.label);this._updateStyleBySingleState();if(this.item&&this.item.contentLink){this.emit("nodeRefreshed",this.item.contentLink);}},_updateBlockFolderTypeIcon:function(){if(this._isTypeOfRoot()){this._iconNodeClass=this.tree.model.getObjectIconClass(this.item,this._blockFolderCollapse);}else{this._iconNodeClass=this.isExpanded?this._blockFolderExpand:this._blockFolderCollapse;}_b7f.add(this.iconNode,this._iconNodeClass);},_handleMouseEnter:function(){this._currentRowState=this._currentRowState|this._rowStates.ENTERED;this._updateStyle();_b7f.remove(this.labelNode,"dijitInlineEditBoxDisplayModeHover");},_handleMouseLeave:function(){this._currentRowState=this._currentRowState^this._rowStates.ENTERED;this._updateStyle();},_onIconNodeMenuClick:function(evt){this.contextMenu&&this.contextMenu.scheduleOpen(evt.target,null,{x:evt.pageX,y:evt.pageY});this.emit("nodeSelected",this);},_updateStyleBySingleState:function(_b8e){var _b8f=this._rowStates;switch(_b8e){case _b8f.SELECTED:case _b8f.ENTERED:if(this.contextMenu){_b7f.add(this.iconNodeMenu,this._blockFolderMenu);}break;default:if(this.contextMenu){_b7f.remove(this.iconNodeMenu,this._blockFolderMenu);}_b7f.remove(this.iconNode,this._blockFolderExpand);_b7f.remove(this.iconNode,this._blockFolderCollapse);var _b90=this.isExpanded&&this.hasChildren()?this._blockFolderExpand:this._blockFolderCollapse;_b7f.add(this.iconNode,this._isTypeOfRoot()?this.tree.model.getObjectIconClass(this.item,this._blockFolderCollapse):_b90);if(this.contextMenu&&parseInt(this._currentRowState&this._rowStates.SELECTED,10)>0){_b7f.add(this.iconNodeMenu,this._blockFolderMenu);}break;}},_updateStyle:function(){for(var _b91 in this._rowStates){if(parseInt(this._currentRowState&this._rowStates[_b91],10)>0){this._updateStyleBySingleState(this._rowStates[_b91]);}}},_addLanguageIndicator:function(){this.inherited(arguments);_b7e.remove(this.iconNodeLanguage,"title");},_setEditorState:function(_b92){if(this._editWidget){_b92=_b84.encode(_b92);this._editWidget.invalidMessage=_b92||"";this._editWidget.set("state",_b92?"Error":"");this._editWidget.isValid=function(){return !_b92;};this._editWidget.validate();}}});});},"url:epi-cms/widget/templates/_FolderTreeNode.html":"<div class=\"dijitTreeNode epi-folderTreeNode\" role=\"presentation\">\r\n    <div tabindex=\"-1\" data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon dijitTreeIcon\" role=\"presentation\" title=\"${_menuTooltip}\">&nbsp;</span>\r\n                <span data-dojo-attach-point=\"iconNodeLanguage\" class=\"epi-extraIcon epi-ft-currentLanguageMissing\" role=\"presentation\">&nbsp;</span>\r\n            </span>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n        </span>\r\n    </div>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>","epi-cms/widget/ContentList":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/aspect","dojo/Evented","dgrid/Keyboard","dgrid/OnDemandList","dgrid/Selection","dojox/html/entities","epi","epi/shell/dgrid/Formatter","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/dgrid/formatters","epi-cms/dgrid/DnD","epi-cms/dgrid/WithContextMenu","epi-cms/widget/ReadOnlyContentList"],function(_b93,lang,_b94,_b95,_b96,_b97,_b98,_b99,_b9a,_b9b,epi,_b9c,_b9d,_b9e,_b9f,DnD,_ba0,_ba1){return _b93([_ba1,_b97],{_gridClass:_b93([_b99,_b9c,_b9a,DnD,_b98,_ba0]),resources:"",noDataMessage:null,editingItem:null,postCreate:function(){this.inherited(arguments);_b94.add(this.domNode,"epi-contentList");},_setCurrentItemAttr:function(_ba2){if(!this.get("editingItem")){this.set("editingItem",_ba2);}this._set("currentItem",_ba2);this.select(_ba2);},_setNoDataMessageAttr:function(_ba3){this.noDataMessage=_ba3;this.grid.set("noDataMessage",_ba3);},_dndNodeCreator:function(item,hint){var _ba4=_b9d.getAndConcatenateValues(item.typeIdentifier,"dndTypes");if(!_ba4&&this.dndTypes){_ba4=this.dndTypes;}return {"node":_b95.create("div").appendChild(document.createTextNode(item.name)),"type":_ba4,"data":item};},getListSettings:function(){var menu={hasMenu:!!this.contextMenu,settings:{title:epi.resources.action.options}};return lang.delegate(this._getBaseSettings(menu),{noDataMessage:this.noDataMessage,dndParams:{copyOnly:true,selfAccept:false,accept:[],creator:lang.hitch(this,this._dndNodeCreator)}});},setupEvents:function(){this.inherited(arguments);this.own(this.grid.on(".epi-createContent:click",lang.hitch(this,function(e){this.emit("createItemAction",{});})),_b96.around(this.grid,"insertRow",lang.hitch(this,this._aroundInsertRow)));if(this.contextMenu){this.own(this.contextMenu.on("close",lang.hitch(this,function(){var _ba5=this.get("editingItem");if(_ba5){this.select(_ba5);}})));}},_onSelect:function(evt){this.inherited(arguments);if(this.grid.selectionMode==="single"){this.emit("itemSelected",evt.rows[0].data);}},editContent:function(item){if(!item||!this.grid.row(item).element){return;}this.emit("itemAction",item);this.set("editingItem",this.currentItem);},_onChangeContext:function(evt){this.editContent(this.grid.row(evt).data);},toggleCut:function(item,_ba6){var row;if(item){row=this.grid.row(_b9e.toContentReference(item.contentLink).id);if(row&&row.element){_b94.toggle(row.element,"epi-opacity50",_ba6);}}}});});},"epi-cms/widget/FilesUploadDropZone":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-geometry","dijit/_Widget","dijit/_TemplatedMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles.dropzone","dojo/text!./templates/FilesUploadDropZone.html"],function(_ba7,lang,_ba8,_ba9,_baa,_bab,_bac,_bad){return _ba7([_baa,_bab],{res:_bac,templateString:_bad,dragStartCssClass:"epi-dragStart",dragOverCssClass:"epi-dragOver",outsideDomNode:null,enabled:true,postCreate:function(){this.inherited(arguments);if(this.outsideDomNode){this.connect(this.outsideDomNode,"dragover",lang.hitch(this,this._onDragOverOutside));this.connect(this.outsideDomNode,"dragleave",lang.hitch(this,function(evt){this._onDragLeave(evt,this.outsideDomNode);}));this.connect(this.outsideDomNode,"dragend",lang.hitch(this,this._onDragLeave));this.connect(this.outsideDomNode,"drop",lang.hitch(this,this._onDragLeave));}this.connect(this.domNode,"dragover",lang.hitch(this,this._onDragOver));this.connect(this.domNode,"dragleave",lang.hitch(this,this._onDragLeave));this.connect(this.domNode,"dragend",lang.hitch(this,this._onDragLeave));this.connect(this.domNode,"drop",lang.hitch(this,this._onDrop));},_onDragOverOutside:function(evt){if(!this.enabled){return;}evt.preventDefault();_ba8.add(this.domNode,this.dragStartCssClass);},_isHover:function(evt,_bae){var _baf=_ba9.position(_bae),_bb0=evt.clientX,_bb1=evt.clientY;return !(_bb0<_baf.x||_bb0>(_baf.x+_baf.w)||_bb1<_baf.y||_bb1>(_baf.y+_baf.h));},_onDragOver:function(evt){if(!this.enabled){return;}evt.preventDefault();_ba8.remove(this.domNode,this.dragStartCssClass);_ba8.add(this.domNode,this.dragOverCssClass);},_onDragLeave:function(evt,_bb2){if(!this.enabled){return;}evt.preventDefault();if(!this._isHover(evt,_bb2||this.domNode)){this._removeAllCssClasses();}},onDrop:function(evt,_bb3){},_onDrop:function(evt){if(!this.enabled){return;}evt.preventDefault();this._removeAllCssClasses();this.onDrop(evt,evt.dataTransfer.files);},_removeAllCssClasses:function(){_ba8.remove(this.domNode,this.dragStartCssClass);_ba8.remove(this.domNode,this.dragOverCssClass);}});});},"url:epi-cms/widget/templates/FilesUploadDropZone.html":"<div class=\"epi-filesUploadDropZone\">\r\n    <div>\r\n        <span data-dojo-attach-point=\"description\">${res.description}</span>\r\n    </div>\r\n</div>","url:epi-cms/widget/templates/HierarchicalList.html":"<div class=\"epi-hierarchicalList\">\r\n    <div data-dojo-attach-point=\"container\"\r\n         data-dojo-type=\"dijit/layout/BorderContainer\"\r\n         data-dojo-props=\"gutters: false\">\r\n        <div class=\"epi-gadgetInnerToolbar\"\r\n             data-dojo-attach-point=\"searchBox\"\r\n             data-dojo-type=\"epi-cms/widget/SearchBox\"\r\n             data-dojo-props=\"region:'top', splitter: false, triggerContextChange: this.triggerContextChange\"\r\n             data-dojo-attach-event=\"onItemAction:_onSearchAction\"></div>\r\n        <div class=\"epi-secondaryGadgetContainer epi-gadgetTopContainer\"\r\n             data-dojo-attach-point=\"tree\"\r\n             data-dojo-type=\"epi-cms/widget/FolderTree\" \r\n             data-dojo-props=\"region:'center', splitter:false, model: this.model.treeStoreModel, showRoot: false, contextMenu: this.contextMenu\"></div>\r\n        <div data-dojo-attach-point=\"list\" class=\"epi-gadgetBottomContainer\"\r\n             data-dojo-type=\"epi-cms/widget/ContentList\"\r\n             data-dojo-props=\"region:'bottom', splitter:true, store: this.model.store, queryOptions: this.model.listQueryOptions, contextMenu: this.contextMenu, resources: this.res\">\r\n            <div data-dojo-attach-point=\"createContentArea\" class=\"epi-createContentContainer\">\r\n                <div class=\"epi-createContent\">\r\n                    <span data-dojo-attach-point=\"createContentAreaIcon\" class=\"dijitReset dijitInline dijitIcon\"></span>\r\n                    <span data-dojo-attach-point=\"createContentAreaText\" class=\"dijitReset dijitInline epi-createContentText\"></span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>","url:epi-cms/widget/templates/AssetsDropZone.html":"<div class=\"epi-assetsDropZone\">\r\n    <span class=\"dijitReset dijitInline epi-dropZoneText\">${res.dropzonedescription}</span>\r\n</div>\r\n","epi-cms/component/PageNavigationTree":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi/dependency","epi-cms/ApplicationSettings","../core/ContentReference","../command/NewContent","./command/ViewTrash","./ContentNavigationTree","epi/i18n!epi/cms/nls/episerver.cms.components.createpage"],function(_bb4,_bb5,lang,_bb6,when,_bb7,_bb8,_bb9,_bba,_bbb,_bbc,_bbd){return _bb5([_bbc],{betweenThreshold:5,expandExtraNodeItems:_bb8.startPage,checkAcceptance:function(_bbe,_bbf){return _bbe===this.tree.dndController;},_startupCommands:function(){this.inherited(arguments);this._createCommand=new _bba({order:10,contentType:this.settings.containedTypes[0],iconClass:"epi-iconPlus",label:_bbd.command.label,resources:_bbd});this.commands=_bb4.filter(this.commands,lang.hitch(this,function(_bc0){return !(_bc0 instanceof _bba);}));this._viewTrashCommand=new _bbb({typeIdentifiers:this.typeIdentifiers});this.commands.push(this._createCommand);this.commands.push(this._viewTrashCommand);},getIconClass:function(item,_bc1){var _bc2=_bb4.some(this.model.roots,function(root){return root==this.model.getIdentity(item);},this);if(_bc2){return "epi-iconObjectRoot";}else{if(item.isStartPage){return "epi-iconObjectStart";}else{return this.inherited(arguments);}}}});});},"epi-cms/component/ContentNavigationTree":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/topic","dojo/when","epi/dependency","epi/string","epi/shell/ClipboardManager","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/selection","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Alert","epi/shell/widget/dialog/Confirmation","epi-cms/_ContentContextMixin","epi-cms/_MultilingualMixin","epi-cms/ApplicationSettings","epi-cms/contentediting/PageShortcutTypeSupport","epi-cms/command/ShowAllLanguages","epi-cms/component/_ContentNavigationTreeNode","epi-cms/component/ContentContextMenuCommandProvider","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/widget/ContentTree","epi/shell/widget/ContextMenu","./command/_GlobalToolbarCommandProvider","../command/CopyContent","../command/CutContent","../command/DeleteContent","../command/PasteContent","epi/i18n!epi/cms/nls/episerver.cms.components.createpage","epi/i18n!epi/cms/nls/episerver.cms.components.pagetree"],function(_bc3,_bc4,_bc5,lang,_bc6,_bc7,when,_bc8,_bc9,_bca,_bcb,_bcc,_bcd,_bce,_bcf,_bd0,_bd1,_bd2,_bd3,_bd4,_bd5,_bd6,_bd7,_bd8,_bd9,_bda,_bdb,_bdc,_bdd,_bde,_bdf,_be0,res){return _bc5([_bd9,_bd0,_bcb,_bd1],{res:res,showAllLanguages:true,_separatorBeforeCssClass:"rowSeparatorBefore",_separatorAfterCssClass:"rowSeparatorAfter",_clipboardManager:null,_contextMenu:null,_contextMenuCommandProvider:null,_focusNode:null,betweenThreshold:0,contextMenuCommandProvider:_bd6,nodeConstructor:_bd5,postMixInProperties:function(){this.inherited(arguments);this._clipboardManager=new _bca();this.selection=new _bcc();this._contextMenuCommandProvider=new this.contextMenuCommandProvider({treeModel:this.model,clipboardManager:this._clipboardManager,repositoryKey:this.repositoryKey});this._startupCommands();this.model.roots=this.roots;this.model.notAllowToDelete=this.settings.preventDeletionFor;this.model.notAllowToCopy=this.settings.preventCopyingFor;},postCreate:function(){this.inherited(arguments);this.own(this.on("copyOrCut",lang.hitch(this,function(copy){copy?this._copyCommand.execute():this._cutCommand.execute();})),this.on("paste",lang.hitch(this,function(){when(this._pasteCommand.execute(),lang.hitch(this,function(){this.selectedNode.expand();}));})),this.on("delete",lang.hitch(this,function(){this._deleteCommand.canExecute?this._deleteCommand.execute():this._showNotificationMessage(this.res.cannotdelete);})),this.on("select",lang.hitch(this,this._onTreeNodeClicked)));this.connect(this,"onClick","_onTreeNodeClicked");var _be1=lang.hitch(this,"_resetSelectionToLastSelected");this.subscribe("/epi/dnd/dropdata",_be1);this.subscribe("/dnd/cancel",_be1);},startup:function(){this.inherited(arguments);when(this.getCurrentContext(),lang.hitch(this,function(_be2){this.contextChanged(_be2);}));},_preparePathNodes:function(_be3){var self=this,_be4;_bc3.some(_be3,function(_be5,_be6){var _be7=self.getNodesByItem(_be5),_be8=_be7.length===1&&!_be7[0];if(_be6>0&&_be8){_bc3.forEach(_be4,function(_be9){if(_be9.state==="LOADED"){_be9._loadDeferred=null;}});return true;}_be4=_be7;return false;});},_resetSelectionToLastSelected:function(){if(!this._lastSelectedContentReference||!this.selectedItem){return;}if(this.selectedItem.contentLink!==this._lastSelectedContentReference){this.selectContent(this._lastSelectedContentReference);}},_startupCommands:function(){this._showLanguagesCommand=new _bd4({model:this});var _bea=this._contextMenuCommandProvider.get("commands");_bc3.some(_bea,lang.hitch(this,function(_beb){if(_beb instanceof _bdc){this._copyCommand=_beb;}else{if(_beb instanceof _bdd){this._cutCommand=_beb;}else{if(_beb instanceof _bdf){this._pasteCommand=_beb;}else{if(_beb instanceof _bde){this._deleteCommand=_beb;}}}}if(this._deleteCommand&&this._pasteCommand&&this._copyCommand){return true;}}));this.commands=[this._showLanguagesCommand].concat(_bea);},_setShowAllLanguagesAttr:function(_bec){this._set("showAllLanguages",_bec);this.model.set("showAllLanguages",_bec);},_onTreeNodeClicked:function(page,node,_bed){when(this.getCurrentContext(),lang.hitch(this,function(_bee){var _bef=_bee?_bd8.compareIgnoreVersion(page.contentLink,_bee.id):true;var _bf0=function(_bf1){var _bf2={typeName:_bcd.getResourceValue(page.typeIdentifier,"name"),name:page.name};_bc7.publish("/epi/shell/context/request",{uri:page.uri},{sender:lang.mixin(_bf1,{requestedContent:_bf2}),forceContextChange:true});};if(!_bef){_bf0(this);return;}if(this.selectContentThrottle){clearTimeout(this.selectContentThrottle);this.selectContentThrottle=null;}this.selectContentThrottle=setTimeout(_bf0,300);}));},contentContextChanged:function(_bf3,_bf4){var _bf5=new _bd8(_bf3.id),_bf6=_bf5.createVersionUnspecificReference().toString(),_bf7=_bd2.wastebasketPage.toString();this.inherited(arguments);if(_bf6===_bf7){return;}this.selection.set("data",this._getSelectionData(this.selectedItem));this._lastSelectedContentReference=_bf6;if(_bf4&&_bf4.sender===this&&this.selectedItem&&_bf6===this.selectedItem.contentLink){this._updateGlobalToolbarButtons();}if(this.isSupportedType(_bf3.dataType)){this.selectContent(_bf6,false,true).then(lang.hitch(this,"_updateGlobalToolbarButtons"));}},isSupportedType:function(_bf8){return this.tree.model.isSupportedType(_bf8);},_getSelectionData:function(_bf9){return _bf9?[{type:"epi.cms.contentdata",data:_bf9}]:[];},_updateGlobalToolbarButtons:function(_bfa){var node=_bfa||this.get("selectedNode"),_bfb=node?this._getSelectionData(node.item):[];if(this._createCommand){this._createCommand.set("model",node&&node.item);}this._contextMenuCommandProvider.updateCommandModel(node&&node.item);this.selection.set("data",_bfb);},contextChangeFailed:function(_bfc,_bfd,_bfe){this.inherited(arguments);if(_bfc){if(_bfe&&_bfe.sender===this){this.selectContent(_bfc.contentLink);}}},_removeHighlightClass:function(){if(this._focusNode&&this._focusNode!=this.selectedNode&&this._focusNode.rowNode){_bc6.remove(this._focusNode.rowNode,"dijitTreeRowSelected");}},_onContextMenuClose:function(){this._removeHighlightClass();},_onContextMenuOpen:function(){if(this._focusNode){_bc6.add(this._focusNode.rowNode,"dijitTreeRowSelected");}},_set_focusNodeAttr:function(_bff){this._removeHighlightClass();this._focusNode=_bff;},_showContextMenu:function(evt){if(!this._contextMenu){this.own(this._contextMenu=new _bda({leftClickToOpen:true,category:"context"}),_bc4.connect(this._contextMenu,"onClose",this,"_onContextMenuClose"),_bc4.connect(this._contextMenu,"onOpen",this,"_onContextMenuOpen"));this._contextMenu.addProvider(this._contextMenuCommandProvider);this._contextMenu.startup();}this._contextMenu.scheduleOpen(evt.target,null,{x:evt.x,y:evt.y});},_createTreeNode:function(){var _c00=this.inherited(arguments);if(_c00.item.contentLink==this.tree.model.rootPage){var _c01=_bc3.filter(_c00.domNode.children,function(_c02){return _c02.className==this._separatorAfterCssClass;},this);}_c00.on("onContextMenuClick",lang.hitch(this,function(node){this._updateGlobalToolbarButtons(node.node);this.set("_focusNode",node.node);this._showContextMenu(node);}));return _c00;},getIconClass:function(item,_c03){var _c04=this.inherited(arguments);if(!item||!item.properties||!item.properties.pageShortcutType){return _c04;}var _c05="";switch(item.properties.pageShortcutType){case _bd3.pageShortcutTypes.Shortcut:_c05="epi-iconObjectInternalLink";break;case _bd3.pageShortcutTypes.External:_c05="epi-iconObjectExternalLink";break;case _bd3.pageShortcutTypes.Inactive:_c05="epi-iconObjectNoLink";break;case _bd3.pageShortcutTypes.FetchData:_c05=!item.hasTemplate?"epi-iconObjectContainerFetchContent":"epi-iconObjectFetchContent";break;default:break;}return _c05?_c04+" "+_c05:_c04;},enableDrop:function(node,_c06){node._droppable=_c06;},_showNotificationMessage:function(_c07){var _c08=new _bce({destroyOnHide:true,description:_bc9.toHTML(_c07)});_c08.show();},_onNodeMouseEnter:function(node,evt){this.inherited(arguments);node.showContextMenu(true);},_onNodeMouseLeave:function(node,evt){this.inherited(arguments);node.showContextMenu(false);}});});},"epi-cms/contentediting/PageShortcutTypeSupport":function(){define([],function(){var _c09={pageShortcutTypes:{Normal:0,Shortcut:1,External:2,Inactive:3,FetchData:4}};return _c09;});},"epi-cms/command/ShowAllLanguages":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi-cms/ApplicationSettings","epi/shell/command/ToggleCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting.command"],function(_c0a,lang,when,_c0b,_c0c,_c0d,_c0e){return _c0a([_c0d],{property:"showAllLanguages",category:"setting",order:50,_watchHandle:null,postscript:function(){this.inherited(arguments);this.currentContentLanguage=this.currentContentLanguage||_c0c.currentContentLanguage;this.store=this.store||_c0b.resolve("epi.storeregistry").get("epi.cms.language");when(this.store.get(this.currentContentLanguage),lang.hitch(this,function(_c0f){this.set("label",lang.replace(_c0e.showonlycontentin,[_c0f.name]));}));},_execute:function(){this.set("active",!this.active);this.model.set(this.property,!this.active);},_onModelChange:function(){if(this.model&&this.model._isSiteMultilingual){when(this.model._isSiteMultilingual(),lang.hitch(this,function(_c10){this.set("canExecute",_c10);}));}}});});},"epi-cms/component/_ContentNavigationTreeNode":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/Deferred","dojo/Evented","dojo/mouse","dojo/on","dojo/when","dojo/text!./templates/_ContentNavigationTreeNode.html","dijit/Tree","dijit/focus","epi/datetime","epi/dependency","epi/string","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/Tooltip","epi-cms/core/ContentReference","epi-cms/widget/_ContentTreeNode","epi-cms/widget/viewmodel/ContentStatusViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.pagetree"],function(_c11,_c12,_c13,lang,_c14,_c15,_c16,_c17,_c18,_c19,on,when,_c1a,Tree,_c1b,_c1c,_c1d,_c1e,_c1f,_c20,_c21,_c22,_c23,res){return _c12([_c22,_c1f,_c18],{templateString:_c1a,res:res,hasContextMenu:true,_pageLocked:"epi-pt-accessRights",_pageBeingEdited:"epi-pt-edited",_contextMenuClass:"epi-iconContextMenu",_iconNodeClass:"",_iconNodeToolTip:undefined,_inUseTooltip:undefined,_selected:false,_contentTypeStore:null,postMixInProperties:function(){this.inherited(arguments);var _c24=_c1d.resolve("epi.storeregistry");this._contentTypeStore=_c24.get("epi.cms.contenttype");},postCreate:function(){this.inherited(arguments);this.set("model",new _c23({contentStatus:this.item.status}));},modelBindingMap:{"statusIcon":["statusIcon"],"statusMessage":["statusMessage"]},_setStatusMessageAttr:function(_c25){_c14.set(this.iconNodeStatus,"title",_c1e.toTooltipText(_c25));},_setStatusIconAttr:function(_c26){if(!(_c26 instanceof Array)){return;}_c15.remove(this.iconNodeStatus);_c15.add(this.iconNodeStatus,"dijitTreeIcon epi-extraIcon");_c11.forEach(_c26,function(_c27){_c15.add(this.iconNodeStatus,_c27);},this);},destroy:function(){this.inherited(arguments);this._destroyIconNodeTooltip();},setSelected:function(_c28){this.inherited(arguments);if(this.hasContextMenu){_c15.toggle(this.iconNodeMenu,this._contextMenuClass,this._selected=_c28);}},showContextMenu:function(show){if(!this._selected&&this.hasContextMenu){_c15.toggle(this.iconNodeMenu,this._contextMenuClass,show);}},_onClickIconNodeMenu:function(evt){_c13.stop(evt);this.labelNode.focus();this.emit("onContextMenuClick",{node:this,target:evt.target,x:evt.pageX,y:evt.pageY});},_onMouseDownIconNodeMenu:function(evt){_c13.stop(evt);},_updateIndividualLayout:function(){this._updateAccessRightIcon();if(this.model){this.model.set("contentStatus",this.item.status);}this._createTooltip();},_updateAccessRightIcon:function(){if(this.item.accessMask===0||this.item.accessMask==1){_c15.add(this.iconNodeAccess,this._pageLocked);_c14.set(this.iconNodeAccess,"title",this.res.tooltip.pagelocked);_c15.add(this.contentNode,"epi-treeReadOnly");}else{if(this.item.inUseNotifications&&this.item.inUseNotifications.length>0){_c15.add(this.iconNodeAccess,this._pageBeingEdited);var _c29=[{label:this.res.tooltip.beingedited}];_c11.forEach(this.item.inUseNotifications,function(_c2a){var date=_c1c.toUserFriendlyHtml(_c2a.created);_c29.push({label:_c2a.userName+", "+date,htmlEncode:false});},this);this._populateIconNodeTooltip(_c29,this.iconNodeAccess);}else{_c15.remove(this.iconNodeAccess,this._pageBeingEdited);_c15.remove(this.iconNodeAccess,this._pageLocked);_c15.remove(this.contentNode,"epi-treeReadOnly");this._destroyIconNodeTooltip();}}},_createTooltip:function(){if(this.indent<0){return;}var _c2b=new _c21(this.item.contentLink);var _c2c=this.item.name+", ID: "+_c2b.id+" (Type: "+this.item.contentTypeName+")";_c14.set(this.labelNode,"title",_c2c);_c14.set(this.iconNode,"title",_c2c);},_populateIconNodeTooltip:function(_c2d,_c2e){if(!this._iconNodeToolTip){this._iconNodeToolTip=new _c20({position:["after-centered","below"]});}this._iconNodeToolTip.tooltipRows=_c2d;this.own(on(_c2e,_c19.enter,lang.hitch(this,function(){if(this._iconNodeToolTip){this._iconNodeToolTip.open(_c2e);}})),on(_c2e,_c19.leave,lang.hitch(this,function(){if(this._iconNodeToolTip){this._iconNodeToolTip.close();}})));},_destroyIconNodeTooltip:function(){if(this._iconNodeToolTip){this._iconNodeToolTip.destroyRecursive();this._iconNodeToolTip=null;}}});});},"url:epi-cms/component/templates/_ContentNavigationTreeNode.html":"<div class=\"dijitTreeNode\" role=\"presentation\">\r\n    <div data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow dijitInline\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon epi-pt-contextMenu\" role=\"presentation\" data-dojo-attach-event=\"onmousedown:_onMouseDownIconNodeMenu, click: _onClickIconNodeMenu\" >&nbsp;</span>\r\n                <span data-dojo-attach-point=\"iconNodeStatus\" class=\"epi-extraIcon\" role=\"presentation\">&nbsp;</span>\r\n                <span data-dojo-attach-point=\"iconNodeAccess\" class=\"epi-extraIcon\" role=\"presentation\">&nbsp;</span>\r\n                <span data-dojo-attach-point=\"iconNodeLanguage\" class=\"epi-extraIcon epi-pt-currentLanguageMissing\" role=\"presentation\">&nbsp;</span>\r\n            </span>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n        </span>\r\n    </div>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>","epi/shell/widget/Tooltip":function(){define("epi/shell/widget/Tooltip",["dojo/_base/declare","dojo/string","dojox/html/entities","dojox/html/ellipsis","dijit/Tooltip"],function(_c2f,_c30,_c31,_c32,_c33){return _c2f(_c33,{showDelay:600,position:["after","before","below","above"],tooltipRows:null,tooltipRowTemplate:"<span>${label}</span>: ${text}",tooltipRowNoTextTemplate:"<span>${label}</span>",getContent:function(){if(this.tooltipRows){var _c34="<ul class='dijitInline dijitReset epi-tooltip-ellipsis'>";for(var i=0;i<this.tooltipRows.length;i++){var row=this.tooltipRows[i];if(!row.text){row.text="";}if(row.htmlEncode===undefined||row.htmlEncode===true){row.label=_c31.encode(row.label);row.text=_c31.encode(row.text);}if(!row.text){_c34+="<li class='dojoxEllipsis'>"+_c30.substitute(this.tooltipRowNoTextTemplate,row)+"</li>";}else{_c34+="<li class='dojoxEllipsis'>"+_c30.substitute(this.tooltipRowTemplate,row)+"</li>";}}_c34+="</ul>";return _c34;}return this.inherited(arguments);}});});},"epi-cms/widget/viewmodel/ContentStatusViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/when","dojo/promise/all","dojo/Stateful","epi/dependency","epi/shell/_StatefulGetterSetterMixin","epi-cms/contentediting/ContentActionSupport","epi/shell/_ContextMixin","epi-cms/ContentLanguageHelper","epi/i18n!epi/cms/nls/episerver.cms.contentediting.versionstatus"],function(_c35,_c36,_c37,lang,when,all,_c38,_c39,_c3a,_c3b,_c3c,_c3d,_c3e){return _c36([_c38,_c3c],{_contentStructureStore:null,autoLoadStatus:false,statusIcon:null,statusMessage:null,constructor:function(){this._statusIconArray=[["epi-statusIndicatorIcon","epi-statusIndicator0"],["epi-statusIndicatorIcon","epi-statusIndicator1"],["epi-statusIndicatorIcon","epi-statusIndicator2"],["epi-statusIndicatorIcon","epi-statusIndicator3"],["epi-statusIndicatorIcon","epi-statusIndicator4"],["epi-statusIndicatorIcon","epi-statusIndicator5"],["epi-statusIndicatorIcon","epi-statusIndicator6"],["epi-statusIndicatorIcon","epi-statusIndicator7"]];this._statusMessageArray=[_c3e.notcreated,_c3e.rejected,_c3e.checkedout,_c3e.checkedin,_c3e.published,_c3e.previouslypublished,_c3e.delayedpublish,_c3e.expired];},postscript:function(){this.inherited(arguments);this._contentStructureStore=this._contentStructureStore||_c39.resolve("epi.storeregistry").get("epi.cms.content.light");},loadStatus:function(){if(!this.contentLink){return;}when(this.getCurrentContext(),lang.hitch(this,function(ctx){when(this._contentStructureStore.refresh(this.contentLink),lang.hitch(this,function(_c3f){if(_c3f&&_c3f.status!==undefined){this.set("content",_c3f);}}));}));},_contentLinkSetter:function(_c40){if(!_c40){return;}this.contentLink=_c40;if(this.autoLoadStatus){this.loadStatus();}},_isDeletedGetter:function(){return this.get("content")&&this.get("content").isDeleted;},_isTranslationNeededGetter:function(){return this.get("content")&&this.get("content").missingLanguageBranch&&this.get("content").missingLanguageBranch.isTranslationNeeded;},_missingLanguageBranchGetter:function(){return this.get("content")&&this.get("content").missingLanguageBranch;},_contentSetter:function(_c41){this.content=_c41;this.set("contentStatus",_c41.status);},_contentStatusSetter:function(_c42){this.contentStatus=_c42;if(!_c42){return;}this.set("statusIcon",this._statusIconArray[_c42]);when(this._getStatusMessage(),lang.hitch(this,function(_c43){this.set("statusMessage",_c43);}));},_getStatusMessage:function(){if(this.get("isDeleted")){return _c3e.versionnotfound;}if(this.get("isTranslationNeeded")){return _c3d.getMissingLanguageMessage(this.content);}if(this.get("isVisibleOnSite")){return null;}return this._statusMessageArray[this.get("contentStatus")];},_isVisibleOnSiteGetter:function(){var _c44=this.get("missingLanguageBranch");if(this.get("isDeleted")||_c44&&_c44.reason==6){return false;}return this.get("contentStatus")===_c3b.versionStatus.Published;}});});},"epi-cms/component/ContentContextMenuCommandProvider":function(){define(["dojo/_base/declare","dojo/_base/array","epi/shell/command/_CommandProviderMixin","../command/CopyContent","../command/CutContent","../command/PasteContent","../command/TranslateContent","../command/DeleteContent","../widget/CreateCommandsMixin","epi/shell/selection"],function(_c45,_c46,_c47,_c48,_c49,_c4a,_c4b,_c4c,_c4d,_c4e){return _c45([_c47,_c4d],{treeModel:null,clipboardManager:null,_settings:null,_newContentCommand:null,_translateContentCommand:null,constructor:function(_c4f){_c45.safeMixin(this,_c4f);},postscript:function(){this.inherited(arguments);this._settings={category:"context",model:this.treeModel,clipboard:this.clipboardManager,selection:new _c4e()};this._translateContentCommand=new _c4b({category:"context"});var _c50=this.getCreateCommands(),_c51=[];for(var key in _c50){_c51.push(_c50[key].command);}_c51.push(this._translateContentCommand,new _c49(this._settings),new _c48(this._settings),new _c4a(this._settings),new _c4c(this._settings));this.set("commands",_c51);},updateCommandModel:function(_c52){_c46.forEach(this.get("commands"),function(_c53){if(_c53.isInstanceOf(this.createCommandClass)||_c53.popup){_c53.set("model",_c52);}},this);this._translateContentCommand.set("model",_c52);this._settings.selection.set("data",[{type:"epi.cms.contentdata",data:_c52}]);}});});},"epi-cms/component/RecentlyChanged":function(){define(["dojo/_base/declare","dojo/_base/lang","epi","epi/dependency","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/command/_Command","epi/shell/command/ToggleCommand","epi/shell/widget/layout/ComponentContainer","epi/shell/widget/dialog/Alert","epi/shell/widget/_FocusableMixin","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/widget/_GridWidgetBase","epi/i18n!epi/cms/nls/episerver.cms.components.recentlychanged"],function(_c54,lang,epi,_c55,_c56,_c57,_c58,_c59,_c5a,_c5b,_c5c,_c5d,_c5e,_c5f){return _c54([_c5e,_c56,_c5b],{_componentsController:null,onlyShowMyChanges:false,postMixInProperties:function(){this.storeKeyName="epi.cms.content.search";this._componentsController=_c55.resolve("epi.shell.controller.Components");this.ignoreVersionWhenComparingLinks=false;this.inherited(arguments);},buildRendering:function(){this.inherited(arguments);var _c60=lang.mixin({columns:this._createGridColumns(),store:this.store,selectionMode:"single"},this.defaultGridMixin);this.grid=new this._gridClass(_c60,this.domNode);},startup:function(){if(this._started){return;}this.inherited(arguments);var _c61=[new _c58({label:_c5f.showmychanges,category:"setting",model:this,property:"onlyShowMyChanges"}),new _c57({iconClass:"epi-iconReload",label:epi.resources.action.refresh,canExecute:true,_execute:lang.hitch(this,function(){this.grid.refresh();})})];this.add("commands",_c61);this.fetchData();},_setOnlyShowMyChangesAttr:function(_c62){this._set("onlyShowMyChanges",_c62);if(this._started){this._saveSettingComponent("onlyShowMyChanges",_c62);}},fetchData:function(){var _c63=this._getQuery();this.grid.set("query",_c63.query,_c63.options);},_getQuery:function(){return {query:{query:"recentlychanged",onlyShowMyChanges:this.onlyShowMyChanges,keepversion:true},options:{ignore:["query"],sort:[{attribute:"saved",descending:true}]}};},_createGridColumns:function(){var _c64={name:{label:epi.resources.header.name,className:"epi-width50",renderCell:lang.hitch(this,this._renderContentItem)},status:{label:epi.resources.header.status,renderCell:function(item,_c65,node,_c66){node.innerHTML=_c5c.getVersionStatus(_c65);},className:"epi-width15"},saved:{label:epi.resources.header.saved,formatter:this._localizeDate,className:"epi-width25"}};if(!this.get("onlyShowMyChanges")){_c64.changedBy={label:epi.resources.header.by,formatter:this._createUserFriendlyUsername,className:"epi-width10"};}return _c64;},_saveSettingComponent:function(type,_c67){var item=this._componentsController.getComponentDefinition(this.id),_c68;if(item){item.settings.onlyShowMyChanges=_c67;var _c69=this._componentsController.saveComponent(item);_c69.then(function(done){},function(){var _c6a=new _c5a({description:_c5f.errormessage});_c6a.show();});_c68=this._getQuery();this.grid.query=_c68.query;this.grid.queryOptions=_c68.options;this.grid.set("columns",this._createGridColumns());}},onContextChanged:function(_c6b){this.grid.clearSelection();var _c6c=new _c5d(_c6b.id).createVersionUnspecificReference().toString();var row=this.grid.row(_c6c);if(row){this.grid.select(row);}}});});},"epi-cms/component/SharedBlocks":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/on","dojo/when","epi-cms/widget/HierarchicalList","epi-cms/component/SharedBlocksViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.createblock","epi/i18n!epi/cms/nls/contenttypes.blockdata"],function(_c6d,_c6e,lang,on,when,_c6f,_c70,_c71,res){return _c6e([_c6f],{showCreateContentArea:true,modelClassName:_c70,noDataMessage:_c71.nocontent,hierarchicalListClass:"epi-blockList",createContentIcon:"epi-iconPlus",createContentText:res.create,postCreate:function(){this.inherited(arguments);this.own(this.list.grid.on("dgrid-refresh-complete",lang.hitch(this,function(evt){when(evt.results,lang.hitch(this,function(_c72){var _c73=_c72.length>0?false:this.model.getCommand("newBlockDefault").get("canExecute");this._toggleCreateContentArea(_c73);}));})));},_setupList:function(){this.inherited(arguments);var _c74=this.model._commandRegistry,_c75=this.list;this.own(on(_c75,"copyOrCut",function copyOrCuthandler(copy){copy?_c74.copy.command.execute():_c74.cut.command.execute();}),on(_c75,"delete",function(){_c74["delete"].command.execute();}),on(_c75,"createItemAction",function(){_c74.newBlockDefault.command.execute();}),on(_c75,"itemAction",function(){_c74.edit.command.execute();}));}});});},"epi-cms/component/SharedBlocksViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi-cms/widget/ContextualContentForestStoreModel","epi-cms/widget/viewmodel/HierarchicalListViewModel","epi-cms/command/NewContent","epi-cms/command/ShowAllLanguages","epi/i18n!epi/cms/nls/episerver.cms.components.createblock"],function(_c76,lang,when,_c77,_c78,_c79,_c7a,_c7b){return _c76([_c78],{treeStoreModelClass:_c77,_updateTreeContextCommandModels:function(_c7c){this.inherited(arguments);var _c7d=lang.hitch(this.treeStoreModel,this.treeStoreModel.translate);this._commandRegistry.translate.command.set("model",_c7c);this._commandRegistry.translate.command.set("executeDelegate",_c7d);this._commandRegistry.newBlockDefault.command.set("model",_c7c);},_setupCommands:function(){this.inherited(arguments);var _c7e={newBlockDefault:{command:new _c79({contentType:"episerver.core.blockdata",iconClass:"epi-iconPlus",label:_c7b.command.label,resources:_c7b})},allLanguages:{command:new _c7a({model:this}),order:55}};this._commandRegistry=lang.mixin(this._commandRegistry,_c7e);this.pseudoContextualCommands.push(this._commandRegistry.newBlockDefault.command);}});});},"epi-cms/component/SiteTree":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/_base/array","dojo/when","dojo/dom-style","dijit/layout/_LayoutWidget","dijit/Tooltip","epi-cms/component/SiteTreeModel","epi-cms/component/SiteTreeNode","epi/dependency","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/command/ToggleCommand","epi/shell/widget/Tree","epi/i18n!epi/cms/nls/episerver.cms.components.sitetree"],function(_c7f,_c80,lang,_c81,when,_c82,_c83,_c84,_c85,_c86,_c87,_c88,_c89,Tree,_c8a){return _c7f([_c83,_c88],{profile:null,buildRendering:function(){this.inherited(arguments);_c82.set(this.domNode,"overflow","auto");},postCreate:function(){this.inherited(arguments);var _c8b=_c87.resolve("epi.storeregistry");var _c8c=_c8b.get("epi.cms.sitestructure");this.profile=this.profile||_c87.resolve("epi.shell.Profile");var _c8d=this._treeModel=new _c85({store:_c8c});var _c8e=new _c89({category:"setting",label:_c8a.showalllanguages,model:_c8d,property:"showAllLanguages"});this.commands.push(_c8e);this._tree=new Tree({model:_c8d,showRoot:false,"class":"epi-simpleTree",persist:false,onClick:lang.hitch(this,function(item){if(!item.host||!item.languageId){window.location.replace(item.editUrl);}else{var self=this;when(self.profile.setContentLanguage(item.languageId,item.host),function(){var _c8f=item.editUrl;if(_c81.some(item.hosts,function(host){return host===window.location.host;})){_c8f=item.editUrl.replace(new RegExp(item.host,"i"),window.location.host);}window.location.replace(_c8f);});}}),_createTreeNode:function(args){return new _c86(args);},_onNodeMouseEnter:function(node){if(node.item.isLanguageNode&&!node.item.isAvailable){_c84.show(_c8a.notavailabletooltip,node.labelNode,["after-centered","below"]);}},_onNodeMouseLeave:function(node){_c84.hide(node.labelNode);}});this.addChild(this._tree);},layout:function(){this._tree.resize();},startup:function(){this.inherited(arguments);this._setTreePath();},_setTreePath:function(){_c80.when(this._treeModel.getCurrentSite(),lang.hitch(this,function(_c90){this._tree.set("path",["root",_c90.currentSite,_c90.currentEditLanguageId]);}));}});});},"epi-cms/component/SiteTreeNode":function(){define(["dojo/dom-class","epi-cms/widget/_ContentTreeNode"],function(_c91,_c92){return dojo.declare([_c92],{_updateItemClasses:function(item){this.inherited(arguments);if(item.isLanguageNode&&!item.isAvailable){_c91.add(this.domNode,"epi-st-disabledRow");}else{_c91.remove(this.domNode,"epi-st-disabledRow");}if(!item.isLanguageNode){_c91.add(this.iconNode,"epi-iconObjectStart");}}});});},"epi-cms/component/Tasks":function(){define(["dojo","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-construct","dojo/dom-geometry","dojo/topic","dijit/form/Select","dijit/_TemplatedMixin","dijit/_Container","dijit/layout/_LayoutWidget","dijit/_WidgetsInTemplateMixin","epi","epi-cms/component/ContentQueryGrid","dojo/text!./templates/Tasks.html","epi/i18n!epi/cms/nls/episerver.cms.components.tasks"],function(dojo,_c93,_c94,lang,_c95,_c96,_c97,_c98,_c99,_c9a,_c9b,_c9c,epi,_c9d,_c9e,_c9f){return _c93([_c9a,_c9b,_c99,_c9c],{templateString:_c9e,resources:_c9f,querySelection:null,_selectionChangedEventHandler:null,postCreate:function(){this.inherited(arguments);var _ca0=_c94.map(this.queries,function(item){return {label:item.displayName,value:item.name};},this);this.querySelection=new _c98({name:"QuerySelection",options:_ca0});_c95.place(this.querySelection.domNode,this.reloadButton.domNode,"before");this._reloadQuery();this.own(this.querySelection.on("change",lang.hitch(this,this._reloadQuery)),_c97.subscribe("/epi/cms/action/refreshmytasks",lang.hitch(this,this._reloadQuery)));},resize:function(_ca1){this.inherited(arguments);this.contentQuery.resize(this._caculateContentQuerySize(_ca1));},_caculateContentQuerySize:function(_ca2){var _ca3=_c96.getMarginBox(this.toolbar);return {w:_ca2.w,h:_ca2.h-_ca3.h};},_reloadQuery:function(){var _ca4=this.querySelection.get("value");_c94.some(this.queries,function(item,_ca5){if(item.name==_ca4){this.contentQuery.set("ignoreVersionWhenComparingLinks",!item.versionSpecific);return true;}},this);this.contentQuery.set("queryName",_ca4);}});});},"dijit/form/Select":function(){require({cache:{"url:dijit/form/templates/Select.html":"<table class=\"dijit dijitReset dijitInline dijitLeft\"\n\tdata-dojo-attach-point=\"_buttonNode,tableNode,focusNode\" cellspacing='0' cellpadding='0'\n\trole=\"listbox\" aria-haspopup=\"true\"\n\t><tbody role=\"presentation\"><tr role=\"presentation\"\n\t\t><td class=\"dijitReset dijitStretch dijitButtonContents\" role=\"presentation\"\n\t\t\t><div class=\"dijitReset dijitInputField dijitButtonText\"  data-dojo-attach-point=\"containerNode,_popupStateNode\" role=\"presentation\"></div\n\t\t\t><div class=\"dijitReset dijitValidationContainer\"\n\t\t\t\t><input class=\"dijitReset dijitInputField dijitValidationIcon dijitValidationInner\" value=\"&#935; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t/></div\n\t\t\t><input type=\"hidden\" ${!nameAttrSetting} data-dojo-attach-point=\"valueNode\" value=\"${value}\" aria-hidden=\"true\"\n\t\t/></td\n\t\t><td class=\"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\"\n\t\t\tdata-dojo-attach-point=\"titleNode\" role=\"presentation\"\n\t\t\t><input class=\"dijitReset dijitInputField dijitArrowButtonInner\" value=\"&#9660; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t\t${_buttonInputDisabled}\n\t\t/></td\n\t></tr></tbody\n></table>\n"}});define("dijit/form/Select",["dojo/_base/array","dojo/_base/declare","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/_base/event","dojo/i18n","dojo/_base/lang","dojo/sniff","./_FormSelectWidget","../_HasDropDown","../Menu","../MenuItem","../MenuSeparator","../Tooltip","dojo/text!./templates/Select.html","dojo/i18n!./nls/validate"],function(_ca6,_ca7,_ca8,_ca9,_caa,_cab,i18n,lang,has,_cac,_cad,Menu,_cae,_caf,_cb0,_cb1){var _cb2=_ca7("dijit.form._SelectMenu",Menu,{autoFocus:true,buildRendering:function(){this.inherited(arguments);var o=(this.menuTableNode=this.domNode);var n=(this.domNode=this.ownerDocument.createElement("div"));n.style.cssText="overflow-x: hidden; overflow-y: scroll";if(o.parentNode){o.parentNode.replaceChild(n,o);}_ca9.remove(o,"dijitMenuTable");n.className=o.className+" dijitSelectMenu";o.className="dijitReset dijitMenuTable";o.setAttribute("role","listbox");n.setAttribute("role","presentation");n.appendChild(o);},postCreate:function(){this.inherited(arguments);this.connect(this.domNode,"onselectstart",_cab.stop);},focus:function(){var _cb3=false,val=this.parentWidget.value;if(lang.isArray(val)){val=val[val.length-1];}if(val){_ca6.forEach(this.parentWidget._getChildren(),function(_cb4){if(_cb4.option&&(val===_cb4.option.value)){_cb3=true;this.focusChild(_cb4,false);}},this);}if(!_cb3){this.inherited(arguments);}},resize:function(mb){if(mb){_caa.setMarginBox(this.domNode,mb);if("w" in mb){this.menuTableNode.style.width="100%";}}}});var _cb5=_ca7("dijit.form.Select",[_cac,_cad],{baseClass:"dijitSelect dijitValidationTextBox",templateString:_cb1,_buttonInputDisabled:has("ie")?"disabled":"",required:false,state:"",message:"",tooltipPosition:[],emptyLabel:"&#160;",_isLoaded:false,_childrenLoaded:false,_fillContent:function(){this.inherited(arguments);if(this.options.length&&!this.value&&this.srcNodeRef){var si=this.srcNodeRef.selectedIndex||0;this.value=this.options[si>=0?si:0].value;}this.dropDown=new _cb2({id:this.id+"_menu",parentWidget:this});_ca9.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "));},_getMenuItemForOption:function(_cb6){if(!_cb6.value&&!_cb6.label){return new _caf({ownerDocument:this.ownerDocument});}else{var _cb7=lang.hitch(this,"_setValueAttr",_cb6);var item=new _cae({option:_cb6,label:_cb6.label||this.emptyLabel,onClick:_cb7,ownerDocument:this.ownerDocument,dir:this.dir,disabled:_cb6.disabled||false});item.focusNode.setAttribute("role","option");return item;}},_addOptionItem:function(_cb8){if(this.dropDown){this.dropDown.addChild(this._getMenuItemForOption(_cb8));}},_getChildren:function(){if(!this.dropDown){return [];}return this.dropDown.getChildren();},_loadChildren:function(_cb9){if(_cb9===true){if(this.dropDown){delete this.dropDown.focusedChild;}if(this.options.length){this.inherited(arguments);}else{_ca6.forEach(this._getChildren(),function(_cba){_cba.destroyRecursive();});var item=new _cae({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(item);}}else{this._updateSelection();}this._isLoaded=false;this._childrenLoaded=true;if(!this._loadingStore){this._setValueAttr(this.value,false);}},_refreshState:function(){if(this._started){this.validate(this.focused);}},startup:function(){this.inherited(arguments);this._refreshState();},_setValueAttr:function(_cbb){this.inherited(arguments);_ca8.set(this.valueNode,"value",this.get("value"));this._refreshState();},_setDisabledAttr:function(_cbc){this.inherited(arguments);this._refreshState();},_setRequiredAttr:function(_cbd){this._set("required",_cbd);this.focusNode.setAttribute("aria-required",_cbd);this._refreshState();},_setOptionsAttr:function(_cbe){this._isLoaded=false;this._set("options",_cbe);},_setDisplay:function(_cbf){var lbl=_cbf||this.emptyLabel;this.containerNode.innerHTML="<span role=\"option\" class=\"dijitReset dijitInline "+this.baseClass.replace(/\s+|$/g,"Label ")+"\">"+lbl+"</span>";},validate:function(_cc0){var _cc1=this.disabled||this.isValid(_cc0);this._set("state",_cc1?"":(this._hasBeenBlurred?"Error":"Incomplete"));this.focusNode.setAttribute("aria-invalid",_cc1?"false":"true");var _cc2=_cc1?"":this._missingMsg;if(_cc2&&this.focused&&this._hasBeenBlurred){_cb0.show(_cc2,this.domNode,this.tooltipPosition,!this.isLeftToRight());}else{_cb0.hide(this.domNode);}this._set("message",_cc2);return _cc1;},isValid:function(){return (!this.required||this.value===0||!(/^\s*$/.test(this.value||"")));},reset:function(){this.inherited(arguments);_cb0.hide(this.domNode);this._refreshState();},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=i18n.getLocalization("dijit.form","validate",this.lang).missingMessage;},postCreate:function(){this.inherited(arguments);this.connect(this.domNode,"onselectstart",_cab.stop);this.domNode.setAttribute("aria-expanded","false");if(has("ie")<9){this.defer(function(){try{var s=domStyle.getComputedStyle(this.domNode);if(s){var ff=s.fontFamily;if(ff){var _cc3=this.domNode.getElementsByTagName("INPUT");if(_cc3){for(var i=0;i<_cc3.length;i++){_cc3[i].style.fontFamily=ff;}}}}}catch(e){}});}},_setStyleAttr:function(_cc4){this.inherited(arguments);_ca9.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width);},isLoaded:function(){return this._isLoaded;},loadDropDown:function(_cc5){this._loadChildren(true);this._isLoaded=true;_cc5();},closeDropDown:function(){this.inherited(arguments);if(this.dropDown&&this.dropDown.menuTableNode){this.dropDown.menuTableNode.style.width="";}},destroy:function(_cc6){if(this.dropDown&&!this.dropDown._destroyed){this.dropDown.destroyRecursive(_cc6);delete this.dropDown;}this.inherited(arguments);},_onFocus:function(){this.validate(true);this.inherited(arguments);},_onBlur:function(){_cb0.hide(this.domNode);this.inherited(arguments);this.validate(false);}});_cb5._Menu=_cb2;return _cb5;});},"dijit/form/_FormSelectWidget":function(){define("dijit/form/_FormSelectWidget",["dojo/_base/array","dojo/_base/Deferred","dojo/aspect","dojo/data/util/sorter","dojo/_base/declare","dojo/dom","dojo/dom-class","dojo/_base/kernel","dojo/_base/lang","dojo/query","dojo/when","dojo/store/util/QueryResults","./_FormValueWidget"],function(_cc7,_cc8,_cc9,_cca,_ccb,dom,_ccc,_ccd,lang,_cce,when,_ccf,_cd0){var _cd1=_ccb("dijit.form._FormSelectWidget",_cd0,{multiple:false,options:null,store:null,query:null,queryOptions:null,labelAttr:"",onFetch:null,sortByLabel:true,loadChildrenOnOpen:false,onLoadDeferred:null,getOptions:function(_cd2){var _cd3=_cd2,opts=this.options||[],l=opts.length;if(_cd3===undefined){return opts;}if(lang.isArray(_cd3)){return _cc7.map(_cd3,"return this.getOptions(item);",this);}if(lang.isObject(_cd2)){if(!_cc7.some(this.options,function(o,idx){if(o===_cd3||(o.value&&o.value===_cd3.value)){_cd3=idx;return true;}return false;})){_cd3=-1;}}if(typeof _cd3=="string"){for(var i=0;i<l;i++){if(opts[i].value===_cd3){_cd3=i;break;}}}if(typeof _cd3=="number"&&_cd3>=0&&_cd3<l){return this.options[_cd3];}return null;},addOption:function(_cd4){if(!lang.isArray(_cd4)){_cd4=[_cd4];}_cc7.forEach(_cd4,function(i){if(i&&lang.isObject(i)){this.options.push(i);}},this);this._loadChildren();},removeOption:function(_cd5){if(!lang.isArray(_cd5)){_cd5=[_cd5];}var _cd6=this.getOptions(_cd5);_cc7.forEach(_cd6,function(i){if(i){this.options=_cc7.filter(this.options,function(node){return (node.value!==i.value||node.label!==i.label);});this._removeOptionItem(i);}},this);this._loadChildren();},updateOption:function(_cd7){if(!lang.isArray(_cd7)){_cd7=[_cd7];}_cc7.forEach(_cd7,function(i){var _cd8=this.getOptions(i),k;if(_cd8){for(k in i){_cd8[k]=i[k];}}},this);this._loadChildren();},setStore:function(_cd9,_cda,_cdb){var _cdc=this.store;_cdb=_cdb||{};if(_cdc!==_cd9){var h;while((h=this._notifyConnections.pop())){h.remove();}if(!_cd9.get){lang.mixin(_cd9,{_oldAPI:true,get:function(id){var _cdd=new _cc8();this.fetchItemByIdentity({identity:id,onItem:function(_cde){_cdd.resolve(_cde);},onError:function(_cdf){_cdd.reject(_cdf);}});return _cdd.promise;},query:function(_ce0,_ce1){var _ce2=new _cc8(function(){if(_ce3.abort){_ce3.abort();}});_ce2.total=new _cc8();var _ce3=this.fetch(lang.mixin({query:_ce0,onBegin:function(_ce4){_ce2.total.resolve(_ce4);},onComplete:function(_ce5){_ce2.resolve(_ce5);},onError:function(_ce6){_ce2.reject(_ce6);}},_ce1));return new _ccf(_ce2);}});if(_cd9.getFeatures()["dojo.data.api.Notification"]){this._notifyConnections=[_cc9.after(_cd9,"onNew",lang.hitch(this,"_onNewItem"),true),_cc9.after(_cd9,"onDelete",lang.hitch(this,"_onDeleteItem"),true),_cc9.after(_cd9,"onSet",lang.hitch(this,"_onSetItem"),true)];}}this._set("store",_cd9);}if(this.options&&this.options.length){this.removeOption(this.options);}if(this._queryRes&&this._queryRes.close){this._queryRes.close();}if(_cdb.query){this._set("query",_cdb.query);this._set("queryOptions",_cdb.queryOptions);}if(_cd9){this._loadingStore=true;this.onLoadDeferred=new _cc8();this._queryRes=_cd9.query(this.query,this.queryOptions);when(this._queryRes,lang.hitch(this,function(_ce7){if(this.sortByLabel&&!_cdb.sort&&_ce7.length){if(_ce7[0].getValue){_ce7.sort(_cca.createSortFunction([{attribute:_cd9.getLabelAttributes(_ce7[0])[0]}],_cd9));}else{var _ce8=this.labelAttr;_ce7.sort(function(a,b){return a[_ce8]>b[_ce8]?1:b[_ce8]>a[_ce8]?-1:0;});}}if(_cdb.onFetch){_ce7=_cdb.onFetch.call(this,_ce7,_cdb);}_cc7.forEach(_ce7,function(i){this._addOptionForItem(i);},this);if(this._queryRes.observe){this._queryRes.observe(lang.hitch(this,function(_ce9,_cea,_ceb){if(_cea==_ceb){this._onSetItem(_ce9);}else{if(_cea!=-1){this._onDeleteItem(_ce9);}if(_ceb!=-1){this._onNewItem(_ce9);}}}),true);}this._loadingStore=false;this.set("value","_pendingValue" in this?this._pendingValue:_cda);delete this._pendingValue;if(!this.loadChildrenOnOpen){this._loadChildren();}else{this._pseudoLoadChildren(_ce7);}this.onLoadDeferred.resolve(true);this.onSetStore();}),function(err){console.error("dijit.form.Select: "+err.toString());this.onLoadDeferred.reject(err);});}return _cdc;},_setValueAttr:function(_cec,_ced){if(!this._onChangeActive){_ced=null;}if(this._loadingStore){this._pendingValue=_cec;return;}var opts=this.getOptions()||[];if(!lang.isArray(_cec)){_cec=[_cec];}_cc7.forEach(_cec,function(i,idx){if(!lang.isObject(i)){i=i+"";}if(typeof i==="string"){_cec[idx]=_cc7.filter(opts,function(node){return node.value===i;})[0]||{value:"",label:""};}},this);_cec=_cc7.filter(_cec,function(i){return i&&i.value;});if(!this.multiple&&(!_cec[0]||!_cec[0].value)&&opts.length){_cec[0]=opts[0];}_cc7.forEach(opts,function(i){i.selected=_cc7.some(_cec,function(v){return v.value===i.value;});});var val=_cc7.map(_cec,function(i){return i.value;}),disp=_cc7.map(_cec,function(i){return i.label;});if(typeof val=="undefined"||typeof val[0]=="undefined"){return;}this._setDisplay(this.multiple?disp:disp[0]);this.inherited(arguments,[this.multiple?val:val[0],_ced]);this._updateSelection();},_getDisplayedValueAttr:function(){var val=this.get("value");if(!lang.isArray(val)){val=[val];}var ret=_cc7.map(this.getOptions(val),function(v){if(v&&"label" in v){return v.label;}else{if(v){return v.value;}}return null;},this);return this.multiple?ret:ret[0];},_loadChildren:function(){if(this._loadingStore){return;}_cc7.forEach(this._getChildren(),function(_cee){_cee.destroyRecursive();});_cc7.forEach(this.options,this._addOptionItem,this);this._updateSelection();},_updateSelection:function(){this._set("value",this._getValueFromOpts());var val=this.value;if(!lang.isArray(val)){val=[val];}if(val&&val[0]){_cc7.forEach(this._getChildren(),function(_cef){var _cf0=_cc7.some(val,function(v){return _cef.option&&(v===_cef.option.value);});_ccc.toggle(_cef.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),_cf0);_cef.domNode.setAttribute("aria-selected",_cf0?"true":"false");},this);}},_getValueFromOpts:function(){var opts=this.getOptions()||[];if(!this.multiple&&opts.length){var opt=_cc7.filter(opts,function(i){return i.selected;})[0];if(opt&&opt.value){return opt.value;}else{opts[0].selected=true;return opts[0].value;}}else{if(this.multiple){return _cc7.map(_cc7.filter(opts,function(i){return i.selected;}),function(i){return i.value;})||[];}}return "";},_onNewItem:function(item,_cf1){if(!_cf1||!_cf1.parent){this._addOptionForItem(item);}},_onDeleteItem:function(item){var _cf2=this.store;this.removeOption(_cf2.getIdentity(item));},_onSetItem:function(item){this.updateOption(this._getOptionObjForItem(item));},_getOptionObjForItem:function(item){var _cf3=this.store,_cf4=(this.labelAttr&&this.labelAttr in item)?item[this.labelAttr]:_cf3.getLabel(item),_cf5=(_cf4?_cf3.getIdentity(item):null);return {value:_cf5,label:_cf4,item:item};},_addOptionForItem:function(item){var _cf6=this.store;if(_cf6.isItemLoaded&&!_cf6.isItemLoaded(item)){_cf6.loadItem({item:item,onItem:function(i){this._addOptionForItem(i);},scope:this});return;}var _cf7=this._getOptionObjForItem(item);this.addOption(_cf7);},constructor:function(_cf8){this._oValue=(_cf8||{}).value||null;this._notifyConnections=[];},buildRendering:function(){this.inherited(arguments);dom.setSelectable(this.focusNode,false);},_fillContent:function(){if(!this.options){this.options=this.srcNodeRef?_cce("> *",this.srcNodeRef).map(function(node){if(node.getAttribute("type")==="separator"){return {value:"",label:"",selected:false,disabled:false};}return {value:(node.getAttribute("data-"+_ccd._scopeName+"-value")||node.getAttribute("value")),label:String(node.innerHTML),selected:node.getAttribute("selected")||false,disabled:node.getAttribute("disabled")||false};},this):[];}if(!this.value){this._set("value",this._getValueFromOpts());}else{if(this.multiple&&typeof this.value=="string"){this._set("value",this.value.split(","));}}},postCreate:function(){this.inherited(arguments);this.connect(this,"onChange","_updateSelection");var _cf9=this.store;if(_cf9&&(_cf9.getIdentity||_cf9.getFeatures()["dojo.data.api.Identity"])){this.store=null;this.setStore(_cf9,this._oValue);}},startup:function(){this._loadChildren();this.inherited(arguments);},destroy:function(){var h;while((h=this._notifyConnections.pop())){h.remove();}if(this._queryRes&&this._queryRes.close){this._queryRes.close();}this.inherited(arguments);},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return [];},_getSelectedOptionsAttr:function(){return this.getOptions(this.get("value"));},_pseudoLoadChildren:function(){},onSetStore:function(){}});return _cd1;});},"dojo/data/util/sorter":function(){define("dojo/data/util/sorter",["../../_base/lang"],function(lang){var _cfa={};lang.setObject("dojo.data.util.sorter",_cfa);_cfa.basicComparator=function(a,b){var r=-1;if(a===null){a=undefined;}if(b===null){b=undefined;}if(a==b){r=0;}else{if(a>b||a==null){r=1;}}return r;};_cfa.createSortFunction=function(_cfb,_cfc){var _cfd=[];function _cfe(attr,dir,comp,s){return function(_cff,_d00){var a=s.getValue(_cff,attr);var b=s.getValue(_d00,attr);return dir*comp(a,b);};};var _d01;var map=_cfc.comparatorMap;var bc=_cfa.basicComparator;for(var i=0;i<_cfb.length;i++){_d01=_cfb[i];var attr=_d01.attribute;if(attr){var dir=(_d01.descending)?-1:1;var comp=bc;if(map){if(typeof attr!=="string"&&("toString" in attr)){attr=attr.toString();}comp=map[attr]||bc;}_cfd.push(_cfe(attr,dir,comp,_cfc));}}return function(rowA,rowB){var i=0;while(i<_cfd.length){var ret=_cfd[i++](rowA,rowB);if(ret!==0){return ret;}}return 0;};};return _cfa;});},"url:dijit/form/templates/Select.html":"<table class=\"dijit dijitReset dijitInline dijitLeft\"\n\tdata-dojo-attach-point=\"_buttonNode,tableNode,focusNode\" cellspacing='0' cellpadding='0'\n\trole=\"listbox\" aria-haspopup=\"true\"\n\t><tbody role=\"presentation\"><tr role=\"presentation\"\n\t\t><td class=\"dijitReset dijitStretch dijitButtonContents\" role=\"presentation\"\n\t\t\t><div class=\"dijitReset dijitInputField dijitButtonText\"  data-dojo-attach-point=\"containerNode,_popupStateNode\" role=\"presentation\"></div\n\t\t\t><div class=\"dijitReset dijitValidationContainer\"\n\t\t\t\t><input class=\"dijitReset dijitInputField dijitValidationIcon dijitValidationInner\" value=\"&#935; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t/></div\n\t\t\t><input type=\"hidden\" ${!nameAttrSetting} data-dojo-attach-point=\"valueNode\" value=\"${value}\" aria-hidden=\"true\"\n\t\t/></td\n\t\t><td class=\"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\"\n\t\t\tdata-dojo-attach-point=\"titleNode\" role=\"presentation\"\n\t\t\t><input class=\"dijitReset dijitInputField dijitArrowButtonInner\" value=\"&#9660; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t\t${_buttonInputDisabled}\n\t\t/></td\n\t></tr></tbody\n></table>\n","epi-cms/component/ContentQueryGrid":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/aspect","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/_GridWidgetBase"],function(_d02,lang,when,_d03,_d04,_d05){return _d02([_d05],{queryName:null,queryParameters:null,dndTypes:["epi.cms.contentreference"],postMixInProperties:function(){this.storeKeyName="epi.cms.content.search";this.inherited(arguments);},buildRendering:function(){this.inherited(arguments);var _d06=lang.mixin({columns:{name:{renderCell:lang.hitch(this,this._renderContentItem)},status:{className:"epi-width35",renderCell:function(item,_d07,node,_d08){node.innerHTML=_d04.getVersionStatus(_d07);}}},store:this.store,dndSourceType:this.dndTypes},this.defaultGridMixin);this.grid=new this._gridClass(_d06,this.domNode);this.grid.set("showHeader",false);this.own(_d03.around(this.grid,"insertRow",lang.hitch(this,this._aroundInsertRow)));},fetchData:function(){when(this._getCurrentItem(),lang.hitch(this,function(_d09){this.set("currentItem",_d09);}));this.grid.set("queryOptions",{ignore:["query"],sort:[{attribute:"name",descending:true}]});var _d0a=this.queryParameters||{};_d0a.query=this.queryName;this.grid.set("query",_d0a);},_setQueryNameAttr:function(_d0b){this.queryName=_d0b;this.fetchData();}});});},"url:epi-cms/component/templates/Tasks.html":"<div>\r\n    <div class=\"epi-gadgetInnerToolbar\" data-dojo-attach-point=\"toolbar\">\r\n        <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"reloadButton\" data-dojo-attach-event=\"onClick: _reloadQuery\"\r\n            class=\"epi-chromelessButton epi-iconReload epi-input-margin--left dijitInline dijitReset\">\r\n        </div>\r\n    </div>\r\n    <div data-dojo-type=\"epi-cms/component/ContentQueryGrid\" data-dojo-attach-point=\"contentQuery\">\r\n    </div>\r\n</div>\r\n","epi-cms/component/Trash":function(){define(["dojo/_base/declare","dojo/dom-construct","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_FocusableMixin","epi-cms/widget/Trash","epi-cms/widget/viewmodel/TrashViewModel"],function(_d0c,_d0d,_d0e,_d0f,_d10,_d11,_d12,_d13){return _d0c([_d0e,_d0f,_d10,_d11],{templateString:"<div class=\"epi-trashComponent\"><div data-dojo-type='epi-cms/widget/Trash' data-dojo-attach-point='trash'></div></div>",updateView:function(data){if(data){this.trash.set("typeIdentifiers",data.typeIdentifiers);}if(this._trashModel){this._trashModel.destroy();}this.trash.set("model",this._trashModel=new _d13());},destroy:function(){this._trashModel.destroy();this.inherited(arguments);}});});},"epi-cms/widget/Trash":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/Evented","dojo/_base/Deferred","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/TabContainer","dijit/layout/ContentPane","dijit/registry","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/dialog/Alert","epi/shell/command/withConfirmation","epi-cms/widget/TrashItemList","epi-cms/widget/EmptyTrashMenu","epi-cms/widget/TrashViewModelConfirmation","epi-cms/widget/command/EmptyTrash","epi-cms/widget/command/RestoreContent","epi/i18n!epi/cms/nls/episerver.cms.components.trash","dojo/text!./templates/Trash.html"],function(_d14,_d15,lang,_d16,_d17,_d18,_d19,_d1a,_d1b,_d1c,_d1d,_d1e,_d1f,_d20,_d21,_d22,_d23,_d24,_d25,_d26,_d27,_d28,_d29){return _d15([_d1a,_d1b,_d1c,_d20,_d18],{resources:_d28,templateString:_d29,_restoreContentCommand:null,typeIdentifiers:null,modelBindingMap:{"contentStore":["store"],"queryOptions":["queryOptions"],"actionResponse":["actionResponse"],"trashes":["trashes"]},postCreate:function(){this.inherited(arguments);this.tabContainer.watch("selectedChildWidget",lang.hitch(this,function(name,_d2a,_d2b){if(_d2b.itemListId){var _d2c=_d1f.byId(_d2b.itemListId);_d2c.bindUserSelector(_d2b.trash.deletedByUsers);}this.model.set("currentTrash",_d2b.trash);}));this._restoreContentCommand=new _d27({model:this.model});this.watch("model",lang.hitch(this,function(){this.model=_d25(this.model);this._restoreContentCommand.set("model",this.model);}));this.on("itemClick",this._onItemClick);this.on("deletedByChange",this._onDeletedByChange);},_setTrashesAttr:function(_d2d){this.tabContainer.destroyDescendants();var _d2e=[];_d14.forEach(_d2d,function(_d2f){if(_d2f&&_d2f.active){this._addTrash(_d2f);var _d30=new _d26({label:_d2f.name,tooltip:_d2f.name,trashId:_d2f.wasteBasketLink,model:this.model});_d2e.push(_d22(_d30,null,{title:_d28.emptytrash.title,description:this.model.getEmptyTrashConfirmMessage(_d2f.name),onShow:lang.hitch(this,function(){var _d31=this.tabContainer.selectedChildWidget.getChildren()[0];_d31.clearSelection();})}));}},this);this.emptyTrashMenu.set("commands",_d2e);if(_d2d&&_d2d.length===1){_d16.add(this.tabContainer.domNode,"hide-tablist");}this.tabContainer.startup();this.tabContainer.layout();},_addTrash:function(_d32){var _d33=null;if(_d32.active){_d32.isRequireLoad=true;var item=new _d1e({title:_d32.name,trash:_d32});this.tabContainer.addChild(item);if(this._isSelected(_d32)){_d33=item;}}if(_d33){this.tabContainer.selectChild(_d33);}},_isSelected:function(_d34){var _d35=false;_d14.some(_d34.typeIdentifiers,lang.hitch(this,function(_d36){return _d14.some(this.typeIdentifiers,function(type){if(_d36==type){_d35=true;return false;}});}));return _d35;},_setQueryOptionsAttr:function(_d37){if(_d37){var _d38=this.tabContainer.selectedChildWidget;if(_d38){var _d39=this.get("store"),_d3a=null;if(_d38.itemListId){_d3a=_d1f.byId(_d38.itemListId);_d3a.set("queryOptions",_d37);}else{_d3a=new _d23({queryOptions:_d37,store:_d39,model:this.model});_d3a.on("itemClick",lang.hitch(this,function(row){this.emit("itemClick",row);}));_d3a.on("deletedByChange",lang.hitch(this,function(_d3b){this.emit("deletedByChange",_d3b);}));_d3a.on("searchBoxChange",lang.hitch(this,this._onSearchBoxChange));_d38.set("content",_d3a);_d38.itemListId=_d3a.id;}_d3a.updateRemovedBy(_d37);}}},_setActionResponseAttr:function(_d3c){if(!_d3c){return;}this._showNotificationMessage(_d3c);},_showNotificationMessage:function(_d3d){new _d21({destroyOnHide:true,description:_d3d?_d3d:""}).show();},_onItemClick:function(row){if(row&&row.data&&this.model.get("currentTrash")){this._restoreContentCommand.set("content",row.data);this._restoreContentCommand.execute();}},_onDeletedByChange:function(_d3e){var _d3f=this.model.get("currentTrash");_d3f.deletedBy=_d3e;_d3f.isRequireLoad=true;this.model.set("currentTrash",_d3f);},_onSearchBoxChange:function(_d40){var _d41=this.model.get("currentTrash");_d41.queryText=_d40;_d41.isRequireLoad=true;this.model.set("currentTrash",_d41);}});});},"epi-cms/widget/TrashItemList":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/window","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/aspect","dojo/keys","dojo/Evented","dojo/query","dojo/html","dojo/Stateful","dojo/string","dojo/when","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Select","dojox/widget/Standby","dgrid/OnDemandGrid","dgrid/Selection","dgrid/Keyboard","dgrid/tree","dgrid/extensions/ColumnResizer","dgrid/util/mouse","put-selector/put","epi","epi/dependency","epi/shell/dgrid/Formatter","epi/shell/dgrid/util/misc","epi/shell/TypeDescriptorManager","epi/shell/widget/SearchBox","epi/shell/widget/_ModelBindingMixin","epi/datetime","epi/username","epi/i18n!epi/cms/nls/episerver.cms.components.trash","dojo/text!./templates/TrashItemList.html"],function(_d42,_d43,lang,_d44,_d45,_d46,_d47,_d48,_d49,keys,_d4a,_d4b,html,_d4c,_d4d,when,_d4e,_d4f,_d50,_d51,_d52,_d53,_d54,_d55,Tree,_d56,_d57,put,epi,_d58,_d59,_d5a,_d5b,_d5c,_d5d,_d5e,_d5f,_d60,_d61){return _d43([_d4e,_d4f,_d50,_d4a,_d4c,_d5d],{resources:_d60,epi:epi,templateString:_d61,_grid:null,_observers:{},_setQueryOptionsAttr:function(_d62){this._set("queryOptions",_d62);this._initialize();},updateRemovedBy:function(_d63){var _d64=this.model.get("currentTrash");if(this.model.isEmptyTrash){this.bindDefaultUserSelector();return;}var _d65=this.store.query({referenceId:_d63.query.referenceId,query:"getblockrootchildren"});var _d66=lang.hitch(this,function(item,_d67,_d68){var _d69=_d64.isDefaultProvider?"":_d64.name;when(this.model.trashStore.query({providerName:_d69}),lang.hitch(this,function(_d6a){if(_d6a){var _d6b=_d6a.deletedByUsers;_d64.deletedByUsers=_d6b;this.bindUserSelector(_d6b);}}));});var id=_d64.name,_d6c=this._observers[id];if(_d6c){_d6c.cancel();delete this._observers[id];}this._observers[id]=_d65.observe(_d66,true);},destroy:function(){for(var id in this._observers){this._observers[id].cancel();delete this._observers[id];}if(this._standby){this._standby.destroyRecursive();this._standby=null;}if(this._grid){this._grid.destroy();this._grid=null;}this.inherited(arguments);},clearSelection:function(){this._grid.clearSelection();this._grid._lastSelected=null;},postCreate:function(){this.inherited(arguments);this.bindUserSelector(this.model.get("currentTrash").deletedByUsers);this.searchBox.encodeSearchText=true;this.searchBox.on("searchBoxChange",lang.hitch(this,function(_d6d){this.emit("searchBoxChange",_d6d);}));this.removedBy._updateSelection=function(){this._set("value",this._getValueFromOpts());var val=this.value;if(!lang.isArray(val)){val=[val];}_d42.forEach(this._getChildren(),function(_d6e){var _d6f=_d42.some(val,function(v){return _d6e.option&&(v===_d6e.option.value);});_d45.toggle(_d6e.domNode,this.baseClass+"SelectedOption",_d6f);_d6e.domNode.setAttribute("aria-selected",_d6f);},this);};},resize:function(){if(this._grid){var top=_d47.position(this._grid.domNode).y;var _d70=_d47.position(_d44.body()).h;_d48.set(this._grid.domNode,"height",(_d70-top)+"px");}},_initialize:function(){this.searchBox.set("disabled",!this.queryOptions.query.isSearchable);if(!this._grid){this._grid=this._createGrid(this.store,this.queryOptions);_d46.place(this._grid.domNode,this.gridContainerNode);}else{this._showStandby(true);if(this.queryOptions){this._grid.set("queryOptions",this.queryOptions.options);this._grid.set("query",this.queryOptions.query);}}this.resize();},bindDefaultUserSelector:function(){this.removedBy._onChangeActive=false;this.removedBy.removeOption(this.removedBy.options);this.removedBy.addOption({label:epi.resources.text.anyone,value:""});this.removedBy._onChangeActive=true;},bindUserSelector:function(_d71){if(_d71){var _d72=this.removedBy.get("value");this.bindDefaultUserSelector();this.removedBy._onChangeActive=false;_d42.forEach(_d71,function(_d73){this.removedBy.addOption({label:this._createUserFriendlyUsername(_d73),value:_d73});},this);this.removedBy.set("value",_d72);this.removedBy._onChangeActive=true;}},_createGrid:function(_d74,_d75){var _d76=_d43([_d53,_d54,_d55,_d59,_d56]);var grid=new _d76({store:_d74,columns:{name:Tree({field:"name",label:epi.resources.header.name,renderCell:lang.hitch(this,this._renderTreeNode)}),removedOn:{field:"deleted",label:epi.resources.header.removed,formatters:[this._localizeDate,_d5a.ellipsis]},by:{field:"deletedBy",label:epi.resources.header.by,formatters:[this._createUserFriendlyUsername,_d5a.ellipsis]},action:{label:" ",formatter:this._renderActionMenu,sortable:false}},minWidth:100,noDataMessage:this._getNoDataMessage(),selectionMode:"single"});this._standby=new _d52({target:grid.domNode,color:"#fff"}).placeAt(document.body);this._standby.startup();this.own(_d49.after(grid,"expand",function(_d77){var row=_d77.element?_d77:grid.row(_d77),_d78=_d4b(row.element).parent()[0];if(_d78){_d48.set(_d78,"height","");}},true));_d49.after(grid,"_processScroll",lang.hitch(this,function(){this._showStandby(false);}));this._showStandby(true);_d49.before(grid,"adjustRowIndices",function(_d79){if(_d79){_d42.forEach(_d4b("div.dgrid-no-data",this.contentNode),function(div){html.set(div,"");});}});_d49.around(grid,"insertRow",lang.hitch(this,this._aroundInsertRow));_d49.before(grid,"renderArray",lang.hitch(this,function(_d7a,_d7b,_d7c){var _d7d=this.queryOptions.query;if(_d7d&&_d7d.query==="searchdeletedcontent"){_d7a.map(function(_d7e){if(_d7e){_d7e.hasChildren=false;}});}}));if(_d75){grid.set("queryOptions",_d75.options);grid.set("query",_d75.query);}var _d7f="epi-dgrid-mouseover";grid.on(_d57.enterRow,function(evt){_d45.add(this,_d7f);});grid.on(_d57.leaveRow,function(evt){_d45.remove(this,_d7f);});grid.on(".epi-gridAction:click",lang.hitch(this,function(evt){var row=grid.row(evt);this.emit("itemClick",row);}));grid.on(".dgrid-column-action:keydown",lang.hitch(this,function(e){if(e.keyCode==keys.ENTER&&!e.shiftKey&&!e.altKey&&!e.ctrlKey){var row=grid.row(e);this.emit("itemClick",row);}}));return grid;},_renderTreeNode:function(_d80,data,td,_d81){if(_d80&&_d80.thumbnailUrl){var _d82=_d46.create("img",{src:_d80.thumbnailUrl+_d4d.substitute("?${0}",[new Date().getTime()]),"class":"epi-thumbnail"},td);_d46.place(_d5a.ellipsis(_d5a.htmlEncode(data)),td);}else{var _d83=_d5b.getValue(_d80.typeIdentifier,"iconClass")||"epi-iconObjectPage";_d46.place(_d5a.icon(_d83+" epi-objectIcon",_d5a.ellipsis(_d5a.htmlEncode(data))),td);}},_renderActionMenu:function(_d84){var data={"title":_d60.restore.tooltip,"label":_d60.restore.label};return lang.replace("<a class=\"epi-gridAction epi-visibleLink\" title=\"{title}\">{label}</a>",data);},_localizeDate:function(_d85){return _d5e.toUserFriendlyString(_d85);},_createUserFriendlyUsername:function(name){return _d5f.toUserFriendlyString(_d5a.htmlEncode(name));},_onDeletedByChange:function(_d86){if(this.model.isEmptyTrash){this.model.isEmptyTrash=false;return;}this.emit("deletedByChange",_d86);},_showStandby:function(_d87){if(!this._standby){return;}if(_d87){if(!this._standby.isVisible()){this._standby.show();}}else{this._standby.hide();}},_getNoDataMessage:function(){return "<span><span class=\"dijitReset dijitInline\">"+_d60.trashitemempty+"</span></span>";},_aroundInsertRow:function(_d88){return lang.hitch(this,function(_d89,_d8a,_d8b,i,_d8c){var row=_d88.apply(this._grid,arguments);if(_d89&&_d89.thumbnailUrl){_d45.add(row,"epi-mediaContent");}return row;});}});});},"dgrid/tree":function(){define("dgrid/tree",["dojo/_base/declare","dojo/_base/array","dojo/_base/Deferred","dojo/query","dojo/on","dojo/aspect","./util/has-css3","./Grid","dojo/has!touch?./util/touch","put-selector/put"],function(_d8d,_d8e,_d8f,_d90,on,_d91,has,Grid,_d92,put){function _d93(_d94,_d95,_d96,_d97){var dir=this.grid.isRTL?"right":"left",cls=".dgrid-expando-icon",node;if(_d95){cls+=".ui-icon.ui-icon-triangle-1-"+(_d96?"se":"e");}node=put("div"+cls+"[style=margin-"+dir+": "+(_d94*(this.indentWidth||9))+"px; float: "+dir+"]");node.innerHTML="&nbsp;";return node;};function _d98(_d99){var _d9a=this,_d9b=this.style.height;if(_d9b){this.style.display=_d9b=="0px"?"none":"block";}if(_d99){put(this,".dgrid-tree-resetting");setTimeout(function(){put(_d9a,"!dgrid-tree-resetting");});}this.style.height="";};function tree(_d9c){var _d9d=_d9c.renderCell||Grid.defaultRenderCell;var _d9e,_d9f;if(!_d9c){_d9c={};}_d9c.shouldExpand=_d9c.shouldExpand||function(row,_da0,_da1){return _da1;};_d91.after(_d9c,"init",function(){var grid=_d9c.grid,_da2=".dgrid-content .dgrid-column-"+_d9c.id,_da3=[];if(!grid.store){throw new Error("dgrid tree column plugin requires a store to operate.");}if(!_d9c.renderExpando){_d9c.renderExpando=_d93;}_da3.push(grid.on(_d9c.expandOn||".dgrid-expando-icon:click,"+_da2+":dblclick,"+_da2+":keydown",function(_da4){var row=grid.row(_da4);if((!grid.store.mayHaveChildren||grid.store.mayHaveChildren(row.data))&&(_da4.type!="keydown"||_da4.keyCode==32)&&!(_da4.type=="dblclick"&&_d9f&&_d9f.count>1&&row.id==_d9f.id&&_da4.target.className.indexOf("dgrid-expando-icon")>-1)){grid.expand(row);}if(_da4.target.className.indexOf("dgrid-expando-icon")>-1){if(_d9f&&_d9f.id==grid.row(_da4).id){_d9f.count++;}else{_d9f={id:grid.row(_da4).id,count:1};}}}));if(has("touch")){_da3.push(grid.on(_d92.selector(_da2,_d92.dbltap),function(){grid.expand(this);}));}if(!grid._expanded){grid._expanded={};}_da3.push(_d91.after(grid,"insertRow",function(_da5){var row=this.row(_da5),_da6=_d9c.shouldExpand(row,_d9e,this._expanded[row.id]);if(_da6){this.expand(_da5,true,true);}return _da5;}));_da3.push(_d91.before(grid,"removeRow",function(_da7,_da8){var _da9=_da7.connected;if(_da9){_d90(">.dgrid-row",_da9).forEach(function(_daa){grid.removeRow(_daa,true);});if(!_da8){put(_da9,"!");}}}));if(_d9c.collapseOnRefresh){_da3.push(_d91.after(grid,"cleanup",function(){this._expanded={};}));}grid._calcRowHeight=function(_dab){var _dac=_dab.connected;return _dab.offsetHeight+(_dac?_dac.offsetHeight:0);};grid.expand=function(_dad,_dae,_daf){var row=_dad.element?_dad:grid.row(_dad),_db0=has("transitionend");_dad=row.element;_dad=_dad.className.indexOf("dgrid-expando-icon")>-1?_dad:_d90(".dgrid-expando-icon",_dad)[0];if(_dad&&_dad.mayHaveChildren&&(_daf||_dae!==!!this._expanded[row.id])){var _db1=_dae===undefined?!this._expanded[row.id]:_dae;put(_dad,".ui-icon-triangle-1-"+(_db1?"se":"e")+"!ui-icon-triangle-1-"+(_db1?"e":"se"));var _db2=_dad.preloadNode,_db3=row.element,_db4,_db5,_db6,_db7;if(!_db2){_db4=_db3.connected=put("div.dgrid-tree-container");_db2=_dad.preloadNode=put(_db3,"+",_db4,"div.dgrid-preload");var _db8=function(_db9){return grid.store.getChildren(row.data,_db9);};_db8.level=_dad.level;if(_d9c.allowDuplicates){_db7={parentId:row.id};}_d8f.when(grid.renderQuery?grid._trackError(function(){return grid.renderQuery(_db8,_db2,_db7);}):grid.renderArray(_db8(_db7),_db2,{query:_db8}),function(){if(grid._expanded[row.id]&&_db0){var _dba=_db4.scrollHeight;_db4.style.height=_dba?_dba+"px":"auto";}});if(_db0){on(_db4,_db0,_d98);}else{_d98.call(_db4);}}_db4=_db3.connected;_db4.hidden=!_db1;_db5=_db4.style;if(!_db0||_daf){_db5.display=_db1?"block":"none";_db5.height="";}else{if(_db1){_db5.display="block";_db6=_db4.scrollHeight;_db5.height="0px";}else{put(_db4,".dgrid-tree-resetting");_db5.height=_db4.scrollHeight+"px";}setTimeout(function(){put(_db4,"!dgrid-tree-resetting");_db5.height=_db1?(_db6?_db6+"px":"auto"):"0px";});}if(_db1){this._expanded[row.id]=true;}else{delete this._expanded[row.id];}}};_d91.after(_d9c,"destroy",function(){_d8e.forEach(_da3,function(l){l.remove();});delete grid.expand;delete grid._calcRowHeight;});});_d9c.renderCell=function(_dbb,_dbc,td,_dbd){var grid=_d9c.grid,_dbe=Number(_dbd&&_dbd.query&&_dbd.query.level)+1,_dbf=!grid.store.mayHaveChildren||grid.store.mayHaveChildren(_dbb),_dc0=_dbd.parentId,_dc1,node;_dbe=_d9e=isNaN(_dbe)?0:_dbe;_dc1=_d9c.renderExpando(_dbe,_dbf,grid._expanded[(_dc0?_dc0+"-":"")+grid.store.getIdentity(_dbb)],_dbb);_dc1.level=_dbe;_dc1.mayHaveChildren=_dbf;node=_d9d.call(_d9c,_dbb,_dbc,td,_dbd);if(node&&node.nodeType){put(td,_dc1);put(td,node);}else{td.insertBefore(_dc1,td.firstChild);}};return _d9c;};tree.defaultRenderExpando=_d93;return tree;});},"dgrid/extensions/ColumnResizer":function(){define("dgrid/extensions/ColumnResizer",["dojo/_base/declare","dojo/on","dojo/query","dojo/_base/lang","dojo/dom","dojo/dom-geometry","dojo/has","../util/misc","put-selector/put","dojo/_base/html","xstyle/css!../css/extensions/ColumnResizer.css"],function(_dc2,_dc3,_dc4,lang,dom,geom,has,_dc5,put){function _dc6(_dc7,span,_dc8,_dc9,id){for(var i=1;i<span;i++){_dc7[_dc8+i][_dc9]=id;}};function _dca(_dcb){var i=_dcb.length,l=i,_dcc=_dcb[0].length,_dcd=new Array(i);while(i--){_dcd[i]=new Array(_dcc);}var _dce={};for(i=0;i<l;i++){var row=_dcd[i],_dcf=_dcb[i];for(var j=0,js=0;j<_dcc;j++){var cell=_dcf[js],k;if(typeof row[j]!="undefined"){continue;}row[j]=cell.id;if(cell.rowSpan&&cell.rowSpan>1){_dc6(_dcd,cell.rowSpan,i,j,cell.id);}if(i>0&&cell.colSpan&&cell.colSpan>1){for(k=1;k<cell.colSpan;k++){row[++j]=cell.id;if(cell.rowSpan&&cell.rowSpan>1){_dc6(_dcd,cell.rowSpan,i,j,cell.id);}}}_dce[cell.id]=_dcb[0][j].id;js++;}}return _dce;};function _dd0(grid,_dd1,_dd2,_dd3){if(_dd2<=0){return;}var _dd4=grid.columns[_dd1],_dd5={grid:grid,columnId:_dd1,width:_dd2,bubbles:true,cancelable:true},rule;if(_dd3){_dd5.parentType=_dd3;}if(!grid._resizedColumns||_dc3.emit(grid.headerNode,"dgrid-columnresize",_dd5)){if(_dd2==="auto"){delete _dd4.width;}else{_dd4.width=_dd2;_dd2+="px";}rule=grid._columnSizes[_dd1];if(rule){rule.set("width",_dd2);}else{rule=_dc5.addCssRule("#"+_dc5.escapeCssIdentifier(grid.domNode.id)+" .dgrid-column-"+_dd1,"width: "+_dd2+";");}grid._columnSizes[_dd1]=rule;grid.resize();return true;}};var _dd6,_dd7=0;var _dd8={create:function(){_dd6=put("div.dgrid-column-resizer");},destroy:function(){put(_dd6,"!");_dd6=null;},show:function(grid){var pos=geom.position(grid.domNode,true);_dd6.style.top=pos.y+"px";_dd6.style.height=pos.h+"px";put(document.body,_dd6);},move:function(x){_dd6.style.left=x+"px";},hide:function(){_dd6.parentNode.removeChild(_dd6);}};return _dc2(null,{resizeNode:null,minWidth:40,adjustLastColumn:true,_resizedColumns:false,buildRendering:function(){this.inherited(arguments);if(!_dd7++){_dd8.create();}},destroy:function(){this.inherited(arguments);for(var name in this._columnSizes){this._columnSizes[name].remove();}if(!--_dd7){_dd8.destroy();}},resizeColumnWidth:function(_dd9,_dda){return _dd0(this,_dd9,_dda);},configStructure:function(){var _ddb=this._oldColumnSizes=lang.mixin({},this._columnSizes),k;this._resizedColumns=false;this._columnSizes={};this.inherited(arguments);for(k in _ddb){if(!(k in this._columnSizes)){_ddb[k].remove();}}delete this._oldColumnSizes;},_configColumn:function(_ddc){this.inherited(arguments);var _ddd=_ddc.id,rule;if("width" in _ddc){if((rule=this._oldColumnSizes[_ddd])){rule.set("width",_ddc.width+"px");}else{rule=_dc5.addCssRule("#"+this.domNode.id+" .dgrid-column-"+_ddd,"width: "+_ddc.width+"px;");}this._columnSizes[_ddd]=rule;}},renderHeader:function(){this.inherited(arguments);var grid=this;var _dde;if(this.columnSets&&this.columnSets.length){var csi=this.columnSets.length;while(csi--){_dde=lang.mixin(_dde||{},_dca(this.columnSets[csi]));}}else{if(this.subRows&&this.subRows.length>1){_dde=_dca(this.subRows);}}var _ddf=_dc4(".dgrid-cell",grid.headerNode),i=_ddf.length;while(i--){var _de0=_ddf[i],id=_de0.columnId,col=grid.columns[id],_de1=_de0.childNodes;if(!col||col.resizable===false){continue;}var _de2=put("div.dgrid-resize-header-container");_de0.contents=_de2;while(_de1.length>0){put(_de2,_de1[0]);}put(_de0,_de2,"div.dgrid-resize-handle.resizeNode-"+id).columnId=_dde?_dde[id]:id;}if(!grid.mouseMoveListen){_dc3(grid.headerNode,".dgrid-resize-handle:mousedown"+(has("touch")?",.dgrid-resize-handle:touchstart":""),function(e){grid._resizeMouseDown(e,this);grid.mouseMoveListen.resume();grid.mouseUpListen.resume();});grid._listeners.push(grid.mouseMoveListen=_dc3.pausable(document,"mousemove"+(has("touch")?",touchmove":""),_dc5.throttleDelayed(function(e){grid._updateResizerPosition(e);})));grid._listeners.push(grid.mouseUpListen=_dc3.pausable(document,"mouseup"+(has("touch")?",touchend":""),function(e){grid._resizeMouseUp(e);grid.mouseMoveListen.pause();grid.mouseUpListen.pause();}));grid.mouseMoveListen.pause();grid.mouseUpListen.pause();}},_resizeMouseDown:function(e,_de3){e.preventDefault();dom.setSelectable(this.domNode,false);this._startX=this._getResizeMouseLocation(e);this._targetCell=_dc4(".dgrid-column-"+_de3.columnId,this.headerNode)[0];this._updateResizerPosition(e);_dd8.show(this);},_resizeMouseUp:function(e){var _de4=this._columnSizes,_de5,_de6,_de7;if(this.adjustLastColumn){_de7=this.headerNode.clientWidth-1;}if(!this._resizedColumns){_de5=_dc4(".dgrid-cell",this.headerNode);if(this.columnSets&&this.columnSets.length){_de5=_de5.filter(function(node){var idx=node.columnId.split("-");return idx[0]=="0"&&!(node.columnId in _de4);});}else{if(this.subRows&&this.subRows.length>1){_de5=_de5.filter(function(node){return node.columnId.charAt(0)=="0"&&!(node.columnId in _de4);});}}_de6=_de5.map(function(_de8){return _de8.offsetWidth;});_de5.forEach(function(_de9,i){this.resizeColumnWidth(_de9.columnId,_de6[i]);},this);this._resizedColumns=true;}dom.setSelectable(this.domNode,true);var cell=this._targetCell,_dea=this._getResizeMouseLocation(e)-this._startX,_deb=cell.offsetWidth+_dea,obj=this._getResizedColumnWidths(),_dec=obj.totalWidth,_ded=obj.lastColId,_dee=_dc4(".dgrid-column-"+_ded,this.headerNode)[0].offsetWidth;if(_deb<this.minWidth){_deb=this.minWidth;}if(_dd0(this,cell.columnId,_deb,e.type)){if(cell.columnId!=_ded&&this.adjustLastColumn){if(_dec+_dea<_de7){_dd0(this,_ded,"auto",e.type);}else{if(_dee-_dea<=this.minWidth){_dd0(this,_ded,this.minWidth,e.type);}}}}_dd8.hide();delete this._startX;delete this._targetCell;},_updateResizerPosition:function(e){if(!this._targetCell){return;}var _def=this._getResizeMouseLocation(e),_df0=_def-this._startX,_df1=this._targetCell.offsetWidth,left=_def;if(_df1+_df0<this.minWidth){left=this._startX-(_df1-this.minWidth);}_dd8.move(left);},_getResizeMouseLocation:function(e){var posX=0;if(e.pageX){posX=e.pageX;}else{if(e.clientX){posX=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;}}return posX;},_getResizedColumnWidths:function(){var _df2=0,_df3=_dc4(".dgrid-cell",this.headerNode);if(this.columnSets&&this.columnSets.length){_df3=_df3.filter(function(node){var idx=node.columnId.split("-");return idx[1]=="0";});}else{if(this.subRows&&this.subRows.length>1){_df3=_df3.filter(function(node){return node.columnId.charAt(0)=="0";});}}var i=_df3.length;if(!i){return {};}var _df4=_df3[i-1].columnId;while(i--){_df2+=_df3[i].offsetWidth;}return {totalWidth:_df2,lastColId:_df4};}});});},"dgrid/util/mouse":function(){define("dgrid/util/mouse",["dojo/on","dojo/dom","dojo/query"],function(on,dom){function _df5(_df6,type){return function(node,_df7){return on(node,_df6+":"+type,function(evt){if(!dom.isDescendant(evt.relatedTarget,this)){return _df7.call(this,evt);}});};};return {enterRow:_df5(".dgrid-content .dgrid-row","mouseover"),enterCell:_df5(".dgrid-content .dgrid-cell","mouseover"),enterHeaderCell:_df5(".dgrid-header .dgrid-cell","mouseover"),leaveRow:_df5(".dgrid-content .dgrid-row","mouseout"),leaveCell:_df5(".dgrid-content .dgrid-cell","mouseout"),leaveHeaderCell:_df5(".dgrid-header .dgrid-cell","mouseout"),createDelegatingHandler:_df5};});},"url:epi-cms/widget/templates/TrashItemList.html":"<div>\r\n    <div class=\"epi-trashHeader clearfix\">\r\n        <div class=\"epi-gadgetInnerToolbar\" data-dojo-attach-point=\"searchBoxContainer\">\r\n            <div data-dojo-type=\"epi/shell/widget/SearchBox\" data-dojo-attach-point=\"searchBox\"></div>\r\n        </div>\r\n        <span class=\"epi-removedByContainer\">\r\n            <label for=\"removedBy_${id}\">${resources.removedby}</label>\r\n            <select data-dojo-type=\"dijit/form/Select\" data-dojo-attach-point=\"removedBy\" id=\"removedBy_${id}\" data-dojo-attach-event='onChange: _onDeletedByChange'>\r\n            </select>\r\n        </span>\r\n    </div>\r\n    <div data-dojo-attach-point=\"gridContainerNode\"></div>\r\n</div>","epi-cms/widget/EmptyTrashMenu":function(){define(["dojo/_base/declare","dijit/layout/_LayoutWidget","epi/shell/command/builder/ButtonBuilder","epi/shell/command/builder/DropDownButtonBuilder","epi/shell/command/builder/MenuAssembler","epi/i18n!epi/cms/nls/episerver.cms.components.trash"],function(_df8,_df9,_dfa,_dfb,_dfc,_dfd){return _df8([_df9],{resources:_dfd,_setCommandsAttr:function(_dfe){this._set("commands",_dfe);this._bindEmptyTrashMenu(_dfe);},_bindEmptyTrashMenu:function(_dff){this.destroyDescendants();if(!_dff||_dff.length<1){return;}var _e00=_dff.length>1;var _e01=null;if(_e00){_e01=new _dfb({settings:{label:_dfd.emptytrash.title,dropDownPosition:["below-alt"]}});}else{_e01=new _dfa({settings:{label:_dfd.emptytrash.title}});this.commands[0].label=_dfd.emptytrash.title;}new _dfc({configuration:[{builder:_e01,target:this}],commandSource:this}).build();},getCommands:function(){return this.get("commands");}});});},"epi-cms/widget/TrashViewModelConfirmation":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/aspect","dojo/when","epi/dependency","epi/string","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Dialog","epi/shell/widget/dialog/Confirmation","epi/shell/widget/dialog/Alert","epi-cms/widget/ContentSelectorDialog","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.components.trash"],function(_e02,_e03,_e04,lang,_e05,when,_e06,_e07,_e08,_e09,_e0a,_e0b,_e0c,_e0d,_e0e){return function(_e0f){var _e10=function(_e11,_e12,_e13){var _e14=new _e04();var _e15=new _e0a({destroyOnHide:true,description:_e07.toHTML(_e12),title:_e07.toHTML(_e11),onAction:function(_e16){_e16?_e14.resolve(_e13):_e14.cancel();}});_e15.show();return _e14;};var _e17=function(_e18,_e19,_e1a){var df=new _e04(),_e1b=_e0e.restore.dialog,_e1c=_e08.getValue(_e18.typeIdentifier,"containerTypes"),_e1d=_e1e(_e18),_e1f={showButtons:false,roots:_e19,multiRootsMode:true,canSelectOwnerContent:false,allowedTypes:_e1c||_e1d,selectedContentType:_e18.typeIdentifier};var _e20=new _e0c(_e1f);var _e21=new _e09({title:_e07.toHTML(_e1b.title),description:_e1a||_e07.toHTML(_e1b.description),confirmActionText:_e07.toHTML(_e0e.restore.label),content:_e20});var _e22=function(_e23){when(_e0f.contentStore.query({id:_e23}),function(_e24){_e21.onActionPropertyChanged({name:"ok"},"disabled",!_e24);});};_e20.on("change",function(_e25){if(_e25){_e22(_e25);}else{_e21.onActionPropertyChanged({name:"ok"},"disabled",true);}});_e21.on("execute",function(){df.resolve(_e20.get("value"));});_e21.on("onHide",function(){df.cancel();});_e21.show();_e20.onChange(null);return df;};var _e26=function(_e27,_e28){var _e29=_e0d.action.Create,_e2a=_e0d.providerCapabilities.Create,_e2b=_e28&&!(_e28.isWastebasket||_e28.isDeleted)&&_e0d.isActionAvailable(_e28,_e29,_e2a,true,true);if(!_e2b){var _e2c=new _e0b({description:_e07.toHTML(_e0e.restore.userdonothavepermission)});_e2c.show();return false;}return true;};var _e2d=function(_e2e,_e2f,_e30,_e31,_e32,_e33){if(!_e32||!_e2e||!_e2f){return false;}if(_e31&&_e30){confirmation=_e10(_e0e.restore.label,_e0e.restore.confirmquestion,_e30);}else{confirmation=_e17(_e2f,_e34(_e2f),_e33);}when(confirmation,function(_e35){when(_e2e.contentStore.get(_e35),function(_e36){if(!_e26(_e2f,_e36)){return false;}return _e32.apply(_e2e,[_e2f,_e35]);});},function(){return false;});};var _e34=function(_e37){var _e38=_e06.resolve("epi.cms.contentRepositoryDescriptors");var _e39=[];for(var key in _e38){_e38[key].containedTypes.forEach(function(type){if(_e08.isBaseTypeIdentifier(_e37.typeIdentifier,type)){_e38[key].roots.forEach(function(root){if(_e39.indexOf(root)===-1){_e39.push(root);}});}});}return _e39;};var _e1e=function(_e3a){var _e3b=_e06.resolve("epi.cms.contentRepositoryDescriptors");var _e3c=[];for(var key in _e3b){_e3b[key].containedTypes.forEach(function(type){if(_e08.isBaseTypeIdentifier(_e3a.typeIdentifier,type)){_e3c=_e3c.concat(_e3b[key].containedTypes);}});}return _e3c;};_e05.around(_e0f,"restore",function(_e3d){return function(_e3e,_e3f){var _e40;return when(_e0f.contentStore.query({id:_e3e.contentLink}),lang.hitch(this,function(_e41){var _e42=null;var _e43=null;if(_e41.hasOwnProperty("statusCode")&&(_e41.statusCode===401||_e41.statusCode===403)){_e42=_e07.toHTML(_e0e.restore.userdonothavepermission);}if(_e41.hasOwnProperty("isDeleted")&&!_e41.isDeleted){_e42=_e07.toHTML(_e0e.restore.contentalreadyrestored);_e43=function(){_e0f.updateTrash(_e0f.get("currentTrash"));};}if(_e42){var _e44=new _e0b({description:_e42,onAction:_e43});_e44.show();return false;}var _e45=_e0f.get("currentTrash");if(_e41.parentLink!=_e45.wasteBasketLink){return when(_e17(_e41,_e34(_e41)),function(_e46){when(_e0f.contentStore.get(_e46),function(_e47){if(!_e26(_e41,_e47)){return false;}return _e3d.apply(_e0f,[_e41,_e46]);});},function(){return false;});}else{return when(_e0f.getOldParent(_e41.contentLink),function(_e48){var _e49=_e48?_e48.contentLink:null;_e2d(_e0f,_e41,_e49,_e49!=null,_e3d);});}}),lang.hitch(this,function(_e4a){var _e4b=new _e0b({description:_e07.toHTML(_e0e.restore.contentdeletedpermanently),onAction:function(){_e0f.updateTrash(_e0f.get("currentTrash"));}});_e4b.show();return false;}));};});return _e0f;};});},"epi-cms/widget/command/EmptyTrash":function(){define(["dojo/_base/declare","epi/shell/command/_Command"],function(_e4c,_e4d){return _e4c([_e4d],{label:null,tooltip:null,trashId:null,_execute:function(){if(this.canExecute){this.model.emptyTrash(this.trashId);}},_onModelChange:function(){var _e4e=!!this.trashId;this.set("canExecute",_e4e);}});});},"epi-cms/widget/command/RestoreContent":function(){define(["dojo/_base/declare","epi/shell/command/_Command"],function(_e4f,_e50){return _e4f([_e50],{content:null,_execute:function(){if(this.canExecute&&this.content){this.model.restore(this.content);}},_onModelChange:function(){var _e51=!!this.model;this.set("canExecute",_e51);}});});},"url:epi-cms/widget/templates/Trash.html":"<div class=\"epi-trash\">\r\n    <div class=\"epi-listingTopContainer\">\r\n        <h1 class=\"dijitInline\">${resources.heading}</h1>\r\n        <div class=\"epi-mediumButton epi-boldButton epi-emptyCommand\" data-dojo-attach-point=\"emptyTrashMenu\" data-dojo-type=\"epi-cms/widget/EmptyTrashMenu\"\r\n            data-dojo-props=\"title: '${resources.emptytrash.tooltip}'\"></div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"stackContainer\">\r\n        <div data-dojo-type=\"dijit/layout/TabContainer\" data-dojo-attach-point=\"tabContainer\" data-dojo-props=\"doLayout:false, useMenu:true, useSlider:false\"> <!-- doLayout=\"false\" for flexible height -->\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi-cms/widget/viewmodel/TrashViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/topic","dojo/Stateful","dojo/_base/json","epi/epi","epi/shell/_StatefulGetterSetterMixin","epi/shell/TypeDescriptorManager","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.components.trash"],function(_e52,_e53,_e54,lang,_e55,_e56,json,epi,_e57,_e58,_e59,_e5a){return _e53([_e56,_e57],{resources:_e5a,trashes:null,currentTrash:null,queryOptions:null,isEmptyTrash:false,storeRegistry:null,contentStore:null,trashStore:null,showAllLanguages:true,_contentRepositoryDescriptors:null,postscript:function(){this.inherited(arguments);this.storeRegistry=_e59.resolve("epi.storeregistry");this.contentStore=this.contentStore||this._getStore();this.trashStore=this.trashStore||this.storeRegistry.get("epi.cms.wastebasket");this._contentRepositoryDescriptors=_e59.resolve("epi.cms.contentRepositoryDescriptors");if(!this.trashes){this._createTrashes();}},destroy:function(){epi.removeDelegateAspects(this.contentStore);},_getStore:function(){var _e5b=this.storeRegistry.get("epi.cms.content.light"),_e5c=this;var _e5d=epi.delegate(_e5b,{getChildren:function(_e5e,_e5f){var _e60=_e5c.get("currentTrash"),_e61=_e5c._createQueryOptions(_e60);lang.mixin(_e61.query,{referenceId:_e5e.contentLink});return this.query(_e61.query,_e61.options);},mayHaveChildren:function(_e62){return _e62.hasChildren;}},["notify"]);return _e5d;},_createTrashes:function(){_e54.when(this.trashStore.query(),lang.hitch(this,function(_e63){this.set("trashes",lang.clone(_e63));}));},_setCurrentTrashAttr:function(_e64){this._set("currentTrash",_e64);if(_e64.isRequireLoad){this.updateTrash(_e64);_e64.isRequireLoad=false;}},getEmptyTrashConfirmMessage:function(_e65){var _e66=_e5a.emptytrash.singleproviderdescription;if(this.trashes.length>1){_e66=_e5a.emptytrash.description.replace("{0}",_e65);}return _e66;},updateTrash:function(_e67){if(_e67&&_e67.active){this.set("queryOptions",this._createQueryOptions(_e67));}else{this.set("queryOptions",null);}},_createQueryOptions:function(_e68){var _e69={referenceId:_e68.wasteBasketLink,query:"getchildren"};var _e6a={ignore:["query"],comparers:this._createComparers()};if(this.showAllLanguages){lang.mixin(_e69,{allLanguages:this.showAllLanguages});_e6a.ignore.push("allLanguages");}if(_e68.deletedBy){lang.mixin(_e69,{deletedBy:_e68.deletedBy});}if(_e68.isSearchable){lang.mixin(_e69,{isSearchable:_e68.isSearchable});_e6a.ignore.push("isSearchable");}if(_e68.queryText){lang.mixin(_e69,{query:"searchdeletedcontent"});lang.mixin(_e69,{matchProvider:true});lang.mixin(_e69,{queryText:_e68.queryText});}return {query:_e69,options:_e6a};},_createComparers:function(){return {"referenceId":function(_e6b,_e6c){return _e6b===_e6c.parentLink;}};},emptyTrash:function(_e6d){if(_e6d){_e54.when(this.trashStore.executeMethod("Empty",_e6d),lang.hitch(this,function(_e6e){var _e6f=_e52.filter(this.get("trashes"),function(_e70){return _e70&&_e70.wasteBasketLink===_e6d;});_e52.forEach(_e6f,function(_e71){_e71.deletedByUsers=[];_e71.isRequireLoad=true;_e71.deletedByUsers=[];});this.isEmptyTrash=true;_e55.publish("/epi/cms/trash/empty",_e6e.extraInformation);if(this.currentTrash.wasteBasketLink===_e6d){this.set("currentTrash",this.currentTrash);}}),lang.hitch(this,function(_e72){if(_e72.status===403){this.set("actionResponse",_e5a.emptytrash.accessdenied);}}));}},restore:function(_e73,_e74){if(_e73&&_e73.contentLink&&_e73.isDeleted&&_e74){_e54.when(this.contentStore.move(_e73.contentLink,{targetId:_e74}),lang.hitch(this,function(_e75){if(_e75){this.contentStore.refresh(_e73.contentLink);if(_e73.parentLink!=this.currentTrash.wasteBasketLink){this.contentStore.refresh(_e73.parentLink).then(lang.hitch(this,function(){this.updateTrash(this.currentTrash);}));}var _e76=this.contentStore.get(_e74);if(_e76&&!_e76.hasChildren){this.contentStore.refresh(_e74).then(function(_e77){_e55.publish("/epi/cms/contentdata/restored",_e77);});}}}),lang.hitch(this,function(_e78){this.set("actionResponse",_e78.xhr?json.fromJson(_e78.xhr.responseText):_e5a.restore.error);}));}},getOldParent:function(_e79){var df=new _e54();_e54.when(this.contentStore.query({referenceId:_e79,query:"getrestorepoint",allLanguages:true}),function(_e7a){var _e7b=_e7a&&lang.isArray(_e7a)&&_e7a.length>0?_e7a[0]:null;df.resolve(_e7b);});return df;}});});},"epi-cms/component/Versions":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/aspect","dojo/dom-class","dojo/on","dojo/string","dojo/topic","dojo/when","dojox/html/entities","dgrid/OnDemandGrid","dgrid/Selection","epi","epi/dependency","epi/username","epi/shell/TypeDescriptorManager","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/command/withConfirmation","epi/shell/widget/_FocusableMixin","epi/shell/widget/Tooltip","epi/shell/widget/dialog/Alert","epi/shell/widget/dialog/Confirmation","epi-cms/_MultilingualMixin","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi-cms/component/command/DeleteVersion","epi-cms/component/command/DeleteLanguageBranch","epi-cms/component/command/SetCommonDraft","epi-cms/command/ShowAllLanguages","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/_GridWidgetBase","epi/i18n!epi/cms/nls/episerver.cms.components.versions"],function(_e7c,_e7d,lang,_e7e,_e7f,_e80,on,_e81,_e82,when,_e83,_e84,_e85,epi,_e86,_e87,_e88,_e89,_e8a,_e8b,_e8c,_e8d,_e8e,_e8f,_e90,_e91,_e92,_e93,_e94,_e95,_e96,_e97,_e98){return _e7d([_e97,_e89,_e8b,_e8f],{showAllLanguages:true,isMultilingual:false,_tooltips:[],postMixInProperties:function(){this._commonDrafts={};this.storeKeyName="epi.cms.contentversion";this.ignoreVersionWhenComparingLinks=false;this.inherited(arguments);this._currentContentLanguage=_e90.currentContentLanguage;this.connect(this.store,"onItemChanged","_onItemChanged");var _e99=_e86.resolve("epi.storeregistry");this._contentStore=_e99.get("epi.cms.contentdata");},buildRendering:function(){this.inherited(arguments);var _e9a=_e7d([_e84,_e85]);this.grid=new _e9a({columns:{language:{label:epi.resources.header.language},statusName:{label:epi.resources.header.status,renderCell:function(item,_e9b,node,_e9c){var html=item.statusName;if(item.isCommonDraft){html="<span class=\"dijitReset dijitInline dijitIcon epi-iconPrimary epi-floatRight\"></span>"+item.statusName;}node.innerHTML=html;}},savedDate:{label:epi.resources.header.saved,formatter:this._localizeDate},savedBy:{label:epi.resources.header.by,formatter:this._createUserFriendlyUsername}},store:this.store,selectionMode:"single",selectionEvents:"click,dgrid-cellfocusin",sort:[{attribute:"savedDate",descending:true}]},this.domNode);},postCreate:function(){this.add("commands",new _e95({model:this}));this._commonDraftCommand=new _e94();this._deleteVersionCommand=new _e92();this._deleteLanguageBranchCommand=new _e93();this.own(_e7f.after(this._commonDraftCommand,"execute",lang.hitch(this,function(_e9d){_e9d.then(null,lang.hitch(this,this._onSetCommonDraftFailure));})),_e7f.after(this._deleteVersionCommand,"execute",lang.hitch(this,function(_e9e){_e9e.then(lang.hitch(this,this._onDeleteVersionSuccess),lang.hitch(this,this._onDeleteVersionFailure));})),_e7f.after(this._deleteLanguageBranchCommand,"execute",lang.hitch(this,function(_e9f){_e9f.then(lang.hitch(this,this._onDeleteVersionSuccess),lang.hitch(this,this._onDeleteVersionFailure));})));this.add("commands",this._commonDraftCommand);this.add("commands",_e8a(this._deleteVersionCommand,null,{title:_e98.deletemenuitemtitle,heading:_e98.deleteversion.note,description:_e98.deleteversion.confirmquestion}));this._deleteLanguageBranchSettings={cancelActionText:epi.resources.action.cancel,setFocusOnConfirmButton:false};this.add("commands",_e8a(this._deleteLanguageBranchCommand,null,this._deleteLanguageBranchSettings));},startup:function(){if(this._started){return;}this.inherited(arguments);this.own(_e7f.around(this.grid,"renderRow",lang.hitch(this,this._aroundRenderRow)));this._toggleLanguage(this.showAllLanguages);this.fetchData();},_setShowAllLanguagesAttr:function(_ea0){this._set("showAllLanguages",_ea0);this._toggleFilterByLanguage(_ea0);},destroy:function(){this.inherited(arguments);this._destroyTooltips();},_onItemChanged:function(){this.fetchData();},fetchData:function(){when(this.getCurrentContent(),lang.hitch(this,function(item){if(!item){return;}this._destroyTooltips();if(item.accessMask&&!_e96.hasAccess(item.accessMask,_e96.accessLevel.Edit)||item.providerCapabilityMask&&!_e96.hasProviderCapability(item.providerCapabilityMask,_e96.providerCapabilities.Edit)){this._showErrorMessage(epi.resources.messages.nopermissiontoviewdata);this.set("isMultilingual",false);this._updateMenu(item);return;}var _ea1={contentLink:item.contentLink};if(!this._allLanguages){_ea1.language=this._currentContentLanguage;}this.grid.set("query",_ea1);this.set("isMultilingual",true);}));},_destroyTooltips:function(){_e7c.forEach(this._tooltips,function(_ea2){_ea2.destroyRecursive();});this._tooltips=[];},_aroundRenderRow:function(_ea3){return lang.hitch(this,function(item){if(item.isCommonDraft){var _ea4=this._commonDrafts[item.language];if(_ea4&&_ea4!=item.contentLink){this._removeCommonDraft(_ea4);}this._commonDrafts[item.language]=item.contentLink;}var row=_ea3.apply(this.grid,arguments);_e80.toggle(row,"dgrid-row-published",item.status===_e96.versionStatus.Published);this._createTooltip(item,row);return row;});},_onSelect:function(e){var item=e.rows[0].data;this._updateMenu(item);this.inherited(arguments);},_updateMenu:function(item){this._commonDraftCommand.set("model",item);this._deleteVersionCommand.set("model",item);when(this._contentStore.get(item.contentLink),lang.hitch(this,function(_ea5){if(_ea5&&_ea5.currentLanguageBranch){var _ea6=lang.replace(_e98.deletelanguagebranch.label,[_ea5.currentLanguageBranch.name]),_ea7=_e88.getResourceValue(_ea5.typeIdentifier,"deletelanguagebranchdescription");lang.mixin(this._deleteLanguageBranchSettings,{confirmActionText:_ea6,description:lang.replace(_ea7,[_e83.encode(_ea5.name),_ea5.currentLanguageBranch.name]),title:_ea6});this._deleteLanguageBranchCommand.set("label",_ea6);}this._deleteLanguageBranchCommand.set("model",_ea5);}));},_showNotificationMessage:function(_ea8){var _ea9=new _e8d({title:_e98.notificationtitle,description:_ea8});_ea9.show();},_selectCommonDraftVersion:function(uri){var _eaa={uri:uri};_e82.publish("/epi/shell/context/request",_eaa,{sender:null});},_onDeleteVersionSuccess:function(){var _eab=new _e91(this.grid.get("query").contentLink);this._selectCommonDraftVersion("epi.cms.contentdata:///"+_eab.createVersionUnspecificReference().toString());},_onDeleteVersionFailure:function(_eac){if(!_eac||!_eac.status){return;}else{if(_eac.status===403){this._showNotificationMessage(_e98.deleteversion.cannotdeletepublished);}else{this._showNotificationMessage(_e98.deleteversion.cannotdelete);}}},_onSetCommonDraftFailure:function(){this._showNotificationMessage(_e98.setcommondraft.failuremessage);},_removeCommonDraft:function(_ead){if(_ead){var item=this.grid.row(_ead).data;if(item){item.isCommonDraft=false;}}},_toggleFilterByLanguage:function(_eae){when(this.getCurrentContext(),lang.hitch(this,function(_eaf){var _eb0={contentLink:_eaf.id};if(!_eae){_eb0.language=this._currentContentLanguage;}this._toggleLanguage(_eae);this.grid.set("query",_eb0);this._allLanguages=_eae;}));},_toggleLanguage:function(_eb1){var _eb2=_eb1?"table-cell":"none";this.grid.styleColumn("language",_e81.substitute("display:${0};",[_eb2]));},_createTooltip:function(item,row){var _eb3=[{label:epi.resources.header.language,text:epi.resources.language[item.language]},{label:epi.resources.header.name,text:item.name},{label:epi.resources.header.status,text:_e96.getVersionStatus(item.status)},{label:_e98.saved,text:this._localizeDate(item.savedDate),htmlEncode:false},{label:_e98.by,text:_e87.toUserFriendlyString(item.savedBy,null,true)}];var _eb4=new _e8c({connectId:row,tooltipRows:_eb3});this._tooltips.push(_eb4);}});});},"epi-cms/component/command/DeleteVersion":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi-cms/ApplicationSettings","epi-cms/contentediting/ContentActionSupport","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.components.versions","epi/shell/command/_Command"],function(_eb5,lang,when,_eb6,_eb7,_eb8,_eb9,_eba){return _eb5([_eba],{label:_eb9.deletemenuitemtitle,iconClass:"epi-iconTrash",category:"context",postscript:function(){this.inherited(arguments);this.storeRegistry=this.storeRegistry||_eb8.resolve("epi.storeregistry");this._content=this.storeRegistry.get("epi.cms.contentdata");this._versions=this.storeRegistry.get("epi.cms.contentversion");},_execute:function(){return this._versions.remove(this.model.contentLink);},_onModelChange:function(){if(_eb6.disableVersionDeletion){this.set("isAvailable",false);return;}this.set("isAvailable",true);if(!this.model.allowToDelete){this.set("canExecute",false);return;}when(this._content.get(this.model.contentLink),lang.hitch(this,function(_ebb){var _ebc=_eb7.action,_ebd=_ebb&&_eb7.isActionAvailable(_ebb,_ebc.Delete);this.set("canExecute",_ebd);}));}});});},"epi-cms/component/command/DeleteLanguageBranch":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi/shell/command/_Command","epi-cms/_MultilingualMixin","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport"],function(_ebe,lang,when,_ebf,_ec0,_ec1,_ec2,_ec3,_ec4){return _ebe([_ec0,_ec1],{label:"",iconClass:"",category:"context",postscript:function(){this.inherited(arguments);this.storeRegistry=this.storeRegistry||_ebf.resolve("epi.storeregistry");this._versions=this.storeRegistry.get("epi.cms.contentversion");this._structure=this.storeRegistry.get("epi.cms.content.light");},_execute:function(){var _ec5=_ec3.toContentReference(this.model.contentLink);return when(this._versions.remove(_ec5,{deleteLanguageBranch:true}),lang.hitch(this,function(){return this._structure.refresh(_ec5.id);}));},_onModelChange:function(){var _ec6=this.model,_ec7=!!(_ec6&&_ec6.currentLanguageBranch&&_ec6.capabilities.deleteLanguageBranch&&!_ec2.disableVersionDeletion),_ec8=_ec7&&!_ec6.currentLanguageBranch.isMasterLanguage&&_ec4.isActionAvailable(_ec6,_ec4.action.Delete);this.set("canExecute",_ec8);this.set("isAvailable",_ec7);}});});},"epi-cms/component/command/SetCommonDraft":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.components.versions","epi/shell/command/_Command"],function(_ec9,_eca,_ecb,_ecc,_ecd){return _ec9([_ecd],{label:_ecc.setcommondraftitemtitle,iconClass:"epi-iconPrimary",category:"context",constructor:function(){var _ece=_ecb.resolve("epi.storeregistry");this.store=_ece.get("epi.cms.contentversion");},_execute:function(){var self=this;return this.store.patch({isCommonDraft:true,contentLink:this.model.contentLink},{id:this.model.contentLink}).then(function(item){return self.store.patchCache(item);});},_onModelChange:function(){var _ecf=this.model,_ed0=_eca.versionStatus,_ed1=_ecf&&!_ecf.isCommonDraft&&(_ecf.status==_ed0.CheckedOut||_ecf.status==_ed0.Rejected);this.set("canExecute",_ed1);}});});},"epi-cms/contentediting/_Renderer":function(){define(["epi","dojo"],function(epi,dojo){return dojo.declare(null,{constructor:function(_ed2){dojo.mixin(this,_ed2);},render:function(_ed3,_ed4,_ed5,_ed6){throw new Error("Abstract method _render must be overridden in a derived class");}});});},"epi-cms/contentediting/ContentDetails":function(){define(["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/url","dojo/_base/window","dojo/dom-style","dojo/dom-construct","dojo/on","dojo/topic","dijit/_TemplatedMixin","dijit/_WidgetBase","dijit/_WidgetsInTemplateMixin","epi","epi/shell/widget/_ModelBindingMixin","epi/shell/command/builder/MenuBuilder","epi/shell/command/builder/MenuAssembler","epi/i18n!epi/cms/nls/episerver.cms.contentediting.contentdetails","dojo/text!./templates/ContentDetails.html"],function(dojo,_ed7,_ed8,lang,url,win,_ed9,_eda,on,_edb,_edc,_edd,_ede,epi,_edf,_ee0,_ee1,res,_ee2){return _ed8([_edd,_edc,_ede,_edf],{templateString:_ee2,_setContentTypeNameAttr:{node:"typeNode",type:"innerHTML"},_setContentIdAttr:{node:"idNode",type:"innerHTML"},_setExistingLanguagesAttr:function(_ee3){this.languagesNode.innerHTML="";_ed7.forEach(_ee3,function(item,idx){var elm,_ee4=idx===_ee3.length-1;if(item.isCurrentLanguage){elm=_eda.create("span",{innerHTML:item.urlSegment});}else{var url=new dojo._Url(window.top.location.href);elm=_eda.create("a",{innerHTML:item.urlSegment,href:[url.scheme,"://",url.authority,url.path,"?language=",item.text,"#context=epi.cms.contentdata:///",item.contentLink].join(""),"class":"epi-visibleLink"});}_eda.place(elm,this.languagesNode);if(!_ee4){_eda.place(win.doc.createTextNode(", "),this.languagesNode);}},this);},_setVisibleToAttr:function(_ee5){this.visibleToNode.innerHTML=_ee5?res.visibleto.everyone:res.visibleto.restricted;},_setManageAccessRightsVisibleAttr:function(_ee6){_ed9.set(this.manageAccessRightsButton.domNode,"display",_ee6?"":"none");},resources:null,modelBindingMap:{"contentTypeName":["contentTypeName"],"contentId":["contentId"],"existingLanguages":["existingLanguages"],"visibleToEveryOne":["visibleTo"]},_menuAssembler:null,postMixInProperties:function(){this.inherited(arguments);this.resources=dojo.mixin({},epi.resources.action,res);},postCreate:function(){this.inherited(arguments);var _ee7=new _ee0();this._menuAssembler=new _ee1({configuration:[{builder:_ee7,target:this.additionalActionsMenu}],commandSource:this.model});this.dropdownButton.set("title",this.resources.toolsbutton.tooltip);},destroy:function(){if(this._menuAssembler){this._menuAssembler.destroy();}this.inherited(arguments);if(this.model){this.model.destroy();}},_setModelAttr:function(_ee8){this.inherited(arguments);if(this._menuAssembler){this._menuAssembler.set("commandSource",this.model);}if(this.model&&this.model.accessRightsCommand){this.own(this.model.accessRightsCommand.watch("canExecute",lang.hitch(this,function(){this.set("manageAccessRightsVisible",this.model.accessRightsCommand.canExecute);})));}},_onManageAccessRightsClick:function(){if(this.model&&this.model.accessRightsCommand){this.model.accessRightsCommand.execute();}}});});},"url:epi-cms/contentediting/templates/ContentDetails.html":"<div class=\"epi-containerLayout\">\r\n    <ul>\r\n        <li class=\"epi-formsRow\">\r\n            <label>${resources.visibleto.title}</label>\r\n            <div class=\"epi-formsWidgetWrapper\">\r\n                <span data-dojo-attach-point=\"visibleToNode\" class=\"dijitInline\"></span>\r\n                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"manageAccessRightsButton\" data-dojo-attach-event=\"onClick: _onManageAccessRightsClick\" class=\"epi-chromelessButton epi-chromelessLinkButton epi-functionLink epi-valign--top\">${resources.manage}</div>\r\n            </div>\r\n        </li>\r\n        <li class=\"epi-formsRow\">\r\n            <label>${resources.existinglanguages}</label>\r\n            <div class=\"epi-formsWidgetWrapper\">\r\n                <span data-dojo-attach-point=\"languagesNode\" class=\"dijitInline\"></span>\r\n            </div>\r\n        </li>\r\n        <li class=\"epi-formsRow\">\r\n            <label>${resources.idandtypename}</label> \r\n            <div class=\"epi-formsWidgetWrapper\">\r\n                <span data-dojo-attach-point=\"idNode\" class=\"dijitInline\"></span>, <span data-dojo-attach-point=\"typeNode\" class=\"dijitInline\"></span>\r\n            </div>\r\n        </li>\r\n        <li class=\"epi-formsRow\">\r\n            <label></label>\r\n            <div class=\"epi-formsWidgetWrapper\">\r\n                <div data-dojo-attach-point=\"dropdownButton\" data-dojo-type=\"dijit/form/DropDownButton\" class=\"dijit dijitReset dijitInline epi-mediumButton\">\r\n                    <span>${resources.toolsbutton.label}</span>\r\n                    <div data-dojo-type=\"dijit/DropDownMenu\" data-dojo-attach-point=\"additionalActionsMenu\"></div>\r\n                </div>\r\n            </div>\r\n        </li>\r\n    </ul>\r\n</div>","epi-cms/contentediting/CreateContent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-style","dojo/dom-class","dojo/topic","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/ValidationTextBox","dijit/layout/_LayoutWidget","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/layout/StackContainer","epi/dependency","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/dialog/Dialog","epi-cms/contentediting/NewContentNameInputDialog","epi-cms/contentediting/viewmodel/CreateContentViewModel","epi-cms/widget/ContentTypeList","epi-cms/widget/PropertiesForm","epi-cms/widget/Breadcrumb","epi-cms/widget/BreadcrumbCurrentItem","dojo/text!./templates/CreateContent.html","epi/i18n!epi/nls/episerver.shared"],function(_ee9,lang,_eea,_eeb,_eec,_eed,when,_eee,_eef,_ef0,_ef1,_ef2,_ef3,_ef4,_ef5,_ef6,_ef7,_ef8,_ef9,_efa,_efb,_efc,_efd,_efe,_eff){return _ee9([_ef1,_eee,_eef,_ef6],{templateString:_efe,sharedResources:_eff,modelType:_ef9,_contextService:null,_beingSuspended:null,modelBindingMap:{"parent":["parent"],"metadata":["metadata"],"headingText":["headingText"],"createAsLocalAssetHelpText":["createAsLocalAssetHelpText"],"contentName":["contentName"],"wizardStep":["wizardStep"],"showAllProperties":["showAllProperties"],"createAsLocalAsset":["createAsLocalAsset"],"seamlessTopPanel":["seamlessTopPanel"],"namePanelIsVisible":["namePanelIsVisible"],"headingPanelIsVisible":["headingPanelIsVisible"],"saveButtonIsVisible":["saveButtonIsVisible"],"saveButtonDisabled":["saveButtonDisabled"],"showCurrentNodeOnBreadcrumb":["showCurrentNodeOnBreadcrumb"],"notificationContext":["notificationContext"],"propertyFilter":["propertyFilter"]},_setParentAttr:function(_f00){if(_f00){this.toolbar.setItemProperty("currentcontent","currentItemInfo",{name:_f00.name,dataType:_f00.typeIdentifier});}},_setPropertyFilterAttr:function(_f01){this._set("propertyFilter",_f01);this.propertiesForm.propertyFilter=_f01;},_setMetadataAttr:function(_f02){if(_f02){this.propertiesForm.set("metadata",_f02);}},_setHeadingTextAttr:function(_f03){this.headingTextNode.innerHTML=this.subHeadingTextNode.innerHTML=_f03;},_setCreateAsLocalAssetAttr:function(_f04){this._set("createAsLocalAsset",_f04);var _f05=this.model.get("parent");if(_f05){this.toolbar.setItemProperty("breadcrumbs","contentLink",_f04&&this.model.canChangeLocalAssetName?_f05.assetsFolderLink:_f05.contentLink);}},_setCreateAsLocalAssetHelpTextAttr:{node:"subHeadingDescNode",type:"innerHTML"},_setContentNameAttr:function(_f06){this.nameTextBox.set("value",_f06);},_setWizardStepAttr:function(_f07){var _f08;var _f09;if(_f07<0||_f07===this.wizardStep){return;}_f08=this.stackContainer.getChildren();if(_f07<_f08.length){_f09=_f08[_f07];this.stackContainer.selectChild(_f09);this._set("wizardStep",_f07);}},_setShowAllPropertiesAttr:function(_f0a){this._set("showAllProperties",_f0a);this.propertiesForm.set("showAllProperties",_f0a);},_setSeamlessTopPanelAttr:function(_f0b){_eec.toggle(this.topPanel.domNode,"epi-listingTopContainer",_f0b);},_setNamePanelIsVisibleAttr:function(_f0c){_eeb.set(this.namePanel,"display",_f0c?"":"none");},_setHeadingPanelIsVisibleAttr:function(_f0d){_eeb.set(this.headingPanel,"display",_f0d?"":"none");_eeb.set(this.subHeadingPanel,"display",_f0d?"none":"");},_setSaveButtonIsVisibleAttr:function(_f0e){this.toolbar.setItemVisibility("saveButton",_f0e);},_setSaveButtonDisabledAttr:function(_f0f){this.toolbar.setItemProperty("saveButton","disabled",_f0f);},_setShowCurrentNodeOnBreadcrumbAttr:function(show){this.toolbar.setItemProperty("breadcrumbs","showCurrentNode",show);this.toolbar.setItemVisibility("currentcontent",!show);},_setNotificationContextAttr:function(_f10){this.toolbar.setItemProperty("notificationCenter","notificationContext",_f10);},postMixInProperties:function(){this.inherited(arguments);this.model=new this.modelType();this.own(this.model.on("saveSuccess",lang.hitch(this,this._onSaveSuccess)));this.own(this.model.on("saveError",lang.hitch(this,this._onSaveError)));this.own(this.model.on("invalidContentName",lang.hitch(this,this._onInvalidContentName)));},postCreate:function(){this.inherited(arguments);this._contextService=this._contextService||_ef5.resolve("epi.shell.ContextService");this._setupToolbar();this.contentTypeList.set("model",this.model);},layout:function(){if(this._started){this.layoutContainer.resize(this._containerContentBox||this._contentBox);_eec.add(this.stackContainer.domNode,"epi-animation-node-reset");}},updateView:function(data){this.view=data.view;this._setCreateMode();this._beingSuspended=false;when(this.model.update(data),lang.hitch(this,function(){this.layout();}),function(err){});},_onSaveSuccess:function(_f11){this._clearCreateMode();this._beingSuspended=true;if(_f11.changeContext){this._changeContext(_f11.newContentLink);}else{this._backToCurrentContext();}if(this.createAsLocalAsset===true){_eed.publish("/epi/cms/action/createlocalasset");}},_onSaveError:function(){this._clearCreateMode();_eed.publish("/epi/cms/action/showerror");},_onInvalidContentName:function(_f12){var _f13=new _ef8({defaultContentName:_f12});var _f14=new _ef7({defaultActionsVisible:false,content:_f13,title:_f13.title,destroyOnHide:true});this.own(_eea.after(_f14,"onExecute",lang.hitch(this,function(){var name=_f13.get("value");if(name===_f12){this.model.set("ignoreDefaultNameWarning",true);}this.model.set("contentName",name);this.model.save();}),true),_eea.after(_f14,"onCancel",lang.hitch(this,function(){if(this.model.wizardStep===this.model.startWizardStep){this.model.set("contentTypeId",null);}when(this.model.getAvailableContentTypes(),lang.hitch(this,function(_f15){if(!_f15||_f15.length==1){this._cancel();}}));}),true));_f14.show();},_onPropertyValidStateChange:function(_f16,_f17){if(_f17){this.model.addInvalidProperty(_f16,_f17);}else{this.model.removeInvalidProperty(_f16);}},_onContentNameChange:function(name){this.model.set("contentName",name);},_onSave:function(){if(this._beingSuspended){return;}this.propertiesForm.validate();this.model.set("properties",this.propertiesForm.get("value"));this.model.save();},_onCancel:function(){this._cancel();},_cancel:function(){this._clearCreateMode();this.model.cancel();this._backToCurrentContext();},_setupToolbar:function(){var _f18=[{name:"leading",type:"toolbargroup",settings:{region:"leading"}},{name:"trailing",type:"toolbargroup",settings:{region:"trailing"}}];var _f19=[{parent:"leading",name:"breadcrumbs",widgetType:"epi-cms/widget/Breadcrumb",settings:{showCurrentNode:false}},{parent:"leading",name:"currentcontent",widgetType:"epi-cms/widget/BreadcrumbCurrentItem"},{parent:"trailing",name:"notificationCenter",widgetType:"epi-cms/widget/NotificationStatusBar"},{parent:"trailing",name:"saveButton",title:_eff.action.create,label:_eff.action.create,type:"button",action:lang.hitch(this,this._onSave),settings:{"class":"epi-boldButton Salt"}},{parent:"trailing",name:"cancelButton",title:_eff.action.cancel,label:_eff.action.cancel,type:"button",action:lang.hitch(this,this._onCancel),settings:{"class":"epi-boldButton"}}];when(this.toolbar.add(_f18),lang.hitch(this,function(){this.toolbar.add(_f19);}));},_changeContext:function(_f1a){_eed.publish("/epi/shell/context/request",{uri:"epi.cms.contentdata:///"+_f1a},{sender:this,viewName:this.view,forceContextChange:true});},_backToCurrentContext:function(){_eed.publish("/epi/shell/action/changeview/back");},_setCreateMode:function(){lang.mixin(this._contextService.currentContext,{"currentMode":"create"});_eed.publish("/epi/cms/action/togglecreatemode",true);},_clearCreateMode:function(){_eec.remove(this.stackContainer.domNode,"epi-animation-node-reset");lang.mixin(this._contextService.currentContext,{"currentMode":undefined});_eed.publish("/epi/cms/action/togglecreatemode",false);}});});},"epi-cms/contentediting/NewContentNameInputDialog":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dijit/_CssStateMixin","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/TextBox","epi","epi/shell/widget/dialog/_DialogContentMixin","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/_ActionProviderWidget","dojo/text!./templates/NewContentNameInputDialog.html","epi/i18n!epi/cms/nls/episerver.cms.widget.newcontentnamedialog"],function(_f1b,lang,_f1c,_f1d,_f1e,_f1f,_f20,_f21,epi,_f22,_f23,_f24,_f25,res){return _f1b([_f1e,_f1f,_f20,_f24,_f22,_f1d],{templateString:_f25,res:res,defaultContentName:null,message:null,title:null,nameLabel:epi.resources.header.name,_setMessageAttr:{node:"messageNode",type:"innerHTML"},postMixInProperties:function(){this.inherited(arguments);this.message=lang.replace(this.res.warningtext,{defaultname:this.defaultContentName});this._set("message",this.message);this.title=res.title;},postCreate:function(){this.inherited(arguments);this.contentNameTextbox.set("value",this.defaultContentName);this.contentNameTextbox.on("focus",function(){this.focusNode.select();});this.contentNameTextbox.on("keyup",lang.hitch(this,function(evt){var _f26=this.contentNameTextbox.isValid();if(evt.keyCode==dojo.keys.ENTER&&_f26){this.executeDialog();}}));this.contentNameTextbox.focus();},_getValueAttr:function(){return this.contentNameTextbox.get("value");},getActions:function(){this._actions=[{name:"ok",label:epi.resources.action.ok,settings:{type:"button","class":"Salt"},action:lang.hitch(this,function(){if(this.contentNameTextbox.isValid()){this.executeDialog();}else{this.contentNameTextbox.focus();}})},{name:"cancel",label:epi.resources.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}];return this._actions;}});});},"url:epi-cms/contentediting/templates/NewContentNameInputDialog.html":"<div class=\"epi-formContainer\">\r\n    <div data-dojo-attach-point=\"messageNode\"></div>\r\n    <br />\r\n    <div>\r\n        <label data-dojo-attach-point=\"contentNameLabelNode\">${nameLabel}</label>\r\n        <input type=\"text\" size=\"40\" maxlength=\"255\"  data-dojo-attach-point=\"contentNameTextbox\" data-dojo-type=\"dijit/form/ValidationTextBox\"\r\n                data-dojo-props=\"required: true, trim:true\"\r\n                missingMessage: \"${res.errormessage.missingmessage}\" />\r\n    </div>\r\n</div>","epi-cms/contentediting/viewmodel/CreateContentViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/Stateful","dojo/string","dojo/when","dojo/Deferred","dojo/Evented","epi/dependency","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/contentediting/ContentEditingValidator","epi/i18n!epi/cms/nls/episerver.cms.components.requiredproperties"],function(_f27,_f28,lang,json,_f29,_f2a,when,_f2b,_f2c,_f2d,_f2e,_f2f,_f30,_f31){return _f28([_f29,_f2c],{_topLevelContainerType:"epi/shell/layout/SimpleContainer",_groupContainerType:"epi-cms/layout/CreateContentGroupContainer",_availableContentTypes:null,_waitingAvailableContentTypes:null,_waitingSuggestedContentTypes:null,_suggestedContentTypes:null,contentDataStore:null,contentTypeStore:null,metadataManager:null,typeIdentifierManager:null,validator:null,parent:null,contentTypeId:null,requestedType:null,createAsLocalAsset:null,canChangeLocalAssetName:null,addToDestination:null,wizardStep:0,startWizardStep:0,contentName:null,ignoreDefaultNameWarning:null,properties:null,headingText:null,createAsLocalAssetHelpText:null,namePanelIsVisible:null,headingPanelIsVisible:null,seamlessTopPanel:null,saveButtonIsVisible:null,saveButtonDisabled:null,showAllProperties:null,showCurrentNodeOnBreadcrumb:null,effectiveParentLink:null,metadata:null,postscript:function(){this.inherited(arguments);var _f32=null;this.contentDataStore=this.contentDataStore||(_f32=_f2d.resolve("epi.storeregistry")).get("epi.cms.contentdata");this.contentTypeStore=this.contentTypeStore||(_f32||_f2d.resolve("epi.storeregistry")).get("epi.cms.contenttype");this.metadataManager=this.metadataManager||_f2d.resolve("epi.shell.MetadataManager");this.validator=this.validator||new _f30({contextTypeName:"epi.cms.contentdata"});this.set("propertyFilter",lang.hitch(this,this._propertyFilter));},update:function(_f33){if(_f33){_f27.forEach(["requestedType","parent","canChangeLocalAssetName","createAsLocalAsset","addToDestination","contentTypeId"],function(_f34){this.set(_f34,_f33[_f34]);},this);}this.set("ignoreDefaultNameWarning",false);this.set("properties",null);this.set("saveButtonIsVisible",false);this.set("wizardStep",this.startWizardStep);if(this.parent){var _f35=this.parent.contentLink+"_new_content";this.validator.clearErrorsBySource();this.validator.setContextId(_f35);this.set("notificationContext",{contextTypeName:"epi.cms.contentdata",contextId:_f35});}},save:function(){this.set("saveButtonDisabled",true);if(!this.ignoreDefaultNameWarning&&(this.canChangeLocalAssetName||!this.createAsLocalAsset)&&(!this.contentName||this.contentName===""||this.contentName===this.defaultName)){this._emitSaveEvent("invalidContentName",this.contentName);return;}this.validator.clearErrorsBySource(this.validator.validationSource.server);when(this.validator.validate(),lang.hitch(this,function(_f36){if(_f36){this._emitSaveEvent("validationError");return;}var _f37=this.buildContentObject();this.contentDataStore.put(_f37).then(lang.hitch(this,this._saveSuccessHandler),lang.hitch(this,this._saveErrorHandler));}),lang.hitch(this,function(){this._emitSaveEvent("validationError");}));},_emitSaveEvent:function(_f38,_f39){this.set("saveButtonDisabled",false);this.emit(_f38,_f39);},cancel:function(){this.addToDestination&&(typeof this.addToDestination.cancel==="function")&&this.addToDestination.cancel();},_propertyFilter:function(_f3a,_f3b){var _f3c=_f3b.originalGroupName!=="EPiServerCMS_SettingsPanel"&&_f3b.originalGroupName!=="Advanced";var _f3d=this._isRequiredProperty(_f3a,_f3b);if(this.showAllProperties){return _f3c||_f3d;}else{return _f3d;}},_saveSuccessHandler:function(_f3e){var ref=new _f2f(_f3e),_f3f=ref.createVersionUnspecificReference(),_f40=lang.hitch(this,function(_f41){this._emitSaveEvent("saveSuccess",{newContentLink:_f41,changeContext:true});});when(this.contentDataStore.refresh(_f3e),lang.hitch(this,function(_f42){if(this.addToDestination){this.addToDestination.save({contentLink:_f3f.toString(),name:_f42.name,typeIdentifier:this.requestedType});this._emitSaveEvent("saveSuccess",{changeContext:false});}else{_f40(_f3f.toString());}}));},_saveErrorHandler:function(err){if(err&&err.responseText){var _f43=json.fromJson(err.responseText);_f27.forEach(_f43,function(item){if(item.propertyName){this.validator.setPropertyErrors(item.propertyName,[{severity:item.severity,errorMessage:item.errorMessage}],this.validator.validationSource.server);}else{this.validator.setGlobalErrors([{severity:item.severity,errorMessage:item.errorMessage}],this.validator.validationSource.server);}},this);}else{if(err){this.validator.setGlobalErrors([{severity:this.validator.severity.error,errorMessage:err.message}],this.validator.validationSource.server);}}this._emitSaveEvent("saveError",err);},buildContentObject:function(){return {name:(!this.createAsLocalAsset||this.canChangeLocalAssetName)?_f2a.trim(this.contentName+""):null,parentLink:this.parent?this.parent.contentLink:null,contentTypeId:this.contentTypeId,properties:this.properties,createAsLocalAsset:this.createAsLocalAsset};},addInvalidProperty:function(_f44,_f45){this.validator.setPropertyErrors(_f44,[{severity:this.validator.severity.error,errorMessage:_f45}],this.validator.validationSource.client);},removeInvalidProperty:function(_f46){this.validator.clearPropertyErrors(_f46);},getAvailableContentTypes:function(){if(this._availableContentTypes){return this._availableContentTypes;}var _f47=this._waitingAvailableContentTypes;if(!_f47){_f47=this._waitingAvailableContentTypes=new _f2b();when(this.contentTypeStore.query({query:"getavailablecontenttypes",parentReference:this.effectiveParentLink,requestedTypes:[this.requestedType]}),lang.hitch(this,function(_f48){this._availableContentTypes=_f48;this._waitingAvailableContentTypes.resolve(this._availableContentTypes);this._waitingAvailableContentTypes=null;}),lang.hitch(this,function(_f49){this._availableContentTypes=null;this._waitingAvailableContentTypes.reject(_f49);this._waitingAvailableContentTypes=null;}));}return _f47.promise;},getSuggestedContentTypes:function(){if(this._suggestedContentTypes){return this._suggestedContentTypes;}var _f4a=this._waitingSuggestedContentTypes;if(!_f4a){_f4a=this._waitingSuggestedContentTypes=new _f2b();when(this.contentTypeStore.query({query:"getsuggestedcontenttypes",parentReference:this.effectiveParentLink,requestedTypes:[this.requestedType]}),lang.hitch(this,function(_f4b){this._suggestedContentTypes=_f4b;this._waitingSuggestedContentTypes.resolve(this._suggestedContentTypes);this._waitingSuggestedContentTypes=null;}),lang.hitch(this,function(_f4c){this._suggestedContentTypes=null;this._waitingSuggestedContentTypes.reject(_f4c);this._waitingSuggestedContentTypes=null;}));}return _f4a.promise;},_contentTypeIdSetter:function(_f4d){this.contentTypeId=_f4d;if(_f4d&&this.parent){when(this._getMetadata(this.parent.contentLink,_f4d),lang.hitch(this,function(_f4e){if(!this.canChangeLocalAssetName||this._hasRequiredProperties(_f4e)){_f4e=this._regroupProperties(_f4e);this.set("metadata",_f4e);this.set("wizardStep",1);this.set("saveButtonIsVisible",true);}else{this.save();}}));}this._setHeadingText();},_canChangeLocalAssetNameSetter:function(_f4f){this.canChangeLocalAssetName=_f4f==null?true:_f4f;},_createAsLocalAssetSetter:function(_f50){var _f51=this.canChangeLocalAssetName||!_f50;this.set("namePanelIsVisible",_f51);this.set("headingPanelIsVisible",_f51);this.set("showAllProperties",!this.canChangeLocalAssetName);this.set("showCurrentNodeOnBreadcrumb",_f51);this.set("seamlessTopPanel",_f51);if(this.parent){this.set("effectiveParentLink",_f50?this.parent.assetsFolderLink:this.parent.contentLink);}this.createAsLocalAsset=_f50;},_effectiveParentLinkSetter:function(_f52){this._clearContentTypesData();this.effectiveParentLink=_f52;},_parentSetter:function(_f53){this.parent=_f53;var _f54=this.parent.typeIdentifier,_f55=_f2e.getResourceValue(this.requestedType,"name"),_f56=_f2e.getResourceValue(_f54,"name"),_f57=_f2e.getResourceValue(_f54,"createaslocalassethelptext");if(_f55&&_f56){_f57=lang.replace(_f57,[_f55.toLowerCase(),_f56.toLowerCase()]);}this.set("createAsLocalAssetHelpText",_f57);},_requestedTypeSetter:function(_f58){var _f59=_f2e.getResourceValue(_f58,"newitemdefaultname");this.defaultName=_f59;this.set("contentName",_f59);this.requestedType=_f58;this._clearContentTypesData();this._setHeadingText();},_hasRequiredProperties:function(_f5a){return _f27.some(_f5a.properties,function(_f5b){return this._isRequiredProperty(_f5a,_f5b);},this);},_isRequired:function(_f5c){return _f5c.settings&&_f5c.settings.required;},_isRequiredProperty:function(_f5d,_f5e){var _f5f=!_f5e.additionalValues.hasValue;var _f60=_f5e.showForEdit&&_f27.every(_f5d.groups,function(_f61){return (_f61.name!==_f5e.groupName&&_f61.name!==_f5e.originalGroupName)||_f61.displayUI;});var _f62=_f27.some(_f5e.properties,function(_f63){return this._isRequiredProperty(_f5e,_f63);},this);return (this._isRequired(_f5e)||_f62)&&_f5f&&_f60&&(_f5e.name!=="icontent_name");},_regroupProperties:function(_f64){_f64=lang.clone(_f64);_f64.layoutType=this._topLevelContainerType;_f27.forEach(_f64.properties,function(prop){var _f65=this._isRequiredProperty(_f64,prop);prop.originalGroupName=prop.groupName;prop.groupName=_f65?"required":"additional";},this);_f64.groups=[{name:"required",displayUI:true,title:_f31.groups.required,uiType:this._groupContainerType},{name:"additional",displayUI:true,title:_f31.groups.additional,uiType:this._groupContainerType}];return _f64;},_getMetadata:function(_f66,_f67){return this.metadataManager.getMetadataForType("EPiServer.Core.ContentData",{parentLink:_f66,contentTypeId:_f67});},_setHeadingText:function(){var _f68=_f2e.getResourceValue(this.requestedType,"create");this.set("headingText",_f68);if(_f68&&this.contentTypeId){when(this.contentTypeStore.get(this.contentTypeId),lang.hitch(this,function(_f69){var _f6a=_f69.localizedName||_f69.name;if(_f6a){this.set("headingText",_f68+": "+_f6a);}}));}},_clearContentTypesData:function(){this._availableContentTypes=null;if(this._waitingAvailableContentTypes){this._waitingAvailableContentTypes.cancel();}this._waitingAvailableContentTypes=null;this._suggestedContentTypes=null;if(this._waitingSuggestedContentTypes){this._waitingSuggestedContentTypes.cancel();}this._waitingSuggestedContentTypes=null;}});});},"epi-cms/contentediting/ContentEditingValidator":function(){define(["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/_base/connect","dojo/store/Memory","dojo/Stateful","epi/dependency"],function(dojo,_f6b,_f6c,_f6d,lang,_f6e,_f6f,_f70,_f71){return _f6c([_f70],{contextTypeName:"",contextId:null,messageService:null,_isBlocking:false,isValid:true,hasErrors:false,_storeId:0,_store:null,severity:{"none":0,"info":1,"warn":2,"error":3},validationSource:{"server":1,"client":2},_errorLevels:{},constructor:function(_f72){_f6c.safeMixin(this,_f72);},postscript:function(){this.inherited(arguments);for(var p in this.severity){var _f73=this.severity[p];this._errorLevels[_f73]=p;}this.messageService=this.messageService||_f71.resolve("epi.shell.MessageService");this._store=new _f6f({idAttribute:"id",data:[]});},setContextId:function(_f74){var _f75=this.contextId;this.contextId=_f74;var _f76=this.messageService.query({contextTypeName:this.contextTypeName,contextId:_f75});_f76.forEach(lang.hitch(this,function(item){item.contextId=this.contextId;this.messageService.put(item);}));},clearPropertyErrors:function(_f77,_f78){if(!_f77){return;}this._clearErrors(_f77,_f78);},setPropertyErrors:function(_f79,_f7a,_f7b){if(!_f79){return;}this._setErrors(_f7a,_f79,_f7b);},clearGlobalErrors:function(_f7c){this._clearErrors(null,_f7c);},clearErrorsBySource:function(_f7d){this._clearErrors(undefined,_f7d);},setGlobalErrors:function(_f7e,_f7f){this._setErrors(_f7e,null,_f7f);},_clearErrors:function(_f80,_f81){var _f82;if(_f80){_f82={"propertyName":_f80};}else{if(_f80===null){_f82={"global":true};}else{_f82={};}}if(_f81){_f82.source=_f81;}var _f83=this._store.query(_f82);_f83.forEach(lang.hitch(this,function(item){this.messageService.remove({id:item.messageId});this._store.remove(item.id);}));this._updateFlags();},_setErrors:function(_f84,_f85,_f86){this._clearErrors(_f85,_f86);_f6b.forEach(_f84,function(item){this._putStoreItem(item,_f85,_f86);},this);this._updateFlags();},_putStoreItem:function(item,_f87,_f88){var _f89="";if(this._errorLevels[item.severity]){_f89=this._errorLevels[item.severity];}var _f8a=this.messageService.put(_f89,item.errorMessage,this.contextTypeName,this.contextId);var _f8b={"id":this._storeId++,"item":item,"severity":item.severity,"messageId":_f8a};if(_f87){_f8b.propertyName=_f87;}else{_f8b.global=true;}if(_f88!==undefined){_f8b.source=_f88;}return this._store.put(_f8b);},_updateFlags:function(){var _f8c=this._store.query({"severity":this.severity.error});var _f8d=this._store.query({"severity":this.severity.warn});var _f8e=_f8c.length===0&&_f8d.length===0;var _f8f=_f8c.length>0;this.set("isValid",_f8e);this.set("hasErrors",_f8f);},validate:function(){var _f90=this.severity.error,_f91=this.severity.warn,_f92=new _f6d();_f6d.when(this._validate(_f90),function(_f93){if(_f93){_f6e.publish("/epi/cms/action/showerror");}_f92.resolve(_f93);},function(){_f6e.publish("/epi/cms/action/showerror");_f92.reject();});return _f92;},_validate:function(_f94){var _f95=new _f6d();if(!this._isBlocking){_f6d.when(this._store.query({"severity":_f94}),lang.hitch(this,function(_f96){var _f97=_f6b.filter(_f96,function(item){return item.source==this.validationSource.client;},this);var _f98=_f97.length>0;var _f99=_f96.length>_f97.length;if(_f98){_f95.reject();}else{_f95.resolve(_f99);}}));}return _f95;}});});},"epi-cms/widget/ContentTypeList":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/Deferred","dojo/promise/all","dojo/when","dijit/layout/_LayoutWidget","epi/dependency","epi/shell/widget/_ModelBindingMixin","epi/shell/TypeDescriptorManager","epi-cms/widget/ContentTypeGroup","epi/i18n!epi/cms/nls/episerver.cms.widget.contenttypelist"],function(_f9a,_f9b,lang,_f9c,_f9d,all,when,_f9e,_f9f,_fa0,_fa1,_fa2,i18n){return _f9b([_f9e,_fa0],{groups:null,modelBindingMap:{"effectiveParentLink":["effectiveParentLink"]},_setEffectiveParentLinkAttr:function(){if(this._started&&this.model.requestedType){this.refresh();}},postMixInProperties:function(){this.inherited(arguments);this.groups={};},buildRendering:function(){this.inherited(arguments);var _fa3=new _fa2();this.connect(_fa3,"onSelect",function(item){this.model.set("contentTypeId",item.id);this.onContentTypeSelected(item);});this.addChild(_fa3);this._suggestedContentTypes=_fa3;},refresh:function(){this.clear();this._setupWidgetTemplate();when(all({types:this.model.getSuggestedContentTypes(),groups:this._groupContentTypes()}),lang.hitch(this,function(_fa4){var _fa5=_fa4.types,_fa6=_fa4.groups,_fa7=_fa6.grouped,_fa8=_fa6.contentTypes;if(_fa5.length<=0){this._suggestedContentTypes.setVisibility(false);}else{_f9c.add(this._suggestedContentTypes.titleNode,"epi-ribbonHeaderSpecial");this._suggestedContentTypes.set("title",this._suggestedTypesTitle);this._suggestedContentTypes.set("contentTypes",_fa5);this._suggestedContentTypes.setVisibility(true);}var key,_fa9;for(key in _fa7){_fa9=this._getOrCreateGroup(key);_fa9.set("contentTypes",_fa7[key]);}if(_fa8 instanceof Array&&_fa8.length===1){var item=_fa8[0];this.model.set("contentTypeId",item.id);this.onContentTypeSelected(item);}}));},setVisibility:function(_faa){this.getChildren().forEach(function(_fab){_fab.setVisibility(_faa);},this);},_setupWidgetTemplate:function(){this._suggestedTypesTitle=_fa1.getResourceValue(this.model.requestedType,"suggestedtypes");this._otherTypesTitle=_fa1.getResourceValue(this.model.requestedType,"othertypes");},clear:function(){this._suggestedContentTypes.clear();for(var key in this.groups){this.groups[key].destroyRecursive();delete this.groups[key];}},_getOrCreateGroup:function(name){var _fac=this.groups[name];if(!_fac){_fac=new _fa2({title:name});this.connect(_fac,"onSelect",function(item){this.model.set("contentTypeId",item.id);this.onContentTypeSelected(item);});this.addChild(_fac);this.groups[name]=_fac;}return _fac;},_groupContentTypes:function(){var _fad={},_fae=new _f9d(),_faf=this._otherTypesTitle;when(this.model.getAvailableContentTypes(),lang.hitch(this,function(_fb0){var _fb1=_fb0.length;_f9a.forEach(_fb0,function(item){when(item,function(type){var _fb2=type.groupName||_faf,_fb3=_fad[_fb2]||[];_fb3.push(type);_fad[_fb2]=_fb3;_fb1--;if(_fb1===0){_fae.resolve({grouped:_fad,contentTypes:_fb0});}});});}));return _fae;},onContentTypeSelected:function(){}});});},"epi-cms/widget/ContentTypeGroup":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/dom-style","dojo/text!./templates/ContentTypeGroup.html","dijit/_TemplatedMixin","dijit/layout/_LayoutWidget","epi-cms/widget/ContentType","dojo/keys","dijit/_KeyNavContainer"],function(_fb4,lang,_fb5,_fb6,_fb7,_fb8,_fb9,_fba,keys,_fbb){return _fb4([_fb9,_fb8,_fbb],{title:"",contentTypes:null,templateString:_fb7,buildRendering:function(){this.inherited(arguments);},postCreate:function(){this.inherited(arguments);this.render();this.connectKeyNavHandlers(this.isLeftToRight()?[keys.LEFT_ARROW,keys.UP_ARROW]:[keys.RIGHT_ARROW,keys.DOWN_ARROW],this.isLeftToRight()?[keys.RIGHT_ARROW,keys.DOWN_ARROW]:[keys.LEFT_ARROW,keys.UP_ARROW]);},render:function(){this.clear();_fb5.forEach(this.contentTypes,function(type){var _fbc=new _fba({contentType:type});this.connect(_fbc,"onSelect",this.onSelect);this.addChild(_fbc);},this);},clear:function(){_fb5.forEach(this.getChildren(),function(_fbd){this.removeChild(_fbd);_fbd.destroyRecursive();},this);},_setTitleAttr:{node:"titleNode",type:"innerText"},_setContentTypesAttr:function(_fbe){this._set("contentTypes",_fbe);if(this._created){this.render();}},onSelect:function(){},setVisibility:function(_fbf){var _fc0=(_fbf?"block":"none");_fb6.set(this.domNode,"display",_fc0);}});});},"url:epi-cms/widget/templates/ContentTypeGroup.html":"<div class=\"epi-listingContainer\" data-dojo-attach-point=\"focusNode\" tabIndex=\"${tabIndex}\">\r\n    <h2 data-dojo-attach-point=\"titleNode\" class=\"epi-ribbonHeader\"></h2>\r\n    <ul data-dojo-attach-point=\"containerNode\" class=\"epi-advancedListing\"></ul>\r\n</div>","epi-cms/widget/ContentType":function(){define(["dojo","dojo/dom-class","dojo/string","dijit/focus","dijit/_Widget","dijit/_TemplatedMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.pagetype","dojo/text!./templates/ContentType.html"],function(dojo,_fc1,_fc2,_fc3,_fc4,_fc5,i18n,_fc6){return dojo.declare([_fc4,_fc5],{templateString:_fc6,contentType:null,iconTemplate:"<img src=\"${0}\" alt=\"${1}\" class=\"epi-preview\" />",emptyIconTemplate:_fc2.substitute("<div class=\"epi-noPreviewIcon\"><span class=\"epi-noPreview\">${0}</span></div>",[i18n.nopreview]),buildRendering:function(){this.inherited(arguments);this.connect(this.domNode,"onclick",this._onClick);this.render();},render:function(){var type=this.contentType;if(type){this.set("name",type.localizedName);this.set("description",type.localizedDescription||i18n.nodescription);this.set("icon",type.imagePath);}},_setContentTypeAttr:function(_fc7){this._set("contentType",_fc7);if(this._created){this.render();}},_setNameAttr:{node:"nameNode",type:"innerText"},_setDescriptionAttr:{node:"descriptionNode",type:"innerText"},_setIconAttr:function(_fc8){this._set("icon",_fc8);this.iconNode.innerHTML=_fc8?_fc2.substitute(this.iconTemplate,[_fc8,this.name]):this.emptyIconTemplate;},focus:function(){this.inherited(arguments);_fc1.add(this.focusNode,"epi-advancedListingItemActive");_fc3.focus(this.focusNode);},_onBlur:function(){this.inherited(arguments);_fc1.remove(this.focusNode,"epi-advancedListingItemActive");},_onKeyPress:function(e){if(e.keyCode===13||e.keyCode===32){this.onSelect(this.contentType);}},_onClick:function(){this.onSelect(this.contentType);},_onMouseOver:function(){_fc1.add(this.focusNode,"epi-advancedListingItemActive");},_onMouseOut:function(){_fc1.remove(this.focusNode,"epi-advancedListingItemActive");},onSelect:function(item){}});});},"url:epi-cms/widget/templates/ContentType.html":"<li class=\"clearfix\" data-dojo-attach-event=\"onkeypress:_onKeyPress, onmouseover:_onMouseOver, onmouseout:_onMouseOut\" data-dojo-attach-point=\"focusNode\">\r\n    <div class=\"epi-browserWindow\"><div class=\"epi-browserWindowContent\" data-dojo-attach-point=\"iconNode\">${emptyIconTemplate}</div></div>\r\n    <h3 data-dojo-attach-point=\"nameNode\"></h3>\r\n    <p data-dojo-attach-point=\"descriptionNode\"></p>\r\n</li>","epi-cms/widget/PropertiesForm":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","dijit/layout/_LayoutWidget","epi/shell/widget/FormContainer"],function(_fc9,_fca,lang,when,_fcb,_fcc){return _fca([_fcb],{metadata:null,showAllProperties:false,propertyFilter:null,_setMetadataAttr:function(_fcd){this._set("metadata",_fcd);this._setupForm();},_setupForm:function(){if(this._form){this._form.destroy();}this._form=new _fcc({metadata:this.metadata,doLayout:false,propertyFilter:lang.hitch(this,this.propertyFilter)});this.connect(this._form,"onFieldCreated",function(_fce,_fcf){this.own(_fcf.watch("state",lang.hitch(this,function(name,_fd0,_fd1){if(_fd0==="Error"&&_fd1!=="Error"){this.onPropertyValidStateChange(_fce);}else{if(_fd0!=="Error"&&_fd1==="Error"){this.onPropertyValidStateChange(_fce,_fcf.getErrorMessage());}}})));});this._form.placeAt(this.domNode);this.own(this._form);},validate:function(){return this._form.validate();},onPropertyValidStateChange:function(_fd2,_fd3){},_getValueAttr:function(){return this._form.get("value");}});});},"epi-cms/widget/BreadcrumbCurrentItem":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/Evented","dojo/topic","dojo/dom-construct","dijit/_TemplatedMixin","dijit/_WidgetBase","epi/string","epi/shell/TypeDescriptorManager","dojo/text!./templates/BreadcrumbCurrentItem.html"],function(_fd4,_fd5,_fd6,_fd7,_fd8,_fd9,_fda,_fdb,_fdc,_fdd){return _fd4([_fda,_fd9],{templateString:_fdd,_currentIconClass:null,_setCurrentItemInfoAttr:function(_fde){if(!_fde){return;}this.heading.innerHTML=_fdb.encodeForWebString(_fde.name);if(_fde.dataType){var _fdf=_fdc.getValue(_fde.dataType,"iconClass");if(_fdf&&_fdf!==this._currentIconClass){_fd5.remove(this.iconNode,this._currentIconClass);_fd5.add(this.iconNode,_fdf);this._currentIconClass=_fdf;}}}});});},"url:epi-cms/widget/templates/BreadcrumbCurrentItem.html":"<div>\r\n    <div class=\"epi-breadCrumbs-title-wrapper\"><span data-dojo-attach-point=\"iconNode\" class=\"dijitInline dijitIcon epi-breadCrumbsCurrentItem-icon\"></span><h1 data-dojo-attach-point=\"heading\" class=\"epi-breadcrumbContentItem dojoxEllipsis\"></h1></div>\r\n</div>","url:epi-cms/contentediting/templates/CreateContent.html":"<div class=\"epi-createContent\">\r\n    <div data-dojo-attach-point=\"layoutContainer\" data-dojo-type=\"dijit/layout/BorderContainer\" data-dojo-props=\"gutters: false, livesplitters: false\">\r\n        <div class=\"epi-static-node\" data-dojo-attach-point=\"topPanel\" data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-props=\"region:'top'\">\r\n            <div data-dojo-attach-point=\"headingPanel\">\r\n                <h1 data-dojo-attach-point=\"headingTextNode\"></h1>\r\n            </div>\r\n            <div data-dojo-attach-point=\"toolbar\" class=\"epi-localToolbar epi-viewHeaderContainer\" data-dojo-type=\"epi/shell/widget/ToolbarSet\" data-dojo-props=\"region:'top'\"></div>\r\n            <div data-dojo-attach-point=\"namePanel\">\r\n                <label>${sharedResources.header.name}</label>\r\n                <input data-dojo-attach-point=\"nameTextBox\" data-dojo-type=\"dijit/form/ValidationTextBox\" data-dojo-attach-event=\"onChange: _onContentNameChange\" maxlength=\"255\" />\r\n            </div>\r\n        </div>\r\n        <div class=\"epi-newContentContainer epi-animation-node\" data-dojo-attach-point=\"stackContainer\" data-dojo-type=\"dijit/layout/StackContainer\" data-dojo-props=\"region: 'center'\">\r\n            <div data-dojo-attach-point=\"contentTypeList\" data-dojo-type=\"epi-cms/widget/ContentTypeList\">\r\n                <div data-dojo-attach-point='subHeadingPanel' class=\"push-padding--left\">\r\n                    <h1 data-dojo-attach-point=\"subHeadingTextNode\"></h1>\r\n                    <p data-dojo-attach-point=\"subHeadingDescNode\"></p>\r\n                </div>\r\n            </div>\r\n            <div data-dojo-attach-point=\"propertiesForm\" data-dojo-type=\"epi-cms/widget/PropertiesForm\" data-dojo-attach-event=\"onPropertyValidStateChange: _onPropertyValidStateChange\">\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>","epi-cms/contentediting/CreateLanguageBranch":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/CreateContent","epi-cms/contentediting/viewmodel/CreateLanguageBranchViewModel"],function(_fe0,lang,_fe1,_fe2){return _fe0([_fe1],{modelType:_fe2,_setCreateMode:function(){lang.mixin(this._contextService.currentContext,{"currentMode":"translate"});}});});},"epi-cms/contentediting/viewmodel/CreateLanguageBranchViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi-cms/contentediting/viewmodel/CreateContentViewModel"],function(_fe3,lang,when,_fe4){return _fe3([_fe4],{languageBranch:null,masterLanguageVersionId:null,postscript:function(){this.wizardStep=1;this.startWizardStep=1;this.inherited(arguments);},update:function(_fe5){var _fe6=_fe5.contentData;var _fe7=_fe5.languageBranch;return when(this.contentDataStore.get(_fe6.parentLink),lang.hitch(this,function(_fe8){var _fe9=_fe4.prototype.update.apply(this,[{requestedType:_fe6.typeIdentifier,parent:_fe8,contentTypeId:_fe6.contentTypeID}]);this.set("languageBranch",_fe7);this.set("masterLanguageVersionId",_fe6.contentLink);this.set("contentName",_fe6.name);return _fe9;}));},_isRequired:function(_fea){return this.inherited(arguments)&&(!this.languageBranch||_fea.settings.isLanguageSpecific===true);},buildContentObject:function(){var _feb=this.inherited(arguments);lang.mixin(_feb,{languageBranch:this.languageBranch,masterLanguageVersionId:this.masterLanguageVersionId});return _feb;}});});},"epi-cms/contentediting/DateTimeNowEditor":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/text!./templates/DateTimeNowEditor.html","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/Tooltip","epi/shell/widget/_ValueRequiredMixin","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.datetimenow"],function(_fec,_fed,lang,_fee,_fef,_ff0,_ff1,_ff2,_ff3,_ff4,_ff5){return _fed([_ff0,_ff1,_ff2,_ff4],{templateString:_fef,value:null,resources:_ff5,_selectorWatchHandle:null,postCreate:function(){this.inherited(arguments);this._selectorWatchHandle=this.dateTimeSelector.watch("value",lang.hitch(this,function(_ff6,_ff7,_ff8){this.onChange(_ff8);}));},onChange:function(_ff9){this.validate();},validate:function(){var _ffa=this.inherited(arguments);if(_ffa){var _ffb=this.get("value");_ffa=this.disabled||!_ffb||!this.minimumValue||_ffb>this.minimumValue;this._set("state",_ffa?"":"Error");if(_ffa){_ff3.hide(this.domNode);}else{_ff3.show(this.minimumValueMessage,this.domNode);}}return _ffa;},_setValueAttr:function(_ffc){this.dateTimeSelector.set("value",_ffc);this._set("value",_ffc);},_getValueAttr:function(){return this.dateTimeSelector.get("value");},_onExpireNowClick:function(){this.set("value",new Date());},destroy:function(){if(this._selectorWatchHandle){this._selectorWatchHandle.unwatch();}_ff3.hide(this.domNode);}});});},"url:epi-cms/contentediting/templates/DateTimeNowEditor.html":"<div class=\"dijitInline dijitInputContainer\">\r\n    <div data-dojo-type=\"epi/shell/widget/DateTimeSelectorDropDown\" data-dojo-attach-point=\"dateTimeSelector\"></div\r\n    ><a class=\"epi-visibleLink\" style=\"padding-left:10px\" data-dojo-attach-event=\"onclick:_onExpireNowClick\">${resources.now}</a>\r\n</div>","epi-cms/contentediting/DialogEditorWrapper":function(){define(["epi","dojo","epi-cms/contentediting/_EditorWrapperBase","epi/shell/widget/dialog/Dialog"],function(epi,dojo,_ffd,_ffe){return dojo.declare([_ffd],{closeOnChange:true,showButtons:false,_dialog:null,buildRendering:function(){this.inherited(arguments);if(!this.editorWidget){dojo["require"](this.editorWidgetType);var cls=dojo.getObject(this.editorWidgetType);var _fff=this.editorParams||{};if("displayedValue" in cls.prototype||"value" in cls.prototype){_fff["displayedValue" in cls.prototype?"displayedValue":"value"]=this.value;}this.editorWidget=new cls(_fff);}var ew=this.editorWidget;var _1000=new _ffe({content:ew,title:this.propertyDisplayName,defaultActionsVisible:this.showButtons,contentClass:"epi-dialog-fullWidth"});this.connect(ew,"onKeyPress",this._onKeyPress);this.connect(ew,"onCancel",this._onCancel);this.connect(ew,"onResize",dojo.hitch(this,function(){this._dialog.resize();}));if("intermediateChanges" in ew){ew.set("intermediateChanges",true);}this.connect(ew,"onChange","_onChange");this.connect(_1000,"onHide",this._onHide);this.connect(_1000,"onCancel",this._onCancel);this._dialog=_1000;},destroy:function(){this._dialog.destroyRecursive();this.inherited(arguments);},_onKeyPress:function(e){if(this.editing){if(e.altKey||e.ctrlKey){return;}if(e.keyCode==dojo.keys.ESCAPE){dojo.stopEvent(e);this.cancel();}else{if(e.keyCode==dojo.keys.ENTER&&e.target.tagName=="INPUT"){dojo.stopEvent(e);this._stopEdit();}}}},_onCancel:function(){this.cancel();this.editorWidget.set("value",this.value);if(this._dialog.open){this._dialog.hide();}},_onChange:function(){this.inherited(arguments);if(this.closeOnChange){this._stopEdit();}},_onHide:function(){if(this.editing){this._stopEdit();}},startEdit:function(){this.inherited(arguments);this._dialog.show();},_stopEdit:function(){this.inherited(arguments);if(this._dialog.open){this._dialog.hide();}},_setTitleAttr:function(title){if(this._dialog){this._dialog.set("title",title);}this._set("title",title);}});});},"epi-cms/contentediting/_EditorWrapperBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/_Widget","epi/epi"],function(_1001,lang,_1002,epi){return _1001([_1002],{wrapperType:"",editorWidgetType:null,editorParams:null,editing:false,disabled:false,blockDisplayNode:null,editorWidget:null,isModified:false,_resetValue:null,_lastSavedValue:null,_createdEditor:false,propertyName:"",propertyDisplayName:"",overlayItem:null,isOverlayDisabled:false,isUndoDisabled:false,hasInlineEditor:false,contentModel:null,onStartEdit:function(_1003,data){},onValueChange:function(_1004,value,_1005){},onCancel:function(_1006){},onStopEdit:function(_1007,value,_1008){},postCreate:function(){this.inherited(arguments);this._contentModelWatchHandle=this.contentModel.watch(this.propertyName,lang.hitch(this,"contentModelChanged"));},destroy:function(){this._contentModelWatchHandle.unwatch();if(this._createdEditor&&this.editorWidget){this.editorWidget.destroyRecursive();}if(this.editorWidget){this.editorWidget.parent=null;}this.blockDisplayNode=this.overlayItem=this.editorWidget=null;this.inherited(arguments);},contentModelChanged:function(name,_1009,value){if(!this.editing){this.set("value",value);}},startEdit:function(_100a){this._startEdit(_100a);},_startEdit:function(_100b){lang.mixin(this.editorParams,_100b);this.set("editing",true);this.set("isModified",false);this._lastSavedValue=this._resetValue=lang.clone(this.getEditorValue());this.isValid();this.onStartEdit(this,this.editorParams);},_stopEdit:function(_100c){this.set("editing",false);this._removeEditingFeatures();this.onStopEdit(this,this.getEditorValue(),this._resetValue,_100c);},cancel:function(){if(this.isModified){this.save(this._resetValue);}else{this.set("value",this._resetValue);}this.set("editing",false);this._removeEditingFeatures();this.onCancel(this);},save:function(val){this.set("value",val);this.set("isModified",true);this.onValueChange(this,val,this._lastSavedValue);this._lastSavedValue=lang.clone(val);},hasBeenEdited:function(){return this.editing&&(!epi.areEqual(this.getEditorValue(),this._resetValue));},hasPendingChanges:function(){return this.editing&&(!epi.areEqual(this.getEditorValue(),this._lastSavedValue));},tryToStopEditing:function(_100d){if(this.editing){if(this.isValid()){if(this.hasBeenEdited()){if(this.hasPendingChanges()){this.save(this.getEditorValue());}this._stopEdit(_100d);}else{this.cancel(_100d);}}else{this._onTryToStopWithInvalidValue();}}},_removeEditingFeatures:function(){},_onTryToStopWithInvalidValue:function(){},_onEditorKeyPress:function(e){if(this.editing){if(e.altKey||e.ctrlKey){return;}if(e.keyCode==dojo.keys.ESCAPE){dojo.stopEvent(e);this.cancel();}else{if(e.keyCode==dojo.keys.ENTER&&e.target.tagName=="INPUT"){dojo.stopEvent(e);this.tryToStopEditing(false);}}}},_onChange:function(val){if(this.editing&&this.isValid()&&this.hasPendingChanges()){this.save(val);}},getEditorWidget:function(){return this.editorWidget;},getEditorValue:function(){var ew=this.editorWidget;if(ew){return ew.get("value");}return null;},setEditorValue:function(val){var ew=this.editorWidget;if(ew&&!epi.areEqual(val,ew.get("value"))){ew.set("value",val);}},_setValueAttr:function(value){this.setEditorValue(value);this._set("value",this.getEditorValue()||value);},isValid:function(){return (this.editorWidget&&this.editorWidget.isValid?this.editorWidget.isValid():true);},focus:function(){this.editorWidget.focus();setTimeout(lang.hitch(this,function(){if(this.editorWidget.focusNode&&this.editorWidget.focusNode.tagName=="INPUT"){dijit.selectInputText(this.editorWidget.focusNode);}}),0);}});});},"epi-cms/contentediting/EditActionPanel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/dom-class","dojo/dom-attr","dijit/_CssStateMixin","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/form/DropDownButton","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/PublishMenu","epi/shell/widget/_ModelBindingMixin","epi/string","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel","dojo/text!./templates/EditActionPanel.html"],function(_100e,lang,_100f,_1010,_1011,_1012,_1013,_1014,_1015,_1016,_1017,_1018,_1019,_101a,res,_101b){return _100e([_1014,_1013,_1015,_1012,_1019],{templateString:_101b,commonRes:epi.resources,baseClass:"epi-statusIndicator",modelBindingMap:{"state":["state"],"statusText":["statusText"],"visible":["visible"],"buttonText":["buttonText"],"nonEditableIndicator":["nonEditableIndicator"],"statusIcon":["statusIcon"],"publishMenuViewModel":["publishMenuViewModel"],"additionalClass":["additionalClass"],"expanded":["expanded"]},_setStatusTextAttr:function(_101c){this._set("statusText",_101c);this._setStatusNodeText(_101c);},_setStatusNodeText:function(_101d){this.statusTextNode.innerHTML=_101d;_1011.set(this.stateNode,"title",!this.expanded?_101a.stripHtmlTags(_101d):"");},_setButtonTextAttr:function(val){this.dropDownButton.set("label",val);},_setVisibleAttr:function(val){_100f.set(this.domNode,"visibility",val?"visible":"hidden");},_setExpandedAttr:function(_101e){this._set("expanded",_101e);this._setStatusNodeText(this.statusText);},_setNonEditableIndicatorAttr:function(val){if(val){_1010.add(this.statusNonEditableIcon,"epi-iconPenDisabled");}else{_1010.remove(this.statusNonEditableIcon,"epi-iconPenDisabled");}},_setStatusIconAttr:function(val){_100f.set(this.statusTextIcon,"class","dijitInline dijitReset dijitIcon "+val);},_setAdditionalClassAttr:function(val){var _101f=this.get("additionalClass");if(_101f){_1010.remove(this.stateNode,_101f);}this._set("additionalClass",val);_1010.add(this.stateNode,val);},focus:function(){this.dropDownButton.focus();},_setPublishMenuViewModelAttr:function(val){this.dropDownMenu.set("model",val);},postCreate:function(){this.inherited(arguments);this.dropDownButton.dropDownPosition=["below-alt"];}});});},"epi-cms/contentediting/PublishMenu":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-style","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/html","dojo/on","dojo/sniff","dojo/Stateful","dojo/when","dijit/DropDownMenu","dijit/_KeyNavContainer","dijit/_WidgetsInTemplateMixin","epi","epi/shell/TypeDescriptorManager","epi/shell/widget/_ModelBindingMixin","epi/shell/command/builder/MenuBuilder","epi/shell/Downloader","epi-cms/contentediting/ContentActionSupport","dojo/text!./templates/PublishMenu.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu"],function(array,_1020,event,lang,_1021,_1022,_1023,_1024,html,on,sniff,_1025,when,_1026,_1027,_1028,epi,_1029,_102a,_102b,_102c,_102d,_102e,res){return _1020([_1026,_1028,_102a],{templateString:_102e,res:res,_menuBuilder:null,commands:null,mainButtonCommand:null,postMixInProperties:function(){this._menuBuilder=new _102b();},modelBindingMap:{"commands":["commands"],"mainButtonCommand":["mainButtonCommand"],"mainButtonSectionVisible":["mainButtonSectionVisible"],"lastChangeStatus":["lastChangeStatus"],"topInfoSectionVisible":["topInfoSectionVisible"],"publishInfoSectionVisible":["publishInfoSectionVisible"],"lastPublishedTitle":["lastPublishedTitle"],"lastPublishedTitleVisible":["lastPublishedTitleVisible"],"lastPublishedText":["lastPublishedText"],"lastPublishedViewLinkVisible":["lastPublishedViewLinkVisible"],"lastPublishedViewLinkHref":["lastPublishedViewLinkHref"],"additionalInfoSectionVisible":["additionalInfoSectionVisible"],"additionalInfoText":["additionalInfoText"],"typeIdentifier":["typeIdentifier"]},_setCommandsAttr:function(_102f){this.focusedChild=null;var _1030=this.getChildren();array.forEach(_1030,function(item){this.removeChild(item);},this);this.destroyDescendants();this._addCommandsToMenu(_102f);this.focusFirstChild();},_setMainButtonCommandAttr:function(_1031){this._set("mainButtonCommand",_1031);if(_1031){this.mainButton.set("label",_1031.label);this.mainButton.set("disabled",!_1031.get("canExecute"));_1023.remove(this.mainButton.domNode,"epi-loading");if(this._addedMainButtonClass){_1023.remove(this.mainButton.domNode,this._addedMainButtonClass);}if(_1031.options&&_1031.options.mainButtonClass){this._addedMainButtonClass=_1031.options.mainButtonClass;_1023.add(this.mainButton.domNode,this._addedMainButtonClass);}}},_setMainButtonSectionVisibleAttr:function(_1032){_1021.set(this.mainButtonSection,"display",_1032?"":"none");_1021.set(this.mainButton.domNode,"display",_1032?"":"none");},_setLastChangeStatusAttr:{node:"lastChangeStatusNode",type:"innerHTML"},_setTopInfoSectionVisibleAttr:function(_1033){_1021.set(this.topInfoSection,"display",_1033?"":"none");},_setPublishInfoSectionVisibleAttr:function(_1034){_1021.set(this.publishInfoSection,"display",_1034?"":"none");},_setLastPublishedTitleAttr:{node:"lastPublishedTitleNode",type:"innerHTML"},_setLastPublishedTitleVisibleAttr:function(_1035){_1021.set(this.lastPublishedTitleNode,"display",_1035?"":"none");},_setLastPublishedTextAttr:{node:"lastPublishedTextNode",type:"innerHTML"},_setLastPublishedViewLinkVisibleAttr:function(_1036){_1021.set(this.lastPublishedViewLinkNode,"display",_1036?"":"none");},_setLastPublishedViewLinkHrefAttr:function(value){_1022.set(this.lastPublishedViewLinkNode,"href",value);},_setAdditionalInfoSectionVisibleAttr:function(_1037){_1021.set(this.additionalInfoSection,"display",_1037?"":"none");},_setAdditionalInfoTextAttr:{node:"additionalInfoNode",type:"innerHTML"},_setTypeIdentifierAttr:function(_1038){var _1039=this.model&&this.model.dataModel&&this.model.dataModel.contentData,_103a=_1039&&_1039.downloadUrl,_103b=_1038&&_1029.getValue(_1038,"actAsAnAsset");if(!_103b||!_103a){_1022.set(this.lastPublishedViewLinkNode,"title",res.lastpublishedviewlinktooltip);html.set(this.lastPublishedViewLinkNode,res.view);if(this._downloadClickHandler){this._downloadClickHandler.remove();this._downloadClickHandler=null;}return;}_1022.set(this.lastPublishedViewLinkNode,"title",res.download);html.set(this.lastPublishedViewLinkNode,res.download);if(!this._downloadClickHandler){this.own(this._downloadClickHandler=on(this.lastPublishedViewLinkNode,"click",lang.hitch(this,function(e){event.stop(e);var _103c=this.model&&this.model.dataModel&&this.model.dataModel.contentData,url=_103c&&_103c.downloadUrl,name=_103c.name;_102c.download(url,name);})));}},postCreate:function(){this.inherited(arguments);this.mainButton._setSelected=this.mainButton._onUnhover=function(){};},onOpen:function(){this.model.set("isOpen",true);this.inherited(arguments);},onClose:function(){this.model.set("isOpen",false);this.inherited(arguments);},_setModelAttr:function(){this.inherited(arguments);this.ownByKey(this.model,this.connect(this.model,"onCommandsChanged","onCommandsChanged"));},onCommandsChanged:function(name,_103d,added){if(_103d){this._removeCommandsFromMenu(lang.isArray(_103d)?_103d:[_103d]);}if(added){this._addCommandsToMenu(lang.isArray(added)?added:[added]);}},_addCommandsToMenu:function(_103e){array.forEach(_103e,function(_103f){if(_103f!==this.model.mainButtonCommand){this._menuBuilder.create(_103f,this);}},this);},_removeCommandsFromMenu:function(_1040){var _1041=this.menu.getChildren();array.forEach(_1040,function(_1042){for(var i=_1041.length-1;i>=0;i--){var item=_1041[i];if(item._command==_1042){this.removeChild(item);break;}}},this);},_onMainButtonClick:function(){if(this.mainButtonCommand){this.mainButton.set("label",this.mainButtonCommand.executingLabel);_1023.add(this.mainButton.domNode,"epi-loading");var _1043=lang.hitch(this,function(_1044){if(_1044||this.mainButtonCommand.options&&this.mainButtonCommand.options.resetLabelAfterExecution){this.mainButton.set("label",this.mainButtonCommand.label);}_1023.remove(this.mainButton.domNode,"epi-loading");if(this.mainButtonCommand.options&&!this.mainButtonCommand.options.keepMenuOpen){this.onExecute();}}),_1045=lang.hitch(this,function(){this.model.set("lastExecutedCommand",this.mainButtonCommand);});when(this.mainButtonCommand.execute(),function(){return when(_1043(false),_1045);},function(){return _1043();});}},focusFirstChild:function(){if(this.mainButton.isFocusable()){return this.focusChild(this.mainButton);}else{return this.inherited(arguments);}},focusNext:function(){var _1046=this._getLastFocusableChild();if(!this.focusedChild.focused){return this.focusChild(this._getFirstFocusableChild());}else{if(this.focusedChild===_1046){this.focusedChild._setSelected(false);return _1021.get(this.mainButton.domNode,"display")==="none"?this.lastPublishedViewLinkNode.focus():this.focusChild(this.mainButton);}else{if(this.focusedChild===this.mainButton){return this.lastPublishedViewLinkNode.focus();}else{return this.inherited(arguments);}}}},focusPrev:function(){var _1047=this._getFirstFocusableChild();if(!this.focusedChild.focused){return _1021.get(this.mainButton.domNode,"display")==="none"?this.focusChild(this._getLastFocusableChild()):this.focusChild(this.mainButton);}else{if(this.focusedChild===_1047){this.focusedChild._setSelected(false);return this.lastPublishedViewLinkNode.focus();}else{return this.inherited(arguments);}}},resize:function(_1048){var _1049=_1024.getMarginBox(this.domNode),_104a=_1024.getPadExtents(this.topInfoSection),_104b=_1024.getMarginBox(this.mainButton.containerNode),_104c=_1024.getMarginBox(this.containerNode);var _104d=Math.max(_104b.w+_104a.l+_104a.r,_1049.w);_104d=Math.max(_104c.w,_104d);_1048.w=_104d;_1024.setMarginBox(this.domNode,_1048);}});});},"url:epi-cms/contentediting/templates/PublishMenu.html":"<div class=\"epi-invertedTooltip epi-publishActionMenu\" role=\"menu\" tabIndex=\"${tabIndex}\" data-dojo-attach-event=\"onkeypress:_onKeyPress\" >\r\n    <div class=\"epi-tooltipDialogTop\" data-dojo-attach-point=\"topInfoSection\">\r\n        <ul>\r\n            <li data-dojo-attach-point=\"lastChangeStatusNode\" class=\"epi-lastchangeStatus\"></li>\r\n            <li data-dojo-attach-point=\"mainButtonSection\">\r\n                <button data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"mainButton\" data-dojo-attach-event=\"onClick: _onMainButtonClick\" class=\"epi-fullWidthButton\"></button>\r\n            </li>            \r\n        </ul>          \r\n        <div data-dojo-attach-point=\"lastPublishedIcon\" class=\"dijitTooltipConnector\"></div>\r\n    </div>\r\n    <div class=\"epi-tooltipDialogInfo\"data-dojo-attach-point=\"publishInfoSection\">\r\n        <ul>\r\n            <li data-dojo-attach-point=\"lastPublishedTitleNode\"></li>\r\n            <li>\r\n                <span data-dojo-attach-point=\"lastPublishedTextNode\"></span>\r\n            </li>\r\n            <li>\r\n                <a href=\"#\" title=\"${res.lastpublishedviewlinktooltip}\" data-dojo-attach-point=\"lastPublishedViewLinkNode\">${res.view}</a>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n    <div class=\"epi-tooltipDialogInfo\" data-dojo-attach-point=\"additionalInfoSection\">\r\n        <ul>\r\n            <li data-dojo-attach-point=\"additionalInfoNode\"></li>\r\n        </ul>\r\n    </div>\r\n    <table class=\"dijitReset epi-tooltipDialogMenu epi-menuInverted\" cellspacing=\"0\">\r\n\t    <tbody data-dojo-attach-point=\"containerNode\" ></tbody>\r\n    </table>\r\n</div>\r\n","url:epi-cms/contentediting/templates/EditActionPanel.html":"<div style=\"display: inline-block\">\r\n    <div class=\"dijitInline dijitReset\" data-dojo-attach-point=\"stateNode\">\r\n        <span data-dojo-attach-point=\"statusNonEditableIcon\" class=\"dijitInline dijitReset dijitIcon\">&nbsp;</span>\r\n        <span class=\"epi-statusContainer dijitInline dijitReset\">\r\n            <span data-dojo-attach-point=\"statusTextIcon\" class=\"dijitInline dijitReset dijitIcon\"></span>\r\n            <span data-dojo-attach-point=\"statusTextNode\" class=\"epi-statusText\"></span>\r\n        </span><span class=\"epi-statusArrow dijitInline dijitReset\"></span><!-- These need to be on the same line because of stupid. -->\r\n    </div>\r\n\r\n\r\n\r\n    <div data-dojo-attach-point=\"dropDownButton\" data-dojo-type=\"dijit/form/DropDownButton\"\r\n        data-dojo-props=\"label: '${commonRes.action.publish}', 'class': 'epi-mediumButton epi-boldButton'\">\r\n        <div data-dojo-attach-point=\"dropDownMenu\" data-dojo-type=\"epi-cms/contentediting/PublishMenu\"></div>\r\n    </div>\r\n</div>","epi-cms/contentediting/EditingBase":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/event","dojo/_base/json","dojo/_base/lang","dojo/date/stamp","dojo/dom-attr","dojo/on","dojo/query","dojo/topic","dojo/when","dijit/_Widget","epi/dependency","epi/datetime","epi/string","epi/Url","epi/shell/DestroyableByKey","epi-cms/contentediting/_View","epi-cms/contentediting/AutoSaveButton","epi-cms/contentediting/MappingManager","epi-cms/contentediting/RenderManager","epi-cms/contentediting/UpdateController","epi-cms/widget/overlay/overlayFactory","epi/i18n!epi/cms/nls/episerver.cms.contentediting"],function(array,_104e,_104f,_1050,_1051,json,lang,date,_1052,on,query,topic,when,_1053,_1054,_1055,_1056,Url,_1057,_1058,_1059,_105a,_105b,_105c,_105d,res){return _104f([_1058,_1057],{toolbar:null,editorFactory:null,syncInterval:10000,activePropertyOnStartup:null,createOverlays:true,_renderManager:null,_mappingManager:null,_activeEditorWrapper:null,_autoSaveButton:null,_reloadRequiredProperty:null,_eventHandlers:null,constructor:function(){this.defaultQueryParameters={epieditmode:true};},postMixInProperties:function(){this.inherited(arguments);this.editorFactory=this.editorFactory||_1054.resolve("epi.cms.contentediting.EditorFactory");this._mappingManager=new _105a();this._eventHandlers=[];},postCreate:function(){this.inherited(arguments);if(this.syncInterval>0){this._syncIntervalId=window.setInterval(lang.hitch(this,"_save"),this.syncInterval);}this.subscribe("/epi/cms/action/save",this._save);this.subscribe("/epi/cms/action/undo",this._undo);this.subscribe("/epi/cms/action/redo",this._redo);this.subscribe("/epi/cms/action/disableundoredoactions",this._toggleUndoRedoActions);},destroy:function(){this._unwatchViewModelHandles();this._stopActiveEditorWrapper();if(this._renderManager){this._renderManager.destroy();}if(this._autoSaveButton){this._autoSaveButton.destroyRecursive();}this._mappingManager.clear();if(this.toolbar){this.toolbar=null;}if(this._syncIntervalId){clearInterval(this._syncIntervalId);}this.inherited(arguments);},_setCommandEnabled:function(_105e,_105f){if(this.toolbar){this.toolbar.setItemProperty(_105e,"disabled",!_105f);}},onContentLinkSyncChange:function(){this.inherited(arguments);this._setButtonState();},_setViewModelAttr:function(_1060){if(_1060===this.viewModel){return;}this.inherited(arguments);this.destroyByKey("viewModel");this.ownByKey("viewModel",_104e.connect(this.viewModel,"onContentChange",this,this._stopActiveEditorWrapper));this.ownByKey("viewModel",_104e.connect(this.viewModel,"onSetActiveProperty",this,this.onSetActiveProperty));this.ownByKey("viewModel",topic.subscribe("/dnd/start",lang.hitch(this.viewModel,"beginOperation")));this.ownByKey("viewModel",topic.subscribe("/dnd/stop",lang.hitch(this,function(){if(this._activeEditorWrapper){return;}this.viewModel.endOperation();})));},_stopActiveEditorWrapper:function(){if(this._activeEditorWrapper!=null){when(this._activeEditorWrapper.tryToStopEditing(),lang.hitch(this,function(){this._activeEditorWrapper=null;}));}},onSetActiveProperty:function(_1061){var _1062=this._mappingManager.findOne("propertyName",_1061);if(_1062){if(_1062.wrapper){_1062.wrapper.startEdit();}else{if(_1062.overlayItem){this._onOverlayItemClick(_1062.overlayItem);}}}},onPreviewReady:function(_1063,doc){if(_1063!=this.viewModel){this.set("viewModel",_1063);this.setupEditMode(doc);}else{if(_1063){this.remapEditMode(doc);}}},_setButtonState:function(){this._setCommandEnabled("reverttopublished",this.viewModel&&!this.viewModel.contentData.isPendingPublish);},setupEditMode:function(doc){this.viewModel.getContentModelAndMetadata().then(lang.hitch(this,function(){this._mappingManager.clear();this._renderManager=new _105b();if(this.toolbar&&!this._autoSaveButton){this._autoSaveButton=new _1059({button:this.toolbar._getWidget("autosave"),model:this.viewModel});}else{if(this._autoSaveButton){this._autoSaveButton.set("model",this.viewModel);}}var _1064=lang.hitch(this,function(){this._toggleUndoRedoActions(this.viewModel.hasUndoSteps,this.viewModel.hasRedoSteps);});this.viewModel.resetNotifications();this._unwatchViewModelHandles();this._viewModelHandles=[this.viewModel.watch("hasUndoSteps",_1064),this.viewModel.watch("hasRedoSteps",_1064)];_1064();this.onReadySetupEditMode(doc);this._setButtonState();this.onPrepareOverlayComplete();}));},remapEditMode:function(doc){this.viewModel.getMetadataThenUpdateModel().then(lang.hitch(this,function(){this._renderManager.resume();if(doc){setTimeout(lang.hitch(this,function(){this._remapUpdateControllers(doc);this.onPrepareOverlayComplete();this._toggleUndoRedoActions(this.viewModel.hasUndoSteps,this.viewModel.hasRedoSteps);this._autoSaveButton.set("model",this.viewModel);}),1);}}));},_unwatchViewModelHandles:function(){if(this._viewModelHandles){array.forEach(this._viewModelHandles,function(_1065){_1065.unwatch();});this._viewModelHandles=null;}},onReadySetupEditMode:function(doc){this._createUpdateControllers(doc);},onSetupEditModeComplete:function(){if(this.activePropertyOnStartup){this.onSetActiveProperty(this.activePropertyOnStartup);this.activePropertyOnStartup=null;}},_getPropertyNodes:function(doc){var _1066=query("[data-epi-property-name]",doc);var _1067=query("[data-epi-property-name] [data-epi-property-name]",doc);return array.filter(_1066,function(node){return _1067.indexOf(node)===-1;});},_getEditableNodes:function(doc){if(!doc||!this.viewModel.canChangeContent()){return [];}var nodes=this._getPropertyNodes(doc);var _1068=[];array.forEach(nodes,function(node){var _1069=_1056.pascalToCamel(_1052.get(node,"data-epi-property-name"));var _106a=this.viewModel.getPropertyMetaData(_1069);if(!_106a){return;}var _106b=_1056.pascalToCamel(_106a.name);var _106c=_1052.get(node,"data-epi-property-display-name");if(_106c){_106a=lang.delegate(_106a,{displayName:_106c});}if(_106a!=null&&_106a.showForEdit){var _106d={cacheResults:true,rerenderOnCancel:false,propertyRenderSettings:_1052.get(node,"data-epi-property-rendersettings")||undefined,useMvc:_1052.has(node,"data-epi-use-mvc")?_1052.get(node,"data-epi-use-mvc").toLowerCase()==="true":false};_106d=lang.mixin(_106d,_106a.additionalValues.renderSettings);var _106e=_1052.has(node,"data-epi-property-editorsettings")?json.fromJson(_1052.get(node,"data-epi-property-editorsettings")):null;var _106f=_1052.has(node,"data-epi-property-overlaysettings")?json.fromJson(_1052.get(node,"data-epi-property-overlaysettings")):null;_106f=lang.mixin(_106f,_106a.overlaySettings);_1068.push({node:node,disabled:(_1052.get(node,"data-epi-disabled")=="true"),useOverlay:(_1052.get(node,"data-epi-useoverlay")=="true"),overlayZIndex:parseInt(_1052.get(node,"data-epi-overlay-z-index"),10)||0,property:{name:_106b,contentLink:this.viewModel.contentLink,contentModel:this.viewModel.contentModel,type:_1052.get(node,"data-epi-property-type"),wrapperType:_1052.get(node,"data-epi-property-edittype"),editorParams:_106e,overlayParams:_106f,editorWidgetType:_1052.get(node,"data-epi-property-editor"),renderSettings:_106d,rendererClass:(_1052.get(node,"data-epi-property-render")==="client")?"epi.cms.contentediting.ClientRenderer":_106a.customEditorSettings.rendererClass,metadata:_106a,propertyNodeName:_1069}});}},this);_1068.sort(function(a,b){if(a.overlayZIndex<b.overlayZIndex){return -1;}else{if(a.overlayZIndex>b.overlayZIndex){return 1;}else{return 0;}}});return _1068;},_createUpdateControllers:function(doc){var _1070=this._createFullPageUpdateController(doc);if(_1070){this._connectUpdateControllerAndOverlayEvents(_1070,null);this._mappingManager.add({updateController:_1070});}var _1071=this._getEditableNodes(doc);array.forEach(_1071,function(_1072){var _1073=_1072.property;var _1074=_1072.node.innerHTML;var _1075=this._createNodeUpdateController(_1072);when(this._createNodeOverlay(_1072),lang.hitch(this,function(_1076){this._connectUpdateControllerAndOverlayEvents(_1075,_1076);this._mappingManager.add({blockPropertyInfo:_1073,node:_1072.node,updateController:_1075,overlayItem:_1076});}));this._renderManager.cacheRender(_1073.name,_1073.renderSettings,this.viewModel.getProperty(_1073.name),_1074);},this);},_createNodeOverlay:function(_1077){var _1078=new _1050();if(!this.createOverlays){_1078.resolve(null);return _1078;}when(_105d.create(_1077),lang.hitch(this,function(_1079){this.overlay.addChild(_1079);_1078.resolve(_1079);}));return _1078;},_createNodeUpdateController:function(_107a){var _107b=_107a.property;var _107c=_107b.metadata;var _107d=new _105c({displayName:_107c.displayName,renderManager:this._renderManager,contentModel:_107b.contentModel,contentLink:_107b.contentLink,modelPropertyName:_107b.name,nodePropertyName:_107b.propertyNodeName,renderSettings:_107b.renderSettings,rendererClass:_107b.rendererClass,displayNode:_107a.node});return _107d;},_createFullPageUpdateController:function(doc){var _107e=[];if(doc){var _107f=query("input[data-epi-full-refresh-property-names][type='hidden']",doc);array.forEach(_107f,function(tag){array.forEach(_1052.get(tag,"data-epi-full-refresh-property-names").split(","),function(_1080){if(!array.some(_107e,function(p){return p===_1080;})){_107e.push(_1056.pascalToCamel(_1080));}});});}array.forEach(this.viewModel.metadata.properties,function(_1081){if(_1081.additionalValues["reloadOnChange"]===true){_107e.push(_1056.pascalToCamel(_1081.name));}});if(!_107e.length){return null;}var _1082=new _105c({displayName:"",renderManager:this._renderManager,contentModel:this.viewModel.contentModel,modelPropertyName:_107e,renderSettings:{isFullReload:true}});return _1082;},_remapUpdateControllers:function(doc){var _1083=this._getEditableNodes(doc);var _1084=this._mappingManager.remap(_1083);array.forEach(_1084,function(_1085){var _1086=_1085.property;var _1087=this._createNodeUpdateController(_1085);var _1088=this._mappingManager.find(function(m){return (m.updateController===undefined||m.updateController===null)&&(m.propertyName.indexOf(_1086.name)===0);});when(this._createNodeOverlay(_1085),lang.hitch(this,function(_1089){this._connectUpdateControllerAndOverlayEvents(_1087,_1089);if(_1088&&_1088.length){this._mappingManager.update(_1088[0],{updateController:_1087,overlayItem:_1089,node:_1085.node});}else{this._mappingManager.add({blockPropertyInfo:_1086,node:_1085.node,updateController:_1087,overlayItem:_1089});}}));this._renderManager.cacheRender(_1086.name,_1086.renderSettings,this.viewModel.getProperty(_1086.name),_1085.node.innerHTML);},this);var _108a=this._createFullPageUpdateController(doc);if(_108a){this._connectUpdateControllerAndOverlayEvents(_108a,null);this._mappingManager.add({updateController:_108a});}},_connectUpdateControllerAndOverlayEvents:function(_108b,_108c){if(_108b){this.connect(_108b,"onReloadRequired",this._onBlockReloadRequired);this.connect(_108b,"onRender",this._onBlockRender);}if(_108c){this.connect(_108c,"onClick",this._onOverlayItemClick);this.connect(_108c,"onValueChange",function(value){this._onOverlayValueChange(_108c,value);});}},_getEditor:function(_108d){var _108e=this._mappingManager.findOne("overlayItem",_108d);return (_108e.wrapper&&_108e.wrapper.editorWidget)?_108e.wrapper.editorWidget:null;},onEditorWrapperCreated:function(_108f){},_onOverlayItemClick:function(_1090,e){if(e){_1051.stop(e);}var _1091=this._mappingManager.findOne("overlayItem",_1090);var _1092=_1091.blockPropertyInfo;var val=this.viewModel.getProperty(_1091.propertyName);var value=lang.clone(val,true);var _1093;var _1094=lang.hitch(this,function(_1095){_1091.wrapper=_1095;this._activeEditorWrapper=_1095;topic.publish("/epi/layout/pinnable/propertyEditor/show",null);array.forEach(this._mappingManager.find(),function(m){if(m.overlayItem){m.overlayItem.set("active",false);}});_1091.overlayItem.set("active",true);var _1096={value:value,parent:_1095};_1095.startEdit(_1096);this.overlay.set("readOnly",_1095.isOverlayDisabled);this.viewModel.set("disableUndo",_1095.isUndoDisabled);});if(_1091.wrapper){_1093=_1091.wrapper;if(_1093&&_1093.editorWidget&&!_1093.editorWidget.overlayItem){_1093.editorWidget.overlayItem=_1090;}_1093.set("blockDisplayNode",_1091.node);_1094(_1093);}else{when(this._createEditorWrapper(_1092,_1090,_1091.node,value),lang.hitch(this,function(_1097){_1094(_1097);this.onEditorWrapperCreated(_1097);}));}},_createEditorWrapper:function(_1098,_1099,node,value){var def=new _1050(),_109a={overlayItem:_1099};when(this.editorFactory.createEditor(_1098,node,value,_109a),lang.hitch(this,function(_109b){this.connect(_109b,"onValueChange","_onWrapperValueChange");this.connect(_109b,"onCancel","_onWrapperCancel");this.connect(_109b,"onStopEdit","_onWrapperStopEdit");def.resolve(_109b);}),def.reject);return def;},_onBlockReloadRequired:function(_109c){var rm=this._renderManager;setTimeout(function(){rm.suspend();rm.clear();},1);this._reloadRequiredProperty=_109c.modelPropertyName;this._reloadPropertyPreview();},_onBlockRender:function(_109d){var _109e=this._mappingManager.findOne("updateController",_109d);if(_109e&&_109e.overlayItem){_109e.overlayItem.refresh();}},_saveEditorChanges:function(_109f,data){var _10a0=this._getEditor(_109f);if(_10a0&&!_10a0.overlayItem){_10a0.overlayItem=_109f;}if(_10a0&&_10a0.saveChanges){_10a0.saveChanges(_10a0,data);}},_onOverlayValueChange:function(_10a1,data){this._saveEditorChanges(_10a1,data.value);this.viewModel.setProperty(data.propertyName,data.value);},_onWrapperValueChange:function(_10a2,value,_10a3){var _10a4=this._mappingManager.findOne("wrapper",_10a2),_10a5=_10a4.propertyName;if(_10a4.overlayItem){_10a4.overlayItem.set("updated",true);}this.viewModel.beginOperation();this.viewModel.setProperty(_10a5,value,_10a3);},_onWrapperStopEdit:function(_10a6,value,_10a7,_10a8){var _10a9=this._mappingManager.findOne("wrapper",_10a6);this.viewModel.endOperation();this._save();if(_10a9.overlayItem){_10a9.overlayItem.set("active",false);}this._activeEditorWrapper=null;this.overlay.set("readOnly",false);this.viewModel.set("disableUndo",false);},_onWrapperCancel:function(_10aa,_10ab){this.viewModel.abortOperation();var _10ac=this._mappingManager.findOne("wrapper",_10aa);var _10ad=_10ac.updateController;if(_10ad&&_10ad.renderSettings&&_10ad.renderSettings.rerenderOnCancel){_10ad.render();}if(_10aa.get("isModified")){this._save();}if(_10ac.overlayItem){_10ac.overlayItem.set("active",false);}this._activeEditorWrapper=null;this.overlay.set("readOnly",false);this.viewModel.set("disableUndo",false);},_undo:function(){setTimeout(lang.hitch(this,function(){this.viewModel.undo();}),0);},_redo:function(){setTimeout(lang.hitch(this,function(){this.viewModel.redo();}),0);},_toggleUndoRedoActions:function(_10ae,_10af){this._setCommandEnabled("undo",!!_10ae);this._setCommandEnabled("redo",!!_10af);},_save:function(){if(!this.viewModel||!this.viewModel.hasPendingChanges){return;}when(this.viewModel.save(),lang.hitch(this,this._reloadPropertyPreview));},_reloadPropertyPreview:function(){if(!this.viewModel.isSaved){this._save();return;}var _10b0=this._activeEditorWrapper&&(this._activeEditorWrapper.propertyName===this._reloadRequiredProperty);var _10b1=this._activeEditorWrapper&&this._activeEditorWrapper.hasInlineEditor;if(this._reloadRequiredProperty&&!(_10b0&&_10b1)){this._toggleUndoRedoActions(false,false);this.onReloadRequired();this._reloadRequiredProperty=null;}}});});},"epi-cms/contentediting/_View":function(){define(["epi","dojo","dijit/_Widget","epi/Url"],function(epi,dojo,_10b2,Url){return dojo.declare([_10b2],{iframeWithOverlay:null,overlay:null,iFrame:null,layoutContainer:null,contextTypeName:null,viewModel:null,postMixInProperties:function(){this.inherited(arguments);if(this.iframeWithOverlay){this.iFrame=this.iframeWithOverlay.iframe;this.overlay=this.iframeWithOverlay.overlay;}this._viewConnections=[];},_setViewModelAttr:function(_10b3){this._set("viewModel",_10b3);},_setIframeWithOverlayAttr:function(value){this._set("iframeWithOverlay",value);this.iFrame=this.iframeWithOverlay.iframe;this.overlay=this.iframeWithOverlay.overlay;},onPreviewReady:function(_10b4,doc){this.set("viewModel",_10b4);this.onPrepareOverlayComplete();},onPrepareOverlayComplete:function(){},onContentLinkSyncChange:function(){},onReloadRequired:function(){},_setReloadRequiredAttr:function(value){this._set("reloadRequired",value);}});});},"epi-cms/contentediting/AutoSaveButton":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/string","dijit/_WidgetBase","epi/datetime","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.autosave"],function(array,_10b5,_10b6,lang,_10b7,_10b8,_10b9,_10ba,_10bb,res){var _10bc={Saving:0,Offline:1,Saved:2};return _10b6([_10ba],{_state:null,button:undefined,lastSaved:undefined,model:null,_currentlySavingClass:"epi-autosave-saving",_errorClass:"epi-autosave-error",_savedClass:"epi-autosave-saved",_hoverClass:"epi-autosave-hover",_modelHandles:null,postMixInProperties:function(){this.inherited(arguments);this._modelHandles=[];},postCreate:function(){this.inherited(arguments);if(!this.button){return;}this.connect(this.button.domNode,"onmouseover",this._addHoverClass);this.connect(this.button.domNode,"onmouseout",this._removeHoverClass);},destroy:function(){array.forEach(this._modelHandles,function(_10bd){_10bd.unwatch();});this.inherited(arguments);},_setModelAttr:function(model){array.forEach(this._modelHandles,function(_10be){_10be.unwatch();});this._set("model",model);if(model){this._modelHandles=[model.watch("isOnline",lang.hitch(this,"_isOnlineChanged")),model.watch("lastSaved",lang.hitch(this,"_lastSavedChanged")),model.watch("isSaved",lang.hitch(this,"_isSavedChanged")),model.watch("isSaving",lang.hitch(this,"_isSavingChanged")),model.watch("hasErrors",lang.hitch(this,"_hasErrorsChanged")),model.watch("disableUndo",lang.hitch(this,this._disableUndo))];this.set("lastSaved",model.lastSaved);if(this.lastSaved){this.updateButton();}else{this._setVisibility(false);}}},_setLastSavedAttr:function(_10bf){this._set("lastSaved",_10bf);this.updateLastSaveTime();},_disableUndo:function(_10c0,_10c1,value){this._isUndoDisabled=value;this.updateButton();},_isOnlineChanged:function(name,_10c2,_10c3){if(_10c3===_10c2){return;}if(_10c3){this.revertToLastAutoSaveTime();}else{this.showOfflineStatus();}},_lastSavedChanged:function(name,_10c4,_10c5){this.set("lastSaved",_10c5);},_isSavedChanged:function(name,_10c6,_10c7){if(_10c7){this.updateLastSaveTime();}},_isSavingChanged:function(name,_10c8,_10c9){if(_10c9){this.showSavingStatus();}else{if(!this.model.isSaved){this.revertToLastAutoSaveTime();}}},_hasErrorsChanged:function(name,_10ca,_10cb){if(_10ca===_10cb){return;}if(!_10cb){this.revertToLastAutoSaveTime();}else{_10b5.publish("/epi/cms/action/showerror");}},_animateSaving:function(){_10b7.replace(this.button.domNode,this._currentlySavingClass,[this._errorClass,this._savedClass]);this._removeHoverClass();},_animateOffline:function(){_10b7.replace(this.button.domNode,this._errorClass,[this._currentlySavingClass,this._savedClass]);this._removeHoverClass();},_animateSaved:function(){_10b7.replace(this.button.domNode,this._savedClass,[this._currentlySavingClass,this._errorClass]);this._removeHoverClass();},_addHoverClass:function(){if(this._state==null||this._state==_10bc.Saving||this._hasDropDownOpen()){return;}if(this._state==_10bc.Saved){_10b7.add(this.button.domNode,this._hoverClass);}},_removeHoverClass:function(){if(!this._hasDropDownOpen()){_10b7.remove(this.button.domNode,this._hoverClass);}},_updateState:function(text){this.button.set("label",text);this.button.set("disabled",this._isUndoDisabled||this._state!=_10bc.Saved);this._setVisibility(true);},_setVisibility:function(_10cc){if(this.button){_10b8.set(this.button.domNode,{display:_10cc?"":"none"});this.button.set("itemVisibility",_10cc&&!this.button.disabled);}},_hasDropDownOpen:function(){return this.button._popupStateNode?_10b7.contains(this.button._popupStateNode,"dijitHasDropDownOpen"):false;},revertToLastAutoSaveTime:function(){if(this.lastSaved===undefined){this._setVisibility(false);return;}this.updateLastSaveTime();},updateLastSaveTime:function(){if(!this.lastSaved){return;}if(!this.model.isOnline){return;}setTimeout(lang.hitch(this,function(){if(this.model.isOnline){this.updateButton();this._animateSaved();}}),1000);},showSavingStatus:function(){this._state=_10bc.Saving;this._updateState(res.savinglabel);this._animateSaving();},showOfflineStatus:function(){this._state=_10bc.Offline;this._updateState(res.offlinelabel);this._animateOffline();},updateButton:function(){if(!this.lastSaved||(this.model.contentData&&this.model.contentData.isDeleted)){this._setVisibility(false);return;}this._state=_10bc.Saved;var _10cd="<span class=\"dijitReset dijitInline clearfix\">${autosavelabel} ${timestamp}</span>&nbsp;<span class=\"epi-inlineButtonLink\">${undolabel}</span>";var _10ce={autosavelabel:res.autosavelabel,undolabel:this.model.undoManager.get("hasUndoSteps")&&!this._isUndoDisabled?res.undolabel:"",timestamp:_10bb.toUserFriendlyHtml(this.lastSaved,null,true)};this._updateState(_10b9.substitute(_10cd,_10ce));}});});},"epi-cms/contentediting/MappingManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/connect","dojo/dom-attr","dojox/encoding/digests/SHA1"],function(_10cf,lang,array,json,_10d0,_10d1,SHA1){return _10cf(null,{_mappings:null,domUtils:null,attrNames:["data-epi-property-name","data-epi-property-display-names","data-epi-property-customsettings-customtag","data-epi-use-mvc","data-epi-disabled","data-epi-useoverlay","data-epi-overlay-z-index","data-epi-property-type","data-epi-property-edittype","data-epi-property-editorsetting","data-epi-property-editor","data-epi-property-render"],constructor:function(){this._mappings=[];this.domUtils=_10d1;},clear:function(){var _10d2;try{while(_10d2=this._mappings.pop()){for(var prop in _10d2){if(_10d2[prop]){if(prop!=="node"){if(lang.isFunction(_10d2[prop].destroyRecursive)){_10d2[prop].destroyRecursive();}else{if(lang.isFunction(_10d2[prop].destroy)){_10d2[prop].destroy();}}}_10d2[prop]=null;}}}}catch(ex){}},_calculateNodeHash:function(node){if(!node){return "";}var attrs=array.map(this.attrNames,dojo.hitch(this,function(n){return this.domUtils.get(node,n)||"";}));return SHA1(json.toJson(attrs));},update:function(_10d3,patch){lang.mixin(_10d3,patch);if(patch.node){_10d3.nodeHash=this._calculateNodeHash(patch.node);}},add:function(item){if(item.node){item.nodeHash=this._calculateNodeHash(item.node);}if(item.blockPropertyInfo&&!item.propertyName){item.propertyName=item.blockPropertyInfo.name;}this._mappings.push(item);},_tryRemapNode:function(item,_10d4){if(this._calculateNodeHash(_10d4.node)===item.nodeHash){item.node=_10d4.node;item.updateController.displayNode=_10d4.node;item.updateController.checkEmptyHtml();if(item.overlayItem){item.overlayItem.set("disabled",false);item.overlayItem.set("sourceItemNode",_10d4.node);item.overlayItem.refresh();}return {success:true,mappedNode:_10d4};}return {success:false};},remap:function(_10d5){var _10d6=[],_10d7=[];array.forEach(_10d5,function(_10d8){_10d6.push(_10d8);});array.forEach(this._mappings,lang.hitch(this,function(item){if(!item.updateController){return;}var _10d9=null;var _10da=array.some(_10d6,lang.hitch(this,function(_10db){var _10dc=this._tryRemapNode(item,_10db);_10d9=_10d9||_10dc.mappedNode;return _10dc.success;}));if(_10da){if(_10d9){_10d6.splice(array.indexOf(_10d6,_10d9),1);}}else{item.updateController.destroy();delete item.updateController;if(item.overlayItem){item.overlayItem.destroy();delete item.overlayItem;}delete item.node;delete item.nodeHash;}if(this._isEmpty(item)){_10d7.push(item);}}));var _10dd;while(_10dd=_10d7.pop()){this._mappings.splice(array.indexOf(this._mappings,_10dd),1);}return _10d6;},_isEmpty:function(_10de){for(var _10df in _10de){if(_10de.hasOwnProperty(_10df)){return false;}}return true;},findOne:function(_10e0,value){var _10e1;array.some(this._mappings,function(m){if(m[_10e0]===value){_10e1=m;return true;}});return _10e1;},find:function(){var _10e2;if(arguments[0]===undefined){return this._mappings;}else{if(lang.isFunction(arguments[0])){_10e2=arguments[0];}else{var _10e3=arguments[0],value=arguments[1];_10e2=function(m){return m[_10e3]===value;};}}return array.filter(this._mappings,_10e2);}});});},"dojox/encoding/digests/SHA1":function(){define("dojox/encoding/digests/SHA1",["./_base"],function(dxd){var chrsz=8,mask=(1<<chrsz)-1;function R(n,c){return (n<<c)|(n>>>(32-c));};function FT(t,b,c,d){if(t<20){return (b&c)|((~b)&d);}if(t<40){return b^c^d;}if(t<60){return (b&c)|(b&d)|(c&d);}return b^c^d;};function KT(t){return (t<20)?1518500249:(t<40)?1859775393:(t<60)?-1894007588:-899497514;};function core(x,len){x[len>>5]|=128<<(24-len%32);x[((len+64>>9)<<4)+15]=len;var w=new Array(80),a=1732584193,b=-271733879,c=-1732584194,d=271733878,e=-1009589776;for(var i=0;i<x.length;i+=16){var olda=a,oldb=b,oldc=c,oldd=d,olde=e;for(var j=0;j<80;j++){if(j<16){w[j]=x[i+j];}else{w[j]=R(w[j-3]^w[j-8]^w[j-14]^w[j-16],1);}var t=dxd.addWords(dxd.addWords(R(a,5),FT(j,b,c,d)),dxd.addWords(dxd.addWords(e,w[j]),KT(j)));e=d;d=c;c=R(b,30);b=a;a=t;}a=dxd.addWords(a,olda);b=dxd.addWords(b,oldb);c=dxd.addWords(c,oldc);d=dxd.addWords(d,oldd);e=dxd.addWords(e,olde);}return [a,b,c,d,e];};function hmac(data,key){var wa=_10e4(key);if(wa.length>16){wa=core(wa,key.length*chrsz);}var ipad=new Array(16),opad=new Array(16);for(var i=0;i<16;i++){ipad[i]=wa[i]^909522486;opad[i]=wa[i]^1549556828;}var hash=core(ipad.concat(_10e4(data)),512+data.length*chrsz);return core(opad.concat(hash),512+160);};function _10e4(s){var wa=[];for(var i=0,l=s.length*chrsz;i<l;i+=chrsz){wa[i>>5]|=(s.charCodeAt(i/chrsz)&mask)<<(32-chrsz-i%32);}return wa;};function toHex(wa){var h="0123456789abcdef",s=[];for(var i=0,l=wa.length*4;i<l;i++){s.push(h.charAt((wa[i>>2]>>((3-i%4)*8+4))&15),h.charAt((wa[i>>2]>>((3-i%4)*8))&15));}return s.join("");};function _10e5(wa){var s=[];for(var i=0,l=wa.length*32;i<l;i+=chrsz){s.push(String.fromCharCode((wa[i>>5]>>>(32-chrsz-i%32))&mask));}return s.join("");};function _10e6(wa){var p="=",tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=[];for(var i=0,l=wa.length*4;i<l;i+=3){var t=(((wa[i>>2]>>8*(3-i%4))&255)<<16)|(((wa[i+1>>2]>>8*(3-(i+1)%4))&255)<<8)|((wa[i+2>>2]>>8*(3-(i+2)%4))&255);for(var j=0;j<4;j++){if(i*8+j*6>wa.length*32){s.push(p);}else{s.push(tab.charAt((t>>6*(3-j))&63));}}}return s.join("");};dxd.SHA1=function(data,_10e7){var out=_10e7||dxd.outputTypes.Base64;var wa=core(_10e4(data),data.length*chrsz);switch(out){case dxd.outputTypes.Raw:return wa;case dxd.outputTypes.Hex:return toHex(wa);case dxd.outputTypes.String:return _10e5(wa);default:return _10e6(wa);}};dxd.SHA1._hmac=function(data,key,_10e8){var out=_10e8||dxd.outputTypes.Base64;var wa=hmac(data,key);switch(out){case dxd.outputTypes.Raw:return wa;case dxd.outputTypes.Hex:return toHex(wa);case dxd.outputTypes.String:return _10e5(wa);default:return _10e6(wa);}};return dxd.SHA1;});},"dojox/encoding/digests/_base":function(){define("dojox/encoding/digests/_base",["dojo/_base/lang"],function(lang){var d=lang.getObject("dojox.encoding.digests",true);d.outputTypes={Base64:0,Hex:1,String:2,Raw:3};d.addWords=function(a,b){var l=(a&65535)+(b&65535);var m=(a>>16)+(b>>16)+(l>>16);return (m<<16)|(l&65535);};var chrsz=8;var mask=(1<<chrsz)-1;d.stringToWord=function(s){var wa=[];for(var i=0,l=s.length*chrsz;i<l;i+=chrsz){wa[i>>5]|=(s.charCodeAt(i/chrsz)&mask)<<(i%32);}return wa;};d.wordToString=function(wa){var s=[];for(var i=0,l=wa.length*32;i<l;i+=chrsz){s.push(String.fromCharCode((wa[i>>5]>>>(i%32))&mask));}return s.join("");};d.wordToHex=function(wa){var h="0123456789abcdef",s=[];for(var i=0,l=wa.length*4;i<l;i++){s.push(h.charAt((wa[i>>2]>>((i%4)*8+4))&15)+h.charAt((wa[i>>2]>>((i%4)*8))&15));}return s.join("");};d.wordToBase64=function(wa){var p="=",tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=[];for(var i=0,l=wa.length*4;i<l;i+=3){var t=(((wa[i>>2]>>8*(i%4))&255)<<16)|(((wa[i+1>>2]>>8*((i+1)%4))&255)<<8)|((wa[i+2>>2]>>8*((i+2)%4))&255);for(var j=0;j<4;j++){if(i*8+j*6>wa.length*32){s.push(p);}else{s.push(tab.charAt((t>>6*(3-j))&63));}}}return s.join("");};return d;});},"epi-cms/contentediting/RenderManager":function(){define(["dojo","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/_base/json","dojo/_base/array","epi","epi/dependency","epi/string","epi/datetime","dojox/encoding/digests/SHA1","dojo/Stateful","epi-cms/contentediting/PropertyRenderer"],function(dojo,_10e9,lang,_10ea,json,array,epi,_10eb,_10ec,_10ed,SHA1,_10ee,_10ef){return _10e9([_10ee],{_cache:null,_queue:null,defaultRenderer:null,_rendererPool:{},rendering:false,processQueueOnRenderValue:true,numberOfItemsInQueue:0,numberOfItemsRendering:0,concurrentProcessedItems:2,processInterval:200,_processIntervalId:0,_itemsBeingRendered:null,viewSettingsManager:null,_viewSettingsToCopy:["visitorgroup"],constructor:function(_10f0){this._cache={};this._queue=[];this._itemsBeingRendered={};lang.mixin(this,_10f0);this.defaultRenderer=this.defaultRenderer||new _10ef();},postscript:function(){this.viewSettingsManager=this.viewSettingsManager||_10eb.resolve("epi.viewsettingsmanager");},destroy:function(){this._stopRenderingInterval();this._isDestroyed=true;for(var i in this._cache){delete this._cache[i];}for(var j in this._itemsBeingRendered){delete this._itemsBeingRendered[j];}this._cache=null;this._itemsBeingRendered=null;this._queue=null;this.inherited(arguments);},_getRenderer:function(_10f1){var def=new _10ea();if(_10f1){if(this._rendererPool[_10f1]){return this._rendererPool[_10f1];}else{var _10f2=_10ec.slashName(_10f1);require([_10f2],function(_10f3){def.resolve(new _10f3());});}}else{return this.defaultRenderer;}return def;},renderValue:function(_10f4,_10f5,value,_10f6,_10f7){var def;if(this._isSuspending){def=new _10ea();def.cancel();return def;}value=_10ed.transformDate(value);_10f6=this.cloneAndCompleteRenderSettings(_10f6||{});var _10f8=this._get(_10f5,_10f6,value);if(_10f8){def=new _10ea();def.resolve(_10f8);}else{if(_10f6&&_10f6.isFullReload){def=new _10ea();def.resolve({doReload:true});}else{def=new _10ea();_10ea.when(this._getRenderer(_10f7),lang.hitch(this,function(_10f9){if(!_10f9){_10f9=this.defaultRenderer;}_10ea.when(this._queueItem(_10f9,_10f4,_10f5,_10f6,value),function(_10fa){def.resolve(_10fa);});if(this.processQueueOnRenderValue&&!this._isSuspending){this._startRenderingInterval();}}));}}return def;},cloneAndCompleteRenderSettings:function(_10fb){_10fb.propertyRenderSettings=_10fb.propertyRenderSettings||"";var _10fc=lang.clone(_10fb);if(this.viewSettingsManager.get("enabled")){array.forEach(this.viewSettingsManager.getRenderingViewSettings(),lang.hitch(this,function(_10fd){if(_10fd.get("enabled")){var _10fe=this.viewSettingsManager.getSettingProperty(_10fd.key);if(_10fe){this.updateRenderSettings(_10fc,_10fe,_10fd.key,_10fd.isTagItem);}}}));}return _10fc;},updateRenderSettings:function(_10ff,_1100,key,_1101){var _1102=[],_1103=[],_1104="",_1105=(_1101?"tag":key),_1106=!_1101,data=null;if(_1101){_10ff.propertyRenderSettings=_10ff.propertyRenderSettings||"";data=(_10ff.propertyRenderSettings?dojo.fromJson(_10ff.propertyRenderSettings):{});}else{data=(_10ff?_10ff:{});}if(!data[_1105]||_1106){_1104=_1100;}else{_1102=data[_1105].split(",");array.forEach(_1102,function(item,idx){item=lang.trim(item);if(item.toLowerCase()!=_1100.toLowerCase()){_1103.push(item);}});_1103.push(_1100);_1104=_1103.join(", ");}data[_1105]=_1104;if(_1101){_10ff.propertyRenderSettings=dojo.toJson(data);}},processQueue:function(){if(this._isSuspending){return;}if(this._queue.length===0){this._stopRenderingInterval();return;}if(this.numberOfItemsRendering>=this.concurrentProcessedItems){return;}var _1107=this._nextItemToProcessIndex();while(_1107>=0&&this.numberOfItemsRendering<this.concurrentProcessedItems){this._processItemInQueue(_1107);_1107=this._nextItemToProcessIndex();}},suspend:function(){if(this._isSuspending){return;}this._isSuspending=true;this._stopRenderingInterval();},clear:function(){this.set("numberOfItemsRendering",0);for(var key in this._itemsBeingRendered){this._itemsBeingRendered[key].deferred.cancel();delete this._itemsBeingRendered[key];}this._itemsBeingRendered={};this.set("numberOfItemsInQueue",0);for(var i=this._queue.length-1;i>=0;i--){delete this._queue[i];}this._queue=[];},resume:function(){if(!this._isSuspending){return;}this._isSuspending=false;this._startRenderingInterval();},_nextItemToProcessIndex:function(){var index=-1;var i=0;while(i<this._queue.length&&index==-1){var item=this._queue[i];var key=this._getRenderHash(item.propertyName,item.renderSettings);if(!(key in this._itemsBeingRendered)){index=i;}i++;}return index;},_processItemInQueue:function(index){var item=this._queue.splice(index,1)[0];this.set("numberOfItemsRendering",this.numberOfItemsRendering+1);this.set("numberOfItemsInQueue",this._queue.length);var key=this._getRenderHash(item.propertyName,item.renderSettings);this._itemsBeingRendered[key]=item;this.set("rendering",true);var _1108=lang.hitch(this,function(_1109){if(this._isDestroyed){item.deferred.cancel();return;}if(_1109&&_1109.innerHtml){this._put(item.propertyName,item.renderSettings,item.value,{doReload:false,innerHtml:_1109.innerHtml});}delete this._itemsBeingRendered[key];this.set("numberOfItemsRendering",this.numberOfItemsRendering-1);this.set("rendering",false);item.deferred.resolve(_1109);});var _110a=lang.hitch(this,function(err){if(this._isDestroyed){item.deferred.cancel();return;}delete this._itemsBeingRendered[key];this.set("numberOfItemsRendering",this.numberOfItemsRendering-1);this.set("rendering",false);item.deferred.reject(err);});_10ea.when(item.renderer.render(item.contentLink,item.propertyName,item.value,item.renderSettings),_1108,_110a);},cacheRender:function(_110b,_110c,value,_110d){data={innerHtml:_110d,doReload:false};this._put(_110b,_110c,value,data);},_queueItem:function(_110e,_110f,_1110,_1111,value){var key=this._getRenderHash(_1110,_1111);var _1112;var _1113=this._itemsBeingRendered[key];if(_1113&&!_1113.deferred.fired&&_1113.value===value){_1112=_1113.deferred;}else{var index=this._queueIndex(_110e,_110f,_1110,_1111,value);if(index<0){_1112=new _10ea();this._queue.push({contentLink:_110f,renderer:_110e,propertyName:_1110,renderSettings:_1111,renderSettingsString:json.toJson(_1111),value:value,deferred:_1112});this.set("numberOfItemsInQueue",this._queue.length);}else{var item=this._queue[index];item.contentLink=_110f;item.renderer=_110e;item.value=value;_1112=item.deferred;}}return _1112;},_startRenderingInterval:function(){if(!this._processIntervalId){this.processQueue();this._processIntervalId=setInterval(lang.hitch(this,function(){this.processQueue();}),this.processInterval);}},_stopRenderingInterval:function(){if(this._processIntervalId){clearInterval(this._processIntervalId);this._processIntervalId=0;}this.set("rendering",false);},_getRenderHash:function(_1114,_1115){return SHA1(json.toJson({p:_1114,r:_1115}));},_queueIndex:function(_1116,_1117,_1118,_1119,value){var index=-1;var _111a=json.toJson(_1119);array.some(this._queue,function(item,i){if((item.propertyName===_1118)&&(item.renderSettingsString==_111a)){index=i;return true;}});return index;},_put:function(_111b,_111c,value,data){if(!_111c.cacheResults){return;}var _111d=this._getCacheHash(_111b,_111c,value);if(!this._cache){this._cache={};}this._cache[_111d]={data:data};},_get:function(_111e,_111f,value){var _1120=this._getCacheHash(_111e,_111f,value);var _1121=this._cache[_1120];return (_1121?_1121.data:undefined);},_getCacheHash:function(_1122,_1123,value){return SHA1(json.toJson({p:_1122,r:_1123,v:value}));}});});},"epi-cms/contentediting/PropertyRenderer":function(){define(["dojo/_base/json","dojo/_base/declare","epi","epi/dependency","epi/shell/XhrWrapper","epi-cms/contentediting/_Renderer","epi-cms/core/ContentReference","epi/routes","dojo/string"],function(json,_1124,epi,_1125,_1126,_1127,_1128,_1129,_112a){return _1124([_1127],{_routes:_1129,_xhrHandler:null,_profile:null,constructor:function(){if(!this._routes){this._routes=epi.routes;}if(!this._xhrHandler){this._xhrHandler=new _1126();}this._profile=this._profile||_1125.resolve("epi.shell.Profile");},render:function(_112b,_112c,_112d,_112e){var _112f=_1128.toContentReference(_112b);var url=null;if(_112e.useMvc){url=this._routes.getActionPath({moduleArea:"CMS",controller:"PropertyRender",action:"Render",epieditmode:true,visitorgroupsByID:_112e.visitorgroup,epslanguage:this._profile?this._profile.contentLanguage:""});}else{url=this._routes.getActionPath({moduleArea:"LegacyCMS",path:"edit/RenderProperty.aspx",id:_112f.toString(),epieditmode:true,visitorgroupsByID:_112e.visitorgroup,epslanguage:this._profile?this._profile.contentLanguage:""});}var _1130={propertyName:_112c,propertyValue:json.toJson(_112d),id:_112f.toString(),renderSettings:""};if(_112e&&_112e.propertyRenderSettings){_1130.renderSettings=_112e.propertyRenderSettings;}return this._xhrHandler.xhrPost({url:url,handleAs:"json",content:_1130});}});});},"epi-cms/contentediting/UpdateController":function(){define(["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/dom-geometry","dojo/dom-attr","dijit"],function(dojo,array,_1131,lang,_1132,_1133,_1134,_1135,dijit){return _1131(null,{_showEmptyNode:true,_hasEmptyHtml:false,emptyValue:"&nbsp;",minWidth:18,minHeight:14,displayNode:null,contentModel:null,contentLink:null,modelPropertyName:null,nodePropertyName:null,renderManager:null,displayName:null,renderSettings:null,rendererClass:null,constructor:function(_1136){dojo.mixin(this,_1136);},postscript:function(){if(this.contentModel){this._modelWatchHandle=[];dojo.forEach(dojo.isArray(this.modelPropertyName)?this.modelPropertyName:[this.modelPropertyName],dojo.hitch(this,function(_1137){this._modelWatchHandle.push(this.contentModel.watch(_1137,dojo.hitch(this,this._renderNode)));}));}this.checkEmptyHtml();},destroy:function(){dojo.forEach(this._modelWatchHandle,function(_1138){_1138.unwatch();});dojo.disconnect(this._renderDisplayNodeConnect);delete this.srcNodeRef;delete this.displayNode;this.inherited(arguments);},onReloadRequired:function(_1139){},onRender:function(block){},_renderNode:function(_113a,_113b,value){var _113c=this.contentLink;var _113d=this.renderSettings;var _113e=this.rendererClass;var _113f=this.nodePropertyName||this.modelPropertyName;var def=this.renderManager.renderValue(_113c,_113f,value,_113d,_113e);if(def!==this._lastRenderDeferred){this._lastRenderDeferred=def;dojo.when(def,dojo.hitch(this,function(_1140){if(this._lastRenderDeferred){if(_1140.doReload!==undefined&&_1140.doReload){this.onReloadRequired(this);}else{if(dojo.isString(_1140)){this._updateRendering(_1140);}else{if(_1140.innerHtml!==undefined){this._updateRendering(_1140.innerHtml,_1140.attributes);}else{if(_1140.error!==undefined){this._handleValidationError(_1140.error);}}}}if(def==this._lastRenderDeferred){this._lastRenderDeferred=null;}}}));}},_isEmptyHtml:function(_1141){var html="";if(!_1141){return false;}if(_1141.tagName=="IMG"){html=dojo.attr(_1141,"src")||"";}else{html=_1141.innerHTML;}html=html.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"");return (typeof html=="string")&&(html.replace(/\s*/g,"").length===0);},checkEmptyHtml:function(){var _1142;if(!this._showEmptyNode){return;}_1142=this._isEmptyHtml(this.displayNode);if(_1142){this.displayNode.innerHTML=dojo.string.substitute(this.emptyValue,this);}this._ensureSize();},_ensureSize:function(){try{this._clearComputedStyle();this._computeStyle();}catch(e){}},_clearComputedStyle:function(){var _1143=this._originalStyle;if(_1143){for(var prop in _1143){if(_1143.hasOwnProperty(prop)){_1133.set(this.displayNode,prop,this._originalStyle[prop]);}}this._originalStyle=null;}},_computeStyle:function(){if(!this.displayNode){return;}var _1144=_1133.get(this.displayNode),_1145={"minWidth":_1133.toPixelValue(this.displayNode,_1144.minWidth),"minHeight":_1133.toPixelValue(this.displayNode,_1144.minHeight),"display":_1144.display},_1146={},_1147=_1145.minHeight===0,_1148=_1145.minWidth===0,_1149=_1145.display==="inline",_114a=_1134.getMarginBox(this.displayNode,_1144);if(_114a.h<(_1147?this.minHeight:_1145.minHeight)||_114a.w<(_1148?this.minWidth:_1145.minWidth)){if(_1147){_1146.minHeight=this.minHeight+"px";}if(_1148){_1146.minWidth=this.minWidth+"px";}if(_1149){_1146.display="inline-block";}if(_1149||_1147||_1148){this._originalStyle=_1145;_1133.set(this.displayNode,_1146);}}},_updateRendering:function(_114b,_114c){this.displayNode.innerHTML=_114b;if(_114c){array.forEach(_114c,lang.hitch(this,function(_114d){this._updateAttribute(_114d);}));}this._hasEmptyHtml=this._isEmptyHtml(this.displayNode);if(this._hasEmptyHtml){this.checkEmptyHtml();if(!this._showEmptyNode){_1133.set(this.displayNode,"display","none");}}else{if(this._showEmptyNode){this._ensureSize();}}this.onRender(this);},_updateAttribute:function(_114e){if(_114e.name.toLowerCase()=="class"){_1132.add(this.displayNode,_114e.value);}else{_1135.set(this.displayNode,_114e.name,_114e.value);}},_handleValidationError:function(_114f){},render:function(){var val=this.contentModel.get(this.modelPropertyName);this._renderNode(this.modelPropertyName,val,val);},focus:function(){dijit.focus(this.displayNode);},setShowEmptyNode:function(val){this._showEmptyNode=val;if(this._hasEmptyHtml){this._updateRendering("");}}});});},"epi-cms/widget/overlay/overlayFactory":function(){define(["dojo/_base/lang","dojo/_base/Deferred","epi/string","epi-cms/widget/overlay/Property"],function(lang,_1150,_1151){return {defaultType:"epi-cms/widget/overlay/Property",create:function(_1152){var _1153=new _1150();var _1154=_1152.property.metadata.overlaySettings&&_1152.property.metadata.overlaySettings.customType;var _1155=_1152.property,_1156=_1151.slashName(_1154||this.defaultType);require([_1156],lang.hitch(this,function(_1157){var _1158=lang.mixin({name:_1155.name,contentModel:_1155.contentModel,displayName:_1155.metadata.displayName,disabled:_1152.disabled,sourceItemNode:_1152.node},_1155.overlayParams);var _1159=new _1157(_1158);_1153.resolve(_1159);}));return _1153;}};});},"epi-cms/widget/overlay/Property":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/string","epi/shell/widget/overlay/Item"],function(_115a,lang,_115b,Item){return _115a([Item],{onValueChange:function(_115c){},_getRightProperty:function(){var _115d=this.name;if(this.dndTargetPropertyName){_115d+=("."+_115b.pascalToCamel(this.dndTargetPropertyName));}return _115d;},onDrop:function(_115e,value){var _115f=this._getRightProperty();this.onValueChange({propertyName:_115f,value:value});}});});},"epi-cms/contentediting/editors/CheckBoxListEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/on","dijit/focus","dijit/_TemplatedMixin","dijit/_Widget","dijit/form/CheckBox","epi/shell/widget/_ValueRequiredMixin"],function(array,_1160,lang,_1161,on,_1162,_1163,_1164,_1165,_1166){return _1160([_1164,_1163,_1166],{templateString:"<div class=\"dijit dijitReset dijitInline\"></div>",baseClass:"epi-checkBoxList",valueIsCsv:true,valueIsInclusive:true,value:null,constructor:function(){this._checkboxes=[];this._labelClickHandles=[];},buildRendering:function(){this.inherited(arguments);array.forEach(this.selections,this._addCheckBoxForItem,this);},destroy:function(){var _1167;while(_1167=this._checkboxes.pop()){_1167.destroyRecursive();}var _1168;while(_1168=this._labelClickHandles.pop()){_1168.remove();}this.inherited(arguments);},focus:function(){try{if(this._checkboxes.length>0){_1162.focus(this._checkboxes[0].domNode);}}catch(e){}},onChange:function(){},onBlur:function(){},onFocus:function(){},_calculateValue:function(){var _1169=[];var _116a=this.valueIsInclusive;array.forEach(this._checkboxes,function(_116b){if(_116a===_116b.checked){_1169.push(_116b.value);}});this._set("value",this.valueIsCsv?_1169.join(","):_1169);},_setValueAttr:function(value){this._set("value",value);var _116c=[];if(value){_116c=this.valueIsCsv?value.split(","):value;}var _116d=this.valueIsInclusive;array.forEach(this._checkboxes,function(_116e){_116e.set("checked",_116d===array.some(_116c,function(v){return v===_116e.value;}));});},_onBlur:function(){this.inherited(arguments);this.onBlur();},_addCheckBoxForItem:function(item){var _116f=_1161.create("span",null,this.domNode);var _1170=new _1165({value:item.value});_1170.placeAt(_116f);_1170.on("change",lang.hitch(this,function(){this._calculateValue();this.onChange(this.value);}));_1170.on("focus",lang.hitch(this,function(){this._set("focused",true);this.onFocus();}));_1170.on("blur",lang.hitch(this,function(){this._set("focused",false);this._onBlur();}));_1170.set("readOnly",!!this.readOnly);this._checkboxes.push(_1170);var label=_1161.create("label",{"for":_1170.id,innerHTML:item.text},_116f);this._labelClickHandles.push(on(label,"click",lang.hitch(this,function(){_1162.focus(_1170.domNode);})));}});});},"epi-cms/contentediting/editors/CollectionEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-construct","dojo/dom-class","dojo/json","dojo/on","dojo/Stateful","dojo/when","dijit/_TemplatedMixin","dijit/_Widget","dgrid/Keyboard","dgrid/OnDemandGrid","dgrid/Selection","dgrid/extensions/ColumnResizer","dgrid/extensions/ColumnReorder","put-selector/put","epi/shell/command/builder/ButtonBuilder","epi/shell/dgrid/Formatter","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/FormContainer","epi/string","epi/shell/command/withConfirmation","epi-cms/contentediting/editors/model/CollectionEditorModel","epi-cms/contentediting/editors/model/CollectionEditorItemModel","epi-cms/contentediting/_EditorWrapperBase","epi-cms/dgrid/DnD","epi-cms/dgrid/formatters","epi-cms/dgrid/WithContextMenu","epi-cms/contentediting/editors/DefaultGridAssembler","./_AddItemDialogMixin","dojo/text!./templates/CollectionEditor.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.collectioneditor"],function(array,_1171,lang,_1172,_1173,_1174,json,on,_1175,when,_1176,_1177,_1178,_1179,_117a,_117b,_117c,put,_117d,_117e,_117f,_1180,_1181,_1182,_1183,_1184,_1185,DnD,_1186,_1187,_1188,_1189,_118a,_118b){return _1171([_1177,_1176,_117f,_1189],{templateString:_118a,multiple:true,baseClass:"epi-collection-editor",value:null,model:null,modelType:_1183,itemType:null,generateColumns:true,excludedColumns:null,includedColumns:null,gridType:_1171([_1179,_117e,_117a,_1178,DnD,_117b,_117c,_1187]),gridAssemblerType:_1188,gridSettings:null,itemModelType:null,itemEditorType:_1180,useFullWidth:true,_noDataMessage:"<span><span class=\"dijitReset dijitInline\">"+_118b.noitems+"</span></span>",_currentProviderHandler:null,postMixInProperties:function(){this.inherited(arguments);this.itemModelType=this.itemModelType||_1184;this.model=this.model||new this.modelType({itemType:this.itemType,itemModelType:this.itemModelType,data:this.value,availableCommands:this.commands});this.own(on(this.model,"itemsChanged",lang.hitch(this,this._onItemsChanged)));this.gridSettings=lang.mixin(this.gridSettings||{},{noDataMessage:this._noDataMessage});if(this.readOnly){this.allowedDndTypes=[];this.gridSettings.dndDisabled=true;}this.gridSettings.dndParams={copyOnly:true,accept:this.allowedDndTypes||[],creator:lang.hitch(this,this._dndNodeCreator)};},postCreate:function(){this.inherited(arguments);when(this.model.initialize(),lang.hitch(this,function(){this._setupGrid();}));},onChange:function(value){},_setValueAttr:function(value){this._set("value",value);if(this.model){this.model.set("data",value);}},_dndNodeCreator:function(item,hint){var _118c=this.allowedDndTypes,node=_1173.create("div").appendChild(document.createTextNode(item.text));return {"node":node,"type":_118c,"data":item};},_setupGrid:function(){var _118d=this._getGridDefinition();var _118e=new this.gridAssemblerType({gridType:this.gridType,gridSettings:this.gridSettings,columnDefinitions:_118d,listCommands:this.readOnly?[]:this.model.getListCommands(),itemCommandsFactory:lang.hitch(this,function(item,_118f){return this.readOnly?[]:this.model.getItemCommands(item,this.commands,_118f);})});this.own(this.grid=_118e.build(this.gridNode,this.commandTargetNode));_1174.add(this.gridNode,"epi-plain-grid--margin-bottom epi-plain-grid--cell-borders");if(!this.gridSettings.dndDisabled){this._setupDnD();}var items=this.model.get("items");this.grid.renderArray(items);if(!items||items.length<=0){this._renderNoDataMessage();}this.own(this.grid.on(".dgrid-row:click",lang.hitch(this,this.onGridRowClick)));this.own(this.grid.on(".dgrid-row:dblclick",lang.hitch(this,this.onGridRowDblClick)));},_setupDnD:function(){this.own(_1172.after(this.grid.dndSource,"onDropData",lang.hitch(this,this.onDndDrop),true));},onDndDrop:function(_1190,_1191,nodes,copy){var i;if(this.grid.dndSource===_1191){for(i=0;i<nodes.length;i++){this.model.moveItem(this.grid.dndSource.getItem(nodes[i].id).data,this.grid.dndSource.current!=null?this.grid.dndSource.getItem(this.grid.dndSource.current.id).data:null,this.grid.dndSource.before);}}else{this.onDropping&&this.onDropping();this.onFocus();for(i=0;i<_1190.length;i++){this._addItem(_1190[i]);if(_1191&&_1191.grid&&_1191.grid.consumer&&_1191.grid.consumer!==this){_1191.grid.consumer.model.removeItem(this.grid.dndSource.getItem(nodes[i].id).data);}}}},_addItem:function(item){when(this._dndGetItemData(item),lang.hitch(this,function(_1192){this.model.addItem(_1192,this.grid.dndSource.current!=null?this.grid.dndSource.getItem(this.grid.dndSource.current.id).data:null,this.grid.dndSource.before);}));},_dndGetItemData:function(item){return item.data;},_getGridDefinition:function(){var _1193=this.generateColumns?this.model.generateColumnsDefinition(this.excludedColumns):this.includedColumns||{};return this.model.generateFormatters(_1193);},_onGridRowSelect:function(e){if(!this.grid.itemCommandProviderMap){return;}if(this._currentProviderHandler){this._currentProviderHandler.removeProvider();}var item=this.grid.row(e).data;this._currentProviderHandler=this.grid.contextMenu.addProvider(this.grid.itemCommandProviderMap[json.stringify(item)]);},onGridRowClick:function(e){this._onGridRowSelect(e);},onGridRowDblClick:function(e){var item={model:this.grid.row(e).data};this.model.editItemDelegate(item);},_getDialogConfirmActionText:function(){return this.gridSettings.confirmActionText?this.gridSettings.confirmActionText:this.inherited(arguments);},onExecuteDialog:function(){var item=this._itemEditor.get("value");if(this._editingItemIndex!==undefined){this.model.saveItem(item,this._editingItemIndex);}else{this.model.addItem(item);}},_onItemsChanged:function(items){if(this.grid){for(var item in this.grid.itemCommandProviderMap){delete this.grid.itemCommandProviderMap[item];}this.grid.refresh();this.grid.renderArray(items);if(!items||items.length<=0){this._renderNoDataMessage();}}var value=this.model.get("data");this._set("value",value);if(!this.readOnly){this.onChange(value);if(this.grid&&this.parent instanceof _1185&&this.editMode&&this.editMode==="formedit"){this.onBlur();}}},_renderNoDataMessage:function(){this.grid.noDataNode=put(this.grid.contentNode,"div.dgrid-no-data");this.grid.noDataNode.innerHTML=this.grid.noDataMessage;},_onBlur:function(){if(this.grid.contextMenu&&this.grid.contextMenu.isShowingNow){return;}this.inherited(arguments);}});});},"dgrid/extensions/ColumnReorder":function(){define("dgrid/extensions/ColumnReorder",["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/on","dojo/query","dojo/dnd/Source","put-selector/put","xstyle/css!../css/extensions/ColumnReorder.css"],function(lang,_1194,_1195,on,query,_1196,put){var _1197=/(\d+)(?:-(\d+))?$/;function _1198(grid,match){var _1199=match[2],_119a=grid[_1199?"columnSets":"subRows"][match[1]];return _1199?_119a[match[2]]:_119a;};function _119b(grid,match,_119c){if(match[2]){grid.columnSets[match[1]][match[2]]=_119c;}else{grid.subRows[match[1]]=_119c;}};function _119d(_119e){return "dgrid-"+_119e+"-";};function _119f(_11a0,_11a1){return _11a1.slice(_119d(_11a0).length);};var _11a2=_1194(_1196,{copyState:function(){return false;},checkAcceptance:function(_11a3,nodes){return _11a3==this;},_legalMouseDown:function(evt){return evt.target.className.indexOf("dgrid-resize-handle")>-1?false:this.inherited(arguments);},onDropInternal:function(nodes){var grid=this.grid,match=_1197.exec(_119f(grid.id,nodes[0].getAttribute("dndType"))),_11a4=match[2]?"columnSets":"subRows",_11a5=_1198(grid,match),_11a6=grid.columns;this.inherited(arguments);if(!match){return;}setTimeout(function(){var _11a7=_1195.map(nodes[0].parentNode.childNodes,function(col){return _11a6[col.columnId];}),_11a8;_119b(grid,match,_11a7);_11a8={grid:grid,subRow:_11a7,column:_11a6[nodes[0].columnId],bubbles:true,cancelable:true,parentType:"dnd"};_11a8[_11a4]=grid[_11a4];if(on.emit(grid.domNode,"dgrid-columnreorder",_11a8)){grid.set(_11a4,grid[_11a4]);}else{_119b(grid,match,_11a5);grid.renderHeader();if(this._sort&&this._sort.length){this.updateSortArrow(this._sort);}}},0);}});var _11a9=_1194(null,{columnDndConstructor:_11a2,_initSubRowDnd:function(_11aa,_11ab){var _11ac,c,len,col,th;for(c=0,len=_11aa.length;c<len;c++){col=_11aa[c];if(col.reorderable===false){continue;}th=col.headerNode;if(th.tagName!="TH"){th=th.parentNode;}put(th,".dojoDndItem[dndType="+_11ab+"]");if(!_11ac){_11ac=th.parentNode;}}if(_11ac){this._columnDndSources.push(new this.columnDndConstructor(_11ac,{horizontal:true,grid:this}));}},renderHeader:function(){var _11ad=_119d(this.id),_11ae,cs;this.inherited(arguments);this._columnDndSources=[];if(this.columnSets){for(cs=0,_11ae=this.columnSets.length;cs<_11ae;cs++){_1195.forEach(this.columnSets[cs],function(_11af,sr){this._initSubRowDnd(_11af,_11ad+cs+"-"+sr);},this);}}else{_1195.forEach(this.subRows,function(_11b0,sr){this._initSubRowDnd(_11b0,_11ad+sr);},this);}},_destroyColumns:function(){if(this._columnDndSources){_1195.forEach(this._columnDndSources,function(_11b1){_11b1.destroy();});}this.inherited(arguments);}});_11a9.ColumnDndSource=_11a2;return _11a9;});},"epi-cms/contentediting/editors/model/CollectionEditorModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/Evented","dojo/Stateful","dojo/when","dojo/promise/all","dijit/Destroyable","dojox/mvc/StatefulArray","epi/dependency","epi/string","epi/shell/command/DelegateCommand","epi-cms/contentediting/editors/model/CollectionEditorItemModel","epi-cms/dgrid/formatters","epi/i18n!epi/nls/episerver.shared"],function(array,_11b2,lang,_11b3,_11b4,_11b5,_11b6,when,all,_11b7,_11b8,_11b9,_11ba,_11bb,_11bc,_11bd,_11be){var _11bf={none:0,add:1,edit:2,remove:4,moveUp:8,moveDown:16};var _11c0=_11b2([_11b6,_11b5,_11b7],{data:null,itemType:null,itemModelType:null,itemMetadata:null,metadataManager:null,availableCommands:null,_itemModels:null,_itemsUnchanged:false,postscript:function(){this.inherited(arguments);this.metadataManager=this.metadataManager||_11b9.resolve("epi.shell.MetadataManager");this.itemModelType=this.itemModelType||_11bc;},initialize:function(){return when(this.metadataManager.getMetadataForType(this.itemType),lang.hitch(this,function(_11c1){this.set("itemMetadata",_11c1);return this._initData();}));},_initData:function(){this._itemModels=new _11b8([]);_11b3.before(this._itemModels,"sort",lang.hitch(this,function(){this._itemsUnchanged=true;},true));this.own(this._itemModels.watchElements(lang.hitch(this,function(){if(!this._itemsUnchanged){this.emit("itemsChanged",this.get("items"));}this._itemsUnchanged=false;})));var _11c2=array.map(this.data,function(item){var _11c3=new this.itemModelType();return when(_11c3.fromItemData(item),function(){return _11c3;});},this);return when(all(_11c2),lang.hitch(this,function(_11c4){this._itemModels.splice.apply(this._itemModels,[0,this._itemModels.length].concat(_11c4));}));},getListCommands:function(_11c5){return [new _11bb({name:"add",tooltip:_11be.action.add,iconClass:"epi-iconPlus",canExecute:true,isAvailable:this._commandIsAvailable(_11bf.add,_11c5),delegate:lang.hitch(this,this.addItemDelegate)})];},getItemCommands:function(item,_11c6,_11c7){return [new _11bb({name:"edit",category:_11c7,label:_11be.action.edit,iconClass:"epi-iconPen",model:item,canExecute:true,isAvailable:this._commandIsAvailable(_11bf.edit,_11c6),delegate:lang.hitch(this,this.editItemDelegate)}),new _11bb({name:"moveUp",category:_11c7,label:_11be.action.moveup,iconClass:"epi-iconUp",model:item,canExecute:this._itemModels.indexOf(item)>0,isAvailable:this._commandIsAvailable(_11bf.moveUp,_11c6),delegate:lang.hitch(this,this.moveItemUpDelegate)}),new _11bb({name:"moveDown",category:_11c7,label:_11be.action.movedown,iconClass:"epi-iconDown",model:item,canExecute:this._itemModels.indexOf(item)<this._itemModels.length-1,isAvailable:this._commandIsAvailable(_11bf.moveDown,_11c6),delegate:lang.hitch(this,this.moveItemDownDelegate)}),new _11bb({name:"remove",category:_11c7,label:_11be.action.remove,iconClass:"epi-iconTrash",model:item,canExecute:true,isAvailable:this._commandIsAvailable(_11bf.remove,_11c6),delegate:lang.hitch(this,this.removeItemDelegate)})];},_commandIsAvailable:function(_11c8,_11c9){_11c9=_11c9||this.availableCommands;return !!(_11c8&_11c9);},generateColumnsDefinition:function(_11ca){var _11cb={};array.forEach(array.filter(this.itemMetadata.properties,function(_11cc){return array.every(_11ca,function(col){return col!==_11cc.name;});}),function(_11cd){var _11ce=_11ba.pascalToCamel(_11cd.name);_11cb[_11ce]={label:_11cd.displayName};});return _11cb;},generateFormatters:function(_11cf){for(var _11d0 in _11cf){array.some(this.itemMetadata.properties,function(_11d1){if(_11d0==_11ba.pascalToCamel(_11d1.name)){this._setTypeFormatter(_11d1,_11cf[_11d0]);this._setSelectionFactoryFormatter(_11d1,_11cf[_11d0]);this._setWrappingFormatter(_11cf[_11d0]);return true;}},this);}return _11cf;},_typeFormatterMap:{"System.DateTime":_11bd.localizedDate,"System.Boolean":_11bd.friendlyBoolean},_wrappingFormatterMap:{"SecondaryText":function(_11d2){if(_11d2){return function(value){return _11bd.secondaryText(_11d2(value),true);};}return function(value){return _11bd.secondaryText(value);};},"VisibleLink":function(_11d3){if(_11d3){return function(value){return _11bd.visibleLink(_11d3(value),true);};}return function(value){return _11bd.visibleLink(value);};}},_setTypeFormatter:function(_11d4,_11d5){for(var _11d6 in this._typeFormatterMap){if(_11d4.modelType.indexOf(_11d6)>-1){_11d5.formatter=this._typeFormatterMap[_11d6];break;}}},_setSelectionFactoryFormatter:function(_11d7,_11d8){if(_11d7.selections&&_11d7.selections.length>0){var _11d9=_11d7.selections;if(_11d8){_11d8.formatter=function(value){var _11da=value;_11d9.forEach(function(_11db){if(_11db.value===value){_11da=_11db.text;}});return _11da;};}}},_setWrappingFormatter:function(_11dc){if(_11dc.wrappingFormatter&&this._wrappingFormatterMap[_11dc.wrappingFormatter]){_11dc.formatter=this._wrappingFormatterMap[_11dc.wrappingFormatter](_11dc.formatter);}},addItemDelegate:function(){this.emit("toggleItemEditor",null);},editItemDelegate:function(cmd){if(this._commandIsAvailable(_11bf.edit,this.availableCommands)){var item=cmd.model;var index=this._itemModels.indexOf(item);this.emit("toggleItemEditor",item,index);}},removeItemDelegate:function(cmd){this.removeItem(cmd.model);},moveItemUpDelegate:function(cmd){var item=cmd.model;var index=this._itemModels.indexOf(item);var _11dd=index-1;if(_11dd>=0){this.moveItem(item,this._itemModels[_11dd],true);}},moveItemDownDelegate:function(cmd){var item=cmd.model;var index=this._itemModels.indexOf(item);var _11de=index+1;if(_11de<this._itemModels.length){this.moveItem(item,this._itemModels[_11de],false);}},saveItem:function(item,index){var _11df=new this.itemModelType();return when(_11df.fromItemData(item),lang.hitch(this,function(){this._itemModels.splice(index,1,_11df);}));},addItem:function(item,_11e0,_11e1){var _11e2=new this.itemModelType();return when(_11e2.fromItemData(item),lang.hitch(this,function(){var _11e3;if(!_11e0){_11e3=this._itemModels.length;}else{_11e3=this._itemModels.indexOf(_11e0);if(!_11e1){_11e3++;}}this._itemModels.splice(_11e3,0,_11e2);}));},moveItem:function(item,_11e4,_11e5){this._itemsUnchanged=true;var _11e6=this._itemModels.indexOf(item);this._itemModels.splice(_11e6,1);var _11e7=this._itemModels.indexOf(_11e4);var _11e8=_11e5?_11e7:_11e7+1;_11e8=item==_11e4?_11e6:_11e8;this._itemModels.splice(_11e8,0,item);},removeItem:function(item){var index=this._itemModels.indexOf(item);this._itemModels.splice(index,1);},_dataSetter:function(value){this.data=value;this._initData();},_dataGetter:function(){return array.map(this._itemModels,function(_11e9){return _11e9.toItemData();},this);},_itemsGetter:function(){return this._itemModels;}});_11c0.commandMask=_11bf;return _11c0;});},"dojox/mvc/StatefulArray":function(){define("dojox/mvc/StatefulArray",["dojo/_base/lang","dojo/Stateful"],function(lang,_11ea){function _11eb(a){if(a._watchElementCallbacks){a._watchElementCallbacks();}return a;};var _11ec=function(a){var array=lang._toArray(a);var ctor=_11ec;ctor._meta={bases:[_11ea]};array.constructor=ctor;return lang.mixin(array,{pop:function(){return this.splice(this.get("length")-1,1)[0];},push:function(){this.splice.apply(this,[this.get("length"),0].concat(lang._toArray(arguments)));return this.get("length");},reverse:function(){return _11eb([].reverse.apply(this,lang._toArray(arguments)));},shift:function(){return this.splice(0,1)[0];},sort:function(){return _11eb([].sort.apply(this,lang._toArray(arguments)));},splice:function(idx,n){var l=this.get("length");idx+=idx<0?l:0;var p=Math.min(idx,l),_11ed=this.slice(idx,idx+n),adds=lang._toArray(arguments).slice(2);[].splice.apply(this,[idx,n].concat(new Array(adds.length)));for(var i=0;i<adds.length;i++){this.set(p+i,adds[i]);}if(this._watchElementCallbacks){this._watchElementCallbacks(idx,_11ed,adds);}if(this._watchCallbacks){this._watchCallbacks("length",l,l-_11ed.length+adds.length);}return _11ed;},unshift:function(){this.splice.apply(this,[0,0].concat(lang._toArray(arguments)));return this.get("length");},concat:function(a){return new _11ec([].concat(this).concat(a));},join:function(sep){var list=[];for(var l=this.get("length"),i=0;i<l;i++){list.push(this.get(i));}return list.join(sep);},slice:function(start,end){var l=this.get("length");start+=start<0?l:0;end=(end===void 0?l:end)+(end<0?l:0);var slice=[];for(var i=start||0;i<Math.min(end,this.get("length"));i++){slice.push(this.get(i));}return new _11ec(slice);},watchElements:function(_11ee){var _11ef=this._watchElementCallbacks,_11f0=this;if(!_11ef){_11ef=this._watchElementCallbacks=function(idx,_11f1,adds){for(var list=[].concat(_11ef.list),i=0;i<list.length;i++){list[i].call(_11f0,idx,_11f1,adds);}};_11ef.list=[];}_11ef.list.push(_11ee);var h={};h.unwatch=h.remove=function(){for(var list=_11ef.list,i=0;i<list.length;i++){if(list[i]==_11ee){list.splice(i,1);break;}}};return h;}},_11ea.prototype,{set:function(name,value){if(name=="length"){var old=this.get("length");if(old<value){this.splice.apply(this,[old,0].concat(new Array(value-old)));}else{if(value>old){this.splice.apply(this,[value,old-value]);}}return this;}else{var _11f2=this.length;_11ea.prototype.set.call(this,name,value);if(_11f2!=this.length){_11ea.prototype.set.call(this,"length",this.length);}return this;}}});};return lang.setObject("dojox.mvc.StatefulArray",_11ec);});},"epi/shell/command/DelegateCommand":function(){define("epi/shell/command/DelegateCommand",["dojo/_base/declare","epi/shell/command/_Command"],function(_11f3,_11f4){return _11f3([_11f4],{delegate:null,_execute:function(){return this.delegate?this.delegate.apply(this,[this].concat(arguments)):null;}});});},"epi-cms/contentediting/editors/model/CollectionEditorItemModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful"],function(_11f5,lang,_11f6){return _11f5([_11f6],{_itemData:null,name:null,fromItemData:function(_11f7){lang.mixin(this,_11f7);this._itemData=_11f7;this.name=this.name||this._itemData.toString();},toItemData:function(){var _11f8={};for(var _11f9 in this._itemData){if(this._itemData.hasOwnProperty(_11f9)){_11f8[_11f9]=this.get(_11f9);}}return _11f8;}});});},"epi-cms/contentediting/editors/DefaultGridAssembler":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/json","dojo/Stateful","epi/shell/command/builder/ButtonBuilder","epi/shell/command/withConfirmation","epi-cms/dgrid/formatters"],function(array,_11fa,lang,json,_11fb,_11fc,_11fd,_11fe){var _11ff=_11fa([],{gridType:null,gridSettings:null,columnDefinitions:null,listCommands:null,itemCommandsFactory:null,constructor:function(_1200){lang.mixin(this,_1200);},build:function(_1201,_1202){},instantiateGrid:function(_1203,_1204,_1205,node){return new _1203(lang.mixin(_1204,{columns:_1205,className:"epi-plain-grid"}),node);}});return _11fa([_11ff],{itemCommandProviderMap:null,constructor:function(){this.itemCommandProviderMap={};},build:function(_1206,_1207){this.columnDefinitions["_epiGrid_Action"]={renderHeaderCell:function(){},renderCell:lang.hitch(this,function(item,value,node,_1208){var _1209=this._getItemCommands(item);this.itemCommandProviderMap[json.stringify(item)]=new _11fb({commands:_1209});this.renderActionMenu(item,node,_1209);}),className:"epi-columnNarrow",sortable:false};var grid=this.instantiateGrid(this.gridType,this.gridSettings,this.columnDefinitions,_1206);grid.itemCommandProviderMap=this.itemCommandProviderMap;this._setupCommands(this.listCommands,_1207);return grid;},renderActionMenu:function(item,node,_120a){node.innerHTML=_120a&&_120a.length>0?_11fe.menu({title:epi.resources.action.options}):"";},_getItemCommands:function(item){var _120b=this.itemCommandsFactory(item,"context");array.some(_120b,function(_120c){if(_120c.name=="remove"&&this.gridSettings.useDeleteWithConfirmation){_120c=_11fd(_120c,null,{title:this.gridSettings.deleteConfirmationTitle,description:this.gridSettings.deleteConfirmationMessage});return true;}},this);return _120b;},_setupCommands:function(_120d,_120e){var _120f=this.getListCommandBuilder();array.forEach(_120d,function(_1210){_120f.create(_1210,_120e);},this);},getListCommandBuilder:function(){return new _11fc({settings:{showLabel:true}});}});});},"epi-cms/contentediting/editors/_AddItemDialogMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","epi/shell/widget/_ValueRequiredMixin","epi/shell/widget/dialog/Dialog","../../widget/_HasChildDialogMixin","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.collectioneditor","epi/i18n!epi/nls/episerver.shared"],function(_1211,lang,on,_1212,_1213,_1214,_1215,_1216){return _1211([_1212,_1214],{itemEditorType:null,_itemEditor:null,_dialog:null,dialogParams:null,_editingItemIndex:null,postCreate:function(){this.inherited(arguments);this.own(on(this.model,"toggleItemEditor",lang.hitch(this,this._onToggleItemEditor)));},_onToggleItemEditor:function(item,index){if(!this._dialog){this._setupItemEditor();}this._itemEditor.set("value",item);this._editingItemIndex=index;this.isShowingChildDialog=true;this._dialog.show();this._setDialogConfirmActionText(item);this._setDialogTitle(item);this._setDialogConfirmActionStatus(item);},_setupItemEditor:function(){this.own(this._itemEditor=this._createItemEditor(),this.connect(this._itemEditor,"onChange","_setDialogConfirmActionStatus"),this._dialog=new _1213(lang.mixin({title:this._getDialogTitleText(),content:this._itemEditor},this.dialogParams)),on(this._dialog,"execute",lang.hitch(this,function(){if(this.validate()){this.onExecuteDialog();}})),on(this._dialog,"hide",lang.hitch(this,this._onCancelDialog)));},_createItemEditor:function(){return new this.itemEditorType({metadata:this.model.get("itemMetadata"),doLayout:false});},_setDialogTitle:function(_1217){this._dialog.set("title",this._getDialogTitleText(_1217));},_getDialogTitleText:function(_1218){return _1215.title;},_onCancelDialog:function(){this.isShowingChildDialog=false;this.onCancelDialog();},onExecuteDialog:function(){},onCancelDialog:function(){},_setDialogConfirmActionText:function(_1219){this._dialog.onActionPropertyChanged({name:this._dialog._okButtonName},"label",this._getDialogConfirmActionText(_1219));},_getDialogConfirmActionText:function(_121a){return _121a?_1216.action.ok:_1216.action.add;},_setDialogConfirmActionStatus:function(item){this._dialog.onActionPropertyChanged({name:this._dialog._okButtonName},"disabled",!item||item==="");}});});},"epi-cms/widget/_HasChildDialogMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom","dijit/_FocusMixin","dijit/popup"],function(_121b,lang,_121c,dom,_121d,popup){return _121b([_121d],{isShowingChildDialog:false,_openedChildDialog:null,_waitingForFocus:false,startup:function(){_121c.before(popup,"open",lang.hitch(this,"_onPopupOpen"),true);_121c.after(popup,"close",lang.hitch(this,"_onPopupClosed"),true);},_onPopupOpen:function(_121e){var popup=_121e.popup;var _121f=popup&&popup.currentTarget;if(_121f&&dom.isDescendant(_121f,this.domNode)){this._openedChildDialog=popup;this.isShowingChildDialog=true;}},_onPopupClosed:function(popup){if(this._openedChildDialog===popup){this._openedChildDialog=null;this.isShowingChildDialog=false;this._waitingForFocus=true;setTimeout(lang.hitch(this,"_waitForFocus"),0);}},_waitForFocus:function(){if(this._waitingForFocus){this._waitingForFocus=false;this._onBlur();}},_onBlur:function(){if(this.isShowingChildDialog){return;}this.inherited(arguments);},_onFocus:function(){this._waitingForFocus=false;if(this.isShowingChildDialog){return;}this.inherited(arguments);}});});},"url:epi-cms/contentediting/editors/templates/CollectionEditor.html":"<div class=\"dijitInline\" style=\"width:100%;\">\r\n    <div data-dojo-attach-point=\"commandTargetNode\"></div>\r\n    <div data-dojo-attach-point=\"gridNode\"></div>\r\n</div>","epi-cms/contentediting/editors/ContentAreaEditor":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-style","dojo/Deferred","dojo/on","dojo/topic","dojo/when","dijit/registry","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_CssStateMixin","dijit/_WidgetsInTemplateMixin","epi/dependency","epi/shell/dnd/Target","epi/shell/command/_CommandProviderMixin","./_ContentAreaTree","./_ContentAreaTreeModel","./_TextWithActionLinksMixin","epi-cms/_ContentContextMixin","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/viewmodel/ContentAreaViewModel","epi/shell/widget/ContextMenu","epi/shell/widget/_ValueRequiredMixin","epi-cms/widget/overlay/Block","epi-cms/widget/command/CreateContentFromSelector","epi-cms/widget/_HasChildDialogMixin","epi-cms/contentediting/command/BlockRemove","epi-cms/contentediting/command/BlockEdit","epi-cms/contentediting/command/MoveToPrevious","epi-cms/contentediting/command/MoveToNext","epi-cms/contentediting/command/MoveOutsideGroup","epi-cms/contentediting/command/Personalize","epi-cms/contentediting/command/SelectDisplayOption","dojo/text!./templates/ContentAreaEditor.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea"],function(_1220,lang,_1221,_1222,_1223,on,topic,when,_1224,_1225,_1226,_1227,_1228,_1229,_122a,_122b,_122c,_122d,_122e,_122f,_1230,_1231,_1232,_1233,_1234,_1235,_1236,_1237,_1238,_1239,_123a,_123b,_123c,_123d,_123e,_123f){return _1220([_1225,_1226,_1228,_1227,_1233,_122f,_122b,_1236,_122e],{baseClass:"epi-content-area-editor",res:_123f,templateString:_123e,value:null,multiple:true,parent:null,overlayItem:null,model:null,intermediateChanges:true,editMode:"onpageedit",_contextService:null,_preventOnBlur:false,_dndTarget:null,constructor:function(){this.allowedDndTypes=[];},onChange:function(value){},_handleModelChange:function(value){this.validate();this.onChange(value);},_onBlur:function(){if(this._preventOnBlur){return;}this.inherited(arguments);},focus:function(){if(this.model.get("value").length>0){this._focusManager.focus(this.treeNode);}else{this.textWithLinks.focus();}},postMixInProperties:function(){this.inherited(arguments);this.commands=this._commands||[new _1238(),new _123d(),new _123c({category:null}),new _123b(),new _1239(),new _123a(),new _1237()];this.model=new _1231();this.own(this.model);this.own(this.model.watch("selectedItem",lang.hitch(this,function(name,_1240,_1241){this.updateCommandModel(_1241);})));this.own(on(this.model,"changed",lang.hitch(this,function(){if(!this._started||this._supressValueChanged){return;}this._set("value",this.model.get("value"));this._handleModelChange(this.value);})));},postCreate:function(){this.inherited(arguments);this.set("emptyMessage",_123f.emptymessage);if(this.parent&&this.overlayItem){this.connect(this.parent,"onStartEdit",function(){this._selectFromOverlay(this.overlayItem.model);});}this.own(topic.subscribe("/dnd/start",lang.hitch(this,this._startDrag)));},buildRendering:function(){this.inherited(arguments);this._contextService=this._contextService||_1229.resolve("epi.shell.ContextService");this.contextMenu=new _1232();this.contextMenu.addProvider(this);this.own(this.contextMenu);this.setupActionLinks(this.actionsContainer);this.tree=new _122c({accept:this.allowedDndTypes,contextMenu:this.contextMenu,model:new _122d({model:this.model})},this.treeNode);this.own(this.tree);this._dndTarget=new _122a(this.actionsContainer,{accept:this.allowedDndTypes,isSource:false,alwaysCopy:false,insertNodes:function(){}});this.own(_1221.after(this._dndTarget,"onDropData",lang.hitch(this,function(_1242,_1243,nodes,copy){var model=_1242[0].data;this.model.modify(lang.hitch(this,function(){this.model.addChild(model);}));}),true));},startup:function(){this.inherited(arguments);this.tree.startup();this.contextMenu.startup();},isCreateLinkVisible:function(){var _1244=new _1223();var _1245=this._contextService&&this._contextService.currentContext;when(this.getCurrentContent(),function(_1246){var _1247=!_1245||(_1245.capabilities.resourceable&&_1245.currentMode!=="create");var _1248=_1230.isActionAvailable(_1246,_1230.action.Create,_1230.providerCapabilities.Create,true);_1244.resolve(!!(_1247&&_1248));});return _1244.promise;},executeAction:function(_1249){if(_1249==="createnewblock"){this._preventOnBlur=true;var _124a=new _1235({creatingTypeIdentifier:"episerver.core.blockdata",createAsLocalAsset:true,canChangeLocalAssetName:false});_124a.set("model",{save:lang.hitch(this,function(block){this._preventOnBlur=false;var value=lang.clone(this.get("value"),true)||[];value.push(block);this.set("value",value);this.onChange(value);this.onBlur();}),cancel:lang.hitch(this,function(){this._preventOnBlur=false;})});_124a.execute();}},isValid:function(){return (!this.required||this.model.get("value").length>0);},_setReadOnlyAttr:function(_124b){this._set("readOnly",_124b);_1222.set(this.actionsContainer,"display",_124b?"none":"");if(this._source){this._source.isSource=!this.readOnly;}if(this.model){this.model.set("readOnly",_124b);}this.tree.set("readOnly",_124b);},_checkAcceptance:function(_124c,nodes){return this.readOnly?false:this._source.defaultCheckAcceptance(_124c,nodes);},_setValueAttr:function(value){this._set("value",value||[]);this.tree.set("selectedItems",null);this._supressValueChanged=true;this.model.set("value",value);this._supressValueChanged=false;},_selectFromOverlay:function(_124d){var child=_124d&&_124d.selectedItem&&_124d.selectedItem.serialize(),model=this.model,path=["root"];if(!child){return;}if(child.contentGroup){model=model.getChild({name:child.contentGroup});path.push(model.id);}model=model.getChild(child);if(!model){return;}path.push(model.id);model.set("selected",true);model.set("ensurePersonalization",_124d.selectedItem.ensurePersonalization);this.tree.set("path",path);},_startDrag:function(_124e,nodes,copy){var _124f=_1224.getEnclosingWidget(nodes[0]);if(_124f.isInstanceOf(_1234)&&this.parent.cancel){this.parent.set("isModified",false);this.parent.cancel();}}});});},"epi-cms/contentediting/editors/_ContentAreaTree":function(){define(["dojo/_base/declare","dojo/aspect","dojo/_base/event","dojo/_base/array","dojo/_base/lang","dojo/dom-class","dijit/registry","epi/dependency","epi/shell/conversion/ObjectConverterRegistry","epi/shell/dnd/tree/dndSource","epi/shell/TypeDescriptorManager","epi/shell/widget/Tree","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel","./_BlockTreeNode","./_GroupTreeNode"],function(_1250,_1251,event,array,lang,_1252,_1253,_1254,_1255,_1256,_1257,Tree,_1258,_1259,_125a,_125b){return _1250([Tree],{showRoot:false,dndController:_1256,betweenThreshold:8,postMixInProperties:function(){this.inherited(arguments);this.dndParams.push("accept");this.accept.push("personalizationarea");},postCreate:function(){this.inherited(arguments);_1252.add(this.domNode,"epi-tree-mngr");this.own(_1251.after(this.dndController,"onDndItemRemoved",lang.hitch(this,function(_125c){if(_125c[0]&&_125c[0].data){this.model.deleteItem(_125c[0].data);}}),true));this.own(_1251.after(this,"_onItemChildrenChange",lang.hitch(this,function(_125d,_125e){array.forEach(_125e,function(child){var _125f=this._itemNodesMap[this.model.getIdentity(child)];if(child.expandOnAdd){this._expandNode(_125f[0]);}if(child.contentGroup&&child.ensurePersonalization&&child.hasAnyRoles&&!child.hasAnyRoles()){_125f[0].showPersonalizationSelector();}},this);}),true));},_setReadOnlyAttr:function(_1260){this._set("readOnly",_1260);if(this.dndController){this.dndController.isSource=!_1260;}},getItemType:function(item){if(!item.typeIdentifier){if(item.contentGroup!==undefined){return ["personalizationarea"];}else{return null;}}return this.accept;},checkItemAcceptance:function(_1261,_1262,_1263,copy){if(this.tree.readOnly){return false;}var _1264=_1253.getEnclosingWidget(_1261);var _1265=_1264.item;var _1266=true;_1262.forInSelectedItems(function(item){_1266=this.tree.model.checkItemAcceptance(_1265,item.data.item,_1263);},this);return _1266;},_onNodeMouseEnter:function(node){node.set("mouseHover",true);},_onNodeMouseLeave:function(node){node.set("mouseHover",false);},_createTreeNode:function(model){var node;if(model.item instanceof _1259){node=new _125b(model);}else{if(model.item instanceof _1258){node=new _125a(model);}else{node=this.inherited(arguments);}}node.set("contextMenu",this.contextMenu);node.set("dndData",model.item);return node;},onClick:function(item,node,e){if(node instanceof _125b){if(node.isExpanded){this._collapseNode(node);}else{this._expandNode(node);}}}});});},"epi-cms/contentediting/viewmodel/ContentBlockViewModel":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/string","dojo/topic","dojo/Deferred","dojo/when","dojo/promise/all","dojox/html/entities","epi","epi/dependency","./_ViewModelMixin","epi-cms/widget/viewmodel/ContentStatusViewModel","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize"],function(_1267,array,lang,_1268,topic,_1269,when,all,_126a,epi,_126b,_126c,_126d,_126e){return _1267([_126d,_126c],{label:null,store:null,hasSiblings:true,isVisible:true,settings:{displayOptionsAttributeName:"data-epi-content-display-option",contentGroupAttributeName:"data-contentgroup"},constructor:function(){this.roleIdentities=this.roleIdentities||[];this.attributes={};},postscript:function(){this.inherited(arguments);if(!this.store){var _126f=_126b.resolve("epi.storeregistry");this.store=_126f.get("epi.cms.visitorgroup");}this.set("label",this.name);this._reloadRoles();},serialize:function(){return {contentGroup:this.contentGroup,contentLink:this.contentLink,name:this.name,roleIdentities:this.roleIdentities,typeIdentifier:this.typeIdentifier,attributes:this.attributes};},equals:function(item){for(var prop in item){if(!epi.areEqual(this[prop],item[prop])){return false;}}return true;},isRoleSelected:function(_1270){if(!this.roleIdentities){return false;}return this.roleIdentities.indexOf(_1270)>-1;},hasAnyRoles:function(){if(!this.roleIdentities){return false;}return this.roleIdentities.length>0;},moveNext:function(){var index=this.parent.indexOf(this);this.parent.modify(function(){this.parent.move(this,index+1);},this);},movePrevious:function(){var index=this.parent.indexOf(this);this.parent.modify(function(){this.parent.move(this,index-1);},this);},moveOutsideGroup:function(){if(!this.contentGroup){return;}this.parent.modify(function(){this.parent.moveOutsideGroup(this);},this);},remove:function(){this.parent.modify(function(){this.parent.removeChild(this);},this);},personalize:function(){this.parent.modify(function(){this.parent.personalize(this);},this);},selectRole:function(_1271,_1272){this.roleIdentities=this.roleIdentities||[];var index=array.indexOf(this.roleIdentities,_1271);if(index>=0){if(!_1272){this.roleIdentities.splice(index,1);}}if(_1272){this.roleIdentities.push(_1271);}this.set("roleIdentities",this.roleIdentities);this._reloadRoles();},resetRoleIdentities:function(){this.set("visible",true);this.set("roleIdentities",null);},_displayOptionSetter:function(_1273){this.attributes[this.settings.displayOptionsAttributeName]=_1273;},_displayOptionGetter:function(){return this.attributes[this.settings.displayOptionsAttributeName];},_roleIdentitiesSetter:function(_1274){this.roleIdentities=_1274||[];this._reloadRoles();},_parentSetter:function(_1275){this.parent=_1275;this.set("contentGroup",this.parent.name);},_contentGroupSetter:function(_1276){this.contentGroup=_1276;this.attributes[this.settings.contentGroupAttributeName]=_1276;this._reloadRoles();},_reloadRoles:function(){if(!this.store){return;}var def=new _1269();var defs=array.map(this.roleIdentities,function(id){return when(this.store.get(id),function(_1277){return _1277;});},this);all(defs).then(lang.hitch(this,function(roles){this.set("roles",roles);def.resolve(roles);}),function(e){def.reject(e);});return def;},_hasSiblingsSetter:function(_1278){this.hasSiblings=_1278;this._updateRolesString();},_selectedSetter:function(_1279){this.selected=_1279;if(_1279){this.emit("selected",this);}},_updateRolesString:function(){if(!this.contentGroup||this.roles===undefined){this.set("rolesString","");return;}if(!this.hasAnyRoles()){if(this.hasSiblings){this.set("rolesString",_126e.everyoneelsesee);}else{this.set("rolesString",_126e.everyonesees);}return;}var _127a=array.map(this.roles,function(r){return "<em>"+_126a.encode(r.name)+"</em>";}).sort().join(", ");var names=_127a.replace(/, (?=[^,]+$)/," "+_126e.groupsand);var _127b="";if(this.roles.length>1){_127b=lang.replace(_126e.groupssee,{groupNames:names});}else{_127b=lang.replace(_126e.groupsees,{groupNamn:names});}this.set("rolesString",_127b);},_rolesSetter:function(roles){this.roles=roles;this._updateRolesString();}});});},"epi-cms/contentediting/viewmodel/_ViewModelMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Stateful","dojo/Evented","dijit/Destroyable"],function(array,_127c,_127d,_127e,_127f){return _127c([_127d,_127e,_127f],{modify:function(_1280,scope,_1281){this._isBeingModified=true;if(scope){_1280.apply(scope);}else{_1280();}this._isBeingModified=false;if(_1281||_1281===undefined){this.emit("changed");}},emit:function(type,event){if(type==="changed"&&this._isBeingModified){return;}this.inherited(arguments);}});});},"epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/viewmodel/_ContainerViewModel","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize"],function(array,_1282,lang,_1283,_1284){return _1282([_1283],{name:null,label:_1284.grouplabel,addChild:function(child,index){this.inherited(arguments,[child,index||0]);this._handles[child.id]=[child.on("selected",lang.hitch(this,"emit","selected",child)),child.on("changed",lang.hitch(this,"emit","changed"))];},serialize:function(){return array.map(this.getChildren(),function(child){return child.serialize();});},equals:function(item){return this.name===item.name;},moveNext:function(){var index=this.parent.indexOf(this);this.parent.modify(function(){this.parent.move(this,index+1);},this);},moveOutsideGroup:function(child){this.parent.moveOutsideGroup(child);},movePrevious:function(){var index=this.parent.indexOf(this);this.parent.modify(function(){this.parent.move(this,index-1);},this);},remove:function(){this.parent.modify(lang.hitch(this,function(){this.parent.removeChild(this);}));},_hash:function(child){return child.contentLink+"_"+Date.now();},_selectedSetter:function(_1285){this.selected=_1285;if(_1285){this.emit("selected",this);}},_visibleGetter:function(){return array.some(this._data,function(item){return item.get("visible");});}});});},"epi-cms/contentediting/viewmodel/_ContainerViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","./_ViewModelMixin"],function(array,_1286,_1287){return _1286([_1287],{constructor:function(){this._data=[];this._handles={};},addChild:function(child,index){child.set("parent",this);child.set("readOnly",this.readOnly);if(!child.id){child.id=this._hash(child);}if(typeof index=="number"){this._data.splice(index,0,child);}else{this._data.push(child);}this._emitChildrenChanged();},getChild:function(item){var _1288=this._data;for(var i=_1288.length-1;i>=0;i--){if(_1288[i].equals(item)){return _1288[i];}}return null;},getChildById:function(id){var _1289=this._data;for(var i=_1289.length-1;i>=0;i--){if(_1289[i].id===id){return _1289[i];}}return null;},getChildren:function(){return this._data;},removeChild:function(child,_128a){var index=this.indexOf(child),_128b=this._handles[child.id];if(index<0&&_128a){array.forEach(this.getChildren(),function(item){if(typeof item.removeChild==="function"){item.removeChild(child,_128a);}});return;}else{if(index<0){return;}}if(_128b){array.forEach(_128b,function(_128c){_128c.remove();});delete this._handles[child.id];}this._data.splice(index,1);this._emitChildrenChanged();},move:function(child,index){var _128d=this.indexOf(child);this._data.splice(_128d,1);this._data.splice(index,0,child);this._emitChildrenChanged();},indexOf:function(child){return this._data.indexOf(child);},_hash:function(child){},_readOnlySetter:function(_128e){this.readOnly=_128e;array.forEach(this.getChildren(),function(child){child.set("readOnly",_128e);},this);},_emitChildrenChanged:function(_128f){var _1290=this._data.length;array.forEach(this._data,function(child,index){child.set("canMoveNext",index<(_1290-1));child.set("canMovePrevious",index>0&&index<=(_1290-1));child.set("hasSiblings",_1290>1);});this.set("count",_1290||0);this.emit("childrenChanged",_128f?_128f:this);}});});},"epi-cms/contentediting/editors/_BlockTreeNode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/keys","dojo/dom-class","dijit/Tree","dijit/focus","dijit/_HasDropDown","epi-cms/widget/PersonalizationSelector","epi-cms/dgrid/formatters","./_ContentAreaTreeNodeMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.blockcontextmenu","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize","dojo/text!./templates/_BlockTreeNode.html"],function(_1291,lang,keys,_1292,Tree,_1293,_1294,_1295,_1296,_1297,_1298,_1299,_129a){return _1291([Tree._TreeNode,_1297,_1294],{templateString:_129a,_contextMenuClass:"epi-iconContextMenu",isExpandable:false,dropDownPosition:["before"],resources:lang.mixin(_1298,_1299),buildRendering:function(){this.inherited(arguments);this.dropDown=new _1295({model:this.item});this.own(this.dropDown);this.aroundNode=this.domNode;this.set("readOnly",this.item.readOnly);_1292.add(this.domNode,"epi-tree-mngr--block");var node=this.rolesNode;var icon=_1296.contentIcon(this.item.typeIdentifier);_1292.add(this.iconNode,icon);node.innerHTML=this.item.get("rolesString");this.own(this.item.watch("rolesString",lang.hitch(this,function(_129b,_129c,_129d){node.innerHTML=_129d;})));this.own(this.item.watch("readOnly",lang.hitch(this,function(){this.set("readOnly",this.item.readOnly);})));},setSelected:function(_129e,_129f){this.inherited(arguments);this.item.set("selected",_129e);_1292.toggle(this.iconNodeMenu,this._contextMenuClass,_129e);},showPersonalizationSelector:function(){if(this.readOnly){return;}this.item.set("ensurePersonalization",false);_1293.focus(this.labelNode);this.loadAndOpenDropDown();},focus:function(){this.labelNode.focus();},_onKey:function(e){if(this.dropDown&&this._opened&&e.keyCode==keys.ESCAPE){this.closeDropDown();}},_onKeyUp:function(){}});});},"epi-cms/widget/PersonalizationSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/when","dojox/html/entities","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/CheckedMenuItem","epi/dependency","epi/shell/_StatefulGetterSetterMixin","dojo/text!./templates/PersonalizationSelector.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize","dijit/Menu","epi/shell/widget/RadioMenuItem"],function(array,_12a0,lang,_12a1,when,_12a2,_12a3,_12a4,_12a5,_12a6,_12a7,_12a8,_12a9,_12aa){return _12a0([_12a3,_12a4,_12a5],{templateString:_12a9,model:null,resources:_12aa,postMixInProperties:function(){this.inherited(arguments);if(!this.store){var _12ab=_12a7.resolve("epi.storeregistry");this.store=_12ab.get("epi.cms.visitorgroup");}},postCreate:function(){this.inherited(arguments);this.own(this.rdEveryone.on("change",lang.hitch(this,"restoreDefault")),this.model.watch("roleIdentities",lang.hitch(this,function(){if(this.model.roleIdentities.length===0){this.restoreDefault();}})));when(this.store.query(),lang.hitch(this,function(_12ac){if(!this._destroyed){this.set("visitorGroups",_12ac);}}));},restoreDefault:function(){array.forEach(this.visitorGroupsMenu.getChildren(),function(item){item.set("checked",false);});this.rdEveryone.set("checked",true);},_setVisitorGroupsAttr:function(_12ad){this._set("visitorGroups",_12ad);if(!this.model.hasAnyRoles()){this.rdEveryone.set("checked",true);}array.forEach(_12ad,function(group){var item=new _12a6({label:_12a2.encode(group.name),visitorgroupId:group.id,checked:this.model.isRoleSelected(group.id)});this.own(item.watch("checked",lang.hitch(this,function(_12ae,_12af,_12b0){this.model.selectRole(group.id,_12b0);this.rdEveryone.set("checked",!this.model.hasAnyRoles());})));this.visitorGroupsMenu.addChild(item);},this);}});});},"url:epi-cms/widget/templates/PersonalizationSelector.html":"<div>\r\n    <div class=\"epi-dijitTooltipContainer\">\r\n        <div class=\"epi-invertedTooltip\">\r\n            <div class=\"epi-tooltipDialogTop\">\r\n                <span data-dojo-attach-point=\"header\">${resources.whocansee}</span>\r\n                <div data-dojo-attach-point=\"lastPublishedIcon\" class=\"dijitTooltipConnector\"></div>\r\n            </div>\r\n        </div>\r\n        <div class=\"epi-tooltipDialogContent--max-height\">\r\n            <div data-dojo-type=\"dijit/Menu\" data-dojo-attach-point=\"visitorGroupsMenu\" style=\"width:100%\"></div>\r\n            <div data-dojo-type=\"dijit/Menu\" data-dojo-attach-point=\"filterOptionsMenu\" style=\"width:100%\">\r\n                <div data-dojo-attach-point=\"rdEveryone\" data-dojo-type=\"epi/shell/widget/RadioMenuItem\" data-dojo-props=\"label:'${resources.everyone}', value: ''\"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>","epi-cms/contentediting/editors/_ContentAreaTreeNodeMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/focus","dojo/_base/event","dojo/dom-class"],function(_12b1,lang,on,_12b2,event,_12b3){return _12b1([],{destroy:function(){this._unBindContextMenu();this.inherited(arguments);},postCreate:function(){this.inherited(arguments);this.own(on(this.iconNodeMenu,"click",lang.hitch(this.labelNode,this.labelNode.focus)));},_unBindContextMenu:function(){if(this.contextMenu){this.contextMenu.unBindDomNode(this.iconNodeMenu);}},_setContextMenuAttr:function(_12b4){this._unBindContextMenu();this._set("contextMenu",_12b4);this.contextMenu.bindDomNode(this.iconNodeMenu);},_setMouseHoverAttr:function(hover){this._set("hover",hover);if(this.item.get("selected")){return;}_12b3.toggle(this.iconNodeMenu,this._contextMenuClass,this.hover);}});});},"url:epi-cms/contentediting/editors/templates/_BlockTreeNode.html":"<div class=\"dijitTreeNode\" role=\"presentation\">\r\n    <div class=\"epi-tree-mngr--node-wrapper\" data-dojo-attach-point=\"rowNode\">\r\n        <span data-dojo-attach-point=\"rolesNode, _buttonNode\" class=\"epi-tree-mngr--view-settings\"></span>\r\n        <div class=\"dijitTreeRow dijitInline\" role=\"presentation\">\r\n            <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                    <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon epi-pt-contextMenu\" title=\"${resources.settingstooltip}\" role=\"presentation\">&nbsp;</span>\r\n                </span>\r\n                <img src=\"${_blankGif}\" alt=\"\" data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"/>\r\n                <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n\r\n            </span>\r\n        </div>\r\n        <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/editors/_GroupTreeNode":function(){define(["dojo/aspect","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dijit/Tree","./_ContentAreaTreeNodeMixin","dojo/text!./templates/_GroupTreeNode.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea"],function(_12b5,array,_12b6,lang,_12b7,_12b8,Tree,_12b9,_12ba,_12bb){return _12b6([Tree._TreeNode,_12b9],{templateString:_12ba,_contextMenuClass:"epi-iconContextMenu",resources:_12bb,buildRendering:function(){this.inherited(arguments);_12b7.remove(this.iconNode,"dijitFolderClosed");this.own(_12b5.after(this,"expand",lang.hitch(this,function(_12bc){_12bc.then(lang.hitch(this,function(){if(this._destroyed){return;}_12b7.add(this.domNode,"epi-treeNodeOpen");array.forEach(this.getChildren(),function(_12bd){var child=_12bd.item;if(child.contentGroup&&child.ensurePersonalization&&child.hasAnyRoles&&!child.hasAnyRoles()){child.set("ensurePersonalization",false);_12bd.showPersonalizationSelector();}},this);}));return _12bc;})));this.own(_12b5.after(this,"collapse",lang.hitch(this,function(_12be){_12be.then(lang.hitch(this,function(){_12b7.remove(this.domNode,"epi-treeNodeOpen");}));return _12be;})));this.own(this.item.watch("readOnly",lang.hitch(this,function(){this._toggleDropMoreMessageNode();})));},postCreate:function(){this.inherited(arguments);this.own(this.item.watch("count",lang.hitch(this,function(_12bf,_12c0,_12c1){this.set("count",_12c1);})));if(this.item){this.set("count",this.item.count);}},setSelected:function(_12c2){this.inherited(arguments);this.item.set("selected",_12c2);_12b7.remove(this.rowNode,"dijitTreeRowSelected");_12b7.toggle(this.domNode,"dijitTreeRowSelected",_12c2);},_setCountAttr:function(count){this._set("count",count);this._toggleDropMoreMessageNode();},_toggleDropMoreMessageNode:function(){_12b8.set(this.dropMoreMessageNode,"display",!this.item.readOnly&&this.count===1?"":"none");}});});},"url:epi-cms/contentediting/editors/templates/_GroupTreeNode.html":"<div class=\"dijitTreeNode epi-tree-mngr--group\" role=\"presentation\" data-dojo-attach-point=\"rowNode\">\r\n    <div class=\"dijitTreeRow dijitInline epi-tree-mngr--group-header\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <img src=\"${_blankGif}\" alt=\"\" data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"/>\r\n        <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon epi-pt-contextMenu\" role=\"presentation\">&nbsp;</span>\r\n            </span>\r\n            <img src=\"${_blankGif}\" alt=\"\" data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon epi-iconUsers\" role=\"presentation\"/>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n        </span>\r\n    </div>\r\n    <hr />\r\n    <span data-dojo-attach-point=\"dropMoreMessageNode\" class=\"epi-tip epi-tip--block\">${resources.groupdropmoremessage}</span>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>\r\n","epi-cms/contentediting/editors/_ContentAreaTreeModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/tree/model","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel"],function(array,_12c3,lang,_12c4,_12c5,_12c6){return _12c3([_12c4],{model:null,root:{id:"root",name:"root"},constructor:function(_12c7){_12c3.safeMixin(this,_12c7);},pasteItem:function(_12c8,_12c9,_12ca,bCopy,_12cb,_12cc){var _12cd=_12c9.id==="root"?this.model:this.model.getChildById(_12c9.id);var child=_12cd.getChildById(_12c8.id);var _12ce=_12ca.id==="root"?this.model:this.model.getChildById(_12ca.id);if(child instanceof _12c5&&!child.hasAnyRoles()){child.set("ensurePersonalization",true);}if(_12cd===_12ce){this.model.modify(function(){_12ce.move(child,_12cb);});return;}this.model.modify(function(){_12cd.removeChild(child);_12ce.addChild(child,_12cb);});},deleteItem:function(item){this.model.modify(lang.hitch(this,function(){this.model.removeChild(item,true);}));},newItem:function(args,_12cf,_12d0,_12d1){if(args.dndData&&args.dndData.data){var _12d2=_12cf.id==="root"?this.model:this.model.getChildById(_12cf.id);var item=args.dndData.data;if(!(item instanceof _12c5)&&!(item instanceof _12c6)){item=new _12c5(item);}item.set("ensurePersonalization",true);this.model.modify(function(){_12d2.addChild(item,_12d0);});}},checkItemAcceptance:function(_12d3,item,_12d4){if(_12d4==="over"){if(!(_12d3 instanceof _12c6)){return false;}if(!(item instanceof _12c5)){return false;}}if(_12d3 instanceof _12c5&&item instanceof _12c6&&_12d3.contentGroup){return false;}return true;},getRoot:function(_12d5){_12d5(this.root);},getLabel:function(item){return item.label;},mayHaveChildren:function(item){if(typeof item.getChildren=="function"||item.id==="root"){return true;}return false;},getIdentity:function(item){return item.id;},getChildren:function(_12d6,_12d7){var _12d8;if(_12d6.id==="root"){_12d8=this.model.getChildren();_12d7(_12d8);this.model.on("childrenChanged",lang.hitch(this,function(index,_12d9,adds){this.onChildrenChange(this.root,this.model.getChildren());}));}else{var model=this.model.getChildById(_12d6.id);if(model&&typeof model.getChildren=="function"){_12d8=model.getChildren();_12d7(_12d8);model.on("childrenChanged",lang.hitch(this,function(index,_12da,adds){this.onChildrenChange(_12d6,model.getChildren());}));}else{_12d7([]);}}}});});},"dijit/tree/model":function(){define("dijit/tree/model",["dojo/_base/declare"],function(_12db){return _12db("dijit.tree.model",null,{destroy:function(){},getRoot:function(_12dc){},mayHaveChildren:function(item){},getChildren:function(_12dd,_12de){},isItem:function(_12df){},fetchItemByIdentity:function(_12e0){},getIdentity:function(item){},getLabel:function(item){},newItem:function(args,_12e1,_12e2,_12e3){},pasteItem:function(_12e4,_12e5,_12e6,bCopy,_12e7,_12e8){},onChange:function(item){},onChildrenChange:function(_12e9,_12ea){}});});},"epi-cms/contentediting/editors/_TextWithActionLinksMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/on","dojo/when","epi/shell/widget/TextWithActionLinks","epi/i18n!epi/cms/nls/episerver.cms.widget.overlay.blockarea"],function(_12eb,lang,_12ec,on,when,_12ed,_12ee){return _12eb(null,{textWithLinks:null,actionsResource:_12ee,isCreateLinkVisible:function(){return true;},getTemplateString:function(){var _12ef=new _12ec();var _12f0=this.actionsResource.emptyactions;when(this.isCreateLinkVisible(),function(_12f1){var _12f2=_12f1?_12f0.template:_12f0.templatewithoutcreate;_12ef.resolve({templateString:_12f2,actions:_12f0.actions});});return _12ef.promise;},setupActionLinks:function(_12f3){when(this.getTemplateString(),lang.hitch(this,function(_12f4){if(!_12f4){return;}this.textWithLinks=new _12ed({contentString:_12f4.templateString,namedActions:_12f4.actions});this.own(on(this.textWithLinks,"onActionClick",lang.hitch(this,this.executeAction)));if(_12f3){this.textWithLinks.placeAt(_12f3);}}));},executeAction:function(_12f5){}});});},"epi/shell/widget/TextWithActionLinks":function(){define("epi/shell/widget/TextWithActionLinks",["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/Evented","dojo/on","dojo/query","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/focus","dojox/html/entities"],function(array,_12f6,event,lang,_12f7,on,query,_12f8,_12f9,_12fa,_12fb){return _12f6([_12f8,_12f9,_12f7],{tagName:"span",templateString:"<{0}>{1}</{0}>",contentString:"",namedActions:null,_actionMap:null,_eventHandlers:null,postMixInProperties:function(){this.inherited(arguments);this._actionMap=[];this._eventHandlers=[];var _12fc={};var _12fd=this.contentString;var _12fe;var id=0;if(this.namedActions){for(var _12ff in this.namedActions){_12fe=_12fb.encode(this.namedActions[_12ff]);_12fc[_12ff]="<a class=\"epi-visibleLink\" href=\"#\" data-dojo-attach-point=\"action"+(id++)+"\">"+_12fe+"</a>";this._actionMap.push(_12ff);}_12fd=lang.replace(_12fd,_12fc);}this.templateString=lang.replace(this.templateString,[this.tagName,_12fd]);},postCreate:function(){this.inherited(arguments);array.forEach(this._actionMap,function(_1300,id){var link=this["action"+id];if(link){var _1301=on(link,"click",(function(_1302,_1303){return function(evt){event.stop(evt);_1302.emit("onActionClick",_1303);};})(this,_1300));this._eventHandlers.push(_1301);}},this);},destroy:function(){array.forEach(this._eventHandlers,function(_1304){_1304.remove();},this);this._eventHandlers=null;this.inherited(arguments);},focus:function(){var links=query("a",this.domNode);if(links.length>0){_12fa.focus(links[0]);}}});});},"epi-cms/contentediting/viewmodel/ContentAreaViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel","epi-cms/contentediting/viewmodel/_ContainerViewModel"],function(array,_1305,lang,_1306,_1307,_1308){return _1305([_1308],{selectedItem:null,addChild:function(child){if(!(child instanceof _1306)&&!(child instanceof _1307)){var model=new _1306(child);this.own(model.watch("roleIdentities",lang.hitch(this,function(){this.emit("changed");})));if(model.contentGroup){child=this._groups[model.contentGroup];if(!child){child=this._createGroup(model.contentGroup);}child.addChild(model);}else{child=model;}}else{child.set("contentGroup",null);if(child instanceof _1307){this.own(child.on("childrenChanged",lang.hitch(this,function(){this._emitChildrenChanged(child);if(child.getChildren().length===0){this.removeChild(child);}})));}else{if(child instanceof _1306){child.resetRoleIdentities();}}}this.own(child.on("changed",lang.hitch(this,function(){this.emit("changed");})));this.inherited(arguments);this._handles[child.id]=child.on("selected",lang.hitch(this,"set","selectedItem"));},moveVisible:function(child,_1309){var _130a=array.filter(this.getChildren(),function(item){return item.get("visible");}),delta=_1309?1:-1,_130b=array.indexOf(_130a,child)+delta,index=this.indexOf(_130a[_130b]);this.modify(lang.hitch(this,function(){this.move(child,index);}));},moveOutsideGroup:function(child){if(!child.contentGroup){return;}var group=this.getChild({name:child.contentGroup}),index=this.indexOf(group);this.modify(lang.hitch(this,function(){group.removeChild(child);this.addChild(child,index);}));},personalize:function(child){var index=this.indexOf(child);this.removeChild(child);var group=new _1307({name:"group_"+Date.now(),expandOnAdd:true});child.set("ensurePersonalization",true);group.addChild(child);this.addChild(group,index);},_valueGetter:function(){var value=[];array.forEach(this.getChildren(),function(child){value=value.concat(child.serialize());});return value;},_valueSetter:function(value){this._transformValueToModels(value);},_selectedItemSetter:function(value){if(this.selectedItem){this.selectedItem.set("selected",false);}this.selectedItem=value;},_transformValueToModels:function(value){this.modify(function(){var _130c=this.getChildren();for(var i=_130c.length-1;i>=0;i--){this.removeChild(_130c[i]);}this._groups={};array.forEach(value,function(child){var model=new _1306(child);this.own(model.watch("roleIdentities",lang.hitch(this,function(){this.emit("changed");})));if(model.contentGroup){var group=this._groups[model.contentGroup];if(!group){group=this._createGroup(model.contentGroup);this.addChild(group);}group.addChild(model,group.getChildren().length);}else{this.addChild(model);}},this);},this,false);},_createGroup:function(name){var group=new _1307({name:name});this._groups[name]=group;return group;},_hash:function(child){return (child.contentLink||child.name)+"_"+Date.now();}});});},"epi-cms/widget/overlay/Block":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/on","dojo/when","epi/shell/widget/overlay/_Base","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi-cms/widget/overlay/_OverlayItemInfoMixin","epi-cms/contentediting/command/ContentAreaCommands","epi-cms/ContentLanguageHelper","epi/i18n!epi/cms/nls/episerver.cms.widget.blockcontextmenu","dojo/text!../templates/Block.html","dijit/form/DropDownButton","epi/shell/widget/ContextMenu"],function(_130d,lang,_130e,_130f,on,when,_1310,_1311,_1312,_1313,_1314,_1315,_1316,_1317){return _130d([_1310,_1311,_1312,_1313],{templateString:_1317,res:_1316,_setMissingRendererAttr:function(value){_130e.toggle(this.domNode,"epi-overlay-item-missing-renderer",value);},buildRendering:function(){this.inherited(arguments);_130f.set(this.personalizedIcon,"display",this.viewModel.contentGroup?"":"none");},postCreate:function(){this.inherited(arguments);this._injectDynamicStyles();this.commandProvider=this.commandProvider||new _1314({model:this.viewModel});this.own(this.viewModel.watch("statusMessage",lang.hitch(this,function(_1318,_1319,_131a){when(_1315.getMissingLanguageMessage(this.viewModel.content),lang.hitch(this,function(_131b){_130f.set(this.warningIcon,"display",_131b?"":"none");}));_130f.set(this.iconsContainer,"display",this.viewModel.contentGroup||_131a?"":"none");})));this.viewModel.loadStatus();this.contextMenu.addProvider(this.commandProvider);if(this.blockInfo&&this.blockInfo.missingrenderer){this.set("missingRenderer",this.blockInfo.missingrenderer);}this.own(on(this.domNode,"click",lang.hitch(this.viewModel,"set","selected",true)),on(this.settingsButton,"click",lang.hitch(this,"_onContextMenuClick")));},_injectDynamicStyles:function(){var node=this.sourceItemNode,_131c=_130f.get(node,"display"),_131d=/inline|inline-block/.test(_131c)?"-inline":"";_130e.add(node,"epi-injected-minSize"+_131d);},_onContextMenuClick:function(){this.commandProvider.set("model",this.viewModel);this.viewModel.set("selected",true);return false;}});});},"epi-cms/widget/overlay/_OverlayItemInfoMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/on","dojo/when","dojo/mouse","epi/shell/TypeDescriptorManager","epi/shell/widget/overlay/OverlayItemInfo","epi-cms/widget/viewmodel/ContentStatusViewModel"],function(_131e,lang,_131f,on,when,mouse,_1320,_1321,_1322){return _131e(null,{disableTooltip:false,useIconOnBlock:false,postCreate:function(){this.own(this.viewModel.watch("contentStatus",lang.hitch(this,"_setupIcon")));this.own(this.viewModel.watch("statusMessage",lang.hitch(this,function(_1323,_1324,_1325){this.set("statusMessage",_1325);})));this.subscribe("/dnd/start",lang.hitch(this,function(){if(!this.disableTooltip){this._set("disableTooltip",true);this._showStatusMessage(false);}}));this.subscribe("/dnd/cancel",lang.hitch(this,function(){this._set("disableTooltip",false);}));this.subscribe("/dnd/drop",lang.hitch(this,function(){this._set("disableTooltip",false);}));var node=this.get("containerDomNode");if(node){this.own(on(node,mouse.enter,lang.hitch(this,function(){this._showStatusMessage(!this.get("disableTooltip"));})));this.own(on(node,mouse.leave,lang.hitch(this,function(){this._showStatusMessage(false);})));}this.inherited(arguments);},destroy:function(){if(this._overlayItemInfo){this._overlayItemInfo.destroyRecursive();this._overlayItemInfo=null;}this.inherited(arguments);},_setStatusIconAttr:function(_1326){var _1327=this.get("overlayItemInfo");if(!_1327){return;}_1327.set("statusIcon",_1326);},_setStatusMessageAttr:function(_1328){var _1329=this.get("overlayItemInfo");if(!_1329){return;}_1329.set("statusMessage",_1328);},_getContainerDomNodeAttr:function(){return this.containerDomNode||this.domNode;},_getOverlayItemInfoAttr:function(){if(!this._overlayItemInfo){this._overlayItemInfo=new _1321();_131f.place(this._overlayItemInfo.domNode,this.get("containerDomNode"));}return this._overlayItemInfo;},_setupIcon:function(){var _132a,_132b,_132c,_132d;_132a=this.get("overlayItemInfo");_132a.set("class",!this.viewModel.get("isVisibleOnSite")?"epi-overlay-content-invisible":"");var _132e=(this.viewModel.content&&this.viewModel.content.typeIdentifier)||this.viewModel.typeIdentifier;if(this.viewModel.get("isVisibleOnSite")&&_132e){_132b=_1320.getValue(_132e,"useIconOnBlock");_132c=_1320.getValue(_132e,"iconClass");_132d=_1320.getValue(_132e,"description");if(_132b){_132a.set("class","epi-overlay-content-info");this.set("useIconOnBlock",true);this.set("statusIcon",_132c);this.set("statusMessage",_132d);}}},_showStatusMessage:function(_132f){if(this._overlayItemInfo){this._overlayItemInfo.showStatusMessage(_132f);}}});});},"epi/shell/widget/overlay/OverlayItemInfo":function(){require({cache:{"url:epi/shell/widget/overlay/templates/OverlayItemInfo.html":"<span class=\"epi-overlay-content\">\r\n    <span data-dojo-attach-point=\"highlightArea\" class=\"epi-overlay-content-highlight-area\"></span>\r\n</span>"}});define("epi/shell/widget/overlay/OverlayItemInfo",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dijit/_WidgetBase","dijit/_TemplatedMixin","dojox/html/entities","epi/string","epi/shell/widget/Tooltip","dojo/text!./templates/OverlayItemInfo.html"],function(array,_1330,lang,_1331,_1332,_1333,_1334,_1335,_1336,_1337,_1338,_1339){return _1330([_1334,_1335],{templateString:_1339,postCreate:function(){this.inherited(arguments);this.showStatusMessage(false);},destroy:function(){this.inherited(arguments);this._destroyTooltip();},showStatusMessage:function(_133a){if(this._tooltip){_133a?this._tooltip.open(this.domNode):this._tooltip.close();}},_setStatusIconAttr:function(_133b){var _133c=lang.isArray(_133b);if(_133c){array.forEach(_133b,function(_133d){_1331.add(this.highlightArea,_133d);},this);}else{_1331.add(this.highlightArea,_133b);}},_setStatusMessageAttr:function(_133e){if(!_133e){return;}var _133f=lang.isArray(_133e);if(this._tooltip){if(_133f){this._tooltip.tooltipRows=_133e;}else{this._tooltip.label=_1336.encode(_133e);}}else{var _1340=_1332.create("div",{"class":"epi-overlay-content-tooltip",innerHTML:_1337.toHTML(_1336.encode(_133e))}),_1341=_133f?{tooltipRows:_133e}:{label:_1340.outerHTML};this._tooltip=new _1338(_1341);}},_destroyTooltip:function(){if(this._tooltip){this._tooltip.destroyRecursive();this._tooltip=null;}}});});},"url:epi/shell/widget/overlay/templates/OverlayItemInfo.html":"<span class=\"epi-overlay-content\">\r\n    <span data-dojo-attach-point=\"highlightArea\" class=\"epi-overlay-content-highlight-area\"></span>\r\n</span>","epi-cms/contentediting/command/ContentAreaCommands":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Stateful","./BlockRemove","./BlockEdit","./MoveVisibleToPrevious","./MoveVisibleToNext","./Personalize","./SelectDisplayOption"],function(array,_1342,_1343,_1344,Edit,_1345,_1346,_1347,_1348){return _1342([_1343],{commands:null,constructor:function(){this.commands=[new Edit(),new _1348(),new _1347(),new _1345(),new _1346(),new _1344()];},_modelSetter:function(model){this.model=model;array.forEach(this.commands,function(_1349){_1349.set("model",model);});}});});},"epi-cms/contentediting/command/BlockRemove":function(){define(["dojo/_base/declare","epi","epi-cms/contentediting/command/_ContentAreaCommand"],function(_134a,epi,_134b){return _134a([_134b],{name:"remove",label:epi.resources.action.remove,tooltip:epi.resources.action.remove,iconClass:"epi-iconTrash",_execute:function(){this.model.remove();},_onModelValueChange:function(){this.set("canExecute",!!this.model&&!this.model.get("readOnly"));}});});},"epi-cms/contentediting/command/_ContentAreaCommand":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/shell/command/_Command"],function(_134c,lang,_134d){return _134c([_134d],{_onModelChange:function(){var model=this.model;if(this._handles){for(var i=0;i<this._handles.length;i++){this._handles[i].remove();}}this._handles=[];if(!model){this.set("canExecute",false);return;}this._watch("readOnly",function(){this._onModelValueChange();},this);this._onModelValueChange();},_watch:function(_134e,_134f,scope){if(scope){this._handles.push(this.model.watch(_134e,lang.hitch(scope,_134f)));}else{this._handles.push(this.model.watch(_134e,_134f));}},_getItem:function(){return this.model.contentGroup?this.model.parent:this.model;},_getContainer:function(){var _1350=function(item){if(item.parent){return _1350(item.parent);}return item;};return _1350(this.model);},_onModelValueChange:function(){}});});},"epi-cms/contentediting/command/BlockEdit":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi","epi/dependency","epi-cms/contentediting/command/_ContentAreaCommand","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_1351,lang,topic,when,epi,_1352,_1353,_1354,_1355){return _1351([_1353],{name:"edit",label:epi.resources.action.edit,tooltip:epi.resources.action.edit,iconClass:"epi-iconPen",category:"menuWithSeparator",constructor:function(){this.contentActionSupport=this.contentActionSupport||_1354;var _1356=_1352.resolve("epi.storeregistry");this._store=_1356.get("epi.cms.content.light");},_execute:function(){var _1357=this.model.contentLink;topic.publish("/epi/shell/context/request",{uri:"epi.cms.contentdata:///"+_1357},{});},_onModelValueChange:function(){var item=this.model;if(!item||!item.contentLink){this.set("canExecute",false);return;}var _1358=item&&this._store.get(item.contentLink);when(_1358,lang.hitch(this,function(_1359){this.set("canExecute",_1359&&!_1359.isDeleted);if(_1359&&_1359.accessMask){if(this.contentActionSupport.hasAccess(_1359.accessMask,this.contentActionSupport.accessLevel[this.contentActionSupport.action.Edit])){this.set("label",_1355.edit);this.set("iconClass","epi-iconPen");}else{this.set("label",_1355.view);this.set("iconClass","epi-iconSearch");}}}));}});});},"epi-cms/contentediting/command/MoveVisibleToPrevious":function(){define(["dojo/_base/array","dojo/_base/declare","epi-cms/contentediting/command/MoveToPrevious"],function(array,_135a,_135b){return _135a([_135b],{_execute:function(){this._getContainer().moveVisible(this._getItem(),false);},_onModelChange:function(){this.inherited(arguments);this._watch("visible",function(){this._onModelValueChange();},this);},_onModelValueChange:function(){var _135c=array.filter(this._getContainer().getChildren(),function(child){return child.get("visible");}),index=array.indexOf(_135c,this._getItem());this.set("canExecute",index>0);}});});},"epi-cms/contentediting/command/MoveToPrevious":function(){define(["dojo/_base/declare","epi","epi-cms/contentediting/command/_ContentAreaCommand"],function(_135d,epi,_135e){return _135d([_135e],{label:epi.resources.action.moveup,tooltip:epi.resources.action.moveup,iconClass:"epi-iconUp",_execute:function(){this.model.movePrevious();},_onModelChange:function(){this.inherited(arguments);this._watch("canMovePrevious",function(){this._onModelValueChange();},this);},_onModelValueChange:function(){this.set("canExecute",this.model.get("canMovePrevious")&&!this.model.get("readOnly"));}});});},"epi-cms/contentediting/command/MoveVisibleToNext":function(){define(["dojo/_base/array","dojo/_base/declare","epi-cms/contentediting/command/MoveToNext"],function(array,_135f,_1360){return _135f([_1360],{_execute:function(){this._getContainer().moveVisible(this._getItem(),true);},_onModelChange:function(){this.inherited(arguments);this._watch("visible",function(){this._onModelValueChange();},this);},_onModelValueChange:function(){var _1361=array.filter(this._getContainer().getChildren(),function(child){return child.get("visible");}),index=array.indexOf(_1361,this._getItem());this.set("canExecute",index!=-1&&index<_1361.length-1);}});});},"epi-cms/contentediting/command/MoveToNext":function(){define(["dojo/_base/declare","epi","epi-cms/contentediting/command/_ContentAreaCommand"],function(_1362,epi,_1363){return _1362([_1363],{label:epi.resources.action.movedown,tooltip:epi.resources.action.movedown,iconClass:"epi-iconDown",category:"menuWithSeparator",_execute:function(){this.model.moveNext();},_onModelChange:function(){this.inherited(arguments);this._watch("canMoveNext",function(){this._onModelValueChange();},this);},_onModelValueChange:function(){this.set("canExecute",this.model.get("canMoveNext")&&!this.model.get("readOnly"));}});});},"epi-cms/contentediting/command/Personalize":function(){define(["dojo/_base/declare","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel","epi-cms/contentediting/command/_ContentAreaCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize"],function(_1364,_1365,_1366,_1367){return _1364([_1366],{label:_1367.label,iconClass:"epi-iconUsers",category:"menuWithSeparator",_execute:function(){if(!this.model.contentGroup){this.model.personalize();}},_onModelValueChange:function(){this.set("canExecute",!!this.model&&this.model.contentLink&&!this.model.contentGroup&&!this.model.get("readOnly"));}});});},"epi-cms/contentediting/command/SelectDisplayOption":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi-cms/contentediting/command/_ContentAreaCommand","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/widget/DisplayOptionSelector","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.displayoptions"],function(_1368,lang,when,_1369,_136a,_136b,_136c,_136d){return _1368([_136a],{label:_136d.label,category:"popup",_labelAutomatic:lang.replace(_136d.label,[_136d.automatic]),constructor:function(){this.popup=new _136c();},postscript:function(){this.inherited(arguments);if(!this.store){var _136e=_1369.resolve("epi.storeregistry");this.store=_136e.get("epi.cms.displayoptions");}when(this.store.get(),lang.hitch(this,function(_136f){this._setCommandAvailable(_136f);this.popup.set("displayOptions",_136f);}));},_onModelChange:function(){this.inherited(arguments);var _1370=this.popup.displayOptions,_1371=this.model.get("displayOption"),_1372=_1370&&_1370.length>0;_1372=_1372&&(this.model instanceof _136b);this._setCommandAvailable(_1370);if(!_1372){this.set("label",this._labelAutomatic);return;}this.popup.set("model",this.model);if(!_1371){this.set("label",this._labelAutomatic);}else{this._setLabel(_1371);}this._watch("displayOption",function(_1373,_1374,_1375){if(!_1375){this.set("label",this._labelAutomatic);}else{this._setLabel(_1375);}},this);},_setCommandAvailable:function(_1376){this.set("isAvailable",_1376&&_1376.length>0&&this.model instanceof _136b);},_setLabel:function(_1377){when(this.store.get(_1377),lang.hitch(this,function(_1378){this.set("label",lang.replace(_136d.label,[_1378.name]));}),lang.hitch(this,function(error){this.set("label",this._labelAutomatic);}));},_onModelValueChange:function(){this.set("canExecute",!!this.model&&this.model.contentLink&&!this.model.get("readOnly"));}});});},"epi-cms/widget/DisplayOptionSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","dijit/MenuSeparator","epi-cms/widget/SelectorMenuBase","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.displayoptions","epi/shell/widget/RadioMenuItem"],function(array,_1379,lang,when,_137a,_137b,_137c,_137d){return _1379([_137b],{model:null,headingText:_137c.title,_rdAutomatic:null,_separator:null,postCreate:function(){this.inherited(arguments);this.own(this._rdAutomatic=new _137d({label:_137c.automatic,value:""}));this.addChild(this._rdAutomatic);this._rdAutomatic.on("change",lang.hitch(this,this._restoreDefault));this.own(this._separator=new _137a());this.addChild(this._separator);},_restoreDefault:function(){this.model.modify(function(){this.model.set("displayOption",null);},this);},_setModelAttr:function(model){this._set("model",model);this._setup();},_setDisplayOptionsAttr:function(_137e){this._set("displayOptions",_137e);this._setup();},_setup:function(){if(!this.model||!this.displayOptions){return;}this._removeMenuItems();var _137f=this.model.get("displayOption");array.forEach(this.displayOptions,function(_1380){var item=new _137d({label:_1380.name,iconClass:_1380.iconClass,displayOptionId:_1380.id,checked:_137f===_1380.id});this.own(item.watch("checked",lang.hitch(this,function(_1381,_1382,_1383){if(!_1383){return;}this.model.modify(function(){this.model.set("displayOption",_1380.id);},this);this._rdAutomatic.set("checked",false);})));this.addChild(item);},this);this._rdAutomatic.set("checked",!_137f);},_removeMenuItems:function(){var items=this.getChildren();items.forEach(function(item){if(item===this._rdAutomatic||item==this._separator){return;}this.removeChild(item);item.destroy();},this);}});});},"epi-cms/widget/SelectorMenuBase":function(){define(["dojo/_base/declare","dojo/keys","dijit/_MenuBase","dojo/text!./templates/SelectorMenuBase.html"],function(_1384,keys,_1385,_1386){return _1384([_1385],{templateString:_1386,headingText:null,postCreate:function(){this.inherited(arguments);this.connectKeyNavHandlers([keys.UP_ARROW],[keys.DOWN_ARROW]);}});});},"url:epi-cms/widget/templates/SelectorMenuBase.html":"<div class=\"epi-DropDownMenu\">\r\n    <div class=\"epi-dijitTooltipContainer\">\r\n        <div class=\"epi-invertedTooltip\">\r\n            <div class=\"epi-tooltipDialogTop\">\r\n                <span>${headingText}</span>\r\n                <div class=\"dijitTooltipConnector\"></div>\r\n            </div>\r\n        </div>\r\n        <div class=\"epi-tooltipDialogContent--max-height\">\r\n            <table class=\"dijitReset dijitMenu epi-tooltipDialogMenu epi-menuInverted epi-mediumMenuItem\" style=\"width: 100%\" cellspacing=\"0\">\r\n\t            <tbody data-dojo-attach-point=\"containerNode\" ></tbody>\r\n            </table>\r\n        </div>\r\n    </div>\r\n</div>\r\n","url:epi-cms/widget/templates/Block.html":"<div class=\"dojoDndItem epi-overlay-block\">\r\n    <div data-dojo-attach-point=\"containerDomNode\"></div>\r\n    <span class=\"epi-personalized\" data-dojo-attach-point=\"iconsContainer\">\r\n        <span class=\"epi-overlayControls epi-mediumButton \">\r\n            <span class=\"dijitReset dijitInline dijitIcon epi-iconWarning\" data-dojo-attach-point=\"warningIcon\"></span>\r\n            <span class=\"dijitReset dijitInline dijitIcon epi-iconUsers\" data-dojo-attach-point=\"personalizedIcon\"></span>\r\n        </span>\r\n    </span>\r\n    <button class=\"epi-chromelessButton epi-overlayControls epi-settingsButton epi-mediumButton\" data-dojo-attach-point=\"settingsButton\" data-dojo-type=\"dijit/form/DropDownButton\" data-dojo-props=\"showLabel:false, title:'${res.settingstooltip}', iconClass:'epi-iconContextMenu'\">\r\n        <div data-dojo-attach-point=\"contextMenu\" data-dojo-type=\"epi/shell/widget/ContextMenu\"></div>\r\n    </button>\r\n</div>","epi-cms/contentediting/command/MoveOutsideGroup":function(){define(["dojo/_base/declare","epi-cms/contentediting/command/_ContentAreaCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize"],function(_1387,_1388,_1389){return _1387([_1388],{label:_1389.moveoutsidegroup,tooltip:_1389.moveoutsidegroup,iconClass:"",category:"menuWithSeparator",_execute:function(){this.model.moveOutsideGroup();},_onModelValueChange:function(){this.set("canExecute",this.model.contentGroup&&!this.model.get("readOnly"));}});});},"url:epi-cms/contentediting/editors/templates/ContentAreaEditor.html":"<div class=\"dijitInline\">\r\n    <div data-dojo-attach-point=\"treeNode\"></div>\r\n    <div data-dojo-attach-point=\"actionsContainer\" class=\"epi-content-area-actionscontainer\"></div>            \r\n</div>","epi-cms/contentediting/editors/ItemCollectionEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/event","dojo/aspect","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/dom-geometry","dojo/keys","dojo/on","dojo/query","dojo/topic","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","epi/shell/dgrid/Formatter","epi/shell/dnd/Target","epi/shell/widget/_ValueRequiredMixin","epi/shell/widget/ContextMenu","epi/shell/TypeDescriptorManager","dgrid/Keyboard","dgrid/OnDemandList","dgrid/Selection","epi-cms/dgrid/formatters","epi-cms/dgrid/DnD","epi-cms/extension/events","epi-cms/contentediting/command/NewItem","epi-cms/contentediting/viewmodel/ItemCollectionViewModel","epi-cms/contentediting/command/ItemCollectionCommands","epi-cms/widget/_HasChildDialogMixin","./_TextWithActionLinksMixin","dojo/text!./templates/ItemCollectionEditor.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.itemcollection"],function(array,_138a,lang,event,_138b,_138c,_138d,_138e,_138f,keys,on,query,topic,when,_1390,_1391,_1392,_1393,_1394,_1395,_1396,_1397,_1398,_1399,_139a,_139b,DnD,_139c,_139d,_139e,_139f,_13a0,_13a1,_13a2,_13a3){return _138a([_1392,_1390,_1391,_1395,_13a0,_13a1],{baseClass:"epi-item-collection-editor",multiple:true,res:_13a3,actionsResource:_13a3,templateString:_13a2,value:null,model:null,contextMenu:null,grid:null,commandProviderClass:_139f,_newItemCommand:null,_gridClass:_138a([_1399,_1393,_139a,DnD,_1398]),_mouseOverClass:"epi-dgrid-mouseover",actionsVisible:true,customTypeIdentifier:null,onChange:function(value){},postMixInProperties:function(){this.inherited(arguments);this.setupAllowedTypes();},postCreate:function(){this.inherited(arguments);this.set("model",new _139e(this.value,{itemModelType:this.itemModelType,readOnly:this.readOnly}));this.setupCommands();this.setupList();this.setupActionContainer();this.setupEvents();},startup:function(){this.inherited(arguments);this.contextMenu.startup();},setupActionContainer:function(){this.own(this._dndTarget=new _1394(this.actionsContainer,{accept:this.get("allowedDndTypes"),isSource:false,alwaysCopy:false,insertNodes:function(){}}));this.setupActionLinks(this.actionsContainer);this._displayActionsContainer();},setupCommands:function(){this.contextMenu=this.contextMenu||new _1396(),this.commandProvider=this.commandProvider||new this.commandProviderClass({model:this.model,commandOptions:this.commandOptions}),this.contextMenu.addProvider(this.commandProvider),this.own(this.contextMenu,this.commandProvider,this._newItemCommand=new _139d({"model":this.model,"dialogContentParams":this.commandOptions?this.commandOptions.dialogContentParams:{}}));},setupList:function(){var menu={hasMenu:!!this.contextMenu,settings:{title:this.res?this.res.menutooltip:""}},_13a4=function(data,_13a5,row){return "<div class='epi-rowIcon'><span class='dijitInline dijitIcon epi-iconLink epi-objectIcon'></span></div>"+data;},_13a6={selectionMode:"single",selectionEvents:"click,dgrid-cellfocusin",formatters:[_139b.contentItemFactory("text","title","typeIdentifier",menu),_13a4],dndParams:{copyOnly:true,accept:this.get("allowedDndTypes"),creator:lang.hitch(this,this._dndNodeCreator)},dndSourceTypes:this.customTypeIdentifier?[this.customTypeIdentifier]:[],consumer:this},_13a7=function(_13a8){var types=_1397.getAndConcatenateValues(this.dndSourceTypes,"dndTypes");if(types.length===0){types=this.dndSourceTypes;}return types;};if(this.customTypeIdentifier){_13a6._getDndType=_13a7;}this.own(this.grid=new this._gridClass(_13a6,this.itemsContainer));this.grid.set("showHeader",false);this.grid.renderArray(this.model.get("data"));this.grid.startup();},setupEvents:function(){var self=this,_13a9=on.selector;this.own(self.model.on("selectedItem",lang.hitch(this,this.focus)),self.model.on("initCompleted",lang.hitch(this,this._renderUI)),self.grid.on(_13a9(".dgrid-row",_139c.mouse.enter),function(e){_138c.add(self,self._mouseOverClass);}),self.grid.on(_13a9(".dgrid-row",_139c.mouse.leave),function(e){_138c.remove(self,self._mouseOverClass);}),self.grid.on("dgrid-select",function(e){self.model.set("selectedItem",e.rows[0].data);self.commandProvider.set("model",self.model);}),self.grid.on(_13a9(".dgrid-row",_139c.keys.del),function(e){self.model.remove();}),self.grid.on(_13a9(".dgrid-row",_139c.keys.shiftf10),function(e){self._showContextMenu(e);}),self.grid.on(_13a9(".dgrid-row",_139c.contextmenu),function(e){var item=self.grid.row(e).data;self.model.set("selectedItem",item);self.select(item);self._showContextMenu(e);}),self.grid.on(".epi-iconContextMenu:click",function(e){self.contextMenu.scheduleOpen(self,null,{x:e.pageX,y:e.pageY});}),_138b.around(self.grid.dndSource,"checkAcceptance",function(_13aa){return function(_13ab,nodes){return !self.readOnly&&_13aa.apply(self.grid.dndSource,arguments);};}),_138b.after(self.grid.dndSource,"onDropData",function(_13ac,_13ad,nodes,copy){var i;if(self.grid.dndSource===_13ad){for(i=0;i<nodes.length;i++){self.model.moveTo(self.grid.dndSource.getItem(nodes[i].id).data,self.grid.dndSource.current!=null?self.grid.dndSource.getItem(self.grid.dndSource.current.id).data:null,self.grid.dndSource.before);}}else{var item;for(i=0;i<_13ac.length;i++){when(_13ac[i].data,lang.hitch(this,function(_13ae){self.model.addTo(_13ae,self.grid.dndSource.current!=null?this.grid.dndSource.getItem(self.grid.dndSource.current.id).data:null,self.grid.dndSource.before);if(_13ad&&_13ad.grid&&_13ad.grid.consumer&&_13ad.grid.consumer!==self){_13ad.grid.consumer.model.set("selectedItem",_13ae);_13ad.grid.consumer.model.remove();}}));}}},true),_138b.around(self.grid,"insertRow",lang.hitch(self,self._aroundInsertRow)),this.model.on("changed",lang.hitch(this,function(){this.onChange(this.value=this.model.get("value")||[]);this._renderUI();this.focus();})),_138b.after(this.grid.dndSource,"onDndStart",lang.hitch(this,function(_13af,nodes,copy){var _13b0=this.grid.dndSource,_13b1=_13b0.accept&&_13b0.checkAcceptance(_13af,nodes);_138c[_13b1?"remove":"add"](this.container,"dojoDndTargetDisabled");}),true),_138b.after(this._dndTarget,"onDropData",lang.hitch(this,function(_13b2,_13b3,nodes,copy){var item;for(var i=0;i<_13b2.length;i++){when(_13b2[i].data,lang.hitch(this,function(_13b4){this.model.addTo(_13b4,null,false);if(_13b3&&_13b3.grid&&_13b3.grid.consumer&&_13b3.grid.consumer!==this){_13b3.grid.consumer.model.set("selectedItem",_13b4);_13b3.grid.consumer.model.remove();}}));}}),true));var _13b5=this.commandProvider.commands.concat(this._newItemCommand);_13b5.forEach(function(_13b6){this.own(_138b.after(_13b6,"onDialogOpen",function(){self.set("isShowingChildDialog",true);self.validate();}),_138b.after(_13b6,"onDialogHideComplete",function(){self.set("isShowingChildDialog",false);self.focus();}));},this);},executeAction:function(_13b7){if(_13b7==="createnewitem"){if(this._newItemCommand){this._newItemCommand.execute();}}},setupAllowedTypes:function(){var _13b8=this.itemConverterKey;this.allowedDndTypes=this.allowedDndTypes||[];if(_13b8){this.allowedDndTypes=this.allowedDndTypes.map(function(type){return type+"."+_13b8;});}if(this.customTypeIdentifier){this.allowedDndTypes.unshift(this.customTypeIdentifier);}},focus:function(){if(this.value&&this.value.length>0){this._focusManager.focus(this.container);if(this.model){var _13b9=this.model.get("selectedItem"),_13ba=this.model.getItemIndex(_13b9);if(_13b9){this.grid&&this.grid.focus(this.grid.row(_13ba).element);}}}else{this.textWithLinks.focus();}},select:function(item){this.grid.clearSelection();if(item){this.grid.select(this.model.getItemIndex(item));}},isValid:function(){return (!this.required||(this.model&&this.model.get("value").length>0));},_onBlur:function(){if(this.contextMenu&&this.contextMenu.isShowingNow){return;}this.inherited(arguments);},_setValueAttr:function(val){this._set("value",val);if(!val||!(val instanceof Array)){this._set("value",[]);}if(this._started){this.model?this.model.set("data",this.value):(this.model=new _139e(this.value,{readOnly:this.readOnly}));this._renderUI();}},_setReadOnlyAttr:function(_13bb){this._set("readOnly",_13bb);this._displayActionsContainer();if(this.model){this.model.set("readOnly",_13bb);}},_dndNodeCreator:function(item,hint){var _13bc=this.allowedDndTypes,node=_138d.create("div").appendChild(document.createTextNode(item.text));if(item.typeIdentifier){_13bc=_1397.getAndConcatenateValues(item.typeIdentifier,"dndTypes");}return {"node":node,"type":_13bc,"data":item};},_aroundInsertRow:function(_13bd){return lang.hitch(this,function(_13be,_13bf,_13c0,i,_13c1){var row=_13bd.apply(this.grid,arguments);var _13c2=this.model.get("selectedItem");if(_13c2&&_13c2.id===_13be.id){this.select(_13c2);}return row;});},_renderUI:function(){this.grid.refresh();this.grid.renderArray(this.model.get("data"));},_showContextMenu:function(e){var _13c3=this.model.get("selectedItem"),_13c4=this.model.getItemIndex(_13c3);if(_13c3){event.stop(e);this.contextMenu.scheduleOpen(this,null,_138f.position(query(".epi-iconContextMenu",this.grid.row(_13c4).element)[0],true));}},_displayActionsContainer:function(){_138e.set(this.actionsContainer,"display",this.readOnly||!this.actionsVisible?"none":"");}});});},"epi-cms/extension/events":function(){define(["dojo/_base/lang","dojo/keys","dojo/mouse","dojo/on"],function(lang,keys,mouse,on){function _13c5(e){return e.keyCode===keys.DELETE;};function _13c6(e){return e.shiftKey;};function isF10(e){return e.keyCode==keys.F10;};function _13c7(e){return _13c6(e)&&isF10(e);};function _13c8(e){return mouse.isLeft(e)||mouse.isMiddle(e)||mouse.isRight(e);};function _13c9(type,_13ca){var _13cb=function(node,_13cc){return on(node,type,function(evt){if(_13ca){return _13ca(evt,_13cc);}return _13cc.call(this,evt);});};return _13cb;};var _13cd={selector:on.selector,contextmenu:_13c9("contextmenu",function(e,_13ce){_13ce.call(this,e);}),keys:{shiftf10:_13c9("keydown",function(e,_13cf){if(_13c7(e)){_13cf.call(this,e);}}),del:_13c9("keydown",function(e,_13d0){if(_13c5(e)){_13d0.call(this,e);}}),contextmenu:_13c9("contextmenu",function(e,_13d1){if(_13c8(e)){return;}_13d1.call(this,e);})},mouse:lang.mixin({contextmenu:_13c9("contextmenu",function(e,_13d2){if(_13c8(e)){_13d2.call(this,e);}})},mouse)};return _13cd;});},"epi-cms/contentediting/command/NewItem":function(){define(["dojo/_base/declare","epi/shell/command/_Command","epi-cms/contentediting/command/_CommandWithDialogMixin","epi-cms/widget/LinkEditor"],function(_13d3,_13d4,_13d5,_13d6){return _13d3([_13d4,_13d5],{dialogContentClass:_13d6,dialogContentParams:null,defaultActionsVisible:false,_execute:function(){this.set("value",null);this.showDialog();},_onModelChange:function(){if(!this.model){this.set("canExecute",false);return;}this.set("canExecute",true);},onDialogExecute:function(){this.inherited(arguments);if(this.dialogContent){this.value=this.dialogContent.get("value");}if(this.model){this.model.addTo(this.value,null,null);}}});});},"epi-cms/contentediting/command/_CommandWithDialogMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/when","dijit/Destroyable","epi/shell/widget/dialog/Dialog","epi/i18n!epi/cms/nls/episerver.cms.widget.editlink","epi/i18n!epi/nls/episerver.shared"],function(array,_13d7,lang,_13d8,when,_13d9,_13da,_13db,_13dc){return _13d7([_13d9],{res:_13db,title:null,destroyOnHide:true,dialogClass:"epi-dialog-portrait",dialogContentClass:null,dialogParams:null,dialogContentParams:null,dialogContent:null,defaultActionsVisible:true,confirmActionText:_13dc.action.ok,cancelActionText:_13dc.action.cancel,value:null,_dialog:null,_getTitle:function(){return this.title||lang.replace(this.value?this.res.title.template.edit:this.res.title.template.create,this.res.title.action);},onDialogOpen:function(){},onDialogExecute:function(){},onDialogCancel:function(){},onDialogHideComplete:function(){},showDialog:function(){if(this.dialogContent){this.dialogContent.destroy();this.dialogContent=null;}this.dialogContent=new this.dialogContentClass(this.dialogContentParams);this._dialog=new _13da(lang.mixin({title:this._getTitle(),dialogClass:this.dialogClass,content:this.dialogContent,destroyOnHide:this.destroyOnHide,defaultActionsVisible:this.defaultActionsVisible,confirmActionText:this.confirmActionText,cancelActionText:this.cancelActionText},this.dialogParams));this._dialog.startup();this.dialogContent.set("value",this.value);this.own(this.dialogContent,_13d8.after(this._dialog,"onExecute",lang.hitch(this,this.onDialogExecute),true),_13d8.after(this._dialog,"onCancel",lang.hitch(this,this.onDialogCancel),true),_13d8.after(this._dialog,"onHide",lang.hitch(this,this.onDialogHideComplete),true),this._dialog.watch("open",lang.hitch(this,function(name,_13dd,_13de){if(!_13de){return;}this.onDialogOpen();})));this._dialog.show();}});});},"epi-cms/widget/LinkEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/dom-class","dijit/_CssStateMixin","epi","epi/dependency","epi/shell/widget/dialog/_DialogContentMixin","epi/shell/widget/FormContainer","epi/shell/widget/_ActionProviderWidget","epi/shell/widget/_ModelBindingMixin","epi-cms/widget/viewmodel/LinkEditorViewModel"],function(array,_13df,lang,_13e0,_13e1,_13e2,epi,_13e3,_13e4,_13e5,_13e6,_13e7,_13e8){return _13df([_13e5,_13e6,_13e4,_13e2,_13e7],{_metadataManager:null,modelClassName:_13e8,hiddenFields:[],postMixInProperties:function(){this.inherited(arguments);this.doLayout=false;this._metadataManager=this._metadataManager||_13e3.resolve("epi.shell.MetadataManager");if(!this.model&&this.modelClassName){var _13e9=_13df(this.modelClassName);this.model=new _13e9();}this._actions=[{name:"ok",label:epi.resources.action.ok,settings:{type:"button","class":"Salt"},action:lang.hitch(this,function(){if(this.validate()){this.executeDialog({action:"ok"});}})},{name:"delete",label:epi.resources.action.deletelabel,settings:{type:"button",disabled:true},action:lang.hitch(this,function(){array.forEach(this.form._getDescendantFormWidgets(),function(_13ea){_13ea.set("value","");},this);this.executeDialog({action:"delete"});})},{name:"cancel",label:epi.resources.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}];},postCreate:function(){if(this.modelType){this.metadata=this._metadataManager.getMetadataForType(this.modelType);}this.inherited(arguments);},_setValueAttr:function(value){this.inherited(arguments);this._handleActions(value);},onFormCreated:function(_13eb){array.forEach(this.form._getDescendantFormWidgets(),function(_13ec){if(this.hiddenFields&&this.hiddenFields.indexOf(_13ec.name)>-1){var _13ed=this._getAncestorNode(_13ec.domNode,"epi-formsRow");_13e0.set(_13ed,{display:"none"});_13ec.set("required",false);}},this);this._handleActions(this.value);},_handleActions:function(value){if(this.hasAction("delete")){this.setActionProperty("delete","disabled",this.model._isEmptyObject(value));}},getFormWidget:function(_13ee){var _13ef=array.filter(this.form._getDescendantFormWidgets(),function(_13f0){return _13f0&&_13f0.name===_13ee;},this);return _13ef?_13ef[0]:null;},_getAncestorNode:function(node,_13f1){var _13f2=node?node.parentNode:null;if(!_13f2){return null;}if(!_13e1.contains(_13f2,_13f1)){return this._getAncestorNode(_13f2,_13f1);}return _13f2;},getActions:function(){return this._actions;},isValidValue:function(){return array.every(this.form._getDescendantFormWidgets(),function(_13f3){return _13f3.get("required")?!!_13f3.get("value"):true;});}});});},"epi-cms/widget/viewmodel/LinkEditorViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/io-query","dojo/topic","dojo/Stateful","dojo/when","epi/shell/_StatefulGetterSetterMixin","epi/dependency"],function(array,_13f4,_13f5,lang,_13f6,topic,_13f7,when,_13f8,_13f9){return _13f4([_13f7,_13f8],{_isEmptyObject:function(obj){for(var i in obj){if(obj[i]&&obj[i]!==""){return false;}}return true;}});});},"epi-cms/contentediting/viewmodel/ItemCollectionViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","dojo/when","epi/dependency","epi/string","epi-cms/contentediting/viewmodel/LinkItemModel","epi-cms/contentediting/viewmodel/_ViewModelMixin"],function(array,_13fa,lang,_13fb,all,when,_13fc,_13fd,_13fe){return _13fa([_13fe],{_instanceId:null,_autoId:0,_selectedItem:null,_data:null,itemModelClass:null,itemModelType:null,constructor:function(data,_13ff){_13fa.safeMixin(this,_13ff);},postscript:function(data){var _1400=_13fd.slashName(this.itemModelType);require([_1400],lang.hitch(this,function(_1401){this.itemModelClass=_1401;this._instanceId=new Date().getTime();this._init(data);}));},moveNext:function(){this._move(1)&&this.emit("changed");},movePrevious:function(){this._move(-1)&&this.emit("changed");},remove:function(){if(!this.get("canEdit")){return;}var index=this.getItemIndex(this._selectedItem);this._data.splice(index,1);var len=this._data.length;this.set("selectedItem",this._data[index>=len?len-1:index]||null);this.emit("changed");},addTo:function(_1402,item,_1403){if(!_1402){return false;}if(this.getItemIndex(_1402)>=0){this.moveTo(_1402,null,false);this.emit("changed");}else{var self=this;when(self._createItemModel(_1402),function(model){if(!item){self._data.push(model);}else{var _1404=self.getItemIndex(item)+(_1403?0:1);self._data.splice(_1404,0,model);}self.emit("changed",{uiChanged:false});});}},moveTo:function(_1405,item,_1406){if(!_1405&&!this._selectedItem){return false;}this.set("selectedItem",_1405||this._selectedItem);var _1407=this.getItemIndex(this._selectedItem);this._data.splice(_1407,1);var _1408=(item?this.getItemIndex(item):(this._data.length-1))+(_1406?0:1);this._data.splice(_1408,0,this._selectedItem);this.emit("changed");},updateItemData:function(item){var index=this.getItemIndex(this._selectedItem);if(index<0){return;}var self=this;when(self._createItemModel(item),function(model){self._selectedItem=self._data[index]=model;self.emit("changed");});},swap:function(_1409,_140a){if(!this._data[_1409]||!this._data[_140a]){return false;}var temp=this._data[_1409];this._data[_1409]=this._data[_140a];this._data[_140a]=temp;return true;},getItemIndex:function(item){var index=-1;if(!item||!(item instanceof this.itemModelClass)){return index;}this._data.some(function(i,o){if(i.id===item.id){index=o;return true;}return false;},this);return index;},_init:function(data){var self=this,_140b;this.set("selectedItem",null);if(!(data instanceof Array)){this._data=[];}else{_140b=data.map(function(item){return this._createItemModel(item);},this);all(_140b).then(function(_140c){self._data=_140c;self.emit("initCompleted");});}},_generateItemId:function(){return this._instanceId+"_"+this._autoId++;},_createItemModel:function(item){var _140d=this.itemModelClass,id={id:this._generateItemId()},model,dfd=new _13fb();if(this.getItemIndex(item)>=0){return item;}if(item instanceof _140d){model=lang.mixin(lang.clone(item),id);}else{model=new _140d(lang.mixin(lang.clone(item),id));}when(model.parse(true),function(){dfd.resolve(model);});return dfd;},_move:function(_140e){var index=this.getItemIndex(this._selectedItem);if(index<0){return false;}return this.swap(index,index+_140e);},_canMoveNextGetter:function(){var index=this.getItemIndex(this._selectedItem);return !!(this._selectedItem&&index>=0&&index<(this._data.length-1));},_canMovePreviousGetter:function(){var index=this.getItemIndex(this._selectedItem);return !!(this._selectedItem&&index>0&&index<=(this._data.length-1));},_canEditGetter:function(){return !this.readOnly&&!!this._selectedItem;},_valueGetter:function(){return this._data.map(function(item){return item.serialize();},this);},_dataGetter:function(){return this._data||[];},_dataSetter:function(data){this._init(data);},_selectedItemGetter:function(){return this._selectedItem;},_selectedItemSetter:function(value){this._selectedItem=value;}});});},"epi-cms/contentediting/viewmodel/LinkItemModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/when","epi/Url","epi-cms/contentediting/viewmodel/CollectionItemModel","epi-cms/core/PermanentLinkHelper"],function(_140f,lang,_1410,when,Url,_1411,_1412){return _140f([_1411],{titleKey:"publicUrl",publicUrl:null,permanentUrl:null,_defaultDataStoreName:"epi.cms.content.light",serialize:function(){return {attributes:this.attributes,text:this.text,href:this.href||this.url,target:this.target||null,title:this.title||"",publicUrl:this.publicUrl,typeIdentifier:this.typeIdentifier||""};},_buildPublicUrl:function(url){var _1413=new Url(url);if(!_1413.scheme){_1413=new Url("",{"scheme":window.location.protocol,"authority":window.location.hostname,"path":url});}return _1413.toString();},_publicUrlGetter:function(){return this._buildPublicUrl(this.publicUrl||this.url||this.href);},_permanentUrlSetter:function(value){this.href=this.permanentUrl=value;},_onTryUpdateItemModel:function(){if(!this.typeIdentifier){return when(_1412.getContent(this.href),lang.hitch(this,function(_1414){if(_1414&&_1414.length>0){this._parseFromContent(_1414[0]);}}));}},_parseFromContent:function(_1415){if(_1415){this.typeIdentifier=_1415.typeIdentifier;this.publicUrl=this._buildPublicUrl(_1415.publicUrl);}}});});},"epi-cms/contentediting/viewmodel/CollectionItemModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/when","epi-cms/contentediting/viewmodel/_ViewModelMixin"],function(_1416,lang,_1417,when,_1418){return _1416([_1418],{id:null,textKey:"text",titleKey:null,iconTypeKey:"typeIdentifier",typeIdentifier:null,serialize:function(){},parse:function(_1419){if(_1419){return this._onTryUpdateItemModel();}return null;},_onTryUpdateItemModel:function(){},_getPropertyValue:function(_141a,_141b){if(_141a===_141b){return this[_141a];}return this.get(_141a);},_nameGetter:function(){return this._getPropertyValue(this.textKey,"name");},_textGetter:function(){return this._getPropertyValue(this.textKey,"text");},_titleGetter:function(){return this._getPropertyValue(this.titleKey,"title")||this._getPropertyValue(this.textKey,"title");},_iconTypeIdentifierGetter:function(){return this._getPropertyValue(this.iconTypeKey,"iconTypeIdentifier");}});});},"epi-cms/contentediting/command/ItemCollectionCommands":function(){define(["dojo/_base/declare","./BlockRemove","./ItemEdit","./MoveToPrevious","./MoveToNext","./ContentAreaCommands"],function(_141c,_141d,Edit,_141e,_141f,_1420){return _141c([_1420],{constructor:function(_1421){var _1422=_1421?_1421.commandOptions:{};this.commands=[new Edit(_1422),new _141e(_1422),new _141f(_1422),new _141d(_1422)];}});});},"epi-cms/contentediting/command/ItemEdit":function(){define(["dojo/_base/declare","epi-cms/contentediting/command/BlockEdit","epi-cms/contentediting/command/_CommandWithDialogMixin","epi-cms/widget/LinkEditor"],function(_1423,_1424,_1425,_1426){return _1423([_1424,_1425],{dialogContentClass:_1426,dialogContentParams:null,defaultActionsVisible:false,_execute:function(){this.showDialog();},_onModelValueChange:function(){if(!this.model){this.set("canExecute",false);return;}this.set("value",this.model.get("selectedItem"));this.set("canExecute",this.model.get("canEdit"));},onDialogExecute:function(_1427){this.inherited(arguments);if(this.dialogContent){this.value=this.dialogContent.get("value");}if(this.model){if(_1427&&_1427.action==="delete"){this.model.remove();}else{this.model.updateItemData(this.value);}}}});});},"url:epi-cms/contentediting/editors/templates/ItemCollectionEditor.html":"<div class=\"dijitInline\">\r\n    <!-- To reuse styling of content area we wrap into a div that include content area class -->\r\n    <div class=\"epi-content-area-editor\" data-dojo-attach-point=\"container\">\r\n        <div data-dojo-attach-point=\"itemsContainer\"></div>\r\n        <div data-dojo-attach-point=\"actionsContainer\" class=\"epi-content-area-actionscontainer\"></div>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/editors/PreviewableDateTimeEditor":function(){define(["dojo/_base/declare","dojo/dom-construct","epi/datetime","epi/shell/widget/DateTimeSelectorDropDown","epi-cms/contentediting/editors/_PreviewableEditor"],function(_1428,_1429,_142a,_142b,_142c){return _1428([_142c],{required:false,controlParams:["required"],buildRendering:function(){this.control=new _142b({datePackage:null});this.inherited(arguments);},onChange:function(val){this.set("labelValue",_142a.toUserFriendlyHtml(val));}});});},"epi-cms/contentediting/editors/_PreviewableEditor":function(){define(["dojo/_base/array","dojo/_base/event","dojo/_base/declare","dojo/_base/lang","dojo/on","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dijit","dijit/_CssStateMixin","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/ValidationTextBox","epi","dojo/text!./templates/_PreviewableEditor.html","dojox/html/entities"],function(array,event,_142d,lang,on,_142e,_142f,_1430,dijit,_1431,_1432,_1433,_1434,_1435,epi,_1436,_1437){return _142d([_1432,_1431,_1433,_1434],{value:null,changeLabel:epi.resources.action.change,templateString:_1436,control:null,controlParams:[],state:"",_setLabelValueAttr:{node:"labelNode",type:"innerHTML"},_setIsEmptyAttr:function(_1438){this._set("isEmpty",_1438);if(_1438){_142e.add(this.domNode,"epi-state-empty");}else{_142e.remove(this.domNode,"epi-state-empty");}},_setValueAttr:function(value){this._set("value",value);this.control.set("value",value);this.set("labelValue",typeof (value)=="string"?_1437.encode(value):value);this.set("isEmpty",!value);},onChange:function(val){},buildRendering:function(){this.inherited(arguments);if(!this.control){this.control=new _1435();this.own(this.control);}this.control.placeAt(this.domNode,"first");},postCreate:function(){this.inherited(arguments);this._setDisplay(false);this.connect(this.labelNode,"onclick",this._onChangeNodeClick);this.connect(this.changeNode,"onclick",this._onChangeNodeClick);this.connect(this.control,"onChange",this._onControlChange);this.connect(this.control,"onBlur",this._onControlBlur);this.own(this.control.watch("state",lang.hitch(this,function(name,old,value){this.set("state",value);})));this.control.validate();this.set("state",this.control.state);array.forEach(this.controlParams,function(_1439){this.control.set(_1439,this.get(_1439));},this);},onBlur:function(){this._setDisplay(false);},_setDisplay:function(_143a){if(!_143a&&!this.validate()){return;}this.showControl=_143a;_1430.set(this.labelNode,"display",_143a?"none":"");_1430.set(this.control.domNode,"display",_143a?"":"none");if(!this.readOnly){_1430.set(this.changeNode,"display",_143a?"none":"");}},focus:function(){if(this.showControl){this.control.focus();}else{this.changeNode.focus();}},_onControlChange:function(value){this._set("value",value);this.set("labelValue",typeof (value)=="string"?_1437.encode(value):value);this.set("isEmpty",!value);this.onChange(value);},_onControlBlur:function(){this._setDisplay(false);},_onChangeNodeClick:function(e){event.stop(e);this._setDisplay(true&&!this.readOnly);dijit.selectInputText(this.control.focusNode);},_setReadOnlyAttr:function(_143b){this._set("readOnly",_143b);_1430.set(this.changeNode,"display",this.readOnly?"none":"");this.readOnly&&this._setDisplay(false);},validate:function(){return this.control.validate();},isValid:function(){return this.control.isValid();},getErrorMessage:function(){return this.control.getErrorMessage();}});});},"url:epi-cms/contentediting/editors/templates/_PreviewableEditor.html":"<div class=\"dijitReset dijitInline epi-previewableTextBox-wrapper\">\r\n    <span data-dojo-attach-point=\"labelNode\" class=\"epi-previewableTextBox-text dojoxEllipsis dijitInline\"></span>\r\n    <a href=\"#\" data-dojo-attach-point=\"changeNode, focusNode\" class=\"epi-functionLink\">${changeLabel}</a>\r\n</div>\r\n","epi-cms/contentediting/editors/PreviewableTextEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dijit/form/ValidationTextBox","epi-cms/contentediting/editors/_PreviewableEditor"],function(array,_143c,_143d,_143e,_143f){return _143c([_143f],{required:false,intermediateChanges:false,controlParams:["intermediateChanges","regExp","required","invalidMessage"],_getRegExpAttr:function(){return this.regExp||"";}});});},"epi-cms/contentediting/editors/SelectionEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/on","dijit/form/Select","dijit/MenuItem","dijit/MenuSeparator","epi/shell/layout/_LayoutWidget","epi/shell/widget/_ValueRequiredMixin"],function(array,_1440,lang,_1441,on,_1442,_1443,_1444,_1445,_1446){return _1440([_1445,_1442,_1446],{actualValue:null,value:null,maxHeight:-1,postMixInProperties:function(){this.inherited(arguments);this.set("selections",this.selections);this.actualValue=this.value;},_setSelectionsAttr:function(_1447){this.set("options",array.map(_1447,function(item){return {label:item.text,value:item.value,selected:(item.value==this.value)||(!item.value&&!this.value)};},this));},postCreate:function(){this.inherited(arguments);on(this,"change",lang.hitch(this,function(){this.validate();this.onLayoutChanged();}));},_getMenuItemForOption:function(_1448){if(_1448.type=="separator"){return new _1444();}else{var click=lang.hitch(this,"_setValueAttr",_1448);var item=new _1443({option:_1448,label:_1448.label||this.emptyLabel,onClick:click,disabled:_1448.disabled||false});item.focusNode.setAttribute("role","listitem");return item;}},_getValueFromOpts:function(){var _1449=this.getOptions()||[];if(!this.multiple&&_1449.length){var _144a=array.filter(_1449,function(i){return i.selected;})[0];if(_144a&&_144a.value!==undefined){return _144a.value;}else{return null;}}else{if(this.multiple){return array.map(array.filter(_1449,function(i){return i.selected;}),function(i){return i.value;})||[];}}return "";},_setValueAttr:function(value,_144b){var _144c=this.getOptions()||[];if(value===null||typeof value!="object"){value=array.filter(_144c,function(i){return (i.value==value)||(!i.value&&!value);});}if(!lang.isArray(value)){value=[value];}if(this._onChangeActive){var _144d=value[0]?value[0].value:null;this._pendingOnChange=this.actualValue!==_144d;this.actualValue=_144d;}array.forEach(_144c,function(i){i.selected=array.some(value,function(v){return v.value===i.value;});});var val=array.map(value,function(i){return i.value;}),disp=array.map(value,function(i){return i.label;});this._set("value",this.multiple?val:val[0]);this._setDisplay(this.multiple?disp:disp[0]);this._updateSelection();this._handleOnChange(this.value,_144b);},_updateSelection:function(){this._set("value",this._getValueFromOpts());var value=this.value;if(value!==undefined){if(!lang.isArray(value)){value=[value];}array.forEach(this._getChildren(),function(child){var _144e=array.some(value,function(v){return child.option&&(v===child.option.value);});child.domNode.setAttribute("aria-selected",_144e);},this);}},validator:function(value,flags){}});});},"epi-cms/contentediting/editors/ShortcutEditor":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Button","epi","epi/shell/widget/dialog/Dialog","epi-cms/contentediting/ShortcutDialog","../viewmodel/ShortcutDialogViewModel","../../widget/_HasChildDialogMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.shortcutblockeditor","epi/i18n!epi/nls/episerver.shared"],function(_144f,lang,_1450,_1451,_1452,_1453,_1454,_1455,epi,_1456,_1457,_1458,_1459,_145a,_145b){return _144f([_1452,_1453,_1454,_1459],{templateString:"<div><span data-dojo-attach-point=\"shortcutTypeNameNode\" class=\"dijitInline\"></span> <div data-dojo-attach-point=\"button\" data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick:_showDialog\" >${resources.action.manage}</div></div>",resources:epi.resources,value:null,contentLink:null,metadata:null,watchHandlers:null,postCreate:function(){this.inherited(arguments);_1450.add(this.button.domNode,"epi-chromelessButton epi-chromelessLinkButton epi-functionLink");},destroy:function(){if(this.button){this.button.destroyRecursive();}this.inherited(arguments);},onChange:function(value){},_showDialog:function(){var _145c=new _1457({metadata:this.metadata,contentLink:this.contentLink,value:this.value,model:new _1458({contentLink:this.contentLink,contentName:this.contentName,value:this.value})});var _145d=new _1456({destroyOnHide:true,defaultActionsVisible:false,confirmActionText:_145b.action.save,content:_145c,title:_145a.dialogtitle});_145d.connect(_145d,"onExecute",lang.hitch(this,function(value){this.set("value",_145c.get("value"));this.onChange(_145c.get("value"));}));_145d.connect(_145d,"onHide",lang.hitch(this,function(){this.isShowingChildDialog=false;}));this.isShowingChildDialog=true;_145d.show();},_setShortcutTypeNameAttr:{node:"shortcutTypeNameNode",type:"innerHTML"},_setReadOnlyAttr:function(value){this._set("readOnly",value);_1451.set(this.button.domNode,"display",value?"none":"");},_setValueAttr:function(value){this._set("value",value);this.set("ShortcutTypeName",value&&value.pageShortcutTypeName?value.pageShortcutTypeName:"");}});});},"epi-cms/contentediting/ShortcutDialog":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/dom-class","dojo/html","dijit/_CssStateMixin","epi-cms/widget/Breadcrumb","epi/shell/widget/dialog/_DialogContentMixin","epi/shell/widget/FormContainer","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/_ActionProviderWidget","dojo/text!./templates/ShortcutDialog.html","epi/i18n!epi/cms/nls/episerver.cms.widget.shortcutblockeditor","epi/i18n!epi/nls/episerver.shared"],function(_145e,lang,_145f,_1460,html,_1461,_1462,_1463,_1464,_1465,_1466,_1467,res,_1468){return _145e([_1464,_1466,_1463,_1461,_1465],{templateString:_1467,contentLink:null,contentName:null,baseClass:"epi-statusIndicator",_externalLinkWidget:null,_shortcutLinkWidget:null,_shortcutTypeWidget:null,_targetFrameWidget:null,_switchLinkTypeFirstRunDone:false,modelBindingMap:{"contentLink":["contentLink"],"contentName":["contentName"],"enableSaveButton":["enableSaveButton"],"enableShortcutLink":["enableShortcutLink"],"enableExternalLink":["enableExternalLink"],"clearExternalLink":["clearExternalLink"],"enableOpenIn":["enableOpenIn"]},postMixInProperties:function(){this.inherited(arguments);this.doLayout=false;},_setContentLinkAttr:function(value){this.breadcrumb.set("contentLink",value);},_setContentNameAttr:{node:"contentNameNode",type:"innerHTML"},_setEnableSaveButtonAttr:function(value){if(this._actions&&this._actions.length){this.setActionProperty("save","disabled",!value);}},_setEnableShortcutLinkAttr:function(value){if(this._shortcutLinkWidget){this._shortcutLinkWidget.set("required",value);this._shortcutLinkWidget.set("state","");var _1469=this._getAncestorNode(this._shortcutLinkWidget.domNode,"epi-formsRow");if(_1469){_145f.set(_1469,"display",value?"":"none");}}},_setEnableExternalLinkAttr:function(value){if(this._externalLinkWidget){this._externalLinkWidget.set("required",value);this._externalLinkWidget.set("disabled",!value);this._externalLinkWidget._set("state","");var _146a=this._getAncestorNode(this._externalLinkWidget.domNode,"epi-formsRow");if(_146a){_145f.set(_146a,"display",value?"":"none");}}},_setEnableOpenInAttr:function(value){if(this._targetFrameWidget){var _146b=this._getAncestorNode(this._targetFrameWidget.domNode,"epi-formsRow");if(_146b){_145f.set(_146b,"display",value?"":"none");}}},_getAncestorNode:function(node,_146c){var _146d=node?node.parentNode:null;if(!_146d){return null;}if(!_1460.contains(_146d,_146c)){return this._getAncestorNode(_146d,_146c);}return _146d;},_setClearExternalLinkAttr:function(value){if(this._externalLinkWidget&&value&&!this._switchLinkTypeFirstRunDone){this._externalLinkWidget.reset();this._switchLinkTypeFirstRunDone=true;}},onFieldCreated:function(_146e,_146f){switch(_146e){case "pageLinkURL":this._externalLinkWidget=_146f;this._externalLinkWidget.set("invalidMessage",res.protocolwarning);this._externalLinkWidget.set("acceptUrl",true);this._externalLinkWidget.set("acceptMailAddress",true);this._externalLinkWidget.set("regExp","^[a-z][a-z\\d+-.]*:.*");this.connect(this._externalLinkWidget.domNode,"onkeyup",lang.hitch(this,function(evt){this.model.set("enableSaveButton",true);}));break;case "pageShortcutLink":this._shortcutLinkWidget=_146f;this._shortcutLinkWidget.set("contentLink",this.model.get("contentLink"));break;case "pageShortcutType":this._shortcutTypeWidget=_146f;break;case "pageTargetFrame":this._targetFrameWidget=_146f;break;default:break;}},onChange:function(value){this.inherited(arguments);this.model.set("intermediateValue",lang.mixin(value,{"pageShortcutTypeName":this._shortcutTypeWidget?this._shortcutTypeWidget.get("displayedValue"):""}));},_getValueAttr:function(){return this.model.get("intermediateValue");},getActions:function(){this._actions=[{name:"save",label:_1468.action.save,settings:{type:"button",disabled:true,"class":"Salt"},action:lang.hitch(this,function(){if(this.validate()){this.executeDialog();}else{this.model.set("enableSaveButton",false);}})},{name:"cancel",label:_1468.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}];return this._actions;}});});},"url:epi-cms/contentediting/templates/ShortcutDialog.html":"<div class=\"epi-formContainer\">\r\n    <div data-dojo-type=\"epi-cms/widget/Breadcrumb\" data-dojo-attach-point=\"breadcrumb\" data-dojo-props=\"showCurrentNode: false\"></div>\r\n    <h1 data-dojo-attach-point=\"contentNameNode\" class=\"epi-breadCrumbsCurrentItem dijitInline dojoxEllipsis\"></h1>\r\n    <div data-dojo-type=\"dijit/form/Form\" class=\"epi-formArea\" data-dojo-attach-point=\"form\"></div>\r\n</div>","epi-cms/contentediting/viewmodel/ShortcutDialogViewModel":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/string","epi-cms/contentediting/PageShortcutTypeSupport","epi/epi","epi/shell/_StatefulGetterSetterMixin"],function(_1470,_1471,_1472,_1473,epi,_1474){return _1470([_1471,_1474],{value:null,intermediateValue:null,savedValue:null,contentLink:null,contentName:null,enableSaveButton:null,enableShortcutLink:null,enableExternalLink:null,enableOpenIn:true,postscript:function(){this.inherited(arguments);this.set("savedValue",this.value);},_setIntermediateValueAttr:function(value){this._set("intermediateValue",value);this.set("enableSaveButton",!epi.areEqual(this.intermediateValue,this.savedValue));this.set("enableShortcutLink",value&&(value.pageShortcutType==_1473.pageShortcutTypes.Shortcut||value.pageShortcutType==_1473.pageShortcutTypes.FetchData)?true:false);this.set("enableExternalLink",value&&value.pageShortcutType==_1473.pageShortcutTypes.External?true:false);this.set("clearExternalLink",value&&value.pageShortcutType==_1473.pageShortcutTypes.External&&this.savedValue.pageShortcutType!=_1473.pageShortcutTypes.External?true:false);this.set("enableOpenIn",value&&!(value.pageShortcutType===_1473.pageShortcutTypes.FetchData||value.pageShortcutType===_1473.pageShortcutTypes.Inactive||value.pageShortcutType===_1473.pageShortcutTypes.Normal));},_setSavedValueAttr:function(value){this._set("savedValue",value);this.set("enableSaveButton",false);},save:function(){this.set("savedValue",this.intermediateValue);}});});},"epi-cms/contentediting/editors/TinyMCEEditor":function(){define(["dojo/_base/array","dojo/_base/config","dojo/_base/declare","dojo/_base/lang","dojo/_base/window","dojo/dom-style","dojo/dom-class","dojo/dom-construct","dojo/Deferred","dojo/keys","dojo/on","dojo/when","dojox/html/entities","dijit/_TemplatedMixin","dijit/focus","epi/dependency","epi/routes","epi/shell/conversion/ObjectConverterRegistry","epi/shell/dnd/Target","epi/shell/layout/_LayoutWidget","epi/shell/TypeDescriptorManager","epi/shell/widget/_ValueRequiredMixin","epi-cms/widget/_DndStateMixin","epi-cms/widget/_HasChildDialogMixin","epi-cms/widget/_UserResizable","epi/shell/widget/dialog/Alert","dojo/text!./templates/TinyMCEEditor.html","epi/i18n!epi/cms/nls/tinymce","epi/i18n!epi/cms/nls/episerver.tinymce"],function(array,_1475,_1476,lang,win,_1477,_1478,_1479,_147a,keys,on,when,_147b,_147c,_147d,_147e,_147f,_1480,_1481,_1482,_1483,_1484,_1485,_1486,_1487,Alert,_1488,_1489,_148a){return _1476([_1482,_147c,_1486,_1487,_1484,_1485],{baseClass:"epiTinyMCEEditor",width:null,height:null,value:null,intermediateChanges:true,templateString:_1488,settings:null,dirtyCheckInterval:2000,autoResizable:false,isResized:false,tinymceRendered:null,dropTarget:null,readOnly:false,_dirtyCheckTimeout:null,constructor:function(_148b){lang.mixin(this,_148b);this.tinymceRendered=new _147a();},postMixInProperties:function(){if(this.autoResizable){this.height=0;}},postCreate:function(){this.dropTarget=new _1481(this.dndOverlay,{accept:this.allowedDndTypes,createItemOnDrop:false,readOnly:this.readOnly});this.connect(this.dropTarget,"onDropData","onDropData");this.connect(this.dndOverlay,"onmousemove","_onOverlayMouseMove");this.inherited(arguments);},startup:function(){this.inherited(arguments);if(!window.tinymce){require(["tinymce/tiny_mce_src"],lang.hitch(this,function(){var res=lang.mixin({},_1489,_148a);tinymce.addI18n({en:res});when(this._loadLegacyPlugins(),lang.hitch(this,function(){this._initTinyMCE();}));}));}else{this._initTinyMCE();}},destroy:function(){this._cancelDirtyCheckInterval();this.inherited(arguments);},_loadLegacyPlugins:function(){var dfd=new _147a();this.legacyPlugins.forEach(function(_148c){var url=_147f.getActionPath({moduleArea:"Util",path:"Editor/tinymce/plugins/"+_148c+"/"+(_1475.isDebug?"editor_plugin_src.js":"editor_plugin.js")});tinymce.PluginManager.load(_148c,url);});tinymce.ScriptLoader.loadQueue(function(){dfd.resolve();});return dfd;},canAccept:function(){return !_1478.contains(this.dndOverlay,"dojoDndTargetDisabled");},_onDndStart:function(){_1477.set(this.dndOverlay,"display","block");this.inherited(arguments);},_onDndCancel:function(){_1477.set(this.dndOverlay,"display","none");this.inherited(arguments);},_onDndDrop:function(){_1477.set(this.dndOverlay,"display","none");this.inherited(arguments);},_onOverlayMouseMove:function(evt){this._dragPosition={x:evt.pageX,y:evt.pageY};},onDropData:function(_148d,_148e,nodes,copy){var _148f=_148d?(_148d.length?_148d[0]:_148d):null;if(!_148f){return;}if(this.onDropping){this.onDropping();}this._dropDataProcessor(_148f);},_dropDataProcessor:function(_1490){when(_1490.data,lang.hitch(this,function(model){var self=this,type=_1490.type,ed=this.getEditor();function _1491(url){ed.focus();ed.execCommand("CreateLink",false,url);};function _1492(html){ed.focus();if(ed.execCommand("mceInsertContent",false,html)){self._onChange(ed.getContent());}};function _1493(data){if(!ed.selection.isCollapsed()){_1491(data.url);}else{var _1494="<a href=\"{0}\" title=\"{1}\">{1}</a>";_1492(lang.replace(_1494,[data.url,_147b.encode(data.text)]));}};function _1495(data){var _1496="<img alt=\"{alt}\" src=\"{src}\" width=\"{width}\" height=\"{height}\" />";var _1497=_1479.create("img",{src:data.previewUrl||data.url,style:{display:"none;"}},win.body(),"last");on.once(_1497,"load",function(){_1492(lang.replace(_1496,this));_1479.destroy(_1497);});};if(type&&type.indexOf("link")!==-1){_1493(model);}else{if(type&&type.indexOf("fileurl")!==-1){_1495(model);}}var _1498=model.typeIdentifier;var _1499=_1483.getValue(_1498,"editorDropBehaviour");if(_1499){if(_1499===1){var html="<div data-contentlink=\""+model.contentLink+"\" data-classid=\"36f4349b-8093-492b-b616-05d8964e4c89\" class=\"mceNonEditable epi-contentfragment\">"+model.name+"</div>";_1492(html);return;}var _149a,_149b=_1483.getInheritanceChain(_1498);for(var i=0;i<_149b.length;i++){var _149c=_149b[i];_149a=_1480.getConverter(_149c,_149c+".link");if(_149a){break;}}if(!_149a){return;}when(_149a.convert(_1498,_1498+".link",model),lang.hitch(this,function(data){if(!data.url){var _149d=new Alert({description:_148a.notabletocreatelinkforpage});_149d.show();this.own(_149d);}else{switch(_1499){case 2:_1493(data);break;case 3:_1495(data);break;}}}));}}));_1477.set(this.dndOverlay,{"display":"none"});},focus:function(){this._set("state","Focused");var ed=this.getEditor();if(ed!=null){this._focused=true;ed._gainedFocus=true;when(this.tinymceRendered,lang.hitch(this,function(){tinymce.execCommand("mceFocus",false,this.editorFrame.id);}));}},validate:function(){return this.inherited(arguments);},getEditor:function(){return (typeof tinymce!=="undefined"&&tinymce!=null?tinymce.get(this.editorFrame.id):null);},getEditorDOM:function(){return tinymce.DOM;},resizeEditor:function(){var ed=this.getEditor(),_149e=0,_149f=(tinymce.isIE?document.body.clientHeight:window.innerHeight)-200,_14a0=(tinymce.isIE?document.body.clientWidth:window.innerWidth)-200,d=ed.getDoc(),b=d.body,DOM=tinymce.DOM,_14a1=this.height,_14a2=this.width,_14a3,_14a4;_14a3=b.scrollHeight;_14a4=b.scrollWidth;if(_14a3>_149e){_14a1=_14a3;}if(_14a3>_149f){_14a1=_149f;}if(_14a4>_14a0){_14a2=_14a0;}DOM.setStyle(ed.contentWindow.frameElement,"height",_14a1+80+"px");if(ed.getBody().scrollWidth!=ed.getBody().offsetWidth){var _14a5=20;if(_14a1==_149f){_14a5=30;}DOM.setStyle(ed.contentWindow.frameElement,"width",ed.getBody().scrollWidth+_14a5+"px");}this.isResized=true;},_setValueAttr:function(_14a6){var _14a7=(_14a6===null||_14a6===undefined);this._emptyRawValue=_14a7;this._rawValue=_14a6;this.value=_14a6;if(_14a7){this.value="";}var _14a8=function(t){var _14a9=t.getEditor();if(_14a9!=null){_14a9.setContent(t.value);}this._started&&setTimeout(lang.hitch(t,t.validate),0);};when(this.tinymceRendered,lang.hitch(this,function(){_14a8(this);}));},_getValueAttr:function(){return this._emptyRawValue?this._rawValue:this.value;},_updateTinySettings:function(){this.settings=lang.mixin(this.settings,{mode:"exact",width:this.width,height:this.height,setup:lang.hitch(this,this._setupEditorEventHandling),relative_urls:false,elements:this.editorFrame.id,readonly:this.readOnly});},_initTinyMCE:function(){this._updateTinySettings();if(this.legacyPlugins&&this.legacyPlugins.length>0){this.settings.plugins=this.settings.plugins+","+this.legacyPlugins.join(",");}this.editorFrame.value=this.value||"";if(typeof tinymce!=="undefined"){tinymce.dom.Event.domLoaded=true;tinymce.init(this.settings);this._startDirtyCheckInterval();}else{console.error("Couldn't initialize the editor");}},_isFullScreen:function(ed){return ed.editorId==="mce_fullscreen";},_onPostRender:function(ed){if(this.tinymceRendered.fired!==0){this.tinymceRendered.resolve();this.own(_147d.registerIframe(ed.contentWindow.frameElement));this._handlePopupMenu(ed);this._handlePopupWindow(ed);}},_handlePopupWindow:function(ed){ed.windowManager.onOpen.add(lang.hitch(this,function(){this.isShowingChildDialog=true;}));ed.windowManager.onClose.add(lang.hitch(this,function(){this.focus();this.isShowingChildDialog=this._isFullScreen(ed);if(!this.isShowingChildDialog&&this._hasPendingChanges){this._onChange(ed.getContent());}}));},_handlePopupMenu:function(ed){var _14aa;for(var i in ed.controlManager.controls){_14aa=ed.controlManager.controls[i];if(_14aa.onRenderMenu){_14aa.onRenderMenu.add(lang.hitch(this,function(_14ab,menu){menu.onShowMenu.add(lang.hitch(this,function(){this.isShowingChildDialog=true;}));menu.onHideMenu.add(lang.hitch(this,function(){this.isShowingChildDialog=this._isFullScreen(ed);}));}));}}},_setupEditorEventHandling:function(ed){ed.onInit.add(lang.hitch(this,function(){if(ed&&ed.selection){ed.selection.onSetContent.add(lang.hitch(this,function(_14ac,args){var isSet=args.set;if(isSet){this._onChange(ed.getContent());}}));}}));ed.onSetContent.add(lang.hitch(this,function(ed,e){this.onSetContent(ed);}));ed.onPostRender.add(lang.hitch(this,function(ed,e){this._onPostRender(ed);}));ed.onKeyUp.add(lang.hitch(this,function(ed,e){this.onKeyUp(ed,e);}));ed.onChange.add(lang.hitch(this,function(ed,e){this._onChange(ed.getContent());}));ed.onRemove.add(lang.hitch(this,function(ed){this.onEditorRemoved(ed);}));ed.onRedo.add(lang.hitch(this,function(ed,level){this.onRedo(ed,level);}));ed.onUndo.add(lang.hitch(this,function(ed,level){this.onUndo(ed,level);}));ed.onBeforeExecCommand.add(lang.hitch(this,function(ed,cmd,ui,val,a){if(cmd==="mceFullScreen"){this.isShowingChildDialog=!this._isFullScreen(ed);}}));},onSetContent:function(ed){if(this.isResized){this._hasPendingChanges=this.value!=ed.getContent()||this._hasPendingChanges;}if(this.autoResizable){setTimeout(lang.hitch(this,function(){this.resizeEditor();}),200);}else{if(!this.isResized){this.isResized=true;}}this.onLayoutChanged();},onEditorRemoved:function(ed){},_isMetaKey:function(e){if(e.keyCode==keys.CTRL||e.keyCode==keys.ALT||e.keyCode==keys.SHIFT||e.keyCode==keys.META){return true;}return false;},onKeyUp:function(_14ad,e){if(_14ad){if(!tinymce.VK.metaKeyPressed(e)&&!this._isMetaKey(e)){this._hasPendingChanges=_14ad.undoManager.typing;}}},_onChange:function(val){this.value=val;this._emptyRawValue=false;if(this.validate()){this._hasPendingChanges=false;this.onChange(this.value);}},onChange:function(val){},_stopEditing:function(){this._focused=false;if(this.get("state")==="Focused"){this._set("state","");}this.displayMessage(null);var ed=this.getEditor();if(ed&&ed.undoManager&&ed.undoManager.typing){ed.undoManager.typing=0;ed.undoManager.add();}if(this._hasPendingChanges){var val=ed.getContent();if(!this.intermediateChanges){this._onChange(val);}else{this.value=val;this._emptyRawValue=false;}}},_onBlur:function(){this._stopEditing();this.inherited(arguments);},_cancelDirtyCheckInterval:function(){if(this._dirtyCheckTimeout){clearTimeout(this._dirtyCheckTimeout);this._dirtyCheckTimeout=null;}},_startDirtyCheckInterval:function(){if(this._destroyed||!this.intermediateChanges){return;}this._cancelDirtyCheckInterval();this._dirtyCheck();this._dirtyCheckTimeout=setTimeout(lang.hitch(this,this._startDirtyCheckInterval),this.dirtyCheckInterval);},_dirtyCheck:function(){var ed=this.getEditor();if(ed){if(this._hasPendingChanges){this._onChange(ed.getContent());}}},onRedo:function(ed,level){this._hasPendingChanges=true;},onUndo:function(ed,level){this._hasPendingChanges=true;}});});},"epi-cms/widget/_DndStateMixin":function(){define(["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/aspect","dojo/dom-class"],function(dojo,array,_14ae,lang,_14af,_14b0,_14b1){return _14ae([],{baseDndStateClass:"epi-dropTarget",dndStateClass:null,dropTarget:null,_aspectAfterHandler:null,postCreate:function(){this.subscribe("/dnd/start","_onDndStart");this.subscribe("/dnd/cancel","_onDndCancel");this.subscribe("/dnd/drop","_onDndDrop");if(this.dropTarget){this._aspectAfterHandler=_14b0.after(this.dropTarget,"onDndStart",lang.hitch(this,"_onAfterDndStart"));}},_getDndStateClassAttr:function(){var _14b2=this.canAccept()?"Enabled":"Disabled";this.dndStateClass=this.baseDndStateClass+_14b2;return this.dndStateClass;},canAccept:function(){return false;},_onDndStart:function(){if(!this.dropTarget){_14b1.add(this.domNode,this.get("DndStateClass"));}},_onAfterDndStart:function(){_14b1.add(this.domNode,this.get("DndStateClass"));},_onDndCancel:function(){_14b1.remove(this.domNode,this.dndStateClass);},_onDndDrop:function(){_14b1.remove(this.domNode,this.dndStateClass);},destroy:function(){this.inherited(arguments);if(this._aspectAfterHandler){this._aspectAfterHandler.remove();this._aspectAfterHandler=null;}}});});},"epi-cms/widget/_UserResizable":function(){define(["epi","dojo"],function(epi,dojo){return dojo.declare(null,{onResizeStart:function(){},onResizeStop:function(){}});});},"url:epi-cms/contentediting/editors/templates/TinyMCEEditor.html":"<div id=\"widget_${id}\">\r\n    <div style=\"display: inline-block\" data-dojo-attach-point=\"stateNode, tooltipNode\">\r\n        <textarea data-dojo-attach-point=\"editorFrame\" id=\"${id}_editorFrame\" style=\"border: none;\"></textarea>\r\n    </div>\r\n    <div data-dojo-attach-point=\"dndOverlay\" style=\"background: rgba(0, 0, 0, 0.01); position: absolute; left: 0; top: 0; right: 0; bottom: 0; display: none\"></div>\r\n</div>\r\n","epi-cms/contentediting/editors/TinyMCEInlineEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/aspect","dojo/on","dojo/sniff","epi/string","epi-cms/contentediting/_HasFloatingComponent","epi-cms/contentediting/editors/TinyMCEEditor","dojo/text!./templates/TinyMCEInlineEditor.html"],function(array,_14b3,lang,dom,_14b4,_14b5,_14b6,_14b7,on,sniff,_14b8,_14b9,_14ba,_14bb){return _14b3([_14b9,_14ba],{baseClass:"epiTinyMCEInlineEditor",autoResizable:true,templateString:_14bb,inlineSettings:null,supportCustomDnd:true,_lastRng:null,_maxCheckRenderedTime:10,_editorIframe:null,onEditorBlur:function(evt){this._stopEditing();},onEditorResizing:function(_14bc){},onEditorResized:function(_14bd){},isEditing:function(){return this.domNode&&_14b6.get(this.domNode,"display").toLowerCase()!=="none";},startup:function(){this._checkingTime=0;if(this._started){return;}this.inherited(arguments);if(!this.ready){return;}this.own(this.watch("state",lang.hitch(this,function(name,_14be,_14bf){on.emit(this.domNode,"editorstatechanged",_14bf);})));},destroy:function(){this._clearLocalDefers();this._externalToolbar=this._toolbarSizeBox=this._toolbarRelativeContainer=this._toolbarRefContainer=null;this._latestButtonIds=this._editorIframe=this._toolbarFinishRender=null;this._lastRng=null;this.inherited(arguments);},focus:function(){this.inherited(arguments);var _14c0=this.getEditor();if(!_14c0){return;}_14c0.selection.setRng(this._lastRng||_14c0.selection.getRng());this.resizeEditor();},resizeEditor:function(){if(_14b6.get(this.containerNode,"display")=="none"){this.onEditorResized();return;}var _14c1=this.getEditor(),style={"height":"auto"},_14c2=this._getEditorIframe();_14b6.set(_14c2,style);style.height=_14c1.getBody().parentNode.scrollHeight+"px";this.onEditorResizing({"style":style});_14b6.set(_14c2,style);this.onEditorResized(lang.hitch(this,this._floatToolbar));},_onBlur:function(){},_updateTinySettings:function(){this.inherited(arguments);this.settings.width=this.settings.height="100%";this.settings=lang.mixin(this.settings,this.inlineSettings);},_setupEditorEventHandling:function(_14c3){this.inherited(arguments);this._disableSetTopStyle();this._appendEditorResizeHandler(_14c3);this._appendEditorFloatToolbarHandler(_14c3);sniff("ie")&&_14c3.onNodeChange.add(lang.hitch(this,function(_14c4){this._lastRng=_14c4.selection.getRng();}));},_clearLocalDefers:function(){this._deferToolbarFullSize&&this._deferToolbarFullSize.remove();this._deferOnKeyUp&&this._deferOnKeyUp.remove();},_appendEditorResizeHandler:function(_14c5){var _14c6=lang.hitch(this,this.resizeEditor);_14c5.onChange.add(_14c6);_14c5.onSetContent.add(_14c6);_14c5.onPaste.add(_14c6);_14c5.onPostRender.add(_14c6);_14c5.onKeyUp.add(lang.hitch(this,function(){this._clearLocalDefers();this._deferOnKeyUp=this.defer(_14c6,10);}));_14c5.onInit.add(lang.hitch(this,function(ed){if(this._isFullScreen(ed)){_14b4.remove(ed.getBody(),this.settings.body_class);}}));},_appendEditorFloatToolbarHandler:function(_14c7){_14c7.onInit.add(lang.hitch(this,this._showEditorToolbar));_14c7.onActivate.add(lang.hitch(this,this._floatToolbar));_14c7.onMouseUp.add(lang.hitch(this,this._floatToolbar));},_showEditorToolbar:function(_14c8){if(!_14c8){return;}this.focus();_14c8.dom.show(this._getExternalToolbar());this._floatToolbar();},_disableSetTopStyle:function(){this.own(_14b7.before(this.getEditorDOM(),"setStyle",lang.hitch(this,function(n,na,v){if(n==this._getExternalToolbar()&&na==="top"){return [];}return;})));},_floatToolbar:function(){this._clearLocalDefers();if(!this._getExternalToolbar()){return;}if(!this._isToolbarRendered()){this._deferToolbarFullSize=this.defer(this._floatToolbar,100);return;}this.onComponentFloat(this._getComponentFloatInfo());},_getComponentFloatInfo:function(){return {"componentInfo":{"component":this._getExternalToolbar(),"componentSizeBox":lang.hitch(this,function(){return this._toolbarSizeBox||(this._toolbarSizeBox=dom.byId(this.editorFrame.id+"_tblext"));})(),"relativeContainer":lang.hitch(this,function(){return this._toolbarRelativeContainer||(this._toolbarRelativeContainer=this._getExternalToolbar().parentNode);})(),"refContainer":lang.hitch(this,function(){return this._toolbarRefContainer||(this._toolbarRefContainer=dom.byId(this.editorFrame.id+"_parent"));})()},"floatingInfo":{"refreshPosition":false}};},_isToolbarRendered:function(){if(this._checkingTime>this._maxCheckRenderedTime){return true;}this._checkingTime++;var _14c9=null,_14ca=0;return this._toolbarFinishRender||(this._toolbarFinishRender=this._getToolbarLatestButtonIds().every(function(_14cb){_14c9=dom.byId(this.editorFrame.id+"_"+_14cb);_14ca=_14c9&&_14b5.position(_14c9).w;return _14ca!==0;},this));},_getToolbarLatestButtonIds:function(){if(this._latestButtonIds){return this._latestButtonIds;}this._latestButtonIds=[];var _14cc=null;for(var _14cd in this.settings){if(_14cd.toLowerCase().indexOf("theme_advanced_button")!=-1){_14cc=this.settings[_14cd].split(",").pop();if(!_14b8.isNullOrEmpty(_14cc)){this._latestButtonIds.push(_14cc);}}}return this._latestButtonIds;},_getExternalToolbar:function(){return this._externalToolbar||(this._externalToolbar=dom.byId(this.editorFrame.id+"_external"));},_getEditorIframe:function(){return this._editorIframe||(this._editorIframe=dom.byId(this.editorFrame.id+"_ifr"));}});});},"epi-cms/contentediting/_HasFloatingComponent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/dom-style"],function(_14ce,lang,_14cf,_14d0){return _14ce(null,{componentGutter:7,_floatingComponentSize:null,_floatingComponent:null,_floatingComponentSizeBox:null,_floatingRelativeContainer:null,_floatingRefContainer:null,onComponentFloat:function(_14d1){this._floatingComponent=_14d1.componentInfo.component;this._floatingComponentSizeBox=_14d1.componentInfo.componentSizeBox;this._floatingRelativeContainer=_14d1.componentInfo.relativeContainer;this._floatingRefContainer=_14d1.componentInfo.refContainer;},getComponentInfo:function(){return {"component":this._floatingComponent,"componentSize":this._getFloatingComponentSize(),"relativeContainer":this._floatingRelativeContainer,"refContainer":this._floatingRefContainer};},destroy:function(){this._floatingComponentSizeBox=this._floatingComponent=this._floatingRelativeContainer=this._floatingRefContainer=null;this._floatingComponentSize=null;this.inherited(arguments);},_getFloatingComponentSize:function(){if(this._floatingComponentSize){return this._floatingComponentSize;}var _14d2=_14cf.getMarginBox(this._floatingComponentSizeBox);return this._floatingComponentSize={"height":parseInt(_14d2.h,10)+this.componentGutter,"width":parseInt(_14d2.w,10)};}});});},"url:epi-cms/contentediting/editors/templates/TinyMCEInlineEditor.html":"<div id=\"widget_${id}\" style=\"position: relative; overflow: visible;\">\r\n    <div data-dojo-attach-point=\"stateNode, tooltipNode\">\r\n        <textarea data-dojo-attach-point=\"editorFrame\" id=\"${id}_editorFrame\" style=\"border: none; visibility: hidden; position: absolute; top:0; left:0; bottom:0; right:0;\"></textarea>\r\n    </div>\r\n    <div data-dojo-attach-point=\"dndOverlay\" style=\"background: rgba(0, 0, 0, 0.01); position: absolute; left: 0; top: 0; right: 0; bottom: 0; display: none\"></div>\r\n</div>\r\n","epi-cms/contentediting/EditToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/DeferredList","dojo/dom-class","dojo/topic","dojo/when","dojox/html/ellipsis","epi","epi/dependency","epi/shell/widget/ToolbarSet","epi/shell/command/withConfirmation","epi-cms/contentediting/command/Editing","epi-cms/contentediting/viewmodel/EditActionPanelViewModel","epi-cms/contentediting/StandardToolbar","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu","epi-cms/widget/NotificationStatusBar","epi-cms/contentediting/EditActionPanel"],function(_14d3,lang,array,_14d4,_14d5,topic,when,_14d6,epi,_14d7,_14d8,_14d9,_14da,_14db,_14dc,res,_14dd){return _14d3([_14dc],{res:res,_editActionViewModel:null,_commands:null,_revertToPublished:null,postMixInProperties:function(){this.inherited(arguments);this._commands=_14da;this._revertToPublished=_14d9(this._commands.revertToPublished,null,{title:_14dd.reverttopublishconfirmation.dialogtitle,heading:_14dd.reverttopublishconfirmation.confirmquestion,description:_14dd.reverttopublishconfirmation.description});this._commands.revertToPublished.watch("canExecute",lang.hitch(this,function(){this.setItemProperty(this._commands.revertToPublished.name,"disabled",!this._commands.revertToPublished.canExecute);}));this._editActionViewModel=new _14db();this.own(this._editActionViewModel);},resize:function(_14de){this.inherited(arguments);if(_14de){_14d5.toggle(this.domNode,"epi-editToolbarNarrow",_14de.w<620);_14d5.toggle(this.domNode,"epi-editToolbarMedium",_14de.w>=620&&_14de.w<1000);this._editActionViewModel.set("expanded",_14de.w>=1000);}},setupChildren:function(){var _14df=[{parent:"center",name:"autosave",label:this.res.autosave.savinglabel,type:"dropdown",settings:{"class":"epi-autosave-hidden"}},{parent:"autosave",name:"undo",title:this.res.undo.title,label:epi.resources.action.undo,type:"menuitem",iconClass:"epi-iconUndo",settings:{disabled:true,showLabel:false},action:function(){topic.publish("/epi/cms/action/undo",[]);}},{parent:"autosave",name:"redo",title:this.res.redo.title,label:epi.resources.action.redo,type:"menuitem",iconClass:"epi-iconRedo",settings:{disabled:true,showLabel:false},action:function(){topic.publish("/epi/cms/action/redo",[]);}},{parent:"autosave",name:"reverttopublished",title:this._commands.revertToPublished.tooltip,label:this._commands.revertToPublished.label,type:"menuitem",iconClass:"epi-iconRevert",settings:{separate:true},action:lang.hitch(this,function(){this._revertToPublished.execute();})},{parent:"trailing",name:"notifications",widgetType:"epi-cms/widget/NotificationStatusBar"},{name:"editactionpanel",label:epi.resources.action.publish,parent:"trailing",widgetType:"epi-cms/contentediting/EditActionPanel",settings:{model:this._editActionViewModel}},{parent:"trailing",name:"editmodeswitch",title:this.res.formedit.title,label:this.res.formedit.label,widgetType:"dijit/form/ToggleButton",iconClass:"epi-iconForms",settings:{showLabel:false,"class":"epi-mediumButton epi-modeButton"},action:function(){if(this.get("state")==="Loading"){return;}this.set("state","Loading");setTimeout(function(){topic.publish("/epi/cms/action/switcheditmode");},0);}}];return when(this.inherited(arguments),lang.hitch(this,function(){return this.add(_14df);}));},_setContentViewModelAttr:function(value){this._set("contentViewModel",value);when(this.isSetup(),lang.hitch(this,function(){this._updateToolbarItemsModel(value);}));},_updateToolbarItemsModel:function(_14e0){this.setItemProperty("autosave","label","");this.setItemProperty("autosave","class","epi-autoSaveButton epi-disabledDropdownArrow");var _14e1=_14e0.contentData;this.setItemProperty("notifications","notificationContext",{contextTypeName:"epi.cms.contentdata",contextId:_14e1.contentLink});var _14e2="",_14e3="";if(_14e0.viewName==="formedit"){this.setItemProperty("editmodeswitch","checked",true);_14e2=this.res.onpageedit.title;_14e3=this.res.onpageedit.label;}else{this.setItemProperty("editmodeswitch","checked",false);_14e2=this.res.formedit.title;_14e3=this.res.formedit.label;}this.setItemProperty("editmodeswitch","title",_14e2);this.setItemProperty("editmodeswitch","label",_14e3);var _14e4=this._hasCustomViews(this.viewConfigurations.availableViews);var _14e5=this._hasBuiltInViews(this.viewConfigurations.availableViews);this.setItemVisibility("editmodeswitch",!_14e4&&_14e5&&_14e1.hasTemplate);this.setItemVisibility("viewselect",_14e4);this._editActionViewModel.set("dataModel",_14e0);},_hasCustomViews:function(_14e6){return array.filter(_14e6,function(view){return !view.hideFromViewMenu&&view.key!=="onpageedit"&&view.key!=="formedit";}).length;},_hasBuiltInViews:function(_14e7){return array.filter(_14e7,function(view){return view.key=="onpageedit"||view.key=="formedit";}).length==2;}});});},"epi-cms/contentediting/viewmodel/EditActionPanelViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/string","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/viewmodel/_ContentViewModelObserver","epi-cms/contentediting/viewmodel/PublishMenuViewModel","epi/datetime","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel"],function(array,_14e8,lang,_14e9,_14ea,_14eb,_14ec,_14ed,_14ee,_14ef,res){return _14e8([_14ec],{state:null,buttonText:null,statusText:null,statusIcon:null,additionalClass:null,nonEditableIndicator:null,visible:null,publishMenuViewModel:null,inUseNotificationManager:null,skipChildModels:false,_virtualStatusEnum:{NotCreated:0,NotPublishedYet:1,NoChangeToPublish:2,ChangesToPublish:3,ReadyToPublish:4,ScheduledPublish:5,Published:6,PreviouslyPublished:7,Expired:8,InUse:9,Deleted:10},_virtualStatusCssState:[],_virtualStatusLocalization:[],_statusIcon:[],_watchers:null,_statusMap:{},postscript:function(){this.res=this.res||res;this.inherited(arguments);this.inUseNotificationManager=this.inUseNotificationManager||_14ef.resolve("epi.cms.contentediting.inUseNotificationManager");if(this._virtualStatusCssState.length===0){for(var _14f0 in this._virtualStatusEnum){this._virtualStatusCssState.push(_14f0);this._virtualStatusLocalization.push(this.res["status"][_14f0.toLowerCase()]);}this._statusMap[_14eb.versionStatus.CheckedOut]=this._virtualStatusEnum.NotPublishedYet;this._statusMap[_14eb.versionStatus.CheckedIn]=this._virtualStatusEnum.ReadyToPublish;this._statusMap[_14eb.versionStatus.Rejected]=this._virtualStatusEnum.ChangesToPublish;this._statusMap[_14eb.versionStatus.DelayedPublish]=this._virtualStatusEnum.ScheduledPublish;this._statusMap[_14eb.versionStatus.Published]=this._virtualStatusEnum.Published;this._statusMap[_14eb.versionStatus.PreviouslyPublished]=this._virtualStatusEnum.PreviouslyPublished;this._statusMap[_14eb.versionStatus.Expired]=this._virtualStatusEnum.Expired;this._statusIcon[_14eb.versionStatus.DelayedPublish]="epi-iconClock";this._statusIcon[_14eb.versionStatus.Rejected]="epi-iconStop";}if(!this.skipChildModels){this.publishMenuViewModel=new _14ed({inUseNotificationManager:this.inUseNotificationManager});}},destroy:function(){if(this.publishMenuViewModel){this.publishMenuViewModel.destroy();}this.inherited(arguments);},_setDataModelAttr:function(value){this.inherited(arguments);if(this.publishMenuViewModel){this.publishMenuViewModel.set("dataModel",value);}},onDataModelChange:function(name,_14f1,value){var _14f2=this.dataModel.contentData,_14f3=this._getVirtualStatus(_14f2);this.set("state",this._virtualStatusCssState[_14f3]);this.set("additionalClass",_14f3===this._virtualStatusEnum.ChangesToPublish?"animated8 shake":"");this._setStatusText(_14f3,_14f2);this.set("buttonText",this._getButtonText(_14f3,_14f2));this.set("statusIcon",this._statusIcon[_14f2.versionStatus]||"");var _14f4=this.dataModel.canChangeContent(_14eb.action.Edit);this.set("nonEditableIndicator",!_14f4);this.set("visible",!_14f2.isWastebasket);},_setStatusText:function(_14f5,_14f6){if(_14f6.status===_14eb.versionStatus.DelayedPublish){this.set("statusText",_14ea.substitute(this._virtualStatusLocalization[_14f5],[_14ee.toUserFriendlyHtml(_14f6.properties.iversionable_startpublish)]));}else{if(_14f5===this._virtualStatusEnum.InUse){var _14f7=this.inUseNotificationManager.getOtherUsersInUseNotifications(_14f6.inUseNotifications);this.set("statusText",_14ea.substitute(this._virtualStatusLocalization[_14f5],[_14f7.join(",")]));}else{this.set("statusText",this._virtualStatusLocalization[_14f5]);}}},_getButtonText:function(_14f8,_14f9){if((_14f8==this._virtualStatusEnum.NotPublishedYet||_14f8==this._virtualStatusEnum.ChangesToPublish||_14f8==this._virtualStatusEnum.ReadyToPublish)&&this.dataModel.canChangeContent(_14eb.action.Publish)){return this.res.buttonlabel.publish;}else{return this.res.buttonlabel.option;}},_getVirtualStatus:function(_14fa){if(_14fa.isDeleted){return this._virtualStatusEnum.Deleted;}var _14fb,_14fc,_14fd;_14fb=this.inUseNotificationManager.ignoreOthersNotifications;this.inUseNotificationManager.ignoreOthersNotifications=true;_14fc=this.dataModel.canChangeContent();this.inUseNotificationManager.ignoreOthersNotifications=_14fb;_14fd=this.inUseNotificationManager.hasInUseNotificationWarning(_14fa.inUseNotifications);if(_14fd&&_14fc){return this._virtualStatusEnum.InUse;}if(_14fa.isCommonDraft){if(_14fa.status===_14eb.versionStatus.Published){return this._virtualStatusEnum.NoChangeToPublish;}if(_14fa.status===_14eb.versionStatus.CheckedOut){return _14fa.isMasterVersion?this._virtualStatusEnum.NotPublishedYet:this._virtualStatusEnum.ChangesToPublish;}}return this._statusMap[_14fa.status];}});});},"epi-cms/contentediting/viewmodel/_ContentViewModelObserver":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/Stateful","epi/shell/_StatefulGetterSetterMixin"],function(_14fe,array,lang,_14ff,_1500){return _14fe([_14ff,_1500],{dataModel:null,_watchers:null,destroy:function(){this._unbindDataModel();},_bindDataModel:function(){this._watchers.push(this.dataModel.watch("status",lang.hitch(this,this.onDataModelChange)));this._watchers.push(this.dataModel.watch("contentData",lang.hitch(this,this.onDataModelChange)));},_unbindDataModel:function(){array.forEach(this._watchers,function(w){w.unwatch();});this._watchers=[];},_setDataModelAttr:function(value){this._unbindDataModel();this._set("dataModel",value);this.onDataModelChange();this._bindDataModel();},onDataModelChange:function(name,_1501,value){}});});},"epi-cms/contentediting/viewmodel/PublishMenuViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","epi","epi/datetime","epi/dependency","epi/username","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/viewmodel/_ContentViewModelObserver","epi/shell/command/_CommandConsumerMixin","epi/shell/command/_GlobalCommandProviderMixin","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu"],function(_1502,lang,epi,_1503,_1504,_1505,_1506,_1507,_1508,_1509,res){return _1502([_1507,_1508,_1509],{commandKey:"epi.cms.publishmenu",contentActionSupport:null,inUseNotificationManager:null,_currentUser:null,commands:null,mainButtonCommand:null,lastExecutedCommand:null,mainButtonSectionVisible:null,lastChangeStatus:null,topInfoSectionVisible:null,publishInfoSectionVisible:null,lastPublishedText:null,lastPublishedViewLinkVisible:null,lastPublishedViewLinkHref:null,additionalInfoSectionVisible:null,additionalInfoText:null,isOpen:null,typeIdentifier:null,postscript:function(){this.inherited(arguments);this.res=this.res||res;this.contentActionSupport=this.contentActionSupport||_1506;this.initializeCommandProviders();},_setDataModelAttr:function(value){this.updateCommandModel(value);this.inherited(arguments);},_setIsOpenAttr:function(value){if(value){this.set("lastChangeStatus",this._getLastChangeStatus(this.dataModel.contentData));}},onDataModelChange:function(name,_150a,value){var _150b=this.dataModel.contentData,_150c=(_150b.publishedBy!==null&&_150b.publishedBy!==undefined);this._updateCommands();this.set("lastChangeStatus",this._getLastChangeStatus(_150b));this.set("topInfoSectionVisible",this._getTopInfoSectionVisible(_150b));this.set("publishInfoSectionVisible",this._getPublishInfoSectionVisible(_150b));this.set("lastPublishedTitle",this._getLastPublishedTitle(_150b));this.set("lastPublishedTitleVisible",_150c);this.set("lastPublishedText",this._getLastPublishedText(_150b));this.set("lastPublishedViewLinkVisible",this._getLastPublishedViewLinkVisible(_150b,_150c));this.set("lastPublishedViewLinkHref",_150b.publicUrl);this.set("typeIdentifier",_150b.typeIdentifier);this._setAdditionalInfo(_150b);},_updateCommands:function(){var _150d=this.getCommands(),_150e=null;dojo.forEach(_150d,dojo.hitch(this,function(_150f){if(_150f.canExecute&&_150f.options&&_150f.options.isMain&&_150f.options.priority&&(!_150e||_150e.options.priority<_150f.options.priority)){_150e=_150f;}}));this.set("mainButtonCommand",_150e);this.set("commands",_150d);this.set("mainButtonSectionVisible",_150e!==null);},_getTopInfoSectionVisible:function(_1510){return this.mainButtonCommand||!((_1510.status===_1506.versionStatus.Published||_1510.status===_1506.versionStatus.Expired)&&!_1510.isCommonDraft);},_getPublishInfoSectionVisible:function(_1511){var _1512=this.inUseNotificationManager.hasInUseNotificationWarning(_1511.inUseNotifications),_1513=this._isOriginallyEditable();return !(_1512&&_1513);},_getLastPublishedViewLinkVisible:function(_1514,_1515){return _1515&&!!_1514.publicUrl;},_getLastChangeStatus:function(_1516){if(this.lastExecutedCommand&&this.lastExecutedCommand.options&&this.lastExecutedCommand.options.successStatus){var _1517=this.lastExecutedCommand.options.successStatus;this.lastExecutedCommand=this.mainButtonCommand;return _1517;}if(_1516.missingLanguageBranch&&_1516.missingLanguageBranch.isTranslationNeeded){return lang.replace(this.res.nottranslated,{languageName:epi.resources.language[_1516.missingLanguageBranch.languageId],languageId:_1516.missingLanguageBranch.languageId});}if(_1516.status==_1506.versionStatus.Published||_1516.status==_1506.versionStatus.Expired){return this.res.notmodifiedsincelastpublish;}if(_1516.status==_1506.versionStatus.PreviouslyPublished){return this._getTemplatedText(this.res.previouslypublished,_1516.versionCreatedBy,_1516.versionCreatedTime);}if(_1516.status==_1506.versionStatus.CheckedIn){return this._getTemplatedText(this.res.pendingapproval,_1516.versionCreatedBy,_1516.versionCreatedTime);}return this._getTemplatedText(this.res.lastchangestatus,_1516.changedBy,_1516.saved);},_getLastPublishedTitle:function(_1518){return _1518.status===_1506.versionStatus.PreviouslyPublished?this.res.currentlypublished:this.res.lastpublishedby;},_getLastPublishedText:function(_1519){return (_1519.publishedBy===null||_1519.publishedBy===undefined)?this.res.notpublishedbefore:this._getTemplatedText(this.res.publishedtime,_1519.publishedBy,_1519.lastPublished,true);},_setAdditionalInfo:function(_151a){var _151b=this.inUseNotificationManager.hasInUseNotificationWarning(_151a.inUseNotifications),_151c=this._isOriginallyEditable(),_151d=_151b&&_151c;this.set("additionalInfoSectionVisible",_151d);if(_151d){var _151e=this.inUseNotificationManager.getOtherUsersInUseNotifications(_151a.inUseNotifications);this.set("additionalInfoText",this._getTemplatedText(this.res.inusewarning,_151e.join(",")));}},_isOriginallyEditable:function(){var _151f=this.inUseNotificationManager.ignoreOthersNotifications;this.inUseNotificationManager.ignoreOthersNotifications=true;var _1520=this.dataModel.canChangeContent();this.inUseNotificationManager.ignoreOthersNotifications=_151f;return _1520;},_getFriendlyUsername:function(name,_1521){return _1505.toUserFriendlyHtml(name,null,_1521);},_getTemplatedText:function(_1522,_1523,_1524,_1525){var date=_1503.deserialize(_1524);return dojo.replace(_1522,{username:this._getFriendlyUsername(_1523,_1525),time:_1503.toUserFriendlyHtml(date),timepassed:_1503.timePassed(date)});}});});},"epi-cms/contentediting/StandardToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","dijit/form/DropDownButton","epi/shell/layout/ToolbarContainer","epi/shell/widget/ToolbarLabel","epi/shell/widget/ToolbarSet","epi-cms/widget/Breadcrumb","epi-cms/widget/BreadcrumbCurrentItem","epi-cms/widget/ViewSelectorDropDownButton"],function(_1526,lang,all,when,_1527,_1528,_1529,_152a,_152b,_152c,_152d){return _1526([_152a],{currentContext:null,availableViews:null,viewName:null,_setupPromise:null,buildRendering:function(){this.inherited(arguments);when(this._setupPromise=this.setupChildren(),lang.hitch(this,function(){this.updateChildren();}));},isSetup:function(){return this._setupPromise;},setupChildren:function(){var _152e=[{name:"leading",type:"toolbargroup",settings:{region:"leading"}},{name:"center",type:"toolbargroup",settings:{region:"center"}},{name:"trailing",type:"toolbargroup",settings:{region:"trailing"}}];var _152f=[{parent:"leading",name:"breadcrumbs",widgetType:"epi-cms/widget/Breadcrumb",settings:{displayAsText:false,showCurrentNode:false}},{parent:"trailing",name:"viewselect",widgetType:"epi-cms/widget/ViewSelectorDropDownButton",settings:{showLabel:false,"class":"epi-mediumButton epi-trailingContainer"}},{parent:"leading",name:"currentcontent",widgetType:"epi-cms/widget/BreadcrumbCurrentItem"}];return when(this.add(_152e),lang.hitch(this,function(){return this.add(_152f);}));},updateChildren:function(){var _1530=this.currentContext,_1531=_1530&&_1530.id;this.setItemProperty("breadcrumbs","contentLink",_1531);this.setItemProperty("viewselect","viewConfigurations",this.viewConfigurations);if(_1530){this.setItemProperty("currentcontent","currentItemInfo",{name:_1530.name,dataType:_1530.dataType});}},update:function(data){if(!data){return;}this.currentContext=data.currentContext;this.viewConfigurations=data.viewConfigurations;when(this.isSetup(),lang.hitch(this,function(){this.updateChildren();}));}});});},"epi-cms/widget/ViewSelectorDropDownButton":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/form/DropDownButton","epi-cms/widget/ViewSelector","epi/i18n!epi/cms/nls/episerver.cms.widget.viewselector"],function(array,_1532,lang,_1533,_1534,_1535){return _1532([_1533],{buildRendering:function(){this.inherited(arguments);this.set("title",_1535.title);this.own(this.dropDown=new _1534());},_setViewConfigurationsAttr:function(value){if(!value){return;}array.some(value.availableViews,lang.hitch(this,function(view){if(view.key===value.viewName){this.set("iconClass",view.iconClass);return true;}}));this.dropDown.set("viewConfigurations",value);}});});},"epi-cms/widget/ViewSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","dijit/MenuSeparator","epi/i18n!epi/cms/nls/episerver.cms.widget.viewselector","epi-cms/widget/SelectorMenuBase","epi/shell/widget/CheckedMenuItem"],function(array,_1536,lang,topic,when,_1537,_1538,_1539,_153a){return _1536([_1539],{viewConfigurations:null,headingText:_1538.title,_setViewConfigurationsAttr:function(value){this._set("viewConfigurations",value);this._setup();},onExecute:function(){},onCancel:function(){},_setup:function(){if(!this.viewConfigurations){return;}array.forEach(this.getChildren(),lang.hitch(this,this.removeChild));var _153b=this.viewConfigurations.viewName,_153c=this.viewConfigurations.availableViews;var _153d="";array.forEach(_153c,function(view){if(view.hideFromViewMenu){return;}var _153e=view.category||"";if(_153e!=_153d){this.addChild(new _1537());}_153d=_153e;var item=new _153a({label:view.name,title:view.description,iconClass:view.iconClass,checked:view.key===_153b,onClick:lang.hitch(this,function(){this.onExecute();item.set("checked",!item.checked);if(_153b=="view"){topic.publish("/epi/cms/action/disablepreview");}topic.publish("/epi/shell/action/changeview",view.key,null,null);})});this.addChild(item);},this);}});});},"epi/shell/widget/CheckedMenuItem":function(){require({cache:{"url:epi/shell/widget/templates/CheckedMenuItem.html":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemcheckbox\" tabIndex=\"-1\">\r\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\r\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\"/>\r\n\t\t<img src=\"${_blankGif}\" data-dojo-attach-point=\"iconNode\"/>\r\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\r\n\t</td>\r\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\" data-dojo-attach-point=\"containerNode,labelNode\"></td>\r\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\r\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\r\n</tr>\r\n"}});define("epi/shell/widget/CheckedMenuItem",["dojo/_base/declare","dijit/CheckedMenuItem","dojo/text!./templates/CheckedMenuItem.html"],function(_153f,_1540,_1541){return _153f(_1540,{templateString:_1541});});},"url:epi/shell/widget/templates/CheckedMenuItem.html":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemcheckbox\" tabIndex=\"-1\">\r\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\r\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\"/>\r\n\t\t<img src=\"${_blankGif}\" data-dojo-attach-point=\"iconNode\"/>\r\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\r\n\t</td>\r\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\" data-dojo-attach-point=\"containerNode,labelNode\"></td>\r\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\r\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\r\n</tr>\r\n","epi-cms/widget/NotificationStatusBar":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-class","dojo/keys","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/BorderContainer","dojox/html/entities","epi/dependency","epi-cms/widget/NotificationStatusZone","epi-cms/widget/TooltipDialog","dojo/text!./templates/NotificationStatusBar.html","epi/i18n!epi/cms/nls/episerver.cms.widget.statusbar.notificationstatus"],function(array,_1542,event,lang,_1543,keys,_1544,_1545,_1546,_1547,_1548,_1549,_154a,_154b,_154c,_154d){return _1542([_1544,_1545,_1546],{res:_154d,templateString:_154c,_itemTemplate:"<li>{message}</li>",_notificationTooltipDialogCssClass:"epi-notificationToolipDialog epi-notificationToolipDialogCompact",_dimmedOutCssClass:"epi-notificationIcon-DimmedOut",_notificationErrorClass:"epi-notificationIcon-Error",_notificationWarningClass:"epi-notificationIcon-Warning",_notificationNoteClass:"epi-notificationIcon-Note",_totalNotifications:0,messageContext:null,_tooltipDialog:null,messageService:null,_observeHandle:null,zoneContainer:null,notificationContext:null,baseClass:"epi-notificationIcon",postMixInProperties:function(){this.inherited(arguments);this.messageService=this.messageService||_1549.resolve("epi.shell.MessageService");},postCreate:function(){this.inherited(arguments);this._tooltipDialog=new _154b({connectorMargin:47,hideOnBlur:true,content:this.zoneLayoutNode});this._buildIconBlock();_1543.add(this._tooltipDialog.domNode,this._notificationTooltipDialogCssClass);this.connect(this.domNode,"onclick",lang.hitch(this,this._show));this.connect(this.domNode,"onkeypress",lang.hitch(this,this._onKeyPress));this.connect(this.closeIcon,"onclick",lang.hitch(this,this._hideTooltip));this.subscribe("/epi/cms/action/showerror",this.show);},update:function(_154e){this._hideTooltip();this.messageContext=_154e;this._listenMessagePool();this._updateUI();},destroy:function(){this._unListenMessagePool();this.inherited(arguments);},focus:function(){this.domNode.focus();},show:function(){this._keepShowing=true;this._showTooltip();},getMessages:function(_154f){var query=(_154f)?lang.mixin({typeName:_154f},this.messageContext):this.messageContext;return this.messageService.query(query);},_onKeyPress:function(evt){if(evt.keyCode===keys.ENTER){this._show();}},_listenMessagePool:function(){this._unListenMessagePool();this._observeHandle=this.messageService.observe(this.messageContext,lang.hitch(this,function(){this._updateUI();}));},_unListenMessagePool:function(){if(this._observeHandle){this._observeHandle.cancel();delete this._observeHandle;}},_updateNotificationZone:function(zone,_1550,items){if(items&&items.length>0){array.forEach(items,function(item){zone.addRow(lang.replace(_1550,{message:_1548.encode(item.message)}),"last");});zone.show();}else{zone.hide();}},_updateUI:function(){this.errorZone.empty();this.warningZone.empty();this.infoZone.empty();var _1551=this.getMessages("error");var _1552=this.getMessages("warn");var _1553=this.getMessages("info");this._totalNotifications=_1551.length+_1552.length+_1553.length;this._buildIconBlock();this._updateNotificationZone(this.errorZone,this._itemTemplate,_1551);this._updateNotificationZone(this.warningZone,this._itemTemplate,_1552);this._updateNotificationZone(this.infoZone,this._itemTemplate,_1553);this._updateIconStatus(_1551.length,_1552.length,_1553.length);},_buildIconBlock:function(){this.domNode.innerHTML=this._totalNotifications;if(this._totalNotifications===0){_1543.add(this.domNode,this._dimmedOutCssClass);_1543.remove(this.domNode,this._notificationNoteClass);_1543.remove(this.domNode,this._notificationWarningClass);_1543.remove(this.domNode,this._notificationErrorClass);this._hideTooltip();}else{_1543.remove(this.domNode,this._dimmedOutCssClass);}},_updateIconStatus:function(_1554,_1555,_1556){if(_1554){_1543.add(this.domNode,this._notificationErrorClass);_1543.remove(this.domNode,this._notificationNoteClass);_1543.remove(this.domNode,this._notificationWarningClass);}else{if(_1555){_1543.add(this.domNode,this._notificationWarningClass);_1543.remove(this.domNode,this._notificationNoteClass);}else{if(_1556){_1543.add(this.domNode,this._notificationNoteClass);}}}},_setNotificationContextAttr:function(value){this._set("notificationContext",value);this.update(value);},_show:function(e){if(e){event.stop(e);}this._showTooltip();},_showTooltip:function(){if(this._totalNotifications===0){return;}this._tooltipDialog.showTooltipDialog(this.domNode,["below-alt"]);},_hideTooltip:function(){this._tooltipDialog.hideTooltipDialog();}});});},"epi-cms/widget/NotificationStatusZone":function(){define(["dojo","dojo/_base/declare","dijit/_Widget","dijit/_TemplatedMixin"],function(dojo,_1557,_1558,_1559){return _1557([_1558,_1559],{templateString:"            <div>                <div class=\"epi-dijitTooltipNotificationBlock epi-dijitTooltipBlock${TypeName}\" data-dojo-attach-point=\"Zone\">                    <span class=\"epi-notificationTypeTitle\"><span class=\"dijitIcon dijitInline epi-dijitTooltip${TypeName}Icon\"></span>${title}</span>                    <ul data-dojo-attach-point=\"contentContainer\"></ul>                </div>            </div>",title:"",type:"",TypeName:"",_hiddenCssClass:"epi-dijitTooltipBlockHidden",postMixInProperties:function(){this.TypeName=this.type.charAt(0).toUpperCase()+this.type.slice(1);},empty:function(){dojo.empty(this.contentContainer);},addRow:function(_155a,_155b){dojo.place(_155a,this.contentContainer,_155b);},show:function(){dojo.removeClass(this.Zone,this._hiddenCssClass);},hide:function(){dojo.addClass(this.Zone,this._hiddenCssClass);}});});},"epi-cms/widget/TooltipDialog":function(){define(["dojo","dojo/number","dijit","dijit/TooltipDialog","dijit/_Widget","dijit/_TemplatedMixin","dojo/text!./templates/TooltipDialog.html"],function(dojo,_155c,dijit,_155d,_155e,_155f,_1560){return dojo.declare([_155d],{templateString:_1560,connectorMargin:25,_defaultConnectorMargin:25,hideOnBlur:false,_isFirstShow:false,_beforeCssClass:"epi-dijitTooltipBefore",_afterCssClass:"epi-dijitTooltipAfter",_pos:0,_defaultConnectorRight:0,_defaultConnectorLeft:0,_wrapperPosX:0,_availableSpace:0,_right:0,_left:0,onBlur:function(){this.inherited(arguments);if(this.hideOnBlur){this.hideTooltipDialog();}},postCreate:function(){this.inherited(arguments);if(!this.connectorMargin||!_155c.parse(this.connectorMargin)||this.connectorMargin===""||this.connectorMargin<this._defaultConnectorMargin){this.connectorMargin=this._defaultConnectorMargin;}},showTooltipDialog:function(_1561,_1562){dijit.popup.open({popup:this,around:_1561,orient:_1562});if(this.hideOnBlur){this.focus();}},hideTooltipDialog:function(){dijit.popup.close(this);},onOpen:function(pos){this._pos=pos;this.inherited(arguments);},_onShow:function(){this._setDefaultValues();this._updatePositions();this.inherited(arguments);},_setDefaultValues:function(){if(!this._isFirstShow){this._defaultConnectorRight=this._getConnectorSpace("right")||this._defaultConnectorMargin;this._defaultConnectorLeft=this._getConnectorSpace("left")||this._defaultConnectorMargin;this._isFirstShow=true;}this._wrapperPosX=_155c.parse(this._pos.x);this._availableSpace=dojo.body().clientWidth;if(this._pos.aroundCorner=="MR"||this._pos.aroundCorner=="ML"){var _1563=_155c.round((this._pos.h-this.connectorNode.clientHeight)/2);dojo.style(this.connectorNode,"top",this._getNumberInPx(_1563));}},_updatePositions:function(){switch(this._pos.aroundCorner){case "TR":case "BR":this._calculateConnectorMarginRight();this._calculateAvailableSpaceLeft();this._updateAlignedRightPositions();break;case "TL":case "BL":this._calculateConnectorMarginLeft();this._calculateAvailableSpaceRight();this._updateAlignedLeftPositions();break;case "MR":dojo.addClass(this.domNode,this._afterCssClass);break;case "ML":dojo.addClass(this.domNode,this._beforeCssClass);break;default:break;}},_updateAlignedRightPositions:function(){if(this._availableSpace>=this.connectorMargin){dojo.style(this.connectorNode,"right",this._getNumberInPx(this.connectorMargin));dojo.style(this._popupWrapper,"left",this._getNumberInPx(this._wrapperPosX+(this.connectorMargin-this._right)));}else{dojo.style(this.connectorNode,"right",this._getNumberInPx(this._defaultConnectorRight));dojo.style(this._popupWrapper,"left",this._getNumberInPx(this._wrapperPosX-(this._right-this._defaultConnectorRight)));}},_updateAlignedLeftPositions:function(){if(this._availableSpace>=this.connectorMargin){dojo.style(this.connectorNode,"left",this._getNumberInPx(this.connectorMargin));dojo.style(this._popupWrapper,"left",this._getNumberInPx(this._wrapperPosX+(this.connectorMargin-this._left)));}else{dojo.style(this.connectorNode,"left",this._getNumberInPx(this._defaultConnectorLeft));dojo.style(this._popupWrapper,"left",this._getNumberInPx(this._wrapperPosX-(this._left-this._defaultConnectorLeft)));}},_calculateAvailableSpaceRight:function(){this._wrapperPosX-=this._left+this._getCenterHorizontalAroundNode();this._availableSpace-=(this._wrapperPosX+this._pos.w);},_calculateAvailableSpaceLeft:function(){this._wrapperPosX+=this._right+this._getCenterHorizontalAroundNode();this._availableSpace-=(this._wrapperPosX+this._pos.w);},_calculateConnectorMarginRight:function(){this._right=this._getConnectorSpace("right");if(this._right<this.connectorMargin){this._right=this.connectorMargin;}},_calculateConnectorMarginLeft:function(){this._left=this._getConnectorSpace("left");if(this._left<this.connectorMargin){this._left=this.connectorMargin;}},_getConnectorSpace:function(_1564){if(!_1564){return 0;}if(_1564=="right"||_1564=="left"){var _1565=dojo.style(this.connectorNode,_1564);if(!_1565){return 0;}var _1566=/(px|em|%)/ig;return _155c.parse(_1565)||_155c.parse(_1565.replace(_1566,""));}return 0;},_getNumberInPx:function(_1567){return _1567+"px";},_getCenterHorizontalAroundNode:function(){return _155c.round((_155c.parse(this.connectorNode.clientWidth)-_155c.parse(this._pos.aroundNodePos.w))/2);}});});},"url:epi-cms/widget/templates/TooltipDialog.html":"<div class=\"epi-dijitTooltipDialog\" role=\"presentation\" tabindex=\"-1\">\r\n    <div class=\"dijitTooltipContainer epi-dijitTooltipContainer\" role=\"presentation\">\r\n        <div class=\"dijitTooltipContents dijitTooltipFocusNode epi-dijitTooltipContents\" data-dojo-attach-point=\"containerNode\" role=\"dialog\"></div>\r\n    </div>\r\n    <div class=\"dijitTooltipConnector epi-dijitTooltipConnector\" data-dojo-attach-point=\"connectorNode\" role=\"presentation\"></div>\r\n</div>","url:epi-cms/widget/templates/NotificationStatusBar.html":"<div>\r\n    <div class=\"epi-dijitTooltipTitleBar\">\r\n        <span class=\"epi-dijitTooltipTitle\">${res.title}</span>\r\n        <span class=\"epi-closeButton dijitDialogCloseIcon\" data-dojo-attach-point=\"closeIcon\" title=\"${res.title}\" role=\"button\"></span>\r\n    </div>\r\n    <div class=\"epi-dijitTooltipContent\" data-dojo-attach-point=\"zoneLayoutNode\">\r\n        <div data-dojo-attach-point=\"zoneContainer\">\r\n            <div data-dojo-type=\"epi-cms/widget/NotificationStatusZone\" data-dojo-attach-point=\"errorZone\" data-dojo-props=\"title: '${res.errortitle}', type: 'error'\"></div>\r\n            <div data-dojo-type=\"epi-cms/widget/NotificationStatusZone\" data-dojo-attach-point=\"warningZone\" data-dojo-props=\"title: '${res.warningtitle}', type: 'warning'\"></div>\r\n            <div data-dojo-type=\"epi-cms/widget/NotificationStatusZone\" data-dojo-attach-point=\"infoZone\"  data-dojo-props=\"title: '${res.notetitle}', type: 'note'\"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/FloatingEditorWrapper":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/aspect","dojo/Deferred","dojo/has","dojo/when","epi/dependency","epi/string","epi/shell/widget/dialog/LightWeight","epi-cms/contentediting/OverlayBasedEditorWrapper"],function(array,_1568,lang,_1569,_156a,_156b,has,when,_156c,_156d,_156e,_156f){return _1568([_156f],{formContainerWidgetType:"epi/shell/widget/FormContainer",destroy:function(){this._removeEditingFeatures();this._destroyDialog();this.inherited(arguments);},startEdit:function(_1570){lang.mixin(this.editorParams,_1570);var self=this,def=new _156b();self._destroyDialog();when(self._setupDialog(),function(){self._dialog.show();self.own(_156a.after(self._dialog,"onAfterShow",function(){self._startEdit(_1570);self._onTryToStopWithInvalidValue();def.resolve();}));});return def;},_createDialog:function(_1571){return new _156e({title:this.propertyDisplayName,content:_1571,duration:350,snapToNode:this.blockDisplayNode,positioner:_156c.resolve("epi.shell.layout.PositioningUtility")});},_setupDialog:function(){var _1572={};var _1573=function(_1574,_1575){_1572[_1574]=_1575;};var _1576=lang.hitch(this,function(_1577){for(var _1578 in _1572){var _1579=_1572[_1578];_1579.set("parent",this);if(_1579.stopEditOnBlur===true){this.connect(_1579,"onBlur",this.onStopEdit);}}_1572=null;});var _157a=lang.mixin({intermediateChanges:true},this.editorParams);if(this.editorWidgetType===this.formContainerWidgetType){lang.mixin(_157a,{onFieldCreated:_1573,onFormCreated:_1576});}var def=new _156b();var _157b=_156d.slashName(this.editorWidgetType);require([_157b],lang.hitch(this,function(_157c){var _157d=new _157c(_157a);this.editorWidget=_157d;var _157e=this._createDialog(_157d);this._handlers=[this.connect(_157e,"onButtonClose",this._onButtonClose),this.connect(_157e,"onCancel",this._onDialogCancel),this.connect(_157e.doneButtonNode,"onClick",this._onButtonClose),this.connect(_157d,"onChange",this._onChange),this.connect(_157d,"onKeyPress","_onEditorKeyPress")];this._dialog=_157e;if(this._createdEditor&&this.editorWidget.startup){this.editorWidget.startup();}def.resolve();}));return def;},_onDialogCancel:function(){this.cancel();},_destroyDialog:function(){array.forEach(this._handlers,function(_157f){_157f.remove();});if(this._dialog){this._dialog.destroy();this._dialog=null;}if(this.editorWidget){this.editorWidget.destroy();this.editorWidget=null;}},_removeEditingFeatures:function(){if(this._dialog.open){this._dialog.hide();}},_onTryToStopWithInvalidValue:function(){dijit.focus(this._dialog.titleNode);if(this.editorWidget.focus){this.editorWidget.focus();}},_onButtonClose:function(){if(!this.editorWidget.isShowingChildDialog){this.tryToStopEditing(false);}}});});},"epi/shell/widget/dialog/LightWeight":function(){require({cache:{"url:epi/shell/widget/dialog/templates/LightWeight.html":"<div class=\"epi-lfw-dialog dijitDialog\" role=\"dialog\" aria-labelledby=\"${id}_title\">\r\n    <div data-dojo-attach-point=\"titleBar\" class=\"dijitDialogTitleBar\">\r\n        <span data-dojo-attach-point=\"titleNode\" class=\"dijitDialogTitle\" id=\"${id}_title\"></span>\r\n         <span data-dojo-attach-point=\"closeButtonNode\" class=\"dijitDialogCloseIcon\" data-dojo-attach-event=\"ondijitclick: onButtonClose\" title=\"${buttonCloseText}\" role=\"button\" tabIndex=\"-1\">\r\n            <span data-dojo-attach-point=\"closeText\" class=\"closeText\" title=\"${buttonCloseText}\">x</span>\r\n        </span>\r\n    </div>\r\n    <div class=\"dijitDialogPaneContent\">\r\n        <div data-dojo-attach-point=\"containerNode\" class=\"dijitDialogPaneContentArea\" data-dojo-attach-event=\"onclick:_onContainerNodeClick\"></div>\r\n        <div data-dojo-attach-point=\"buttonContainerNode\" class=\"dijitDialogPaneActionBar clearfix\">\r\n            <button data-dojo-attach-point=\"doneButtonNode\" data-dojo-type=\"dijit/form/Button\" type=\"button\">${buttonDoneText}</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n"}});define("epi/shell/widget/dialog/LightWeight",["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dijit/_WidgetsInTemplateMixin","dijit/focus","dijit/Dialog","dijit/DialogUnderlay","epi/shell/widget/dialog/_DialogMixin","dojo/text!./templates/LightWeight.html"],function(_1580,lang,_1581,_1582,focus,_1583,_1584,_1585,_1586){return _1580([_1583,_1585,_1582],{templateString:_1586,buttonCloseText:epi.resources.action.close,buttonDoneText:epi.resources.action.done,buttonLearnMoreText:epi.resources.action.learnmore,useGlassUnderlay:false,_glassUnderlay:null,"class":"epi-lfw-dialog",snapToNode:null,positioner:null,destroy:function(){if(this._glassUnderlay){this._glassUnderlay.destroyRecursive();delete this._glassUnderlay;}this.inherited(arguments);},show:function(){return this.inherited(arguments).then(lang.hitch(this,this._onAfterShow));},_size:function(){this.inherited(arguments);if(this.positioner){this._relativePosition=this.positioner.findPosition(this.domNode,{snapTo:this.snapToNode});}},resize:function(){this._size();this._position();},_onAfterShow:function(){if(this.content&&this.content.focus){this.content.focus();}if(this.useGlassUnderlay){this._createUnderlay();}else{if(this._moveable&&!this._attachedMoveEvents){this.connect(this._moveable,"onMoveStart",lang.hitch(this,this._createUnderlay));this.connect(this._moveable,"onMoveStop",lang.hitch(this,this._removeUnderlay));this._attachedMoveEvents=true;}if(this.content&&this.content.onResizeStart&&this.content.onResizeStop&&!this._attachedContentResizeEvents){this.connect(this.content,"onResizeStart",lang.hitch(this,this._createUnderlay));this.connect(this.content,"onResizeStop",lang.hitch(this,this._removeUnderlay));this._attachedContentResizeEvents=true;}}this.onAfterShow();},_createUnderlay:function(){if(this._glassUnderlay){this._glassUnderlay.show();}else{this._glassUnderlay=new _1584();this._glassUnderlay.show();var _1587=_1581.get(this.domNode,"zIndex");_1581.set(this._glassUnderlay.domNode,"zIndex",_1587-1);_1581.set(this._glassUnderlay.domNode,"filter","alpha(opacity=0)");_1581.set(this._glassUnderlay.domNode,"opacity","0");}},_removeUnderlay:function(){this._glassUnderlay.hide();},_onContainerNodeClick:function(e){if(e.target===this.containerNode){this._getFocusItems();this._firstFocusItem&&focus.focus(this._firstFocusItem);}},onButtonClose:function(){},onAfterShow:function(){},onAfterHide:function(){},hide:function(){return this.inherited(arguments).then(lang.hitch(this,this._onAfterHide));},_onAfterHide:function(){if(this.useGlassUnderlay){this._removeUnderlay();}this.onAfterHide();},layout:function(){if(this._glassUnderlay&&_1581.get(this._glassUnderlay.domNode,"display")!="none"){this._glassUnderlay.layout();}var _1588=dijit._underlay?_1581.get(dijit._underlay.domNode,"display"):null;this.inherited(arguments);if(dijit._underlay){_1581.set(dijit._underlay.domNode,"display",_1588);}}});});},"url:epi/shell/widget/dialog/templates/LightWeight.html":"<div class=\"epi-lfw-dialog dijitDialog\" role=\"dialog\" aria-labelledby=\"${id}_title\">\r\n    <div data-dojo-attach-point=\"titleBar\" class=\"dijitDialogTitleBar\">\r\n        <span data-dojo-attach-point=\"titleNode\" class=\"dijitDialogTitle\" id=\"${id}_title\"></span>\r\n         <span data-dojo-attach-point=\"closeButtonNode\" class=\"dijitDialogCloseIcon\" data-dojo-attach-event=\"ondijitclick: onButtonClose\" title=\"${buttonCloseText}\" role=\"button\" tabIndex=\"-1\">\r\n            <span data-dojo-attach-point=\"closeText\" class=\"closeText\" title=\"${buttonCloseText}\">x</span>\r\n        </span>\r\n    </div>\r\n    <div class=\"dijitDialogPaneContent\">\r\n        <div data-dojo-attach-point=\"containerNode\" class=\"dijitDialogPaneContentArea\" data-dojo-attach-event=\"onclick:_onContainerNodeClick\"></div>\r\n        <div data-dojo-attach-point=\"buttonContainerNode\" class=\"dijitDialogPaneActionBar clearfix\">\r\n            <button data-dojo-attach-point=\"doneButtonNode\" data-dojo-type=\"dijit/form/Button\" type=\"button\">${buttonDoneText}</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/OverlayBasedEditorWrapper":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","epi/shell/widget/IframeWithOverlay","epi-cms/contentediting/_EditorWrapperBase"],function(_1589,lang,on,_158a,_158b){return _1589([_158b],{postCreate:function(){this.inherited(arguments);this.own(on(this.get("iframeWithOverlay").iframe,"mousedown",lang.hitch(this,this._onViewportClick)));},destroy:function(){this._iframeWithOverlay=null;this.inherited(arguments);},_onViewportClick:function(evt){},_onEditorResize:function(_158c){},_onEditorResizeFinished:function(_158d){},_getOverlayItemAttr:function(){return this.overlayItem||this.editorParams.overlayItem;},_getIframeWithOverlayAttr:function(){if(this._iframeWithOverlay){return this._iframeWithOverlay;}var _158e=null,_158f=this.overlayItem;while(_158f){if(_158f instanceof _158a){_158e=_158f;break;}_158f=_158f.getParent();}return this._iframeWithOverlay=_158e;}});});},"epi-cms/contentediting/FlyoutEditorWrapper":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/number","epi/shell/widget/IframeWithOverlay","epi/shell/widget/dialog/LightWeight","epi-cms/contentediting/FloatingEditorWrapper"],function(_1590,_1591,lang,_1592,_1593,_1594,_1595,_1596,_1597,_1598){return _1591([_1598],{_eventHandlers:null,_overlayContainer:null,isOverlayDisabled:true,isUndoDisabled:true,constructor:function(){this._eventHandlers=[];},_createDialog:function(_1599){var _159a=function(_159b){if(!this.open||!_159b){return;}this._containerNodeCS=this._containerNodeCS||_1594.getComputedStyle(this.containerNode);if(!this._dialogChromeSize){this._chromeHeight=_1593.getMarginBox(this.domNode).h-_1593.getMarginBox(this.containerNode).h;}_1593.setMarginBox(this.containerNode,{h:_159b.h-this._chromeHeight},this._containerNodeCS);_1594.set(this.domNode,{top:_159b.t+"px",left:_159b.l+"px"});};var _159c=new _1597({title:this.propertyDisplayName,content:_1599,duration:350,draggable:false,closeIconVisible:false,region:"trailing",resize:_159a,overlayItem:this.overlayItem,_position:function(){},_size:function(){}});_1592.add(_159c.domNode,"epi-floatingEditorWrapperDialog");_159c.placeAt(this.get("iframeWithOverlay"));_1594.set(_159c.domNode,{top:"-10000px"});return _159c;},_onViewportClick:function(evt){this.tryToStopEditing(false);},_removeEditingFeatures:function(){this.inherited(arguments);this._disconnectLocal(this._eventHandlers);},_disconnectLocal:function(_159d){if(lang.isArray(_159d)){var _159e;while(_159e=_159d.pop()){_1590.disconnect(_159e);}}}});});},"epi-cms/contentediting/FormEditing":function(){define(["dojo/_base/declare","dojo/dom-class","dijit/layout/ContentPane","epi-cms/contentediting/_FormEditingMixin","epi-cms/contentediting/_ValidationMixin","epi-cms/contentediting/EditingBase"],function(_159f,_15a0,_15a1,_15a2,_15a3,_15a4){return _159f([_15a4,_15a2,_15a3],{createOverlays:false,selectFormOnCreation:true,placeForm:function(form){form.set("transitionMode","reveal");form.set("fitContainer",true);this.layoutContainer.addChild(form,0);},removeForm:function(form){this.layoutContainer.leftOver=form;_15a0.replace(this.iframeWithOverlay.domNode,"dijitVisible","dijitHidden");return false;}});});},"epi-cms/contentediting/_FormEditingMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","epi-cms/contentediting/SideBySideEditorWrapper","epi/shell/widget/FormContainer"],function(array,_15a5,lang,when,_15a6,_15a7){return _15a5(null,{_form:null,_formWidgets:null,canHandleLeftOver:true,selectFormOnCreation:false,formSettings:null,connectOverlayItemsToFormWidgets:false,_formConnects:null,destroy:function(){this._removeAndDestroyForm();this._formWidgets=null;this.inherited(arguments);},_removeAndDestroyForm:function(){if(this._form){if(this.removeForm(this._form)){this._form.destroy();this._form=null;}var _15a8;while(_15a8=this._formConnects.pop()){this.disconnect(_15a8);_15a8=null;}this._formConnects=null;this._form=null;}for(var p in this._formWidgets){this._formWidgets[p]=null;}},_setupForm:function(){this._formWidgets={};this._form=new _15a7(lang.mixin({readOnly:!this.viewModel.canChangeContent(),metadata:this.viewModel.metadata,baseClass:"epi-cmsEditingForm"},this.formSettings));this._formConnects=[];this._formConnects.push(this.connect(this._form,"onFieldCreated",this.onFieldCreated));this._formConnects.push(this.connect(this._form,"onGroupCreated",this.onGroupCreated));this._formConnects.push(this.connect(this._form,"onFormCreated",this.onFormCreated));this.placeForm(this._form);this._formPlaced=true;this._finishFormCreation();},_createFormEditorWrappers:function(){for(var _15a9 in this._formWidgets){var _15aa={name:_15a9,metadata:this.viewModel.getPropertyMetaData(_15a9)};var value=lang.clone(this.viewModel.getProperty(_15aa.name));var _15ab=new _15a6({property:_15aa,propertyName:_15a9,value:value,editorWidget:this._formWidgets[_15a9],contentModel:this.viewModel.contentModel,operation:this.viewModel._operation});_15ab.editorWidget.set("parent",_15ab);_15ab.editorWidget.set("editMode","formedit");this.connect(_15ab,"onValueChange","_onWrapperValueChange");this.connect(_15ab,"onCancel","_onWrapperCancel");this.connect(_15ab,"onStopEdit","_onWrapperStopEdit");this._createMapping(_15a9,_15ab);_15aa=null;value=null;_15ab=null;}},_createMapping:function(_15ac,_15ad){var names=_15ac.split(".");var _15ae=false;if(this.connectOverlayItemsToFormWidgets){while(names.length>0){var _15af=names.join(".");var _15b0=this._mappingManager.find("propertyName",_15af);array.forEach(_15b0,function(_15b1){_15ae=true;_15b1.propertyName=_15ac;_15b1.wrapper=_15b1.wrapper||_15ad;});names.pop();}}if(!_15ae){this._mappingManager.add({propertyName:_15ac,wrapper:_15ad});}},placeForm:function(form){},removeForm:function(form){},onFieldCreated:function(_15b2,_15b3){this._formWidgets[_15b2]=_15b3;if(this._addStateWatch){this._addStateWatch(_15b3);}},onGroupCreated:function(_15b4,_15b5){if(_15b5.contentViewModel!==undefined){_15b5.set("contentViewModel",this.viewModel);}},onFormCreated:function(form){this._formCreated=true;this._finishFormCreation();},_finishFormCreation:function(){if(this._formPlaced&&this._formCreated){when(this.selectFormOnCreation?this.layoutContainer.selectChild(this._form):null,lang.hitch(this,this._removeLeftOver));this.toolbar.setItemProperty("editmodeswitch","state","");this._createFormEditorWrappers(this._form);this.onSetupEditModeComplete();}},_removeLeftOver:function(){if(this.layoutContainer.leftOver){var _15b6=this.layoutContainer.selectedChildWidget===this.layoutContainer.leftOver;when(_15b6?this.layoutContainer.selectChild(this.iframeWithOverlay):null,lang.hitch(this,function(){this.layoutContainer.removeChild(this.layoutContainer.leftOver);this.layoutContainer.leftOver.destroyRecursive();this.layoutContainer.leftOver=null;}));}},onReadySetupEditMode:function(){this.inherited(arguments);this._removeAndDestroyForm();this._setupForm();},remapEditMode:function(){this.inherited(arguments);this._form&&this._form.set("readOnly",!this.viewModel.canChangeContent());}});});},"epi-cms/contentediting/SideBySideEditorWrapper":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/window","epi-cms/contentediting/_EditorWrapperBase"],function(_15b7,lang,_15b8,_15b9){return _15b7([_15b9],{_grabFocusOnStartEdit:true,postCreate:function(){this.inherited(arguments);if(this.editorWidget){this.connect(this.editorWidget,"onChange","_onChange");this.connect(this.editorWidget,"onFocus",lang.hitch(this,function(){setTimeout(lang.hitch(this,function(){this._tryToStartEditing(false);}),0);}));this.connect(this.editorWidget,"onBlur",lang.hitch(this,function(){setTimeout(lang.hitch(this,function(){this.tryToStopEditing(true);}),0);}));this.connect(this.editorWidget,"onDropping",lang.hitch(this,function(){this._tryToStartEditing(true);}));}},contentModelChanged:function(name,_15ba,value){this.set("value",value);},_tryToStartEditing:function(_15bb){if(this.editing){return;}this._grabFocusOnStartEdit=_15bb;this.startEdit();this._grabFocusOnStartEdit=true;},_onChange:function(val){if(this._preventChangeEvent){return;}var _15bc=this.editing;if(this.operation&&this.operation.inProgress&&!this.editing){this.editing=true;}this.inherited(arguments);this.editing=_15bc;},_setValueAttr:function(value){this._preventChangeEvent=true;this.inherited(arguments);this._preventChangeEvent=false;},startEdit:function(){if(this._grabFocusOnStartEdit){this.editorWidget.focus();_15b8.scrollIntoView(this.editorWidget.domNode);}this.inherited(arguments);},stopEdit:function(_15bd){this.set("value",this.getEditorValue());this.inherited(arguments);}});});},"epi-cms/contentediting/_ValidationMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang"],function(array,_15be,lang){return _15be(null,{_watchHandles:null,constructor:function(){this._watchHandles=[];},destroy:function(){array.forEach(this._watchHandles,function(_15bf){_15bf.unwatch();});this._watchHandles=null;this.inherited(arguments);},_addStateWatch:function(_15c0){var _15c1=_15c0.get("name"),_15c2=this.viewModel;var _15c3=function(){var state=_15c0.get("state");if(state!=="Error"){_15c2.validator.clearPropertyErrors(_15c1,_15c2.validator.validationSource.client);}else{if(state==="Error"){var _15c4=_15c0.get("message");_15c4===""&&(_15c4=_15c0.getErrorMessage());_15c2.validator.setPropertyErrors(_15c1,[{"severity":_15c2.validator.severity.error,"errorMessage":_15c4}],_15c2.validator.validationSource.client);}}};this._watchHandles.push(_15c0.watch("state",_15c3));this._watchHandles.push(_15c0.watch("message",_15c3));}});});},"epi-cms/contentediting/InlineEditorWrapper":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-style","dojo/Deferred","dojo/on","dojo/when","epi/string","epi-cms/contentediting/OverlayBasedEditorWrapper"],function(array,_15c5,event,lang,_15c6,_15c7,on,when,_15c8,_15c9){return _15c5([_15c9],{width:"100%",hasInlineEditor:true,matchStyle:false,destroy:function(){this._removeEditingFeatures();this._removeLocalHandlers();this._blockDisplayNodeOpacity=null;this.inherited(arguments);},_onViewportClick:function(evt){this._stopEditorEditing(evt);},_stopEditorEditing:function(evt){var _15ca=this.getEditorWidget();if(!_15ca||!_15ca.isEditing()){return;}_15ca.onEditorBlur(evt);this.tryToStopEditing(true);},_getOrCreateEditor:function(){if(this._createdEditor){return this.editorWidget;}var _15cb=new _15c7();var _15cc=_15c8.slashName(this.editorWidgetType),_15cd=lang.mixin(this.editorParams,{value:this.value});if(this.matchStyle){_15cd.style=this._computeStyling();}require([_15cc],lang.hitch(this,function(_15ce){var _15cf=this.editorWidget=new _15ce(_15cd);_15cf.placeAt(this.get("overlayItem").domNode);this.own(on(_15cf.domNode,"editorstatechanged",lang.hitch(this,this._onEditorStateChanged)));this._handlers=[this.connect(_15cf,"onClick",event.stop),this.connect(_15cf,"onEditorResizing",this._onEditorResizing),this.connect(_15cf,"onEditorResized",this._onEditorResized)];this._handlers.push(this.connect(_15cf,"onChange","_onEditorChange"));this._handlers.push(this.connect(_15cf,"onKeyPress","_onEditorKeyPress"));this._createdEditor=true;_15cb.resolve(_15cf);}));return _15cb;},_computeStyling:function(){var _15d0=_15c6.getComputedStyle(this.blockDisplayNode),_15d1="line-height:"+_15d0.lineHeight+";",_15d2=_15c6.getComputedStyle(this.domNode);["Weight","Family","Size","Style"].forEach(function(prop){var _15d3=_15d0["font"+prop],_15d4=_15d2["font"+prop];if(_15d4!=_15d3){_15d1+="font-"+prop+":"+_15d0["font"+prop]+";";}},this);var width=this.width;if(width=="100%"){_15d1+="width:100%;";}else{_15d1+="width:"+(width+(Number(width)==width?"px":""))+";";}_15d1+="position: absolute; left: 0px; top: 0px;";return _15d1;},_onEditorChange:function(value){this._onChange(value);},_onEditorResizing:function(_15d5){},_onEditorResized:function(_15d6){},_onEditorStateChanged:function(_15d7){var _15d8=this.get("overlayItem");_15d8&&_15d8.set("error",_15d7==="Error");},startEdit:function(){var _15d9=this.getInherited(arguments);when(this._getOrCreateEditor(),lang.hitch(this,function(_15da){this._blockDisplayNodeOpacity=_15c6.get(this.blockDisplayNode,"opacity");_15c6.set(_15da.domNode,{"display":""});_15c6.set(this.blockDisplayNode,{"opacity":0.5});_15d9.apply(this);this.focus();}));},_removeLocalHandlers:function(){(this._handlers instanceof Array&&this._handlers.length>0)&&this._handlers.forEach(function(_15db){_15db.remove();});},_removeEditingFeatures:function(){(this.blockDisplayNode&&this._blockDisplayNodeOpacity)&&_15c6.set(this.blockDisplayNode,{"opacity":this._blockDisplayNodeOpacity});(this.editorWidget&&this.editorWidget.domNode)&&_15c6.set(this.editorWidget.domNode,"display","none");},_toggleSupportCustomDnd:function(_15dc){var _15dd=this.get("overlayItem");if(!_15dd){return;}var _15de=this.getEditorWidget();if(!_15de||!_15de.supportCustomDnd){return;}if(_15dc===true){_15dd.transferDndControlTo(_15de);_15de._onDropDataHandler||(_15de._onDropDataHandler=_15de.connect(_15dd,"onDropData",lang.hitch(_15de,function(_15df,_15e0,nodes,copy){_15de.onDropData(_15df,_15e0,nodes,copy);})));return;}_15dd.transferDndControlTo(_15dd);_15de._onDropDataHandler&&_15de.disconnect(_15de._onDropDataHandler);_15de._onDropDataHandler=null;},_toggleOverlayItemZIndex:function(_15e1){var _15e2=this.get("overlayItem");if(!_15e2||!_15e2.item){return;}var _15e3=parseInt(_15c6.get(_15e2.item,"zIndex"),10);_15c6.set(_15e2.item,{"zIndex":_15e1===true?++_15e3:--_15e3});}});});},"epi-cms/contentediting/NotificationBar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojo/_base/array","dojo/on","dijit/_TemplatedMixin","dijit/_Widget","dijit/_Container","dijit/_WidgetsInTemplateMixin","dojo/Evented","dijit/form/Button","dojox/html/ellipsis","dojo/text!./templates/NotificationBar.html","dojo/text!./templates/NotificationBarItem.html"],function(_15e4,lang,_15e5,_15e6,_15e7,array,on,_15e8,_15e9,_15ea,_15eb,_15ec,_15ed,_15ee,_15ef,_15f0){var _15f1=_15e4([_15e9,_15e8,_15eb,_15ec],{templateString:_15f0,item:null,viewModel:null,postCreate:function(){this.inherited(arguments);if(this.item.content){this._addContent(this.item);}this._addCommands(this.item);},_onClose:function(e){e.preventDefault();this.emit("close",this);},_addContent:function(item){if(lang.isString(item.content)){this.textContainer.innerHTML=this.item.content;}else{_15e7.place(this.item.content,this.textContainer);}},_addCommands:function(item){if(lang.isArray(this.item.commands)){array.forEach(this.item.commands,lang.hitch(this,function(_15f2){this._addButtonForCommand(_15f2);}));}},_addButtonForCommand:function(_15f3){var _15f4=new _15ed({label:_15f3.label,title:_15f3.tooltip,iconClass:_15f3.iconClass});if(_15f3.cssClass){_15e5.add(_15f4.domNode,_15f3.cssClass);}_15f4.set("disabled",!_15f3.canExecute);_15f4.on("click",function(){_15f3.execute();});this.own(_15f3.watch("canExecute",lang.hitch(this,function(){_15f4.set("disabled",!_15f3.canExecute);})));if(_15f3.category==="leftAligned"){_15f4.placeAt(this.contentContainer,"first");}else{_15f4.placeAt(this.buttonContainer,"first");}this.own(_15f4);}});var _15f5=_15e4([_15e9,_15ea,_15e8,_15eb,_15ec],{templateString:_15ef,noBorderClass:"epi-notificationBarWithoutBorder",clear:function(){this._hideIfEmpty();array.forEach(this.getChildren(),function(_15f6){this.removeChild(_15f6);_15f6.destroy();_15f6=null;},this);this.emit("notificationsChanged");},destroy:function(){this.destroyDescendants();this.inherited(arguments);},add:function(_15f7){var _15f8=new _15f1({item:_15f7});on(_15f8,"close",lang.hitch(this,"_onCloseNotification"));this.addChild(_15f8);this._hideIfEmpty();this.emit("notificationsChanged");},remove:function(_15f9){array.forEach(this.getChildren(),lang.hitch(this,function(_15fa){if(_15fa.item&&_15fa.item==_15f9){this._onCloseNotification(_15fa);}}));this._hideIfEmpty();},_onCloseNotification:function(item){this.removeChild(item);item.destroy();item=null;this._hideIfEmpty();this.emit("notificationsChanged");},_hideIfEmpty:function(){var show=this.getChildren().length>0;_15e5.toggle(this.domNode,this.noBorderClass,!show);_15e6.set(this.domNode,"display",show?"":"none");}});return _15f5;});},"url:epi-cms/contentediting/templates/NotificationBar.html":"<div class=\"epi-notificationBar\">\r\n    <div data-dojo-attach-point=\"containerNode\"></div>\r\n</div>","url:epi-cms/contentediting/templates/NotificationBarItem.html":"<div class=\"epi-notificationBarItem\">\r\n    <div class=\"epi-notificationBarText\" data-dojo-attach-point=\"contentContainer\">\r\n        <p data-dojo-attach-point=\"textContainer\"></p>\r\n    </div>\r\n    <div class=\"epi-notificationBarButtonContainer\" data-dojo-attach-point=\"buttonContainer\">\r\n        <button data-dojo-type=\"dijit/form/Button\" class=\"epi-chromelessButton\" data-dojo-props=\"iconClass:'epi-iconClose', showLabel:false\" data-dojo-attach-event=\"onClick:_onClose\"></button>\r\n    </div>\r\n</div>","epi-cms/contentediting/OnPageEditing":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/when","epi/shell/gesture/ScrollPullDown","epi-cms/contentediting/_FormEditingMixin","epi-cms/contentediting/_ValidationMixin","epi-cms/contentediting/EditingBase"],function(_15fb,lang,_15fc,when,_15fd,_15fe,_15ff,_1600){return _15fb([_1600,_15fe,_15ff],{_iframeConnects:null,postMixInProperties:function(){this.inherited(arguments);this.formSettings={doLayout:false,baseClass:"epi-cmsEditingForm epi-cmsEditingFormOpe",propertyFilter:function(_1601,_1602){return _1602.groupName==="EPiServerCMS_SettingsPanel";}};},destroy:function(){this._removePullDownGesture();this.inherited(arguments);},onEditorWrapperCreated:function(_1603){if(_1603&&_1603.editorWidget){var _1604=_1603.editorWidget;if(_1604.onFieldCreated){this.connect(_1604,"onFieldCreated",function(_1605,_1606){this._addStateWatch(_1606);});}else{_1604.set("name",_1603.get("propertyName"));this._addStateWatch(_1604);}_1604.validate&&_1604.validate();}},onSetActiveProperty:function(_1607){var _1608=this._mappingManager.findOne("propertyName",_1607);if(!_1608){dojo.publish("/epi/cms/action/switcheditmode",[null,{activePropertyOnStartup:_1607}]);}else{this.inherited(arguments);}},_onOverlayItemClick:function(_1609,e){var _160a=this._activeEditorWrapper;if(_160a){_160a.tryToStopEditing();if(_160a.editing||_1609.name===_160a.overlayItem.name){return;}}this.inherited(arguments);},placeForm:function(form){form.set("fitContainer",false);form.set("transitionMode","slideIn");this.layoutContainer.addChild(form,0);this._setupPullDownGesture(form);},_setupPullDownGesture:function(form){var _160b=this;this._pullDownGesture=_15fd(_160b.iframeWithOverlay.previewContainer,{isShown:false,show:function(){this.isShown=null;when(_160b.layoutContainer.selectChild(form),lang.hitch(this,function(){this.isShown=true;_160b.iframeWithOverlay.onViewportPullDown();}),lang.hitch(this,function(){this.isShown=false;_160b.iframeWithOverlay.onViewportPullDown();}));},hide:function(){this.isShown=null;when(_160b.layoutContainer.selectChild(_160b.iframeWithOverlay),lang.hitch(this,function(){this.isShown=false;_160b.iframeWithOverlay.onViewportPullDown();}),lang.hitch(this,function(){this.isShown=true;_160b.iframeWithOverlay.onViewportPullDown();}));}});this._pullDownGesture.addMouseWheelListener(form.domNode);if(_160b.iframeWithOverlay.iframe.isInspectable()){this._setupIframeMouseWheelListeners();}},_setupIframeMouseWheelListeners:function(){var _160c=this._pullDownGesture.addMouseWheelListener(this.iframeWithOverlay.iframe.getDocument());this._iframeConnects=[];this._iframeConnects.push(this.connect(this.iframeWithOverlay.iframe,"onLoad",function(){_160c=this._pullDownGesture.addMouseWheelListener(this.iframeWithOverlay.iframe.getDocument());}));this._iframeConnects.push(this.connect(this.iframeWithOverlay.iframe,"onUnload",function(){_160c&&_160c.remove();}));},_teardownIframeMouseWheelListeners:function(){if(this._iframeConnects){var c;while(c=this._iframeConnects.pop()){this.disconnect(c);}c=null;this._iframeConnects=null;}},_removePullDownGesture:function(){this._teardownIframeMouseWheelListeners();if(this._pullDownGesture){this._pullDownGesture.destroy();this._pullDownGesture=null;}},removeForm:function(form){this._removePullDownGesture();this.layoutContainer.leftOver=form;return false;}});});},"epi/shell/gesture/ScrollPullDown":function(){define("epi/shell/gesture/ScrollPullDown",["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/mouse","dojo/on","dijit/Destroyable"],function(_160d,event,lang,mouse,on,_160e){return _160d([_160e],{_delegate:null,_scrollTarget:null,_isScrolling:false,_pullDownInertia:100,_ts:null,_tb:null,destroy:function(){this._delegate=null;},constructor:function(_160f,_1610){this._delegate=_1610;this._scrollTarget=_160f;this.addMouseWheelListener(_160f);},addMouseWheelListener:function(_1611){if(_1611){return this.own(on(_1611,mouse.wheel,lang.hitch(this,this._onMouseWheel)))[0];}},_blockShowEvent:function(){if(this._scrollTarget.scrollTop>0){this._isScrolling=true;}this._ts&&clearTimeout(this._ts);this._ts=setTimeout(lang.hitch(this,function(){this._isScrolling=false;}),this._pullDownInertia);return this._isScrolling;},_initiateScrollBlock:function(){this._scrollBlock=true;},_blockScrollEvent:function(){this._tb&&clearTimeout(this._tb);this._tb=setTimeout(lang.hitch(this,function(){this._scrollBlock=false;}),this._pullDownInertia);return (this._delegate.isShown==null)||this._scrollBlock;},_raiseShow:function(evt){if(this._delegate.isShown===false){event.stop(evt);this._delegate.show();this._initiateScrollBlock();}},_raiseHide:function(evt){if(this._delegate.isShown===true){event.stop(evt);this._delegate.hide();this._initiateScrollBlock();}},_onMouseWheel:function(evt){if(!evt.wheelDelta){this._blockScrollEvent();return;}if(this._blockScrollEvent()){event.stop(evt);return;}if(evt.wheelDelta<0||(this._delegate.isShown&&this._scrollTarget.scrollTop>0)){this._raiseHide(evt);}else{if(!this._blockShowEvent()){this._raiseShow(evt);}}}});});},"epi-cms/contentediting/PageDataController":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/Deferred","dojo/promise/all","dojo/topic","dojo/when","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/layout/BorderContainer","epi/dependency","epi/string","epi/Url","epi/shell/layout/CardContainer","epi/shell/widget/IframeWithOverlay","epi-cms/_ContentContextMixin","epi-cms/contentediting/ContentReferencesNotification","epi-cms/contentediting/ContentViewModel","epi-cms/contentediting/EditToolbar","epi-cms/contentediting/ExpirationNotification","epi-cms/contentediting/LanguageNotification","epi-cms/contentediting/NotificationBar","epi-cms/contentediting/ShortcutNotification","epi-cms/contentediting/ViewSettingsNotification","epi-cms/contentediting/WorkflowTaskNotification","epi-cms/contentediting/command/Editing","epi/i18n!epi/cms/nls/episerver.cms.contentediting","dojo/text!./templates/PageDataController.html"],function(array,_1612,lang,_1613,_1614,_1615,all,topic,when,_1616,_1617,_1618,_1619,_161a,_161b,Url,_161c,_161d,_161e,_161f,_1620,_1621,_1622,_1623,_1624,_1625,_1626,_1627,_1628,res,_1629){return _1612([_1617,_1616,_1618,_161e],{templateString:_1629,contextTypeName:"epi.cms.contentdata",pendingNotificationTimeOutId:null,isActive:true,defaultEditCssRules:[{selector:".epi-injected-minSize",css:"min-height: 30px;"},{selector:".epi-injected-minSize-inline",css:"min-height: 30px; min-width: 100px; display: inline-block !important;"},{selector:"[contenteditable=true]:focus",css:"outline: 3px #b4c600 solid;"}],_currentViewComponent:null,_viewModels:null,_notificationHandlerId:null,_messageService:null,_editingCommands:null,_currentViewModel:null,_pageDataStore:null,_contentReferencesNotification:null,_shortcutNotification:null,_languageNotification:null,_expirationNotification:null,_workflowTaskNotification:null,_availableViews:null,_previewQueryParameters:null,_viewSettingsManager:null,_inUseNotificationManager:null,_showOverlay:true,postMixInProperties:function(){this.inherited(arguments);var _162a=_161a.resolve("epi.storeregistry");this._viewSettingsManager=_161a.resolve("epi.viewsettingsmanager");this._messageService=this._messageService||_161a.resolve("epi.shell.MessageService");this._profile=this._profile||_161a.resolve("epi.shell.Profile");this._pageDataStore=_162a.get("epi.cms.contentdata");this._editingCommands=_1628;if(!this._viewModels){this._viewModels=[];}this._inUseNotificationManager=this.inUseNotificationManager||_161a.resolve("epi.cms.contentediting.inUseNotificationManager");this._contentReferencesNotification=new _161f();this._languageNotification=new _1623();this._expirationNotification=new _1622();this._shortcutNotification=new _1625();this._viewSettingsNotification=new _1626();this._workflowTaskNotification=new _1627();},postCreate:function(){this.inherited(arguments);this.subscribe("/epi/cms/action/switcheditmode",lang.hitch(this,this._switchEditMode));var cs=_161a.resolve("epi.shell.ContextService");this._interceptorHandle=cs.registerRequestInterceptor(lang.hitch(this,this._interceptRequestContext));this.notificationBar.on("notificationsChanged",lang.hitch(this,function(){this.layoutContainer.layout();}));this.own(this._contentReferencesNotification.watch("notification",lang.hitch(this,this._contentReferencesNotificationWatchHandler)),this._languageNotification.watch("notification",lang.hitch(this,this._defaultNotificationWatchHandler)),this._expirationNotification.watch("notification",lang.hitch(this,this._defaultNotificationWatchHandler)),this._shortcutNotification.watch("notification",lang.hitch(this,this._shortcutNotificationWatchHandler)),this._viewSettingsNotification.watch("notification",lang.hitch(this,this._defaultNotificationWatchHandler)),this._workflowTaskNotification.watch("notification",lang.hitch(this,this._workflowTaskNotificationWatchHandler)));},startup:function(){if(this._started){return;}this.inherited(arguments);var url=new Url(window.location.href),_162b=url.getQueryParameterValue("view");this.iFrame=this.iframeWithOverlay.iframe;this.connect(this.iFrame,"onLoad","_iFrameLoaded");this.connect(this.iFrame,"onUnload","_iFrameUnLoaded");_1613.add(this.toolbar.domNode,"epi-localToolbar epi-viewHeaderContainer");this._injectCssRules();when(this.getCurrentContext(),lang.hitch(this,function(_162c){this.contextChanged(_162c);}));},_defaultNotificationWatchHandler:function(name,_162d,_162e){if(_162d){this.notificationBar.remove(_162d);}if(_162e&&_162e.content){this.notificationBar.add(_162e);}},_shortcutNotificationWatchHandler:function(name,_162f,_1630){this._defaultNotificationWatchHandler(name,_162f,_1630);this._showOverlay=_1625.LinkTypes[_1630.shortcutType]!=="fetchdata";},_contentReferencesNotificationWatchHandler:function(name,_1631,_1632){this._defaultNotificationWatchHandler(name,_1631,_1632);this.notificationBar.set("viewModel",this._currentViewModel.contentData);},_workflowTaskNotificationWatchHandler:function(name,_1633,_1634){if(_1633 instanceof Array){array.forEach(_1633,function(_1635){this.notificationBar.remove(_1635);},this);}if(_1634 instanceof Array){array.forEach(_1634,function(_1636){this.notificationBar.add(_1636);},this);}},_switchEditMode:function(_1637,_1638){var _1639,_163a=this._currentViewModel.viewName,_163b=null,_163c="view",_163d="onpageedit",_163e="formedit";if(_163a===_163c){topic.publish("/epi/cms/action/disablepreview");}if(_163a===_163e){_1639=_163d;_163b=this._getPreviewUrl(this._currentContentContext,_1639);}else{_1639=_163e;}this._ensurePreviewReady(this.setView(_1639,_1638),_163b,function(view){});},destroy:function(){this._interceptorHandle.remove();this._destroyCurrentViewComponent();this._viewModels=null;this.inherited(arguments);},_iFrameLoaded:function(url,_163f){if(!!url&&!_163f){this._requestContextChangeByUrl(url,true,true);}},_iFrameUnLoaded:function(url){this.iframeWithOverlay.overlay.set("enabled",false);},_destroyCurrentViewComponent:function(){if(this._currentViewComponentReloadRequireHandle){this._currentViewComponentReloadRequireHandle.remove();this._currentViewComponentReloadRequireHandle=null;}if(this._currentViewComponent){this._currentViewComponent.destroyRecursive();this._currentViewComponent=null;}},_getViewModelIndex:function(id){var index=-1;array.some(this._viewModels,function(item,idx){if(item.contentLink==id){index=idx;return true;}});return index;},_getViewModel:function(id){var index=this._getViewModelIndex(id);if(index>=0){return this._viewModels[index];}else{return null;}},_removeViewModel:function(id){var index=this._getViewModelIndex(id);if(index>=0){var _1640=this._viewModels.splice(index,1)[0];_1640.clear();}},_createViewModel:function(_1641,ctx){var _1642=new _1620({contentLink:_1641.contentLink,contextTypeName:this.contextTypeName});_1642.set("contentData",_1641);_1642.set("languageContext",ctx.languageContext);this._viewModels.push(_1642);return _1642;},contentContextUpdated:function(ctx,_1643){var _1644=ctx.id;this._pageDataStore.refresh(_1644).then(lang.hitch(this,function(_1645){if(this._currentViewModel){this._updateContentViewModel(_1645,ctx.languageContext);this._refreshModel(_1645,ctx);}}));},updateView:function(_1646,ctx,_1647){if(_1646&&_1646.skipUpdateView){return;}if(_1647&&_1647.widgetResumed){_1614.set(this.domNode,"visibility","hidden");}if(_1646&&_1646.contextIdSyncChange){this._pageDataStore.refresh(ctx.id).then(lang.hitch(this,function(_1648){this._updateContentViewModel(_1648,ctx.languageContext);this._currentViewComponent.onContentLinkSyncChange();this._refreshModel(_1648,ctx);}));}else{this._previousEditMode=null;if(this._currentViewModel){this._currentViewModel.suspend();}var _1649;if(_1646&&_1646.viewName){if(_1646.availableViews){this._availableViewsLookup={};array.forEach(_1646.availableViews,lang.hitch(this,function(_164a){this._availableViewsLookup[_164a.key]=_164a;}));}_1649=_1646.viewName;}this.toolbar.update({currentContext:ctx,viewConfigurations:{availableViews:_1646.availableViews,viewName:_1646.viewName}});if(this._currentViewComponent&&this._currentViewComponent.isSticky){_1649=this._currentViewModel.viewName;}var _164b=this._getPreviewUrl(ctx,_1649);this._ensurePreviewReady(this._loadContentDataAndSetView(ctx.id,_1649,ctx),_164b);}},_getPreviewUrl:function(_164c,_164d){return (_164d==="view"&&_164c.previewUrl)?_164c.previewUrl:_164c.editablePreviewUrl;},_ensurePreviewReady:function(_164e,_164f){var _1650=[];if(_164e){_1650.push(_164e);}if(_164f!==null&&_164f!==undefined){_1650.push(this._changeUrl(_164f));}all(_1650).then(lang.hitch(this,function(){var doc=this.iframeWithOverlay.iframe.getDocument();var _1651=this.connect(this._currentViewComponent,"onPrepareOverlayComplete",function(){this.disconnect(_1651);_1651=null;this.iframeWithOverlay.overlay.set("enabled",this._showOverlay&&this.iframeWithOverlay.iframe.isInspectable());this.iframeWithOverlay.layout(true);});_1614.set(this.domNode,"visibility","visible");this._viewSettingsManager.onPreviewReady(this.iframeWithOverlay);this._currentViewComponent.onPreviewReady(this._currentViewModel,doc);this._viewSettingsNotification.set("invokeActionValue",{viewModel:this._currentViewModel,viewSetting:this._viewSettingsManager});}));},_loadContentDataAndSetView:function(_1652,_1653,ctx){var def=new _1615();when(this._pageDataStore.refresh(_1652),lang.hitch(this,function(_1654){if(!_1654){return;}this._currentViewModel=this._getViewModel(_1654.contentLink);this.notificationBar.clear();if(!this._currentViewModel){this._currentViewModel=this._createViewModel(_1654,ctx);}else{this._updateContentViewModel(_1654,ctx.languageContext);}this._currentViewModel.set("viewLanguage",this._viewSettingsManager.get("enabled")?this._viewSettingsManager.getSettingProperty("viewlanguage"):null);this._refreshModel(_1654,ctx);when(this.setView(_1653),function(){def.resolve();},function(){def.cancel();});}),function(){def.reject();});return def;},_updateContentViewModel:function(_1655,_1656){this._currentViewModel.wakeUp();this._currentViewModel.set("contentData",_1655);this._currentViewModel.set("languageContext",_1656);},_refreshModel:function(_1657,_1658){var model=this._currentViewModel;if(model){this.toolbar.set("contentViewModel",model);this._inUseNotificationManager.updateCommandModel(model);this._editingCommands.set("model",model);this._contentReferencesNotification.set("invokeActionValue",model.contentData);this._languageNotification.set("invokeActionValue",_1658);this._shortcutNotification.set("invokeActionValue",model);this._workflowTaskNotification.set("invokeActionValue",model.contentData);this._expirationNotification.set("invokeActionValue",model);}},itemChanged:function(id,item){},setView:function(_1659,_165a){var def=new _1615();if(_1659==="onpageedit"&&(!this._currentViewModel.contentData.hasTemplate||!(_1659 in this._availableViewsLookup))){_1659="formedit";}if(_1659&&!(_1659 in this._availableViewsLookup)){return;}var _165b=lang.hitch(this,function(){when(this._setView(_1659,_165a),function(){def.resolve();},function(){def.cancel();});});var _165c=lang.hitch(this,function(){topic.publish("/epi/cms/action/showerror");def.cancel();});when(this._savePendingChanges(),_165b,_165c);return def;},_setView:function(_165d,_165e){var def=new _1615(),_165f=this._currentViewComponent,_1660=_165f&&_165f.viewModel&&_165f.viewModel.viewName===_165d;_1660=false;if(_1660){this._currentViewModel.viewName=_165d;this.toolbar.set("contentViewModel",this._currentViewModel);def.resolve();}else{this._destroyCurrentViewComponent();var _1661=_161b.slashName(this._availableViewsLookup[_165d].viewType);require([_1661],lang.hitch(this,function(_1662){this._currentViewComponent=new _1662(lang.mixin({layoutContainer:this.editLayout,iframeWithOverlay:this.iframeWithOverlay,contextTypeName:this.contextTypeName,toolbar:this.toolbar},_165e));this._currentViewComponentReloadRequireHandle=this.connect(this._currentViewComponent,"onReloadRequired",this._onViewRequireReload);this._currentViewComponent.startup();this._currentViewModel.viewName=_165d;this.toolbar.set("contentViewModel",this._currentViewModel);if(this.editLayout.leftOver&&!this._currentViewComponent.canHandleLeftOver){when(this.editLayout.selectedChildWidget===this.editLayout.leftOver?this.editLayout.selectChild(this.iframeWithOverlay):null,lang.hitch(this,function(){this.editLayout.removeChild(this.editLayout.leftOver);this.editLayout.leftOver.destroyRecursive();this.editLayout.leftOver=null;}));}def.resolve();}));}return def;},_onViewRequireReload:function(){var _1663=this._getPreviewUrl(this._currentContentContext,this._currentViewModel.viewName);this._ensurePreviewReady(null,_1663);},resize:function(size){this.inherited(arguments);this.layoutContainer.resize(size);},onShow:function(){this.iframeWithOverlay.overlay.set("enabled",this._showOverlay);},onHide:function(){this.iframeWithOverlay.overlay.set("enabled",false);},_clearNotifications:function(){if(this._currentViewModel&&this._currentViewModel.validator){this._currentViewModel.validator.clear();}},_requestContextChangeByUrl:function(url,_1664,_1665,_1666,_1667){var _1668=new Url(url,_1666,_1667),_1669={url:_1668.toString()},_166a={sender:this,forceContextChange:_1664,suppressFailure:_1665,viewName:this._currentViewModel&&this._currentViewModel.viewName};topic.publish("/epi/shell/context/request",_1669,_166a);},_changeUrl:function(url){var _166b=lang.mixin(this._previewQueryParameters,this._viewSettingsManager.get("previewParams"));return this.iframeWithOverlay.iframe.load(url,{query:_166b},true,true);},_interceptRequestContext:function(_166c,_166d){if(!(_166d&&_166d.sender&&_166d.sender===this)){return this._savePendingChanges();}else{var def=new _1615();def.resolve();return def;}},_savePendingChanges:function(){if(this._currentViewModel&&!this._currentViewModel.isSaved){return this._currentViewModel.save();}else{var def=new _1615();def.resolve();return def;}},savePendingChanges:function(){return this._savePendingChanges();},_injectCssRules:function(){this.iFrame.addCssRules(this.defaultEditCssRules);}});});},"epi/shell/layout/CardContainer":function(){define("epi/shell/layout/CardContainer",["dojo/_base/declare","dojo/_base/lang","dojo/_base/fx","dojo/aspect","dojo/has","dojo/on","dojo/dom-class","dojo/dom-style","dojo/dom-geometry","dojo/Deferred","dojo/when","dijit/_TemplatedMixin","dijit/layout/StackContainer","dgrid/util/has-css3"],function(_166e,lang,fx,_166f,has,on,_1670,_1671,_1672,_1673,when,_1674,_1675,_1676){return _166e([_1675,_1674],{doLayout:false,transitionClass:"epi-transition",transitionDirection:"vertical",baseClass:"epi-cardContainer",templateString:"<div><div class='dijitContainer' style='position: relative;' data-dojo-attach-point='containerNode'></div></div>",layout:function(){var child=this.selectedChildWidget;var _1677=this.getChildren(),_1678=_1677[_1677.length-1];if(child&&child.resize){if(child.fitContainer){child.resize(this._containerContentBox||this._contentBox);}else{child.resize();}}if(child!==_1678&&!child.fitContainer){_1670.replace(_1678.domNode,"dijitVisible","dijitHidden");if(_1678&&_1678!==child&&_1678.resize){if(_1678.fitContainer){_1678.resize(this._containerContentBox||this._contentBox);}else{_1678.resize();}}}},addChild:function(child,_1679){if(this._started){var _167a=this.getChildren(),_167b=_167a[_167a.length-1];if(_1679>=_167a.length){_1670.replace(_167b.domNode,"dijitHidden","dijitVisible");}}this.inherited(arguments);},_transition:function(_167c,_167d){var _167e=this.getChildren(),_167f=_167e[_167e.length-1];if(!_167d||_167d._destroyed){return;}if(_167d.fitContainer&&_167d!==_167f){_1670.replace(_167f.domNode,"dijitVisible","dijitHidden");}return when(_167c===_167f?this._hideTransition(_167d,_167f):null,lang.hitch(this,function(n){var _1680=0;if(_167d&&!_167d._destroyed&&_167d!==_167f){_1680=_1672.getMarginBox(_167d.domNode).h;this._hideChild(_167d);}if(!_167c||_167c._destroyed){return;}this._showChild(_167c);if(_167c.resize){if(_167c.fitContainer){_167c.resize(this._containerContentBox||this._contentBox);}else{_167c.resize(null);}return when(this._showTransition(_167c,_167f,_1680),function(){if(_167c.fitContainer&&_167c!==_167f){_1670.replace(_167f.domNode,"dijitHidden","dijitVisible");}});}else{return;}}));},_hideTransition:function(_1681,_1682){return this._doTransition(_1681,_1682,false);},_showTransition:function(_1683,_1684,_1685){return this._doTransition(_1683,_1684,true,_1685);},_doTransition:function(page,_1686,_1687,_1688){if(page!==_1686){var _1689=_1672.getMarginBox(page.domNode),_168a=this._getAnimationNode(page,_1686);var _168b=this.transitionDirection==="vertical"?"top":"left",size=this.transitionDirection==="vertical"?_1689.h:_1689.w;from=_1687?-(size-_1688)+"px":"0px",to=_1687?"0px":-size+"px",restore=!_1687;return this._animate(_168a,_168b,from,to,restore);}},_getAnimationNode:function(page,_168c){return page.transitionMode==="slideIn"?this.containerNode:"reveal"?_168c.domNode:null;},_animate:function(node,_168d,from,to,_168e){var dfd=new _1673();if(node&&has("css-transitions")){_1671.set(node,_168d,from);setTimeout(lang.hitch(this,function(){_1670.add(node,this.transitionClass);var _168f=on(node,has("transitionend"),lang.hitch(this,function(){_168f.remove();_1670.remove(node,this.transitionClass);if(_168e){_1671.set(node,_168d,from);}dfd.resolve();}));setTimeout(function(){_1671.set(node,_168d,to);},1);}),1);}else{dfd.resolve();}return dfd.promise;}});});},"epi-cms/contentediting/ContentReferencesNotification":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/dom-construct","dojo/on","dojo/when","epi","epi/shell/TypeDescriptorManager","epi-cms/contentediting/_ContentEditingNotification","epi-cms/command/BackCommand","epi-cms/widget/sharedContentDialogHandler","epi/i18n!epi/cms/nls/episerver.cms.contentediting.notificationbar"],function(array,_1690,event,_1691,on,when,epi,_1692,_1693,_1694,_1695,_1696){return _1690([_1693],{_backCommand:null,constructor:function(_1697){this._backCommand=new _1694();},postscript:function(){this._storeName="epi.cms.contentreferences";this.inherited(arguments);},_executeAction:function(value){var _1698=_1692.getValue(value.typeIdentifier,"actAsAnAsset");if(!_1698){return false;}return this._store.get(value.contentLink);},_onExecuteSuccess:function(_1699){if(!_1699){return;}var _169a=_1691.create("div");if(_1699.length>0){_169a.innerHTML+=_1696.affect;var _169b=_1699.length+" "+(_1699.length===1?epi.resources.text.item:epi.resources.text.items),self=this,_169c=_1691.create("a",{href:"#",innerHTML:_169b,title:_1696.referencestooltip},_169a);on(_169c,"click",function(evt){event.stop(evt);self._showReferenceDialog();});}else{_169a.innerHTML+=epi.resources.messages.notinuse;}this._backCommand.set("model",{});this._setNotification({content:_169a,commands:[this._backCommand]});},_showReferenceDialog:function(){_1695({contentData:this.get("invokeActionValue"),showToolbar:true,mode:_1695.mode.show});}});});},"epi-cms/contentediting/_ContentEditingNotification":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/when","epi/dependency"],function(_169d,lang,_169e,when,_169f){return _169d([_169e],{invokeActionValue:null,notification:null,_storeName:null,_store:null,_invokeActionProperty:"invokeActionValue",postscript:function(){this.inherited(arguments);this._setupStore();this.watch(this._invokeActionProperty,lang.hitch(this,this._invokeActionPropertyWatchHandler));},_setupStore:function(){if(!this._store&&this._storeName){var _16a0=_169f.resolve("epi.storeregistry");this._store=_16a0.get(this._storeName);}},_executeAction:function(value){return value;},_onExecuteSuccess:function(){},_onExecuteFailed:function(){},_invokeActionPropertyWatchHandler:function(name,_16a1,value){if(value==null){return;}when(this._executeAction(value),lang.hitch(this,this._onExecuteSuccess),lang.hitch(this,this._onExecuteFailed));},_setNotification:function(_16a2){this.set("notification",_16a2);}});});},"epi-cms/command/BackCommand":function(){define(["dojo/_base/declare","dojo/topic","epi/dependency","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.cms.command"],function(_16a3,topic,_16a4,_16a5,_16a6){return _16a3([_16a5],{label:_16a6.backtoprevious,tooltip:_16a6.backtoprevious,category:"leftAligned",iconClass:"epi-iconLeft",cssClass:"epi-chromelessButton epi-visibleLink",_previousContent:null,postscript:function(){this.inherited(arguments);this.contextHistory=this.contextHistory||_16a4.resolve("epi.cms.BackContextHistory");},_execute:function(){topic.publish("/epi/shell/context/request",{uri:this._previousContent.uri},{trigger:"back",sender:this});},_onModelChange:function(){this._previousContent=this.contextHistory.getPrevious();this.set("canExecute",this._previousContent!=null);}});});},"epi-cms/contentediting/ContentViewModel":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/on","dojo/when","dojo/Stateful","dijit/Destroyable","epi/dependency","epi/datetime","epi/string","epi/shell/UndoManager","epi/shell/conversion/ObjectConverterRegistry","epi/shell/widget/dialog/Alert","epi/shell/Stateful","../ApplicationSettings","./ContentActionSupport","./ContentEditingValidator","./ContentModelServerSync","./Operation","epi/i18n!epi/cms/nls/episerver.cms.contentediting","epi/i18n!epi/cms/nls/episerver.cms.components.versions"],function(array,_16a7,_16a8,_16a9,lang,on,when,_16aa,_16ab,_16ac,_16ad,_16ae,_16af,_16b0,Alert,_16b1,_16b2,_16b3,_16b4,_16b5,_16b6,res,_16b7){return _16a8([_16aa,_16ab],{contentModel:null,metadata:null,syncService:null,editorFactory:null,syncInterval:10000,validator:null,contentDataStore:null,profileHandler:null,languageContext:null,_converterRegistry:null,_contentVersionStore:null,_syncRetryTimeout:60000,undoManager:null,contextTypeName:"",contentLink:null,contentData:null,viewName:null,isCreatingNewVersion:false,hasUndoSteps:false,hasRedoSteps:false,isValid:true,hasPendingChanges:false,lastSaved:null,isSaved:true,isSaving:false,isOnline:true,hasErrors:false,isChangingContentStatus:false,_isSuspended:false,constructor:function(){},postscript:function(){this.inherited(arguments);this.profileHandler=this.profileHandler||_16ac.resolve("epi.shell.Profile");this.metadataManager=this.metadataManager||_16ac.resolve("epi.shell.MetadataManager");this.currentContentLanguage=this.currentContentLanguage||_16b2.currentContentLanguage;this.contentDataStore=this.contentDataStore||_16ac.resolve("epi.storeregistry").get("epi.cms.contentdata");if(!this._contentVersionStore){this._contentVersionStore=_16ac.resolve("epi.storeregistry").get("epi.cms.contentversion");}this.undoManager=this.undoManager||new _16af();this.validator=this.validator||new _16b4({contextId:this.contentLink,contextTypeName:this.contextTypeName});if(!this.syncService){this._createSyncService();}var _16b8=lang.hitch(this,function(name,_16b9,_16ba){this.set(name,_16ba);});this._operation=new _16b6();this.own(this.syncService.watch("hasPendingChanges",_16b8),this.validator.watch("isValid",_16b8),this.validator.watch("hasErrors",_16b8),this.undoManager.watch("hasUndoSteps",_16b8),this.undoManager.watch("hasRedoSteps",_16b8),on(this._operation,"commit",lang.hitch(this,this._commitChanges)));},setActiveProperty:function(name){this.onSetActiveProperty(name);},suspend:function(){this._isSuspended=true;this.onContentChange();this.onSuspend();},onSuspend:function(){},wakeUp:function(){this._isSuspended=false;},destroy:function(){this.clear();this.inherited(arguments);},clear:function(){this.undoManager.clear();},_createSyncService:function(){var _16bb=new _16b5({contentLink:this.contentLink,contentDataStore:this.contentDataStore});this.syncService=_16bb;},connectLocal:function(_16bc,obj,evt,_16bd){if(!lang.isArray(_16bc)){throw Error("First argument to connectLocal must be an Array");}return _16bc.push(_16a7.connect(obj,evt,this,_16bd));},disconnectLocal:function(_16be){if(lang.isArray(_16be)){var _16bf;while(_16bf=_16be.pop()){_16a7.disconnect(_16bf);}}},resetNotifications:function(){this.validator.clearErrorsBySource(this.validator.validationSource.client);},beginOperation:function(){this._operation.begin();},endOperation:function(){this._operation.end();},abortOperation:function(){this._operation.abort();},getProperty:function(_16c0){return this.contentModel.get(_16c0);},setProperty:function(_16c1,value,_16c2){this._setModelProperty(_16c1,value,_16c2);},publishProperty:function(_16c3,value){this.syncService.publishProperty(_16c3,value).then(lang.hitch(this,function(){this.contentModel.set(_16c3,value);this._patchContentDataStore(this.contentData.contentLink,_16c3,null,value);when(this.contentDataStore.refresh(this.contentData.contentLink),lang.hitch(this,function(_16c4){this.set("contentData",_16c4);}));}));},_commitChanges:function(_16c5){var _16c6=array.map(_16c5,function(item){return {propertyName:item.propertyName,value:item.oldValue,oldValue:item.value};});this.undoManager.createStep(this,this._saveProperties,[_16c6],"Edit properties");},_saveProperties:function(_16c7){this.beginOperation();array.forEach(_16c7,function(p){this._setModelProperty(p.propertyName,p.value,p.oldValue);},this);this.endOperation();},_setModelProperty:function(_16c8,value,_16c9){this.set("isSaved",false);this._operation.save({propertyName:_16c8,value:value,oldValue:_16c9||this.contentModel.get(_16c8)});this.contentModel.set(_16c8,value);this.syncService.scheduleForSync(_16c8,value);this.onPropertyEdited(_16c8,value);},onPropertyEdited:function(_16ca,value){},_onSynchronizeSuccess:function(_16cb,_16cc,_16cd){array.forEach(_16cc,lang.hitch(this,function(_16ce){this.validator.clearPropertyErrors(_16ce.name,this.validator.validationSource.server);this._patchContentDataStore(_16cb,_16ce.name,null,_16ce.value);}));this.validator.setGlobalErrors(_16cd.validationErrors,this.validator.validationSource.server);},_onSynchronizeFailure:function(_16cf,_16d0,_16d1,_16d2){array.forEach(_16d0,function(_16d3){if("successful" in _16d3){if(_16d3.successful){this.validator.clearPropertyErrors(_16d3.name,this.validator.validationSource.server);}else{this.validator.setPropertyErrors(_16d3.name,[{"errorMessage":_16d3.validationErrors,severity:this.validator.severity.error}],this.validator.validationSource.server);}}else{}},this);if(_16d2){if(_16d2.validationErrors){this.validator.setGlobalErrors(_16d2.validationErrors,this.validator.validationSource.server);}else{this.validator.clearGlobalErrors(this.validator.validationSource.server);}}},_contentLinkChanged:function(_16d4,_16d5){this.contentLink=_16d5;this.syncService.contentLink=_16d5;this.validator.setContextId(_16d5);if(!this._isSuspended){var _16d6={uri:"epi.cms.contentdata:///"+_16d5};_16a7.publish("/epi/shell/context/request",[_16d6,{sender:this,contextIdSyncChange:true,trigger:"internal"}]);}},ensureWritableVersion:function(){var _16d7=this.contentLink;if(!this.contentData.isNewVersionRequired){return _16d7;}this.isCreatingNewVersion=true;var def=new _16a9();when(this._contentVersionStore.put({originalContentLink:_16d7}),lang.hitch(this,function(_16d8){this._contentLinkChanged(_16d7,_16d8.contentLink);this.isCreatingNewVersion=false;def.resolve(_16d8);}),lang.hitch(this,function(){this.isCreatingNewVersion=false;def.reject();}));return def;},validate:function(){var def;if(!this.validator){def=new _16a9();def.resolve();}else{def=this.validator.validate();}return def;},revertToPublished:function(){var _16d9=this.contentLink;when(this._contentVersionStore.remove(_16d9),lang.hitch(this,function(){this._loadPublishedVersion(_16d9);}),lang.hitch(this,function(error){var _16da;if(error.status===403){_16da=_16b7.deleteversion.cannotdeletepublished;}else{if(error.status===404){_16da=res.versionstatus.versionnotfound;}}if(_16da){this.dialog=new Alert({description:_16da,onAction:lang.hitch(this,function(){this._loadPublishedVersion(_16d9);})});this.dialog.show();}}));},_loadPublishedVersion:function(_16db){when(this._contentVersionStore.query({contentLink:_16db,language:this.languageContext?this.languageContext.language:"",query:"getpublishedversion"}),lang.hitch(this,function(_16dc){if(_16dc!==null){var _16dd={uri:"epi.cms.contentdata:///"+_16dc.contentLink,context:this};_16a7.publish("/epi/shell/context/request",[_16dd,{sender:this,trigger:"internal"}]);}}));},createDraft:function(){var _16de=this.contentLink;var _16df=this.contentData.status;var _16e0=_16b3.versionStatus;var _16e1=_16df===_16e0.DelayedPublish;return when(this._contentVersionStore.put({originalContentLink:_16de,isCommonDraft:_16e1}),lang.hitch(this,function(_16e2){var _16e3={uri:"epi.cms.contentdata:///"+_16e2.contentLink,context:this};_16a7.publish("/epi/shell/context/request",[_16e3,{sender:this}]);}));},editCommonDraft:function(){var _16e4=this.contentLink;return when(this._contentVersionStore.query({contentLink:_16e4,query:"getcommondraftversion"}),lang.hitch(this,function(_16e5){var _16e6={uri:"epi.cms.contentdata:///"+_16e5.contentLink,context:this};_16a7.publish("/epi/shell/context/request",[_16e6,{sender:this}]);}));},_populateContentModel:function(data,_16e7){var props={},_16e8,_16e9;for(var _16ea in data){var _16eb=_16e7.getPropertyMetadata(_16ea);var _16ec=data[_16ea];if(_16eb.hasSubProperties()){props[_16ea]=this._populateContentModel(_16ec,_16eb);}else{props[_16ea]=_16ec;_16e8=_16eb.customEditorSettings.converter;if(_16e8){_16e9=_16b0.getConverter(_16e8,"runtimeType");if(_16e9){props[_16ea]=_16e9.convert(_16e8,"runtimeType",_16ec);}}}}return props;},getPropertyMetaData:function(_16ed){if(this.metadata){return this.metadata.getPropertyMetadata(_16ed);}else{var _16ee=[],def=new _16a9();this.connectLocal(_16ee,this,"onMetadataResolve",function(_16ef){if(_16ef){def.resolve(this.metadata.getPropertyMetadata(_16ed));}else{def.reject();}this.disconnectLocal(_16ee);});return def;}},getContentModelAndMetadata:function(){var def=new _16a9();when(this.metadataManager.getMetadataForType("EPiServer.Core.ContentData",{contentLink:this.contentLink}),lang.hitch(this,function(_16f0){this.set("metadata",_16f0);var _16f1=this.createContentModelObject(_16f0);this.set("contentModel",_16f1);this.onMetadataResolve(true);def.resolve();}),lang.hitch(this,function(){this.onMetadataResolve(false);def.reject();}));return def;},onMetadataResolve:function(_16f2){},getMetadataThenUpdateModel:function(){var def=new _16a9();when(this.metadataManager.getMetadataForType("EPiServer.Core.ContentData",{contentLink:this.contentLink}),lang.hitch(this,function(_16f3){this.set("metadata",_16f3);var _16f4=this.createContentModelObject(_16f3);this.set("contentModel",lang.mixin(this.contentModel,_16f4));def.resolve();}),function(){def.reject();});return def;},createContentModelObject:function(_16f5){var _16f6=this._populateContentModel(this.contentData.properties,_16f5);var _16f7=new _16b1();_16f7.set(_16f6);return _16f7;},save:function(){if(!this.isOnline){var def=new _16a9();def.resolve(true);return def;}return this._save();},_save:function(){var def=new _16a9(),_16f8=lang.hitch(this,function(_16f9){if(_16f9){if(_16f9.successful){this._onSynchronizeSuccess(_16f9.contentLink,_16f9.properties,_16f9);}else{this._onSynchronizeFailure(_16f9.contentLink,_16f9.properties,_16f9.validationErrors,_16f9);}if(_16f9&&_16f9.hasContentLinkChanged){this._contentLinkChanged(_16f9.contentLink,_16f9.oldContentLink);}}this.set("isOnline",true);this.set("lastSaved",new Date());this.set("isSaving",false);this.set("isSaved",true);def.resolve(true);}),_16fa=lang.hitch(this,function(_16fb){this.set("hasErrors",true);this.set("isSaving",false);this.set("isSaved",false);this.set("isOnline",false);if(_16fb){array.forEach(_16fb.properties,lang.hitch(this,function(_16fc){if(!this.syncService.pendingSync(_16fc.name)){this.syncService.scheduleForSync(_16fc.name,_16fc.value);}}));}setTimeout(lang.hitch(this,function(){this.set("isOnline",true);this._save();}),this._syncRetryTimeout);def.reject(_16fb);});if(this.isCreatingNewVersion||!this.hasPendingChanges){_16f8();}else{when(this.ensureWritableVersion(),lang.hitch(this,function(){this.set("isSaving",true);when(this.syncService.save(),_16f8,_16fa);}),_16fa);}return def;},undo:function(){this.undoManager.undo();},redo:function(){this.undoManager.redo();},_patchContentDataStore:function(_16fd,_16fe,_16ff,_1700){var _1701={};lang.setObject(_16fe,_1700,_1701);return this.contentDataStore.patchCache({contentLink:_16fd,changedBy:this.profileHandler.userName,saved:_16ad.serialize(new Date()),properties:_1701});},changeContentStatus:function(_1702){var _1703=this.contentLink;var def=new _16a9();this.set("isChangingContentStatus",true);var _1704=lang.hitch(this,function(_1705){var _1706=_1705&&_1705.success;var _1707=this.validator;if(_1706){if(_1702==_16b3.action.Publish||_1702==_16b3.action.CheckIn||_1702==(_16b3.saveAction.CheckIn|_16b3.saveAction.DelayedPublish|_16b3.saveAction.ForceCurrentVersion)){this.set("lastSaved",null);}if(_1707){_1707.clearGlobalErrors(_1707.validationSource.server);}def.resolve({id:_1705.id,oldId:_1703});}else{if(_1705&&_1705.validationErrors){if(_1707){_1707.setGlobalErrors(_1705.validationErrors,_1707.validationSource.server);_1707.validate();}def.reject(null);}else{def.reject((_1705&&_1705.errorMessage)?_1705.errorMessage:res.publish.error);}}this.set("isChangingContentStatus",false);});var _1708=lang.hitch(this,function(_1709){_16a7.publish("/epi/cms/action/showerror");def.reject((_1709&&_1709.errorMessage)?_1709.errorMessage:res.publish.error);this.set("isChangingContentStatus",false);});this.onContentChange();when(this.validate(),lang.hitch(this,function(){when(this.save(),lang.hitch(this,function(){when(this.contentDataStore.executeMethod("ChangeStatus",this.contentLink,{action:_1702}),_1704,_1708);}),_1708);}),_1708);return def;},onContentChange:function(){},hasEditAccess:function(){return _16b3.hasAccess(this.contentData.accessMask,_16b3.accessLevel.Edit);},hasAccess:function(_170a){var _170b=!this.languageContext||!this.languageContext.isTranslationNeeded;return _170b&&_16b3.isActionAvailable(this.contentData,_170a||_16b3.action.Edit,_16b3.providerCapabilities.Edit);},canTranslateContent:function(){if(this.viewLanguage&&this.languageContext&&this.viewLanguage!=this.currentContentLanguage){return false;}return true;},canChangeContent:function(_170c){return this.canEditCurrentLanguage()&&this.hasAccess(_170c);},canEditCurrentLanguage:function(){if(!this.languageContext){return true;}return this.languageContext.language==this.currentContentLanguage;}});});},"epi-cms/contentediting/ContentModelServerSync":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/json","dojo/_base/lang","dojo/Stateful","epi/datetime","epi/string"],function(array,_170d,_170e,json,lang,_170f,_1710,_1711){return _170d([_170f],{_queue:null,_isSynchronizing:false,hasPendingChanges:false,contentLink:null,contentDataStore:null,processInterval:200,_processIntervalId:0,_saveDeferred:null,_publish:false,constructor:function(_1712){lang.mixin(this,_1712);this._queue=[];},scheduleForSync:function(_1713,value){if(value===undefined){return;}this.set("hasPendingChanges",true);value=_1710.transformDate(value);var index=this._propertyIndexInQueue(_1713);if(index<0){this._queue.push({name:_1713,value:value});}else{this._queue[index].value=value;}},publishProperty:function(_1714,value){this._publish=true;this.scheduleForSync(_1714,value);return this._synchronizeItem(true);},_propertyIndexInQueue:function(_1715){var index=-1;array.some(this._queue,function(item,i){if(item.name===_1715){index=i;return true;}});return index;},save:function(){return this._startSynchronizeInterval();},_startSynchronizeInterval:function(){if(this._processIntervalId>0){return this._saveDeferred;}var fn=lang.hitch(this,function(){return this._synchronizeItem();});var def=fn();if(this.processInterval>=0){this._processIntervalId=setInterval(fn,this.processInterval);}return def;},_stopSynchronizeInterval:function(){if(this._processIntervalId){clearInterval(this._processIntervalId);this._processIntervalId=0;}},_synchronizeItem:function(){if(this._isSynchronizing){return this._saveDeferred;}if(this._queue.length===0){return this._saveDeferred;}if(!this._saveDeferred){this._saveDeferred=new _170e();}this._isSynchronizing=true;var items=this._queue;this._queue=[];var _1716=this.contentLink;var _1717=lang.hitch(this,function(_1718){var _1719=true;var _171a={};if(_1718){array.forEach(_1718.properties,lang.hitch(this,function(_171b){_171b.name=_1711.pascalToCamel(_171b.name);}));var _171c=_1718.savedContentLink;_171a=lang.mixin({successful:false,contentLink:_1719?_1718.savedContentLink:_1716,hasContentLinkChanged:_1718.savedContentLink&&_171c!=this.contentLink},_1718);if(_171c&&_171c!=this.contentLink){_171a.oldContentLink=this.contentLink;this.contentLink=_171c;}}else{_1719=false;}this._isSynchronizing=false;if(this._queue.length===0){this._stopSynchronizeInterval();this.set("hasPendingChanges",false);var def=this._saveDeferred;this._saveDeferred=null;if(_1719){def.resolve(_171a);}else{def.reject({contentLink:_1716,properties:items,error:"Unexpected result returned from the server."});}}});var _171d=lang.hitch(this,function(error){var _171e={contentLink:_1716,properties:items,error:error};this._isSynchronizing=false;if(this._queue.length===0){var def=this._saveDeferred;this._saveDeferred=null;this._stopSynchronizeInterval();this.set("hasPendingChanges",false);def.reject(_171e);}});_170e.when(this._saveProperties(items),_1717,_171d);return this._saveDeferred;},pendingSync:function(_171f){return this._propertyIndexInQueue(_171f)!==-1;},_saveProperties:function(items){var _1720=this.contentLink;var _1721={};array.forEach(items,lang.hitch(this,function(item){_1721[item.name]=json.toJson(item.value);}));var _1722={id:_1720,properties:_1721,publishChanges:this._publish};this._publish=false;return this.contentDataStore.patch(_1722,{id:_1722.id});}});});},"epi-cms/contentediting/Operation":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Evented","dojo/Stateful"],function(array,_1723,lang,_1724,_1725){return _1723([_1725,_1724],{inProgress:false,changes:null,constructor:function(){this.changes=[];},begin:function(){this.set("inProgress",true);},save:function(data){if(this.inProgress){this.changes=array.filter(this.changes,function(_1726){if(_1726.propertyName===data.propertyName){data.oldValue=_1726.oldValue;return false;}return true;});this.changes.push(data);return;}if(!lang.isArray(data)){data=[data];}this.emit("commit",data);},end:function(){this.set("inProgress",false);if(this.changes.length>0){this.save(this.changes);}this.changes=[];},abort:function(){this.set("inProgress",false);this.changes=[];}});});},"epi-cms/contentediting/ExpirationNotification":function(){define(["dojo/_base/declare","dojo/string","epi/datetime","epi/dependency","epi-cms/ApplicationSettings","epi-cms/contentediting/_ContentEditingNotification","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/cms/nls/episerver.cms.contentediting.versionstatus"],function(_1727,_1728,_1729,_172a,_172b,_172c,_172d,_172e){return _1727([_172c],{postscript:function(){this.inherited(arguments);this._notificationPeriod=_172b.expirationNotificationPeriod;this._setupCommands();},_executeAction:function(_172f){return _172f.contentData.properties.iversionable_expire;},_onExecuteSuccess:function(_1730){var _1731=_1729.serverTime();var _1732=_1730?_1730.stopPublish:null,_1733=new Date(_1732);var text=null;if(_1732&&_1729.isDateValid(_1733)){if(new Date(_1731.getTime()+this._notificationPeriod*1000)>_1733){text=_1733<_1731?_172e.expired:_1728.substitute(_172d.expiretimetext,[_1729.timeToGo(_1733)]);}}if(!text){this._setNotification(null);}else{this._setNotification({content:text,commands:[this._editingCommands.manageExpiration]});}},_viewModelValueHandler:null,_setupCommands:function(){if(!this._editingCommands){this._editingCommands=_172a.resolve("epi.cms.contentEditing.command.Editing");}if(this._commandsWatchHandler){this._commandsWatchHandler.unwatch();}var self=this;var _1734=null;self._commandsWatchHandler=this._editingCommands.manageExpiration.watch("viewModel",function(name,_1735,_1736){if(self._viewModelValueHandler){self._viewModelValueHandler.unwatch();}self._viewModelValueHandler=_1736.watch("value",function(name,_1737,value){self._onExecuteSuccess(value);});});}});});},"epi-cms/contentediting/LanguageNotification":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/url","dojo/dom-construct","epi/dependency","epi-cms/ApplicationSettings","epi-cms/contentediting/_ContentEditingNotification","epi-cms/contentediting/command/Editing","epi/i18n!epi/cms/nls/episerver.cms.contentediting.languagenotification"],function(_1738,lang,array,Url,_1739,_173a,_173b,_173c,_173d,_173e){return _1738([_173c],{_onExecuteSuccess:function(_173f){if(!_173f.languageContext){return;}var store=_173a.resolve("epi.storeregistry").get("epi.cms.language");store.query().then(lang.hitch(this,function(_1740){languageResource={};array.forEach(_1740,function(_1741){languageResource[_1741.languageId]=_1741.name;},this);var _1742=_173f.languageContext.warning;var _1743=_173b.currentContentLanguage;var _1744=_173f.languageContext;var _1745;if(_1743!=_1744.preferredLanguage&&_1744.isTranslationNeeded){_1742=lang.replace(_173e.nottranslatedswitchto,[languageResource[_1744.language],languageResource[_1744.preferredLanguage]]);_1745=_1744.preferredLanguage;}else{if(_1743!=_1744.language&&!_1744.isTranslationNeeded){_1742=lang.replace(_173e.workinginwrongsite,[languageResource[_1743],languageResource[_1744.language]]);_1745=_1744.language;}}if(!_1742){this._setNotification(null);return;}var html=_1739.create("div",{innerHTML:_1742});if(_1745){var url=new Url(window.top.location.href);var text=lang.replace(_173e.switchto,[languageResource[_1745]]);var link=_1739.create("a",{href:[url.scheme,"://",url.authority,url.path,"?language=",_1745,"#context=",_173f.versionAgnosticUri].join(""),innerHTML:text,title:text},html);}this._setNotification({content:html,commands:_1744.isTranslationNeeded&&_1743==_1744.preferredLanguage?[_173d.translate]:[]});}));}});});},"epi-cms/contentediting/ShortcutNotification":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/string","epi-cms/contentediting/_ContentEditingNotification","epi/i18n!epi/cms/nls/episerver.cms.contentediting.shortcutnotification"],function(_1746,lang,_1747,_1748,_1749){var _174a=["normal","shortcut","external","inactive","fetchdata"];var _174b=_1746([_1748],{contentData:null,postscript:function(){this.inherited(arguments);this.watch("contentData",lang.hitch(this,this._contentDataWatchHandler));},_onExecuteSuccess:function(value){if(this._viewModelWatch){this._viewModelWatch.unwatch();}this._viewModelWatch=value.watch("contentModel",lang.hitch(this,function(name,_174c,_174d){if(this._contentModelWatch){this._contentModelWatch.unwatch();}this._contentModelWatch=_174d.watch("iversionable_shortcut",lang.hitch(this,function(name,_174e,_174f){this._updateNotification(_174f&&_174f.pageShortcutType);}));}));this.set("contentData",value.contentData);},_contentDataWatchHandler:function(name,_1750,value){if(value&&value.capabilities&&value.capabilities.isPage){this._updateNotification(value.properties.pageShortcutType);}},_updateNotification:function(_1751){var _1752,_1753=null;if(_1751>0){_1752=_174a[_1751];_1753=_1747.toHTML(_1749[_1752]);}this._setNotification({shortcutType:_1751,content:_1753});}});_174b.LinkTypes=_174a;return _174b;});},"epi-cms/contentediting/ViewSettingsNotification":function(){define(["dojo/_base/declare","epi-cms/contentediting/_ContentEditingNotification","epi/i18n!epi/cms/nls/episerver.cms.contentediting.viewsettingsnotification"],function(_1754,_1755,_1756){return _1754([_1755],{_onExecuteSuccess:function(value){var _1757=!value.viewModel.canChangeContent()&&value.viewSetting.get("enabled")&&value.viewSetting.hasVisitorGroup();this._setNotification(_1757?{content:_1756.visitorgroups.noaccessright}:null);}});});},"epi-cms/contentediting/WorkflowTaskNotification":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojox/html/entities","epi/datetime","epi/string","epi-cms/contentediting/_ContentEditingNotification","epi-cms/contentediting/command/WorkflowTask","epi/i18n!epi/ui/nls/personalization.task"],function(array,_1758,lang,topic,_1759,_175a,_175b,_175c,_175d,_175e){return _1758([_175c],{_contentData:null,taskStatus:["statusnotstarted","statusinprogress","statuscompleted","statusrejected"],constructor:function(){this._storeName="epi.cms.workflowtask";this.inherited(arguments);},_executeAction:function(_175f){this._contentData=_175f;return this._store.query({id:_175f.contentLink});},_onExecuteSuccess:function(tasks){var _1760=[];array.forEach(tasks,function(task){_1760.push({content:_175b.toHTML(this._renderMessage(task)),commands:[new _175d({model:{contentData:this._contentData,task:task}})]});},this);this._setNotification(_1760);if(!tasks||tasks.length===0){topic.publish("/epi/cms/action/refreshmytasks");}},_renderMessage:function(task){var _1761="";_1761+=task.subject&&task.subject.length>0?_1759.encode(task.subject):"-";_1761+=task.dueDate?lang.replace(", {0} {1}",[_175e.duedate.toLowerCase(),_175a.toUserFriendlyString(task.dueDate)]):"";_1761+=", "+_175e[this.taskStatus[task.status]];return _1761;}});});},"epi-cms/contentediting/command/WorkflowTask":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/io-query","epi","epi-cms/contentediting/command/_LegacyDialogCommandBase","epi-cms/core/ContentReference","epi/i18n!epi/cms/nls/episerver.cms.contentediting.command.workflowtask"],function(_1762,lang,_1763,_1764,_1765,epi,_1766,_1767,_1768){return _1762([_1766],{label:_1768.label,tooltip:_1768.tooltip,cssClass:"epi-chromelessButton epi-visibleLink",dialogPath:"Edit/WorkflowTask.aspx",raiseCloseEvent:true,getDialogParams:function(){var self=this;return {dialogTitle:_1768.title,legacyButtonQuery:"div span.epi-cmsButton",onMapDialogButton:function(_1769){return self._mapDialogButtons(_1769);},onLoad:function(_176a){self._closeLegacyDialogOnRedirect(_176a,this);},destroyOnHide:true,showCloseButton:true};},getContentReference:function(){return new _1767(this.model.contentData.contentLink);},getRouteParams:function(){return lang.mixin({task:this.model.task.taskId},this.inherited(arguments));},_onModelChange:function(){var model=this.model;var _176b=!!(model&&model.contentData&&!model.contentData.isDeleted&&model.task&&model.task.taskId);this.set("canExecute",_176b);},_isCancelButton:function(_176c){return _176c&&_1764.contains(_176c,"epi-cmsButton-Cancel");},_mapDialogButtons:function(_176d){return !(this._isCancelButton(_176d)||_1764.contains(_176d,"epi-cmsButton-ViewMode"));},_closeLegacyDialogOnRedirect:function(_176e,_176f){var uri=_176e.containerIframe.contentWindow.location.href,query=uri.substring(uri.indexOf("?")+1,uri.length),_1770=_1765.queryToObject(query);if(!_1770||!(_1770.task)){_176f.hide();}}});});},"url:epi-cms/contentediting/templates/PageDataController.html":"<div style=\"width: 100%; height: 100%;\">\r\n    <div data-dojo-attach-point=\"layoutContainer\" data-dojo-type=\"dijit/layout/BorderContainer\" data-dojo-props=\"gutters: false, livesplitters: false\" style=\"width: 100%; height: 100%\">\r\n        <div data-dojo-attach-point=\"toolbar\" data-dojo-type=\"epi-cms/contentediting/EditToolbar\" data-dojo-props=\"region:'top'\"></div>\r\n        <div data-dojo-attach-point=\"notificationBar\" data-dojo-type=\"epi-cms/contentediting/NotificationBar\" data-dojo-props=\"region:'top'\"></div>\r\n        <div data-dojo-attach-point=\"editLayout\" data-dojo-type=\"epi/shell/layout/CardContainer\" data-dojo-props=\"region: 'center'\">\r\n            <div data-dojo-attach-point=\"iframeWithOverlay\" data-dojo-type=\"epi/shell/widget/IframeWithOverlay\" data-dojo-props=\"fitContainer: true\">\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>","epi-cms/contentediting/SettingsPanel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","dojo/when","dojo/dom-geometry","dijit/_Container","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","dijit/layout/BorderContainer","epi/shell/layout/SimpleContainer","dojo/text!./templates/SettingsPanel.html"],function(_1771,lang,array,_1772,when,_1773,_1774,_1775,_1776,_1777,_1778,_1779,_177a){return _1771([_1777,_1774,_1775,_1776],{templateString:_177a,contentViewModel:null,detailsWidgetIdentifier:"epi-cms/contentediting/ContentDetails",detailsModelIdentifier:"epi-cms/contentediting/viewmodel/ContentDetailsViewModel",detailsWidgetProperties:null,_contentDetailsDef:null,_contentDetailsModelDef:null,buildRendering:function(){this.inherited(arguments);var _177b=this.detailsWidgetIdentifier;var _177c=this.detailsModelIdentifier;var _177d=new _1772();var _177e=new _1772();require([_177b,_177c],lang.hitch(this,function(_177f,_1780){var _1781=new _177f({},this.contentDetails);this.own(_1781);var model=new _1780();this.own(model);_1781.set("model",model);_1781.startup();this.contentDetails=_1781;_177d.resolve(_1781);_177e.resolve(model);}));this._contentDetailsDef=_177d;this._contentDetailsModelDef=_177e;},_setContentViewModelAttr:function(_1782){this._set("contentViewModel",_1782);when(this._contentDetailsModelDef,function(model){model.set("dataModel",_1782);});},addChild:function(w){if(this.detailsWidgetProperties){var _1783=array.filter(this.detailsWidgetProperties,function(item){return item.propertyName==w.name;});if(_1783.length>0){when(this._contentDetailsDef,lang.hitch(this,function(_1784){_1784.addChild(w,_1783[0].options);}));return;}}this.widgetContainer.addChild(w);}});});},"url:epi-cms/contentediting/templates/SettingsPanel.html":"<div class=\"epi-documentHeader\">\r\n    <div data-dojo-type=\"epi/shell/layout/SimpleContainer\" data-dojo-attach-point=\"widgetContainer\"></div>\r\n    <div data-dojo-attach-point=\"contentDetails\"></div>\r\n</div>","epi-cms/contentediting/ValidationTextboxWithWarning":function(){define(["dojo/_base/declare","dojox/validate/regexp","dijit/form/ValidationTextBox"],function(_1785,_1786,_1787){return _1785([_1787],{regExpForWarning:null,acceptUrl:false,acceptMailAddress:false,_refreshState:function(){if(!this._created){return;}this.focused?this._validateWhenTyping():this.validate(false);},_isValidWhenTyping:function(){var value=this.textbox.value;return (this.acceptUrl&&(new RegExp(_1786.url({scheme:true}))).test(value))||(this.acceptMailAddress&&(new RegExp("mailto\\:"+_1786.emailAddress())).test(value))||(this.regExpForWarning&&(new RegExp("^(?:"+this.regExpForWarning+")"+(this.required?"":"?")+"$")).test(value));},_validateWhenTyping:function(){var _1788="";var _1789=this.disabled||this.isValid(true);if(_1789){this._maskValidSubsetError=true;}var _178a=this._isEmpty(this.textbox.value);var _178b=!_1789&&this._isValidSubset();this._set("state",_1789?(this._isValidWhenTyping()?"":"Incomplete"):(((_178a||_178b)&&this._maskValidSubsetError)?"Incomplete":"Error"));this.focusNode.setAttribute("aria-invalid",_1789?"false":"true");if(this.state=="Error"){this._maskValidSubsetError=_178b;_1788=this.getErrorMessage(true);}else{if(this.state=="Incomplete"){_1788=this.getPromptMessage(true);this._maskValidSubsetError=!this._hasBeenBlurred;}else{if(_178a){_1788=this.getPromptMessage(true);}}}this.set("message",_1788);return _1789;}});});},"dojox/validate/regexp":function(){define("dojox/validate/regexp",["dojo/_base/lang","dojo/regexp","dojox/main"],function(lang,_178c,dojox){var _178d=lang.getObject("validate.regexp",true,dojox);_178d=dojox.validate.regexp={ipAddress:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.allowDottedDecimal!="boolean"){flags.allowDottedDecimal=true;}if(typeof flags.allowDottedHex!="boolean"){flags.allowDottedHex=true;}if(typeof flags.allowDottedOctal!="boolean"){flags.allowDottedOctal=true;}if(typeof flags.allowDecimal!="boolean"){flags.allowDecimal=true;}if(typeof flags.allowHex!="boolean"){flags.allowHex=true;}if(typeof flags.allowIPv6!="boolean"){flags.allowIPv6=true;}if(typeof flags.allowHybrid!="boolean"){flags.allowHybrid=true;}var _178e="((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])";var _178f="(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]";var _1790="(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]";var _1791="(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|"+"4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])";var hexRE="0[xX]0*[\\da-fA-F]{1,8}";var _1792="([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}";var _1793="([\\da-fA-F]{1,4}\\:){6}"+"((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])";var a=[];if(flags.allowDottedDecimal){a.push(_178e);}if(flags.allowDottedHex){a.push(_178f);}if(flags.allowDottedOctal){a.push(_1790);}if(flags.allowDecimal){a.push(_1791);}if(flags.allowHex){a.push(hexRE);}if(flags.allowIPv6){a.push(_1792);}if(flags.allowHybrid){a.push(_1793);}var _1794="";if(a.length>0){_1794="("+a.join("|")+")";}return _1794;},host:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.allowIP!="boolean"){flags.allowIP=true;}if(typeof flags.allowLocal!="boolean"){flags.allowLocal=false;}if(typeof flags.allowPort!="boolean"){flags.allowPort=true;}if(typeof flags.allowNamed!="boolean"){flags.allowNamed=false;}var _1795="(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)";var _1796="(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)";var _1797=flags.allowPort?"(\\:\\d+)?":"";var _1798="((?:"+_1795+"\\.)+"+_1796+"\\.?)";if(flags.allowIP){_1798+="|"+_178d.ipAddress(flags);}if(flags.allowLocal){_1798+="|localhost";}if(flags.allowNamed){_1798+="|^[^-][a-zA-Z0-9_-]*";}return "("+_1798+")"+_1797;},url:function(flags){flags=(typeof flags=="object")?flags:{};if(!("scheme" in flags)){flags.scheme=[true,false];}var _1799=_178c.buildGroupRE(flags.scheme,function(q){if(q){return "(https?|ftps?)\\://";}return "";});var _179a="(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]+(?:\\?[^?#\\s/]*)?(?:#[A-Za-z][\\w.:-]*)?)?)?";return _1799+_178d.host(flags)+_179a;},emailAddress:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.allowCruft!="boolean"){flags.allowCruft=false;}flags.allowPort=false;var _179b="([!#-'*+\\-\\/-9=?A-Z^-~]+[.])*[!#-'*+\\-\\/-9=?A-Z^-~]+";var _179c=_179b+"@"+_178d.host(flags);if(flags.allowCruft){_179c="<?(mailto\\:)?"+_179c+">?";}return _179c;},emailAddressList:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.listSeparator!="string"){flags.listSeparator="\\s;,";}var _179d=_178d.emailAddress(flags);var _179e="("+_179d+"\\s*["+flags.listSeparator+"]\\s*)*"+_179d+"\\s*["+flags.listSeparator+"]?\\s*";return _179e;},numberFormat:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.format=="undefined"){flags.format="###-###-####";}var _179f=function(_17a0){return _178c.escapeString(_17a0,"?").replace(/\?/g,"\\d?").replace(/#/g,"\\d");};return _178c.buildGroupRE(flags.format,_179f);},ca:{postalCode:function(){return "([A-Z][0-9][A-Z] [0-9][A-Z][0-9])";},province:function(){return "(AB|BC|MB|NB|NL|NS|NT|NU|ON|PE|QC|SK|YT)";}},us:{state:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.allowTerritories!="boolean"){flags.allowTerritories=true;}if(typeof flags.allowMilitary!="boolean"){flags.allowMilitary=true;}var _17a1="AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|"+"NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY";var _17a2="AS|FM|GU|MH|MP|PW|PR|VI";var _17a3="AA|AE|AP";if(flags.allowTerritories){_17a1+="|"+_17a2;}if(flags.allowMilitary){_17a1+="|"+_17a3;}return "("+_17a1+")";}}};return _178d;});},"dojox/main":function(){define("dojox/main",["dojo/_base/kernel"],function(dojo){return dojo.dojox;});},"epi-cms/contentediting/viewmodel/ContentDetailsViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","epi","epi/datetime","epi/dependency","epi/username","epi-cms/contentediting/command/AccessRights","epi-cms/contentediting/command/LanguageSettings","epi-cms/contentediting/command/DynamicProperties","epi/shell/command/_CommandConsumerMixin","epi/shell/command/_GlobalCommandProviderMixin","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/contentediting/viewmodel/_ContentViewModelObserver"],function(array,_17a4,lang,epi,_17a5,_17a6,_17a7,_17a8,_17a9,_17aa,_17ab,_17ac,_17ad,_17ae,_17af){return _17a4([_17af,_17ab,_17ac],{commandKey:"epi.cms.contentdetailsmenu",res:null,contentTypeName:null,contentId:null,visibleToEveryOne:null,existingLanguages:null,accessRightsCommand:null,languageSettingsCommand:null,dynamicPropertiesCommand:null,expirationCommand:null,constructor:function(_17b0){_17a4.safeMixin(this,_17b0);},postscript:function(){this.initializeCommandProviders();this.accessRightsCommand=new _17a8();this.languageSettingsCommand=new _17a9();this.dynamicPropertiesCommand=new _17aa();if(!this.expirationCommand){var _17b1=_17a6.resolve("epi.cms.contentEditing.command.Editing");this.expirationCommand=_17b1.manageExpiration;}if(!this.store){var _17b2=_17a6.resolve("epi.storeregistry");this.store=_17b2.get("epi.cms.contenttype");}this.inherited(arguments);},destroy:function(){this.accessRightsCommand.destroy();this.languageSettingsCommand.destroy();this.dynamicPropertiesCommand.destroy();this.inherited(arguments);},_setDataModelAttr:function(value){this.updateCommandModel(value);this.accessRightsCommand.set("model",value);this.languageSettingsCommand.set("model",value);this.dynamicPropertiesCommand.set("model",value);this.inherited(arguments);},onDataModelChange:function(name,_17b3,value){var _17b4=this.dataModel.contentData,_17b5=new _17ae(_17b4.contentLink);this.set("contentId",_17b5.id);this.set("existingLanguages",array.map(_17b4.existingLanguageBranches,function(item){return {text:item.languageId,urlSegment:item.urlSegment,isCurrentLanguage:_17b4.currentLanguageBranch&&item.languageId===_17b4.currentLanguageBranch.languageId,contentLink:new _17ae(item.commonDraftLink).createVersionUnspecificReference().toString()};}));this.set("visibleToEveryOne",_17b4.visibleToEveryOne);dojo.when(this.store.get(_17b4.contentTypeID),dojo.hitch(this,function(type){this.set("contentTypeName",type.localizedName);}));this.set("commands",this.getCommands());},getCommands:function(){var _17b6=this.inherited(arguments);return [this.dynamicPropertiesCommand,this.languageSettingsCommand,this.expirationCommand].concat(_17b6);}});});},"epi-cms/contentediting/command/AccessRights":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_LegacyDialogCommandBase","epi/i18n!epi/cms/nls/episerver.cms.contentediting.contentdetails.command.accessrights"],function(_17b7,_17b8,_17b9,_17ba){return _17b7([_17b9],{name:"AccessRights",label:_17ba.label,tooltip:_17ba.tooltip,dialogPath:"Edit/EditSecurity.aspx",raiseCloseEvent:true,_onModelChange:function(){var _17bb=this.model.contentData,_17bc=_17b8.hasAccess(_17bb.accessMask,_17b8.accessLevel.Administer),_17bd=this.model.canChangeContent();this.set("canExecute",_17bb.capabilities.securable&&_17bc&&_17bd);}});});},"epi-cms/contentediting/command/LanguageSettings":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_LegacyDialogCommandBase","epi/i18n!epi/cms/nls/episerver.cms.contentediting.contentdetails.command.languagesettings"],function(_17be,_17bf,_17c0,_17c1){return _17be([_17c0],{name:"LanguageSettings",label:_17c1.label,tooltip:_17c1.tooltip,dialogPath:"Edit/LanguageSettings.aspx",raiseCloseEvent:true,_onModelChange:function(){var _17c2=this.model.contentData,_17c3=_17bf.hasAccess(_17c2.accessMask,_17bf.accessLevel.Administer),_17c4=this.model.canChangeContent();this.set("canExecute",_17c2.capabilities.languageSettings&&_17c3&&_17c4);}});});},"epi-cms/contentediting/command/DynamicProperties":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_LegacyDialogCommandBase","epi/i18n!epi/cms/nls/episerver.cms.contentediting.contentdetails.command.dynamicproperties"],function(_17c5,_17c6,_17c7,_17c8){return _17c5([_17c7],{label:_17c8.label,tooltip:_17c8.tooltip,dialogPath:"Edit/EditDynProp.aspx",raiseCloseEvent:false,_onModelChange:function(){var _17c9=this.model.contentData,_17ca=_17c6.hasAccess(_17c9.accessMask,_17c6.accessLevel.Administer),_17cb=this.model.canChangeContent();this.set("canExecute",_17c9.capabilities.dynamicProperties&&_17ca&&_17cb);}});});},"epi-cms/conversion/PropertyContentAreaConverter":function(){define(["dojo/_base/declare"],function(_17cc){return _17cc(null,{sourceDataType:"epi.cms.propertycontentarea",targetDataType:"runtimeType",registerDefaultConverters:function(_17cd){_17cd.registerConverter(this.sourceDataType,this.targetDataType,this);},convert:function(_17ce,_17cf,data){if(_17ce===this.sourceDataType&&_17cf===this.targetDataType){return data?data._unparsedString:data;}return null;}});});},"epi-cms/layout/CreateContentGroupContainer":function(){define(["dojo/_base/declare","dojo/dom-construct","epi/shell/layout/SimpleContainer"],function(_17d0,_17d1,_17d2){return _17d0([_17d2],{templateString:"<div class='epi-containerLayout clearfix'>                            <div class='epi-formsHeaderContainer'>                                <h2>${title}</h2>                            </div>                            <ul data-dojo-attach-point='containerNode'></ul>                        </div>"});});},"epi-cms/layout/EditLayoutContainer":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dijit/layout/TabContainer","dijit/registry","dojo/text!./templates/EditLayoutContainer.html"],function(array,_17d3,_17d4,_17d5,_17d6,_17d7){return _17d3([_17d5],{templateString:_17d7,postMixInProperties:function(){this.inherited(arguments);this.doLayout=false;this.tabPosition="top";},addChild:function(_17d8,index){if(_17d8.region==="top"){_17d4.place(_17d8.domNode,this.topPaneContainerNode);if(this._started&&!_17d8._started){_17d8.startup();}}else{this.inherited(arguments);}},removeChild:function(_17d9){if(_17d9.region==="top"){if(this._descendantsBeingDestroyed){return;}if(this._started){this.layout();}}else{this.inherited(arguments);}},getChildren:function(){var _17da=this.topPaneContainerNode?_17d6.findWidgets(this.topPaneContainerNode):[];return _17da.concat(this.inherited(arguments));},layout:function(){if(!this._contentBox||typeof (this._contentBox.l)=="undefined"){return;}var _17db=_17d6.findWidgets(this.topPaneContainerNode);array.forEach(_17db,function(_17dc){_17dc.resize();});return this.inherited(arguments);},selectChild:function(_17dd){if(_17dd.region==="top"){return;}else{return this.inherited(arguments);}}});});},"url:epi-cms/layout/templates/EditLayoutContainer.html":"<div class=\"dijitTabContainer\">\r\n    <div data-dojo-attach-point=\"topPaneContainerNode\"></div>\r\n\t<div class=\"dijitTabListWrapper\" data-dojo-attach-point=\"tablistNode\"></div>\r\n\t<div data-dojo-attach-point=\"tablistSpacer\" class=\"dijitTabSpacer ${baseClass}-spacer\"></div>\r\n\t<div class=\"dijitTabPaneWrapper ${baseClass}-container\" data-dojo-attach-point=\"containerNode\"></div>\r\n</div>\r\n","epi-cms/legacy/LegacyFormEditor":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/focus","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Button","epi/dependency","epi/shell/widget/dialog/Dialog","epi-cms/widget/_HasChildDialogMixin","epi/shell/widget/_ValueRequiredMixin","epi-cms/legacy/EditPropertyWidget","epi/i18n!epi/cms/nls/episerver.cms.legacy.legacyformeditor"],function(_17de,lang,_17df,_17e0,_17e1,_17e2,_17e3,_17e4,_17e5,_17e6,_17e7,_17e8,res){return _17de([_17e0,_17e1,_17e2,_17e6,_17e7],{localization:res,destroyOnHide:false,editorWidgetClass:_17e8,templateString:"            <div class=\"dijit dijitReset dijitInline dijitLeft epi-legacyFormEditor\">                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"openButton\" data-dojo-attach-event=\"onClick: openEditor\" data-dojo-props=\"label:'${localization.helptext}'\"></div>            </div>",editorWidget:null,value:null,multiple:false,contentLink:null,contentTypeId:null,contentLanguage:null,propertyName:null,_dialog:null,onChange:function(){},postCreate:function(){this.inherited(arguments);lang.mixin(this.params,{contentLink:this.contentLink});},buildRendering:function(){this.inherited(arguments);if(this.output){this.output.set("disabled",true);}},destroy:function(){if(this._dialog){this._dialog.destroyRecursive();}this.inherited(arguments);},_setReadOnlyAttr:function(value){this._set("readOnly",value);this.openButton.set("disabled",value);},_setValueAttr:function(value){this._set("value",value);this.setDisplayValue(value);},_getValueAttr:function(value){if(this.editorWidget){this._set("value",this.editorWidget.get("value",value));}return this.value;},_onChange:function(){var value=this.editorWidget.get("value");this.onChange(value);if(this._dialog&&this._dialog.open){this._dialog.hide();}this.setDisplayValue(value);},_onCancel:function(){this._dialog.hide();},_onDialogHide:function(){this.isShowingChildDialog=false;},openEditor:function(){this.isShowingChildDialog=true;if(!this._dialog||this.destroyOnHide){this._createDialog();}this.editorWidget.set("value",this.value);this._dialog.show();},_createDialog:function(){var _17e9=this.editorWidgetClass;this.editorWidget=new _17e9(this.params);this._dialog=new _17e5({destroyOnHide:this.destroyOnHide,content:this.editorWidget,title:this.editorWidget.title||this.label,defaultActionsVisible:false,dialogClass:"",contentClass:"epi-dialog-fullWidth"});this.connect(this.editorWidget,"onResize",lang.hitch(this,function(){this._dialog.resize();}));this.connect(this.editorWidget,"onChange","_onChange");this.connect(this.editorWidget,"onCancel","_onCancel");this.connect(this._dialog,"onHide","_onDialogHide");},setDisplayValue:function(value){if(this.output){this.output.set("value",this.localization.helptext);}},focus:function(){this.openButton.focus();}});});},"epi-cms/legacy/EditPropertyWidget":function(){define(["epi","dojo","dijit","dojo/i18n","dojo/string","dojox/html/entities","epi-cms/contentediting/RenderManager","epi-cms/legacy/LegacyDialogWrapper","epi/routes"],function(epi,dojo,dijit,i18n,_17ea,_17eb,_17ec,_17ed,_17ee){return dojo.declare([_17ed],{editorFeatures:null,value:"",contentLink:null,contentTypeId:null,contentLanguage:null,propertyName:null,fullName:null,_reloadOnNextEdit:false,onChange:function(_17ef){},postMixInProperties:function(){this.features=dojo.mixin({width:400,height:30},this.editorFeatures);this.autoFit=true;this.connect(this,"onCallback","_onCallback");this.inherited(arguments);},startup:function(){this.inherited(arguments);var _17f0={moduleArea:"LegacyCMS",path:"edit/EditProperty.aspx",epslanguage:this.contentLanguage,propertyname:this.fullName};dojo.mixin(_17f0,this.contentLink?{id:this.contentLink}:{contentTypeId:this.contentTypeId,parentLink:this.parentLink});this.set("url",_17ee.getActionPath(_17f0));},_setUrlAttr:function(url){this._currentUrl=url;var value=_17eb.encode(dojo.toJson(this.value));var _17f1=_17ea.substitute("<html><body><form method=\"post\" action=\"${0}\" ><input type=\"hidden\" name=\"value\" value=\"${1}\" /></form></body></html>",[url,value]);this.containerIframe.contentDocument.write(_17f1);this.containerIframe.contentDocument.forms[0].submit();},_onCallback:function(_17f2){var _17f3=_17f2.value;var _17f4=dojo.fromJson(_17f3);if(this._oldStringValue===undefined){this._oldStringValue=dojo.toJson(this.value);}if(_17f3!==this._oldStringValue){this._oldStringValue=dojo.toJson(_17f4);this.value=_17f4;this.onChange(_17f4);}else{this.onCancel();}},resize:function(){this.inherited(arguments);if(this._reloadOnNextEdit){this._reloadOnNextEdit=false;this._reloadUrl(true);}},_setValueAttr:function(value){this._set("value",value);if(this._started){this._reloadOnNextEdit=true;}}});});},"epi-cms/legacy/LegacyDialogWrapper":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/sniff","dojo/aspect","dojo/on","dojo/topic","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/query","dojo/string","dojo/when","dijit/_Contained","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/a11y","dijit/focus","dijit/form/Button","dijit/layout/_LayoutWidget","epi/Url","epi/shell/widget/_ActionProviderWidget","epi-cms/legacy/_LegacyDialogObject","epi-cms/legacy/LegacyDialogPopup","epi/i18n!epi/cms/nls/episerver.shared.action"],function(array,_17f5,lang,sniff,_17f6,on,topic,_17f7,_17f8,_17f9,_17fa,_17fb,has,query,_17fc,when,_17fd,_17fe,_17ff,a11y,_1800,_1801,_1802,Url,_1803,_1804,_1805,_1806){return _17f5([_1802,_17fe,_17ff,_1803,_17fd],{_currentUrl:null,dialogArguments:null,callbackArguments:null,features:null,autoFit:false,showCloseButton:false,_isIframeInitialLoad:true,_iframeFocusRegistration:null,_scrollbarWidth:null,_iframeHandles:null,templateString:"        <div style=\"position: relative;\" tabindex=\"0\">            <iframe data-dojo-attach-point=\"containerIframe\" tabindex=\"-1\" frameborder=\"0\" style=\"border: none; position: absolute, top:0, left: 0;\" src=\"about:blank\" ></iframe>        </div>",_mappedButtons:null,postMixInProperties:function(){this.inherited(arguments);this._isIframeInitialLoad=true;this._iframeHandles=[];this.features=lang.mixin({width:320,height:240},this.features);},postCreate:function(){this.inherited(arguments);this._legacyDialog=this._createLegacyDialogObject(lang.hitch(this,function(){this.onCallback.apply(this,arguments);}),this.callbackArguments,this.dialogArguments,window);this._resetIframeContainerSize();},startup:function(){this.inherited(arguments);if(this.containerIframe.attachEvent){this.containerIframe.attachEvent("onload",lang.hitch(this,this._onIframeLoad));}else{this.connect(this.containerIframe,"onload",lang.hitch(this,this._onIframeLoad));}},resize:function(){this.inherited(arguments);if(this._started){this._setIframeSizeFromDomNode();}},_setUrlAttr:function(value){var url=value||"about:blank";this._currentUrl=url;_17f7.set(this.containerIframe,"src",url);},onCallback:function(_1807){},onLoad:function(){},onCancel:function(){},onFocus:function(){this.inherited(arguments);this._focusIframeContent();},onMapDialogButton:function(_1808){return true;},onBeforePerformAction:function(_1809){},getLegacyDialog:function(){return this._legacyDialog;},_focusIframeContent:function(){var _180a=this.containerIframe.contentWindow,doc=_180a&&_180a.document,_180b=(doc&&a11y.getFirstInTabbingOrder(doc))||this.containerIframe;_1800.focus(_180b);},_onIframeLoad:function(){this.own(topic.subscribe("/IsInLegacyWrapper/NeedToBeCloseOnLoad",lang.hitch(this,function(_180c){this.onCancel();})));if(!has("ie")){this._iframeFocusRegistration=_1800.registerIframe(this.containerIframe);}this._focusIframeContent();this._overrideLegacyDialogUtilities();var _180d=this.containerIframe.contentWindow;this._iframeHandles.push(on(_180d,"unload",lang.hitch(this,this._removeIframeHandles)));if(_180d.EPi&&_180d.EPi.ToolButton){this._iframeHandles.push(_17f6.after(_180d.EPi.ToolButton,"SetEnabled",lang.hitch(this,this._toolButtonChanged),true));}this._iframeHandles.push(_17f6.after(this._legacyDialog,"ButtonChanged",lang.hitch(this,this._toolButtonChanged),true));this._mapDialogButtons();this._setTitle();var _180e=query(".epi-contentContainer",this.containerIframe.contentWindow.document)[0];if(_180e){_17f8.add(_180e,"epi-legacyDialog");}if(this.autoFit){this._calculateAndSetContentSize();}this.onResize();this.onResize();if(this.onLoad){this.onLoad.apply(this,arguments);}this._isIframeInitialLoad=false;},_removeIframeHandles:function(){array.forEach(this._iframeHandles,function(_180f){_180f.remove();});this._iframeHandles=[];this._mappedButtons=null;},_setTitle:function(){if(this.dialogTitle){this.title=this.dialogTitle;return;}var title=query("title",this.containerIframe.contentWindow.document)[0];if(title){this.title=_17fc.trim(title.innerHTML);}},_getScrollbarWidth:function(){if(this._scrollbarWidth===null){var d=_17f9.create("div",{style:"position:absolute; top:-2000; left:-2000; width:100px; height:100px; overflow:scroll"},document.body);this._scrollbarWidth=d.offsetWidth-d.clientWidth;_17f9.destroy(d);}return this._scrollbarWidth;},_boxToStyle:function(size){return {width:size.w+"px",height:size.h+"px"};},_setIframeSizeFromDomNode:function(){_17fb.set(this.containerIframe,this._boxToStyle(_17fa.getContentBox(this.domNode)));},_setContentSize:function(size){_17fb.set(this.domNode,this._boxToStyle(size));this._setIframeSizeFromDomNode();},_calculateAndSetContentSize:function(_1810){function _1811(doc,dir){if(doc&&doc.body&&doc.documentElement){return Math.max(doc.documentElement["client"+dir],doc.documentElement["scroll"+dir],doc.documentElement["offset"+dir],doc.body["scroll"+dir],doc.body["offset"+dir]);}return 0;};var _1812=null;try{_1812=this.containerIframe.contentWindow.document;}catch(e){return;}var _1813=(_1812.documentElement.scrollHeight-_1812.documentElement.clientHeight)>0,_1814=_1813&&this.autoFit?this._getScrollbarWidth():0,_1815={w:_1811(_1812,"Width")+_1814,h:_1811(_1812,"Height")};this._setContentSize(_1815);},_resetIframeContainerSize:function(){this._setContentSize({w:this.features.width,h:this.features.height});},_showNode:function(_1816,show){if(!_1816){return;}_17fb.set(_1816,"display",show?"":"none");},_toolButtonChanged:function(_1817,_1818){if(typeof _1817==="string"){var _1819=lang.getObject("containerIframe.contentWindow.EPi",false,this);_1817=_1819&&_1819._GetDomObject&&_1819._GetDomObject(_1817);}if(_1817){if(this.hasAction(_1817.id)){this.setActionProperty(_1817.id,"disabled",_1817.disabled);this.setActionProperty(_1817.id,"visible",_1817.style.display!="none");this.setActionProperty(_1817.id,"label",_1817.value||_1817.innerHTML);}var _181a=this._mappedButtons[_1817.id];if(_181a){this._showNode(_181a.containerNode,false);}}},_mapDialogButtons:function(){var _181b=query(this.legacyButtonQuery||"[data-epi-dialog-button]",this.containerIframe.contentWindow.document);this.removeActions(this.getActions());this._mappedButtons={};array.forEach(_181b,function(_181c){var _181d=_17f7.get(_181c,"data-epi-dialog-button"),_181e=null;switch(_181d){case "functioner":return;case "container":_181e=query("[data-epi-dialog-button=\"functioner\"]",_181c)[0];break;default:if(_181c.tagName=="INPUT"){_181e=_181c;if(_17f8.contains(_181e.parentNode,"epi-cmsButton")){_181c=_181e.parentNode;}}else{_181e=query("INPUT",_181c)[0];}break;}this._mappedButtons[_181e.id]={containerNode:_181c,functionNode:_181e};this._showNode(_181c,false);when(this.onMapDialogButton(_181e),lang.hitch(this,function(_181f){if(_181f){var label=_181e.tagName=="INPUT"?_181e.value:_181e.innerHTML,title=_181e.tagName=="INPUT"?_17f7.get(_181e,"title"):_181e.innerHTML,_1820={name:_181e.id,label:label,disabled:_181e.disabled,title:title,action:lang.hitch(this,function(){this.onBeforePerformAction(_1820,_181e);_181e.click();})};this.addActions(_1820);}}));},this);if(this.showCloseButton){this.addActions({name:"close",label:_1806.close,action:lang.hitch(this,this.onCancel)});}},_overrideLegacyDialogUtilities:function(){var _1821=this.containerIframe.contentWindow;if(!_1821.EPi){_1821.EPi={};}_1821.EPi.CreateDialog=lang.hitch(this,this._createLegacyDialogFnc);_1821.EPi.GetDialog=lang.hitch(this,this._getLegacyDialogFnc);},_getLegacyDialogFnc:function(win){if(win){return win.EPi.GetDialog();}return this._legacyDialog;},_createLegacyDialogFnc:function(url,_1822,_1823,_1824,_1825,_1826){var _1827=new _1805({url:url,destroyOnHide:true,dialogArguments:_1824,callbackArguments:_1823,features:_1825});_1827.on("Callback",lang.hitch(this,function(){if(_1822){_1822.apply(this,arguments);}}));_1827.show();return _1827.legacyDialogObject;},_createLegacyDialogObject:function(_1828,_1829,_182a,_182b){var obj=new _1804({callbackMethod:_1828,callbackArguments:_1829,dialogArguments:_182a,_opener:_182b?_182b.top:window.top});try{obj._dialog=this.containerIframe.contentWindow;}catch(e){obj._dialog=null;}return obj;},_reloadUrl:function(_182c){this._isIframeInitialLoad=_182c;if(this._isIframeInitialLoad){this._resetIframeContainerSize();}var url=new Url(this._currentUrl);lang.mixin(url.query,{"epi.preventCache":new Date().valueOf()});this.set("url",url.toString());},cleanup:function(){var _182d=this.containerIframe.contentWindow;_182d.EPi.CreateDialog=null;_182d.EPi.GetDialog=null;if(this._legacyDialog&&!this._legacyDialog.IsCleaned()){this._legacyDialog.Cleanup();}},destroy:function(){this.cleanup();if(this._iframeFocusRegistration){this._iframeFocusRegistration.remove();this._iframeFocusRegistration=null;}this.inherited(arguments);}});});},"epi-cms/legacy/_LegacyDialogObject":function(){define(["dojo/_base/declare","dojo/_base/kernel"],function(_182e,_182f){return _182e(null,{_dialog:null,constructor:function(_1830){this.callbackMethod=_1830.callbackMethod||null;this.callbackArguments=_1830.callbackArguments||null;this.dialogArguments=_1830.dialogArguments||null;this._opener=(_1830.opener?_1830.opener.top:window.top);while(this._opener.EPiOpenedDialog&&this._opener.EPiOpenedDialog._dialog){this._opener=this._opener.EPiOpenedDialog._dialog;}this._opener.EPiOpenedDialog=this;},Close:function(_1831){if(typeof (this.callbackMethod)=="function"){(this.callbackMethod).call(this,_1831,this.callbackArguments);}},ButtonChanged:function(_1832){},Cleanup:function(){var _1833;if(this._dialog!=null){}this._CleanDialog();if(this._opener){this._opener.EPiOpenedDialog=null;}delete this._opener;this.callbackMethod=null;this.callbackArguments=null;delete this.callbackMethod;delete this.callbackArguments;this._cleaned=true;},IsCleaned:function(){return this._cleaned;},_CleanDialog:function(){for(var prop in this){if(prop!="callbackMethod"&&prop!="callbackArguments"&&prop!="_opener"){this[prop]=null;delete this[prop];}}}});});},"epi-cms/widget/CategorySelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/query","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/form/Button","dijit/Tooltip","dojox/html/entities","epi-cms/widget/_HasChildDialogMixin","epi-cms/widget/CategorySelectorDialog","epi/shell/widget/_ValueRequiredMixin","epi/dependency","epi/epi","epi/shell/widget/dialog/Dialog","dojo/text!./templates/CategorySelector.html","epi/i18n!epi/cms/nls/episerver.cms.widget.CategorySelector"],function(array,_1834,lang,all,_1835,_1836,_1837,_1838,query,_1839,_183a,_183b,_183c,_183d,_183e,_183f,_1840,_1841,_1842,epi,_1843,_1844,res){return _1834([_183a,_1839,_183b,_183f,_1841],{templateString:_1844,localization:res,multiple:true,value:null,store:null,_categories:null,_categoriesParentsName:{},onChange:function(value){},postMixInProperties:function(){this.inherited(arguments);if(!this.store){var _1845=_1842.resolve("epi.storeregistry");this.store=_1845.get("epi.cms.category");}},destroyDescendants:function(){if(this._tooltip){this._tooltip.destroy();delete this._tooltip;}this.inherited(arguments);},_setValueAttr:function(value){if(!lang.isArray(value)){value=[value];}var _1846=array.filter(value,function(v){return !!v;});this._setValueAndFireOnChange(_1846);if(_1846.length>0){this._set("value",_1846);}else{this._set("value",null);}this._started&&this.validate();},_setValueAndFireOnChange:function(value){if(epi.areEqual(this._categories,value)){return;}this._categories=value;this.onChange(this._categories);this._updateDisplayNode();},_getValueAttr:function(){return this._categories;},_setReadOnlyAttr:function(value){this._set("readOnly",value);_1838.set(this.button.domNode,"display",value?"none":"");_1836.toggle(this.domNode,"dijitReadOnly",value);},focus:function(){this.button.focus();},_createCategoryButton:function(_1847){if(query("div[data-epi-category-id="+_1847.id+"]",this.categoriesGroupContainer).length!==0){return;}var _1848=_1837.create("div",{"class":"dijitReset dijitLeft dijitInputField dijitInputContainer epi-categoryButton"});var _1849=_1837.create("div",{"class":"dijitInline epi-resourceName"});var _184a=_1837.create("div",{"class":"dojoxEllipsis",innerHTML:_183e.encode(_1847.description)});_1837.place(_184a,_1849);_1837.place(_1849,_1848);this._tooltip=new _183d({connectId:_184a,label:_183e.encode(this._getCategoryPath(_1847))});var _184b=_1837.create("div",{"class":"epi-removeButton",innerHTML:"&nbsp;"});_1835.set(_184b,"data-epi-category-id",_1847.id);var _184c=_184b.onClick?"onClick":"onclick";if(!this.readOnly){this.connect(_184b,_184c,lang.hitch(this,this._onRemoveClick));_1837.place(_184b,_1849);}else{_1837.place(_1837.create("span",{innerHTML:"&nbsp;"}),_1849);}_1837.place(_1848,this.categoriesGroupContainer);},_getCategoryPath:function(_184d){if(!_184d.parentsNameCollection||_184d.parentsNameCollection.length==1){return "";}var path=_184d.parentsNameCollection[1];for(i=2;i<_184d.parentsNameCollection.length;i++){path=path+"/"+_184d.parentsNameCollection[i];}return path;},_createNoCategoriesChosenSpan:function(){this.categoriesGroupContainer.innerHTML="";_1837.create("span",{innerHTML:this.localization.nocategorieschosen},this.categoriesGroupContainer);},_updateDisplayNode:function(){this.categoriesGroupContainer.innerHTML="";if(!this._categories||this._categories.length===0){this._createNoCategoriesChosenSpan();return;}this._categoriesParentsName={};var _184e=[];this._categories.forEach(function(_184f){_184e.push(this.store.refresh(_184f));},this);all(_184e).then(lang.hitch(this,function(_1850){_1850.forEach(function(_1851){if(_1851&&_1851.visible){this._categoriesParentsName[_1851.id]=_1851.parentsNameCollection;this._createCategoryButton(_1851);}else{var _1852=this._categories.indexOf(_1851.id);if(_1852!=-1){this._categories.splice(_1852,1);}}if(this._categories.length===0){this._createNoCategoriesChosenSpan();}},this);}));},_onRemoveClick:function(arg){if(!this._categories){return;}var _1853=parseInt(_1835.get(arg.target,"data-epi-category-id"),10);var _1854=this._categories.indexOf(_1853);if(_1854==-1){return;}var _1855=lang.clone(this._categories);_1855.splice(_1854,1);this.set("value",_1855);},_getCategoriesParentsNameClone:function(){var _1856={};array.forEach(this._categories,lang.hitch(this,function(_1857){_1856[_1857]=this._categoriesParentsName[_1857];}));return _1856;},_onShow:function(){this.categorySelectorDialog.set("value",lang.clone(this._categories));this.categorySelectorDialog.set("selectedCategoriesData",this._getCategoriesParentsNameClone());this.isShowingChildDialog=true;this.categorySelectorDialog.onShow();},_onExecute:function(){var _1858=this.categorySelectorDialog.get("value");this.set("value",_1858);},_isEmptyArray:function(array){return !array||array.length===0;},_onDialogHide:function(){this.focus();this.isShowingChildDialog=false;},_createDialog:function(){this.categorySelectorDialog=new _1840({rootCategory:this.root});this.dialog=new _1843({title:this.localization.popuptitle,content:this.categorySelectorDialog,dialogClass:"epi-dialog-portrait"});this.connect(this.dialog,"onExecute","_onExecute");this.connect(this.dialog,"onShow","_onShow");this.connect(this.dialog,"onHide","_onDialogHide");this.dialog.startup();},_onButtonClick:function(){if(!this.dialog){this._createDialog();}this.dialog.show(true);}});});},"epi-cms/widget/CategorySelectorDialog":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/form/Button","epi","epi/dependency","epi-cms/widget/CategoryTree"],function(array,_1859,lang,_185a,_185b,_185c,_185d,epi,_185e,_185f){return _1859([_185b,_185a,_185c],{templateString:"<div class=\"epi-categorySelectorDialog\">                             <div data-dojo-attach-point=\"categoryTree\" data-dojo-type=\"epi-cms/widget/CategoryTree\" data-dojo-props=\"rootCategory: ${rootCategory}\"></div>                         </div>",selectedCategoriesData:null,_selectedCategoryIds:null,rootCategory:null,onShow:function(){if(!this._selectedCategoryIds&&!this.categoryTree){return;}this.categoryTree.set("selectedNodeIds",this._selectedCategoryIds);this.categoryTree.set("selectedNodeData",this.selectedCategoriesData);},_setValueAttr:function(value){this._selectedCategoryIds=value;if(!this._selectedCategoryIds){this._selectedCategoryIds=[];}},_getValueAttr:function(){return this.categoryTree.get("selectedNodeIds");}});});},"epi-cms/widget/CategoryTree":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/Tree","epi","epi-cms/widget/_CategoryTreeNode","epi-cms/widget/CategoryTreeStoreModel"],function(array,_1860,lang,Tree,epi,_1861,_1862){return _1860([Tree],{showRoot:false,selectedNodeIds:null,selectedNodeData:null,constructor:function(){this.selectedNodeIds=[];this.selectedNodeData={};},postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.model=new _1862({rootCategory:this.rootCategory});this.persist=false;}},postCreate:function(){this.inherited(arguments);this.connect(this,"onOpen",lang.hitch(this,this._onNodeOpen));this.connect(this,"onClose",lang.hitch(this,this._onNodeClose));this.watch("selectedNodeData",lang.hitch(this,this._loadSelectedNodes));},startup:function(){this.inherited(arguments);this.dndController.singular=true;},buildNodeFromTemplate:function(args){return new _1861(args);},getNodeById:function(_1863){var nodes=this.getNodesByItem(_1863.toString());if(!nodes){return null;}return nodes[0];},_getTotalSelectedNodes:function(_1864,_1865,_1866){if(!_1864||!_1864.item||!_1864.item.hasChildren||!lang.isArray(_1865)||_1865.length===0||!_1866){return 0;}var _1867=0,_1868=[],_1869=[],_186a=lang.clone(_1864.item.parentsNameCollection);var _186b=function(_186c){if(lang.isArray(_186c)&&_186c.length>0){_186c.pop();}};_186a[_186a.length-1]=_1864.item.name;array.forEach(_1865,function(_186d){_1868=lang.clone(_1866[_186d]);_186b(_1868);_1869=lang.clone(_1868);lang.mixin(_1869,_186a);if(lang.isArray(_1868)&&epi.areEqual(_1868,_1869)){_1867++;}},this);return _1867;},_setTotalSelectedNodes:function(_186e){if(_186e){_186e.set("totalSelectedNodes",this._getTotalSelectedNodes(_186e,this.selectedNodeIds,this.selectedNodeData));array.forEach(_186e.getChildren(),function(_186f){if(_186f&&_186f.item&&_186f.item.hasChildren){if(_186f.isExpanded){this._setTotalSelectedNodes(_186f);}else{_186f.set("totalSelectedNodes",this._getTotalSelectedNodes(_186f,this.selectedNodeIds,this.selectedNodeData));}}},this);}},_loadSelectedNodes:function(){this.expandChildrenDeferred.then(lang.hitch(this,function(){this.set("toggleSelectNodes",this.rootNode,this.selectedNodeIds);this._setTotalSelectedNodes(this.rootNode);}));},_onNodeCreated:function(node){node.set("totalSelectedNodes",this._getTotalSelectedNodes(node,this.selectedNodeIds,this.selectedNodeData));},_onNodeSelectChanged:function(_1870,item){if(!this.getNodeById(item.id)){return;}var index=this.selectedNodeIds.indexOf(item.id),exist=index!=-1;if(_1870&&!exist){this.selectedNodeIds.push(item.id);this.selectedNodeData[item.id]=item.parentsNameCollection;}if(!_1870&&exist){this.selectedNodeIds.splice(index,1);this.selectedNodeData[item.id]={};}},_onNodeOpen:function(item,node){this.set("toggleSelectNodes",node,this.selectedNodeIds);this._setTotalSelectedNodes(node);},_onNodeClose:function(item,node){this._setTotalSelectedNodes(node);},_setToggleSelectNodesAttr:function(_1871,_1872){if(!_1871||!lang.isArray(_1872)){return;}var _1873=false;array.forEach(_1871.getChildren(),function(_1874){if(_1874){_1873=_1872.indexOf(_1874.item.id)!=-1;_1874.set("checked",_1873);if(_1874.hasChildren()){this.set("toggleSelectNodes",_1874,_1872);}}},this);},_createTreeNode:function(args){var node=this.buildNodeFromTemplate(args);node.connect(node,"onNodeSelectChanged",lang.hitch(this,function(_1875,item){this._onNodeSelectChanged(_1875,item);}));this._onNodeCreated(node);return node;}});});},"epi-cms/widget/_CategoryTreeNode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/keys","dojo/text!./templates/_CategoryTreeNode.html","dijit/_TemplatedMixin","dijit/form/CheckBox","epi","epi-cms/widget/_ContentTreeNode"],function(_1876,lang,_1877,_1878,keys,_1879,_187a,_187b,epi,_187c){return _1876([_187c,_187a],{templateString:_1879,_checkbox:null,checked:false,postCreate:function(){this.inherited(arguments);_1877.add(this.iconNode,"dijitHidden");this._checkbox=this._createCheckbox();},_createCheckbox:function(){if(!this.item.selectable){return;}var _187d=_1878.create("span",{"class":"epi-checkboxNode dijitTreeExpando"});var _187e=new _187b({name:"checkboxCategory",value:this.item.id,tabIndex:-1,checked:false,onChange:lang.hitch(this,function(_187f){this.onNodeSelectChanged(_187f,this.item);})});_187e.placeAt(_187d);_1878.place(_187d,this.expandoNode,"after");return _187e;},onNodeSelectChanged:function(_1880,item){},_onLabelClick:function(){if(!this._checkbox){return;}this.set("checked",!this._checkbox.checked);},_onLabelKeyUp:function(evt){if(evt.keyCode==keys.SPACE||evt.keyCode==keys.ENTER){this._onLabelClick();}},_setCheckedAttr:function(_1881){if(!this._checkbox){return;}this._set("checked",_1881);this._checkbox.set("checked",_1881);},_setTotalSelectedNodesAttr:function(_1882){var _1883=this.tree.model.getLabel(this.item),_1884=!this.isExpanded&&_1882>0;this.labelNode.innerHTML=_1884?_1883+" ("+_1882+")":_1883;}});});},"url:epi-cms/widget/templates/_CategoryTreeNode.html":"<div class=\"dijitTreeNode epi-categoryTreeNode\" role=\"presentation\">\r\n    <a href=\"#\" tabIndex=\"-1\" data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel epi-categoryTreeLabel\" role=\"treeitem\"\r\n                  tabindex=\"-1\" aria-selected=\"false\" data-dojo-attach-event=\"onclick:_onLabelClick, keyup:_onLabelKeyUp\">\r\n            </span>\r\n        </span>\r\n    </a>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>","epi-cms/widget/CategoryTreeStoreModel":function(){define(["dojo","epi/dependency","epi/routes"],function(dojo,_1885,_1886){return dojo.declare(null,{store:null,rootCategory:undefined,constructor:function(args){dojo.mixin(this,args);if(!this.store){var _1887=_1885.resolve("epi.storeregistry");this.store=_1887.get("epi.cms.category");}},getRoot:function(_1888){dojo.when(this.store.get(this.rootCategory),_1888);},mayHaveChildren:function(item){return item.hasChildren;},getChildren:function(_1889,_188a){var id=this.getIdentity(_1889),_188b=this.store.query({id:id,query:"getchildren"});_188b.then(function(_188c){_1889.children=_188c;_188a(_188c);});},getIdentity:function(item){return this.store.getIdentity(item);},getLabel:function(item){return item.description;}});});},"url:epi-cms/widget/templates/CategorySelector.html":"<div class=\"dijitReset dijitInputField dijitInputContainer dijitInline epi-resourceInputContainer epi-categorySelector\" id=\"widget_${id}\">\r\n    <div data-dojo-attach-point=\"categoriesGroupContainer\" class=\"dijit dijitReset dijitInline dijitInlineTable dijitLeft dijitTextBox displayNode epi-categoriesGroup\">\r\n    </div> \r\n    <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick: _onButtonClick\" data-dojo-attach-point=\"button\" class=\"epi-categoriesSelectorButton\" data-dojo-props=\"label:'+'\"></div>\r\n</div>","epi-cms/widget/ContentSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/dom-class","dojo/dom-style","dojo/query","dojo/string","dojo/when","dijit/_CssStateMixin","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/focus","dijit/form/Button","epi/dependency","epi/shell/TypeDescriptorManager","epi/shell/widget/_ValueRequiredMixin","epi/shell/widget/dialog/Dialog","epi-cms/core/ContentReference","epi-cms/core/PermanentLinkHelper","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/_Droppable","epi-cms/widget/_HasClearButton","epi-cms/widget/_HasChildDialogMixin","epi-cms/widget/ContentSelectorDialog","dojo/text!./templates/ContentSelector.html","epi/i18n!epi/cms/nls/episerver.cms.widget.contentselector"],function(array,_188d,lang,_188e,_188f,_1890,query,_1891,when,_1892,_1893,_1894,_1895,_1896,_1897,_1898,_1899,_189a,_189b,_189c,_189d,_189e,_189f,_18a0,_18a1,_18a2,_18a3,_18a4){return _188d([_1894,_1893,_1895,_1892,_18a0,_18a1,_189f,_189a],{templateString:_18a3,roots:null,value:null,required:false,missingMessage:_18a4.requiredmessage,tooltipPosition:[],contentLink:null,permanentLink:null,canSelectOwnerContent:false,accessLevel:_189e.accessLevel.Read,showAllLanguages:true,_setSelectedContentNameAttr:function(value){query(this.selectedContentNameNode).text(value);},_setDisabledAttr:function(value){this.inherited(arguments);this.button.set("disabled",value);this._set("disabled",value);},_setSelectedContentLinkAttr:{node:"selectedContentLinkNode",type:"innerHTML"},postMixInProperties:function(){this.inherited(arguments);var _18a5=_1898.resolve("epi.storeregistry");this._store=_18a5.get("epi.cms.content.light");if(!this.roots){var _18a6=this.contentRepositoryDescriptors||_1898.resolve("epi.cms.contentRepositoryDescriptors");var _18a7=_18a6[this.repositoryKey];this.roots=_18a7.roots;}this.nameAttrSetting=this.name?("name=\""+this.name.replace(/"/g,"&quot;")+"\""):"";},_setReadOnlyAttr:function(value){this._set("readOnly",value);_1890.set(this.button.domNode,"display",value?"none":"");_1890.set(this.clearButton,"display",value?"none":"");_188f.toggle(this.domNode,"dijitReadOnly",value);},_setValueAttr:function(value){this._set("value",value);this._setValueAndFireOnChange(value);},_getDialog:function(){if(this.dialog&&this.dialog.domNode){return this.dialog;}var title=_18a4.title;if(this.allowedTypes&&this.allowedTypes.length===1){var name=_1899.getResourceValue(this.allowedTypes[0],"name");if(name){title=_1891.substitute(_18a4.format,[name]);}}this.contentSelectorDialog=new _18a2({canSelectOwnerContent:this.canSelectOwnerContent,showButtons:false,roots:this.roots,allowedTypes:this.allowedTypes,showAllLanguages:this.showAllLanguages});this.dialog=new _189b({title:title,dialogClass:"epi-dialog-portrait",content:this.contentSelectorDialog,destroyOnHide:true});this.connect(this.contentSelectorDialog,"onChange","_setDialogButtonState");this.connect(this.dialog,"onExecute","_onDialogExecute");this.connect(this.dialog,"onHide","_onDialogHide");return this.dialog;},_isContentAllowed:function(_18a8){var _18a9=array.indexOf(this.allowedTypes,_18a8)!==-1;if(!_18a9){_18a9=array.some(this.allowedTypes,function(type){return _1899.isBaseTypeIdentifier(_18a8,type);});}return _18a9;},_onButtonClick:function(){when(this._getContentData(this.contentLink),lang.hitch(this,function(_18aa){this.canSelectOwnerContent=_18aa&&this._isContentAllowed(_18aa.typeIdentifier);var _18ab=this._getDialog();this.isShowingChildDialog=true;var _18ac;if(this.value){_18ac=this._convertValueToContentReference(this.value);}if(_18ac){_18ac=_18ac.createVersionUnspecificReference().toString();}this.contentSelectorDialog.set("value",_18ac);_18ab.show();}));},_onDialogExecute:function(){var value=this.contentSelectorDialog.get("value");this._setValueAndFireOnChange(value);},_convertValueToContentReference:function(value){return new _189c(value);},_onDialogHide:function(){this.isShowingChildDialog=false;},_setValueAndFireOnChange:function(value){var _18ad=value==="-"?this.contentLink:value;this.set("permanentLink",null);when(this._getContentData(_18ad),lang.hitch(this,function(_18ae){var _18af=this.value!==_18ad;this.value=_18ad;this.input.value=this.value;this._started&&this.validate();this._updateDisplayNode(_18ae);if(_18af){this.onChange(_18ad);}if(_18ae){this.set("permanentLink",_189d.toPermanentLink(_18ae));}}));},_getContentData:function(_18b0){if(!_18b0){return null;}return this._store.get(_18b0);},_getValueAttr:function(){return this.value;},_onFocus:function(){if(this.get("disabled")){return;}this.inherited(arguments);this.validate();},_onBlur:function(){if(this.get("disabled")){return;}this.inherited(arguments);this.validate();},focus:function(){if(!this.button.disabled&&this.button.focusNode&&this.button.focusNode.focus){try{_1896.focus(this.button.focusNode);}catch(e){}}},onChange:function(value){},_updateDisplayNode:function(_18b1){if(_18b1){_188f.remove(this.domNode,"epi-noValue");_188f.remove(this.resourceName,"dijitPlaceHolder");this.set("selectedContentName",_18b1.name);this.set("selectedContentLink",new _189c(_18b1.contentLink).id);}else{_188f.add(this.domNode,"epi-noValue");_188f.add(this.resourceName,"dijitPlaceHolder");this.set("selectedContentName",_18a4.helptext);this.set("selectedContentLink","");}},reset:function(){this.set("value",null);},_setDialogButtonState:function(_18b2){var self=this;if(!_18b2){return;}when(self._store.get(_18b2),function(_18b3){self.dialog.definitionConsumer.setItemProperty(self.dialog._okButtonName,"disabled",!_189e.hasAccess(_18b3.accessMask,self.accessLevel));});}});});},"epi-cms/widget/_Droppable":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/shell/dnd/Target"],function(_18b4,lang,when,_18b5){return _18b4(null,{dropAreaNode:null,allowedDndTypes:null,postCreate:function(){this.inherited(arguments);var _18b6=this.own(new _18b5(this.dropAreaNode,{accept:this.allowedDndTypes,createItemOnDrop:false,readOnly:this.readOnly,skipForm:true}))[0];this.connect(_18b6,"onDropData","_onDropData");},onDropping:function(){},onDrop:function(){},_onDropData:function(_18b7,_18b8,nodes,copy){var _18b9=_18b7?(_18b7.length?_18b7[0]:_18b7):null;if(_18b9){this.onDropping();when(_18b9.data,lang.hitch(this,function(_18ba){var value;if(this.dndSourcePropertyName){value=_18ba[this.dndSourcePropertyName];}else{value=_18ba;}this.set("value",value);this.onDrop();}));}}});});},"epi-cms/widget/_HasClearButton":function(){define(["epi","dojo","dijit"],function(epi,dojo,dijit){return dojo.declare(null,{postCreate:function(){this.inherited(arguments);var _18bb=this.clearButton.onClick?"onClick":"onclick";dojo.connect(this.clearButton,_18bb,dojo.hitch(this,this.clearValue));},clearValue:function(){if(this.readOnly){return;}var value=this.getEmptyValue();this.set("value",value);},getEmptyValue:function(){return null;}});});},"url:epi-cms/widget/templates/ContentSelector.html":"<div class=\"dijitReset dijitInputField dijitInputContainer dijitInline epi-resourceInputContainer\" id=\"widget_${id}\">\r\n    <div data-dojo-attach-point=\"displayNode, dropAreaNode, stateNode\" class=\"dijit dijitReset dijitInline dijitInlineTable dijitLeft dijitTextBox displayNode\">\r\n        <div class=\"dijitReset dijitLeft dijitInputField dijitInputContainer\">\r\n            <div data-dojo-attach-point=\"clearButton\" class=\"epi-clearButton\">&nbsp;</div>\r\n            <div data-dojo-attach-point=\"resourceName\" class=\"dijitInline epi-resourceName dojoxEllipsis\"/>\r\n                <span data-dojo-attach-point=\"selectedContentNameNode\"></span> <span data-dojo-attach-point=\"selectedContentLinkNode\"></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <input type=\"hidden\" ${!nameAttrSetting} value=\"${value}\" data-dojo-attach-point=\"input\"/>\r\n    <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick: _onButtonClick\" data-dojo-attach-point=\"button\" data-dojo-props=\"label:'...'\"></div>\r\n</div>","epi-cms/widget/HyperLinkSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/dom-style","dojo/dom-construct","dojo/when","dojo/DeferredList","dijit/_Widget","epi/string","epi/shell/widget/_ModelBindingMixin","epi-cms/widget/_HyperLinkFieldItem","epi-cms/widget/viewmodel/HyperLinkSelectorViewModel"],function(array,_18bc,lang,_18bd,_18be,_18bf,when,_18c0,_18c1,_18c2,_18c3,_18c4,_18c5){return _18bc([_18c1,_18c3],{value:null,_dfCreateWidget:null,modelClassName:_18c5,modelBindingMap:{"wrapperSettings":["wrapperSettings"],"selectedWrapper":["selectedWrapper"]},postMixInProperties:function(){this.inherited(arguments);if(!this.model&&this.modelClassName){var _18c6=_18bc(this.modelClassName);this.model=new _18c6({providers:this.providers});}},_setSelectedWrapperAttr:function(_18c7){if(!_18c7){return;}array.forEach(this.wrappers,function(_18c8){_18c8.set("selected",false);if(_18c8.inputWidget){_18c8.inputWidget.set("state","");}});if(_18c7.inputWidget){_18c7.set("selected",true);}},_setWrapperSettingsAttr:function(_18c9){var _18ca=[];array.forEach(_18c9,lang.hitch(this,function(_18cb){_18cb.groupname+=this.id;var _18cc=new _18c4(_18cb);if(_18cb.invisible){_18be.set(_18cc.domNode,{display:"none"});}_18cc.on("radioButtonChange",lang.hitch(this,function(){this.set("selectedWrapper",_18cc);_18cc.focus();}));_18ca.push(_18cc);}));this.set("wrappers",_18ca);},_setWrappersAttr:function(_18cd){this._set("wrappers",_18cd);if(this._dfCreateWidget){this._dfCreateWidget.cancel();this._dfCreateWidget=null;}var _18ce=[],_18cf=lang.hitch(this,function(ctor,_18d0){var child=new ctor(_18d0.settings);_18d0.addChild(child);_18d0.set("required",this.required);});array.forEach(_18cd,function(_18d1){var df=new _18bd();_18ce.push(df);var ctor=lang.getObject(_18d1.widgetType);if(!ctor){require([_18c2.slashName(_18d1.widgetType)],function(ctor){_18cf(ctor,_18d1);df.resolve();});}else{_18cf(ctor,_18d1);df.resolve();}});this._dfCreateWidget=new _18c0(_18ce);when(this._dfCreateWidget,lang.hitch(this,function(_18d2){array.forEach(_18cd,function(_18d3){_18bf.place(_18d3.domNode,this.domNode);},this);this.onSelectorsCreated(this);if(this.value){this._setValueForWidgets(this.value);}else{if(this.wrappers&&this.wrappers.length>0){this.wrappers[0].set("selected",true);}}}));},onSelectorsCreated:function(_18d4){},_getSelectedWrapper:function(){return array.filter(this.wrappers,function(_18d5){return (_18d5.inputWidget&&_18d5.get("selected"));})[0];},_getValueAttr:function(){var _18d6=this._getSelectedWrapper();if(_18d6){if(_18d6.inputWidget&&_18d6.settings.isContentLink){this.value=_18d6.inputWidget.get("permanentLink");}else{this.value=_18d6.get("value");}}return this.value;},_setValueAttr:function(value){this._set("value",value);this._setValueForWidgets(value);},_setValueForWidgets:function(value){array.forEach(this.wrappers,function(_18d7){_18d7.set("value",null);});if(!value){return;}when(this.model.getContentData(value),lang.hitch(this,function(_18d8){if(_18d8){array.every(this.wrappers,function(_18d9){if(_18d9&&_18d9.settings.isContentLink){if(array.some(_18d9.settings.allowedTypes,lang.hitch(this,function(_18da){return this.model.isBaseTypeIdentifier(_18d8.typeIdentifier,_18da);}))){_18d9.set("value",_18d8.contentLink);var _18db=_18d8.missingLanguageBranch&&_18d8.missingLanguageBranch.isTranslationNeeded;_18d9.set("showAllLanguages",_18db);this.set("selectedWrapper",_18d9);return false;}}return true;},this);}else{array.every(this.wrappers,function(_18dc){if(_18dc&&!_18dc.settings.isContentLink){var _18dd=_18dc.inputWidget;if(_18dd&&_18dd.validator(value,_18dd.constraints)){_18dc.set("value",value);this.set("selectedWrapper",_18dc);return false;}}return true;},this);}}));},validate:function(){var _18de=this._getSelectedWrapper();return _18de?_18de.validate():false;},focus:function(){var _18df=this._getSelectedWrapper();if(_18df){_18df.focus();}},reset:function(){this.set("value",null);}});});},"epi-cms/widget/_HyperLinkFieldItem":function(){define(["dojo/_base/declare","dijit/_Widget","dijit/_TemplatedMixin","dijit/_Container","dijit/_Contained","dojo/text!./templates/_HyperLinkFieldItem.html"],function(_18e0,_18e1,_18e2,_18e3,_18e4,_18e5){return _18e0([_18e1,_18e3,_18e4,_18e2],{templateString:_18e5,inputWidget:null,settings:[],_onRadioButtonChange:function(evt){this.onRadioButtonChange(this,evt);},onRadioButtonChange:function(_18e6,evt){},addChild:function(child){this.inputWidget=child;this.inherited(arguments);},validate:function(){return this.inputWidget?this.inputWidget.validate():false;},_setValueAttr:function(value){if(this.inputWidget){this.inputWidget.set("value",value);}},_getValueAttr:function(){return this.inputWidget.get("value");},_setRequiredAttr:function(val){if(this.inputWidget){this.inputWidget.set("required",val);}},_setSelectedAttr:function(value){if(this.inputWidget){this.inputWidget.set("disabled",!value);this.radioNode.checked=value;}},_getSelectedAttr:function(){return this.radioNode.checked;},_setShowAllLanguagesAttr:function(val){if(this.inputWidget){this.inputWidget.set("showAllLanguages",val);}},focus:function(){if(this.inputWidget){this.inputWidget.focus();}}});});},"url:epi-cms/widget/templates/_HyperLinkFieldItem.html":"<div class='epi-formsRow epi-hyperLink'>\r\n    <input type='radio' name='${groupname}' id='${id}_${name}' value='${name}' data-dojo-type='dijit.form.RadioButton' data-dojo-attach-event='onchange:_onRadioButtonChange' data-dojo-attach-point='radioNode'/>\r\n    <label for='${id}_${name}'>${displayName}</label>\r\n    <div class='epi-formsWidgetWrapper' data-dojo-attach-point='containerNode'></div>\r\n</div>","epi-cms/widget/viewmodel/HyperLinkSelectorViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/io-query","dojo/dom-style","dojo/dom-construct","dojo/when","epi/string","epi/shell/TypeDescriptorManager","epi/shell/_StatefulGetterSetterMixin","epi-cms/core/PermanentLinkHelper"],function(array,_18e7,lang,_18e8,_18e9,_18ea,_18eb,when,_18ec,_18ed,_18ee,_18ef){return _18e7([_18e8,_18ee],{_setProvidersAttr:function(_18f0){var _18f1=[];array.forEach(_18f0,lang.hitch(this,function(_18f2){_18f1.push({name:_18f2.name,displayName:_18f2.displayName?_18f2.displayName:_18f2.name,title:_18f2.title?_18f2.title:"",groupname:"hyperLink_",widgetType:_18f2.widgetType,invisible:_18f2.invisible,settings:{roots:_18f2.roots,allowedTypes:_18f2.linkableTypes,isContentLink:(_18f2.linkableTypes&&_18f2.linkableTypes.length>0),allowedDndTypes:[],disabled:true,value:null}});}));this.set("wrapperSettings",_18f1);},getContentData:function(value){if(value){return _18ef.getContent(value,{"allLanguages":true});}return null;},isBaseTypeIdentifier:function(type,base){return _18ed.isBaseTypeIdentifier(type,base);}});});},"epi-cms/widget/overlay/ContentArea":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/dnd/Manager","dojo/dom-attr","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/json","dojo/on","dojo/query","dojo/when","dijit/_Container","dijit/registry","epi/dependency","epi/shell/widget/overlay/Item","epi/shell/dnd/Source","epi/shell/dnd/_MarkerSource","epi-cms/widget/overlay/Block","epi-cms/contentediting/editors/ContentBlockEditor","epi-cms/widget/command/CreateContentFromSelector","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/viewmodel/ContentAreaViewModel","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/editors/_TextWithActionLinksMixin","dojo/text!../templates/ContentArea.html"],function(array,_18f3,lang,_18f4,_18f5,_18f6,_18f7,_18f8,_18f9,_18fa,json,on,query,when,_18fb,_18fc,_18fd,Item,_18fe,_18ff,Block,_1900,_1901,_1902,_1903,_1904,_1905,_1906){return _18f3([Item,_18fb,_1905],{templateString:_1906,layout:"",defaultWatchKey:"",allowedDndTypes:null,blockClass:Block,modelClass:_1903,dndSourceClass:_18f3([_18fe,_18ff]),dndSourceSettings:null,_supressValueChanged:false,constructor:function(){this._watches={};},postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.model=new this.modelClass();}this.model.set("value",lang.clone(this.contentModel.get(this.name)));this.contentModel.watch(this.name,lang.hitch(this,function(name,_1907,value){if(epi.areEqual(value,this.model.get("value"))){return;}this.refresh();}));this._pendingPersonalizations=[];this._contentStore=this._contentStore||_18fd.resolve("epi.storeregistry").get("epi.cms.contentdata");this._ownerContentLink=this.contentModel.get("icontent_contentlink");},buildRendering:function(){this.inherited(arguments);this.setupActionLinks(this.actionsNodeControls);},postCreate:function(){this.inherited(arguments);this.own(on(this.model,"changed",lang.hitch(this,function(){if(!this._started||this._supressValueChanged){return;}this._onChildrenChanged();if(this._pendingPersonalizations.length>0){this._pendingPersonalizations=[];this.onClick(this);}})));this._setupDirectionality();this._setupBlocks();},destroy:function(){this.inherited(arguments);for(var i in this._watches){this._watches[i].remove();}this._watches={};this._source.destroy();if(this.textWithLinks){this.textWithLinks.destroy();this.textWithLinks=null;}},isCreateLinkVisible:function(){var _1908=new _18f5();when(this._contentStore.get(this._ownerContentLink),function(_1909){var _190a=_1902.isActionAvailable(_1909,_1902.action.Create,_1902.providerCapabilities.Create,true);_1908.resolve(_190a);});return _1908.promise;},_setHasChildrenAttr:function(value){this._set("hasChildren",value);},_getMinHeightAttr:function(){return _18fa.get(this.sourceItemNode,"minHeight");},onValueChange:function(_190b){},updatePosition:function(_190c){if(!this.canUpdatePosition()){return false;}var _190d=this.inherited(arguments),_190e,_190f,_1910,_1911;if(this.hasChildren){this._setupDirectionality();this._positionBlocks();}_1910=this.get("minHeight");_18fa.set(this.sourceItemNode,"minHeight","");_190e=Math.floor(_18f9.position(this.actionsNodeControls,false).h);_190f=_190e>0?_190e:this.get("actionNodeHeight")||0;_1911=Math.floor(_18f9.position(this.sourceItemNode,false).h);if(_190f===0){this._clearPosition();return _190d;}_190f&&(this.set("actionNodeHeight",_190f));_18fa.set(this.sourceItemNode,"minHeight",(_1911+_190f)+"px");_18fa.set(this.actionsNodeControls,"marginTop",(_1911)+"px");if(_1910===_1911+_190f){return _190d;}return true;},refresh:function(){this._actionNodeHeight=null;this.destroyDescendants();this._source.clearItems();if(this._source.anchor){_18f8.destroy(this._source.anchor);}for(var i in this._watches){this._watches[i].remove();}this._watches={};this._supressValueChanged=true;this.model.set("value",lang.clone(this.contentModel.get(this.name)));this._setupBlocks();this.inherited(arguments);this._supressValueChanged=false;},_setupDnd:function(){var _1912=lang.mixin({_skipStartup:true,creator:lang.hitch(this,"_creator"),copyOnly:false,alwaysCopy:false,dropParent:this.containerNode,type:this.allowedDndTypes,accept:this.allowedDndTypes,singular:true,propertyName:this.name},this.dndSourceSettings||{});this._source=new this.dndSourceClass(this.domNode,_1912);this._source.defaultCheckAcceptance=this._source.checkAcceptance;this._source.checkAcceptance=lang.hitch(this,this._checkAcceptance),this.own(_18f4.after(this._source,"onDropData",lang.hitch(this,"_onDrop"),true));this.own(_18f4.before(this._source,"delItem",lang.hitch(this,"_onDndItemRemoved"),true));},_creator:function(item){var node=_18f8.create("div"),_1913;if(typeof item.getNormalizedData=="function"){_1913=item.getNormalizedData();}_1913=_1913?_1913.data:item;return {node:node,type:this.allowedDndTypes,data:_1913};},_setupBlocks:function(){var _1914=this._getBlockNodes();array.forEach(_1914,this._createBlock,this);this.set("hasChildren",_1914.length>0);},_createBlock:function(node){var id=_18f7.get(node,"data-epi-block-id"),info=json.parse(_18f7.get(node,"data-epi-block-personalization")),_1915=info?info.contentGroup:this.defaultWatchKey,model=this.model;if(_1915){model=model.getChild({name:_1915});}model=model&&model.getChild(lang.mixin({contentLink:id},info));if(!model){return;}var block=new this.blockClass({disabled:this.disabled,viewModel:model,sourceItemNode:node});this.addChild(block);this._watches["block_"+id+"_ensurePersonalization"]=model.watch("ensurePersonalization",lang.hitch(this,function(_1916,_1917,_1918){var index=array.indexOf(this._pendingPersonalizations,model);if(_1918){if(index<0){this._pendingPersonalizations.push(model);}}else{if(index>0){this._pendingPersonalizations.splice(index,1);}}}));model.set("visible",true);this._source.setItem(block.domNode.id,{name:model.name,data:model,type:this.allowedDndTypes});},_onChildrenChanged:function(){this.onValueChange({propertyName:this.name,value:this.model.get("value")});},_positionBlocks:function(){var _1919=this.getChildren(),_191a=[],_191b=this.get("position");array.forEach(_1919,function(_191c,i){var _191d,_191e,_191f;if(!_191a[i]){_191a[i]=_18f9.position(_191c.sourceItemNode,false);}_191d=_191a[i];_191d.x-=_191b.x;_191d.y-=_191b.y;_191c.resize(_191d);},this);},_checkAcceptance:function(_1920,nodes){if(this.readOnly){return false;}var _1921=_18fc.getEnclosingWidget(nodes[0]);if(_1921.isInstanceOf(_1900)){return false;}return this._source.defaultCheckAcceptance(_1920,nodes);},_getBlockNodes:function(){var _1922=query("[data-epi-block-id]",this.sourceItemNode);var _1923=query("[data-epi-block-id] [data-epi-block-id]",this.sourceItemNode);return array.filter(_1922,function(node){return _1923.indexOf(node)===-1;});},_setupDirectionality:function(){var _1924;if(/vertical|horizontal/.test(this.layout)){_1924=this.layout==="horizontal";}else{_1924=array.some(this._getBlockNodes(),function(node){var style=_18fa.getComputedStyle(node),_1925=/left|right/.test(style.cssFloat),_1926=/inline|inline-block/.test(style.display);return _1925||_1926;});}this._source.setHorizontal(_1924);},executeAction:function(_1927){if(_1927==="createnewblock"){var _1928=new _1901({creatingTypeIdentifier:"episerver.core.blockdata",createAsLocalAsset:true,canChangeLocalAssetName:false,treatAsSecondaryView:true});_1928.set("model",{save:lang.hitch(this,function(block){var value=lang.clone(this.model.get("value"),true)||[];value.push(block);this.onValueChange({propertyName:this._source.propertyName,value:value});})});_1928.execute();}else{this.inherited(arguments);}},_onDrop:function(data,_1929,nodes,_192a){var model=this.model,_192b=this._source;if(_192b.anchor===_192b.targetAnchor){return;}var index=array.indexOf(_192b.getAllNodes(),_192b.targetAnchor)+(_192b.before?-1:1),_192c=array.filter(model.getChildren(),function(child){return child.get("visible");});index=model.indexOf(_192c[index-1])+1;if(!lang.isArray(data)){data=[data];}if(_192b==_1929&&!_192a){model.modify(function(){array.forEach(data,function(item,i){var data=item.data;if(data.contentGroup){data=model.getChild({name:data.contentGroup});}model.move(data,index+i);});});}else{model.modify(function(){array.forEach(data,function(item,i){var block=new _1904(item.data);model.addChild(block,index+i);});});}},_onDndItemRemoved:function(key){var data=this._source.getItem(key);if(!lang.isArray(data)){data=[data];}this.model.modify(function(){array.forEach(data,function(item){this.model.removeChild(item.data);},this);},this);}});});},"epi/shell/dnd/_MarkerSource":function(){define("epi/shell/dnd/_MarkerSource",["dojo/_base/array","dojo/_base/declare","dojo/dnd/Manager","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style"],function(array,_192d,_192e,_192f,_1930,_1931,_1932){return _192d(null,{_markerNode:null,markerTemplateString:"<div class=\"dojoDndItem-marker\"><div class=\"epi-dndDropMarker\"></div></div>",markerDelay:150,markOnlyAllowedDropLocations:false,_calculatedCurrent:false,destroy:function(){this.inherited(arguments);this.targetAnchorSibling=null;if(this._markerNode){_1930.destroy(this._markerNode);this._markerNode=null;}},setHorizontal:function(_1933){_192f.toggle(this.node,"dojoDndHorizontal",_1933);this.horizontal=_1933;},onMouseOver:function(e){this.inherited(arguments);this._calculatedCurrent=false;},onMouseMove:function(e){if(this.isDragging&&this.targetState=="Disabled"){return;}dojo.dnd.Source.superclass.onMouseMove.call(this,e);var m=_192e.manager();if(!this.isDragging){if(this.mouseDown&&this.isSource&&(Math.abs(e.pageX-this._lastX)>this.delay||Math.abs(e.pageY-this._lastY)>this.delay)){var nodes=this.getSelectedNodes();if(nodes.length){m.startDrag(this,nodes,this.copyState(dojo.isCopyKey(e),true));}}}if(this.isDragging){var _1934=false;if(this.current&&!this._calculatedCurrent){if(!this.targetBox||this.targetAnchor!=this.current){this.targetBox=_1931.position(this.current,true);}if(this.horizontal){_1934=(e.pageX-this.targetBox.x)<(this.targetBox.w/2);}else{_1934=(e.pageY-this.targetBox.y)<(this.targetBox.h/2);}}else{_1934=this._calculateCurrent({x:e.pageX,y:e.pageY});}if(this.current!=this.targetAnchor||_1934!=this.before){this._markTargetAnchor(_1934);m.canDrop(!this.current||m.source!=this||!this.markOnlyAllowedDropLocations||!(this.current.id in this.selection));}}},_calculateCurrent:function(point){var _1935=[],_1936,_1937;function _1938(_1939,_193a){function _193b(value){return value*value;};return Math.sqrt(_193b(_1939.x-_193a.x)+_193b(_1939.y-_193a.y));};this.getAllNodes().forEach(function(node){var pos=_1931.position(node);pos.x2=pos.x+pos.w;pos.xCentered=pos.x+pos.w/2;pos.y2=pos.y+pos.h;pos.yCentered=pos.y+pos.h/2;if(this.horizontal){_1935.push({node:node,before:true,x:pos.x,y:pos.yCentered},{node:node,before:false,x:pos.x2,y:pos.yCentered});}else{_1935.push({node:node,before:true,x:pos.xCentered,y:pos.y},{node:node,before:false,x:pos.xCentered,y:pos.y2});}},this);array.forEach(_1935,function(value){value.distance=_1938(point,value);if(!_1936||value.distance<_1937){_1936=value;_1937=value.distance;}},this);if(_1936){this.current=_1936.node;this._calculatedCurrent=true;return _1936.before;}return false;},_markTargetAnchor:function(_193c){var _193d=true,_193e=true;if(this.current===this.targetAnchor&&this.before===_193c){return;}if(this.targetAnchor){this._removeItemClass(this.targetAnchor,this.before?"Before":"After");}if(this.targetAnchorSibling){this._removeItemClass(this.targetAnchorSibling,!this.before?"Before":"After");}this.targetAnchor=this.current;this.targetBox=null;this.before=_193c;if(this.targetAnchor){this.targetAnchorSibling=_193c?this.targetAnchor.previousSibling:this.targetAnchor.nextSibling;if(!(this.targetAnchorSibling&&this.targetAnchorSibling.nodeType===1&&_192f.contains(this.targetAnchorSibling,"dojoDndItem"))){this.targetAnchorSibling=null;}if(this.markOnlyAllowedDropLocations){_193d=!(this.targetAnchor.id in this.selection);_193e=!this.targetAnchorSibling||!(this.targetAnchorSibling.id in this.selection);}if(_193d&&_193e){this._addItemClass(this.targetAnchor,this.before?"Before":"After");}if(this.targetAnchorSibling&&_193d&&_193e){this._addItemClass(this.targetAnchorSibling,!this.before?"Before":"After");}this._positionMarker(_193d&&_193e);}else{this._positionMarker(false);}},_unmarkTargetAnchor:function(){if(this.targetAnchor){this._removeItemClass(this.targetAnchor,this.before?"Before":"After");}if(this.targetAnchorSibling){this._removeItemClass(this.targetAnchorSibling,!this.before?"Before":"After");}this._positionMarker(false);this.targetAnchor=this.targetAnchorSibling=this.targetBox=null;this.before=true;},_positionMarker:function(_193f){var _1940=this._markerNode,_1941,_1942,_1943,style,top,left,_1944,gap=-1;if(_193f){_1941=_1931.position(this.targetAnchor,false);_1942=this.targetAnchorSibling?_1931.position(this.targetAnchorSibling,false):{h:0,w:0};_1943=_1931.position(this.node,false);if(this.horizontal){if(this.before){left=_1941.x-_1943.x;if(this.targetAnchorSibling){gap=(_1941.x-_1942.x-_1942.w)/2;}if(gap>=0){left-=gap;}}else{left=_1941.x+_1941.w-_1943.x;if(this.targetAnchorSibling){gap=(_1942.x-_1941.x-_1941.w)/2;}if(gap>=0){left+=gap;}}_1944=gap>=0?Math.max(_1941.h,_1942.h):_1941.h;style={display:"block",top:_1941.y-_1943.y+"px",left:left+"px",height:_1944+"px"};}else{if(this.before){top=_1941.y-_1943.y;if(this.targetAnchorSibling){gap=(_1941.y-_1942.y-_1942.h)/2;}if(gap>=0){top-=gap;}}else{top=_1941.y+_1941.h-_1943.y;if(this.targetAnchorSibling){gap=(_1942.x-_1941.x-_1941.w)/2;}if(gap>=0){top-=gap;}}width=gap>=0?Math.max(_1941.w,_1942.w):_1941.w;style={display:"block",top:top+"px",width:width+"px"};}}else{style={display:"none"};}if(!_1940){_1940=this._markerNode=_1930.place(this.markerTemplateString,this.node);_1932.set(_1940,style);}else{setTimeout(function(){_1932.set(_1940,style);},this.markerDelay);}}});});},"epi-cms/contentediting/editors/ContentBlockEditor":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/event","dojo/dom-attr","dojo/dom-class","dojo/dom-style","dojo/html","dojo/NodeList-dom","dojo/query","dijit/_Widget","dijit/_TemplatedMixin","dijit/popup","dojox/html/ellipsis","epi/shell/widget/_ModelBindingMixin","epi-cms/contentediting/editors/ContentBlockEditorViewModel","epi/i18n!epi/cms/nls/episerver.cms.widget.blockcontextmenu","dojo/text!./templates/ContentBlockEditor.html","dojo/NodeList-manipulate"],function(_1945,_1946,event,_1947,_1948,_1949,html,_194a,query,_194b,_194c,pm,_194d,_194e,_194f,res,_1950){return _1945([_194b,_194c,_194e],{templateString:_1950,model:null,contextMenu:null,isDraggable:true,modelBindingMap:{"contentLink":["contentLink"],"name":["name"],"contentGroup":["contentGroup"],"roleIdentities":["roleIdentities"],"selected":["selected"]},_setSelectedAttr:function(_1951){this.inherited(arguments);_1948.toggle(this.itemNode,"epi-content-block-editor-node-selected",_1951);_1949.set(this.iconNodeMenu,"visibility",_1951?"visible":"hidden");},_setNameAttr:function(value){this.inherited(arguments);query(this.labelNode).text(value);_1947.set(this.iconNodeMenu,"title",res.settingstooltip);},postMixInProperties:function(){this.inherited(arguments);this.model=this.model||new _194f(this.modelData);},_setIsDraggableAttr:function(_1952){this._set("isDraggable",_1952);if(this.isDraggable){_1948.add(this.domNode,"dojoDndItem");}else{_1948.remove(this.domNode,"dojoDndItem");}},_onClick:function(evt){event.stop(evt);this.contextMenu&&pm.close(this.contextMenu);this.model.set("selected",!this.model.selected);},_onContextMenu:function(evt){event.stop(evt);this.contextMenu&&this.contextMenu.scheduleOpen(evt.target,null,{x:evt.pageX,y:evt.pageY});}});});},"epi-cms/contentediting/editors/ContentBlockEditorViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","epi-cms/widget/viewmodel/ContentStatusViewModel"],function(_1953,lang,_1954,_1955){return _1953([_1954,_1955],{contentLink:"",contentGroup:"",roleIdentities:null,selected:false,name:"",index:0,getValue:function(){return {contentLink:this.contentLink,name:this.name,contentGroup:this.contentGroup,roleIdentities:this.roleIdentities};}});});},"url:epi-cms/contentediting/editors/templates/ContentBlockEditor.html":"<div class=\"epi-content-block-editor\">\r\n    <a href=\"#\" data-dojo-attach-point=\"itemNode\" style=\"display: block;\" data-dojo-attach-event=\"onclick:_onClick\">\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"epi-content-block-node\">\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dojoxEllipsis\"></span>\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-floatRight\">\r\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-iconContextMenu\" style=\"visibility: hidden;\" data-dojo-attach-event=\"onclick:_onContextMenu\"></span>\r\n            </span>\r\n        </span>\r\n    </a>\r\n</div>","url:epi-cms/widget/templates/ContentArea.html":"<div class=\"epi-overlay-blockarea\">\r\n\t<div class=\"epi-overlay-item-container\">\r\n\t\t<div class=\"epi-overlay-bracket\"></div>\r\n\t</div>\r\n\t<div data-dojo-attach-point=\"containerNode\" class=\"epi-overlay-blockarea-container\"></div>\r\n\t<div data-dojo-attach-point=\"actionsNode\" class=\"epi-overlay-blockarea-actionscontainer\">\r\n\t\t<div data-dojo-attach-point=\"actionsNodeControls\" class=\"epi-overlay-blockarea-actions\"></div>\r\n\t</div>\r\n</div>","epi-cms/widget/overlay/ItemCollection":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/viewmodel/ItemCollectionViewModel","epi-cms/widget/overlay/Property","epi/string"],function(_1956,lang,_1957,_1958,_1959){return _1956([_1958],{modelType:"epi-cms/contentediting/viewmodel/ItemCollectionViewModel",model:null,postMixInProperties:function(){this.inherited(arguments);this._setupAllowedTypes();this._setupModel(this.contentModel.get(this.name));this.own(this.contentModel.watch(this.name,lang.hitch(this,function(name,_195a,_195b){this.model.set("data",_195b);})));},onDrop:function(_195c,value){this.model.addTo(value,null,false);},_setupModel:function(data){var _195d=_1959.slashName(this.modelType);require([_195d],lang.hitch(this,function(_195e){this.model=new _195e(data,this.modelParams);this.own(this.model.on("changed",lang.hitch(this,function(_195f){this.onValueChange({propertyName:this.name,value:this.model.get("value")});})));}));},_setupAllowedTypes:function(){var _1960=this.modelParams.itemConverterKey,_1961=this.modelParams.customTypeIdentifier;this.allowedDndTypes=this.allowedDndTypes||[];if(_1960){this.allowedDndTypes=this.allowedDndTypes.map(function(type){return type+"."+_1960;});}if(_1961){this.allowedDndTypes.unshift(_1961);}}});});},"epi-cms/widget/ReadOnlyDateTimeEditor":function(){define(["dojo/_base/declare","dijit/_Widget","dijit/_TemplatedMixin","epi/datetime","dojo/text!./templates/ReadOnlyDateTimeEditor.html"],function(_1962,_1963,_1964,_1965,_1966){return _1962([_1963,_1964],{templateString:_1966,value:null,_setValueAttr:function(value){this._set("value",value);if(value){this.valueNode.innerHTML=_1965.toUserFriendlyHtml(value);}}});});},"url:epi-cms/widget/templates/ReadOnlyDateTimeEditor.html":"<div class=\"dijit dijitReset dijitInline dijitLeft\" data-dojo-attach-point=\"valueNode\"></div>","epi-cms/widget/UrlContentSelector":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/when","epi/Url","epi-cms/core/ContentReference","epi-cms/core/PermanentLinkHelper","epi-cms/widget/ContentSelector"],function(_1967,_1968,lang,when,Url,_1969,_196a,_196b){return _1967([_196b],{_contentData:null,_setValueAndFireOnChange:function(value){if(!value){this._updateDisplayNode(null);if(this.value!==value){this.onChange(null);}this._contentData=null;this.value=value;this._started&&this.validate();return;}when(this._getContentByPermanentLink(value),lang.hitch(this,function(_196c){this._updateDisplayNode(_196c);if(!epi.areEqual(this.value,value)){var _196d=_196a.toPermanentLink(_196c);this.value=_196d;this._started&&this.validate();this.onChange(_196d);}}));},_convertValueToContentReference:function(value){if(this._contentData){return new _1969(this._contentData.contentLink);}return null;},_getContentByPermanentLink:function(value){if(epi.areEqual(this.value,value)&&this._contentData){return this._contentData;}return when(_196a.getContent(value,{"allLanguages":true}),lang.hitch(this,function(_196e){this._contentData=_196e;return _196e;}));}});});},"epi-cms/widget/UrlSelector":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/when","epi/shell/widget/_ModelBindingMixin","epi-cms/widget/LinkEditor","epi-cms/widget/viewmodel/UrlSelectorViewModel","epi-cms/widget/_SelectorBase","epi-cms/contentediting/command/_CommandWithDialogMixin"],function(_196f,lang,_1970,_1971,when,_1972,_1973,_1974,_1975,_1976){return _196f([_1975,_1976,_1972],{modelClassName:_1974,dialogContentClass:_1973,dialogContentParams:null,defaultActionsVisible:false,modelBindingMap:{"internalValue":["internalValue"]},postMixInProperties:function(){this.inherited(arguments);this.dialogContentParams={modelType:this.metadata.additionalValues["modelType"],hiddenFields:["text","title","target"]};if(!this.model&&this.modelClassName){var _1977=_196f(this.modelClassName);this.model=new _1977();}},_onButtonClick:function(){this.showDialog();},onChange:function(value){},isValid:function(){return (!this.required||(this.model&&!this.model.get("isEmpty")));},onDialogExecute:function(){this.inherited(arguments);if(this.dialogContent){if(this.parent){this.parent.editing=true;}var _1978=this.dialogContent.get("value");this.set("value",_1978);this.onChange(_1978?_1978.href:null);}this._updateDisplayNode(this.value);},_updateDisplayNode:function(value){if(value){_1970.remove(this.domNode,"epi-noValue");_1970.remove(this.resourceName,"dijitPlaceHolder");this.set("selectedContentName",value.name);}else{_1970.add(this.domNode,"epi-noValue");_1970.add(this.resourceName,"dijitPlaceHolder");this.set("selectedContentName","");}},_getValueAttr:function(){return this.model.get("value");},_setValueAttr:function(value){this.model.set("value",value);},_setInternalValueAttr:function(value){this._set("value",value);this._updateDisplayNode(value);}});});},"epi-cms/widget/viewmodel/UrlSelectorViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/io-query","dojo/topic","dojo/Stateful","dojo/when","epi/shell/_StatefulGetterSetterMixin","epi-cms/core/PermanentLinkHelper"],function(array,_1979,_197a,lang,_197b,topic,_197c,when,_197d,_197e){return _1979([_197c,_197d],{_getValueAttr:function(){if(typeof this.internalValue==="string"||!this.internalValue){return this.internalValue;}else{return this.internalValue.href;}},_setValueAttr:function(value){if(typeof value==="string"){value={href:value};}if(!value||!value.href){this.set("internalValue",null);this.set("isEmpty",true);return;}this.set("isEmpty",false);when(_197e.getContent(value.href,{"allLanguages":true}),lang.hitch(this,function(_197f){value.name=_197f?_197f.name:value.href;this.set("internalValue",value);}));}});});},"epi-cms/widget/_SelectorBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/dom-class","dojo/dom-style","dojo/query","dojo/when","dijit/_CssStateMixin","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","epi/dependency","epi/i18n","epi/shell/widget/_ValueRequiredMixin","epi-cms/widget/_Droppable","epi-cms/widget/_HasClearButton","epi-cms/widget/_HasChildDialogMixin","dojo/text!./templates/_SelectorBase.html"],function(_1980,lang,_1981,_1982,_1983,_1984,query,when,_1985,_1986,_1987,_1988,_1989,i18n,_198a,_198b,_198c,_198d,_198e){return _1980([_1987,_1986,_1988,_1985,_198c,_198d,_198b,_198a],{templateString:_198e,roots:null,value:null,required:false,missingMessage:"",tooltipPosition:[],canSelectOwnerContent:false,contentRepositoryDescriptors:null,allowedDndTypes:[],_setSelectedContentNameAttr:function(value){query(this.selectedContentNameNode).text(value);},_setSelectedContentLinkAttr:{node:"selectedContentLinkNode",type:"innerHTML"},postCreate:function(){this.inherited(arguments);this.own(_1981.after(this,"onDrop",lang.hitch(this,this.focus)));},postMixInProperties:function(){this.inherited(arguments);if(!this.contentRepositoryDescriptors){this.contentRepositoryDescriptors=_1989.resolve("epi.cms.contentRepositoryDescriptors");}if(!this.roots&&this.repositoryKey){var _198f=this.contentRepositoryDescriptors[this.repositoryKey];this.roots=_198f.roots;}},_setReadOnlyAttr:function(value){this._set("readOnly",value);_1984.set(this.button.domNode,"display",value?"none":"");_1984.set(this.clearButton,"display",value?"none":"");_1983.toggle(this.domNode,"dijitReadOnly",value);},_setValueAttr:function(value){this.value=value;},_getDialog:function(){},_onButtonClick:function(){},_onDialogExecute:function(){},_onDialogHide:function(){},_getValueAttr:function(){return this.value;},_onBlur:function(){this.inherited(arguments);this.validate();},focus:function(){this.button.focus();},onChange:function(value){},_updateDisplayNode:function(_1990){},_setDialogButtonState:function(_1991){}});});},"url:epi-cms/widget/templates/_SelectorBase.html":"<div data-dojo-attach-point=\"inputContainer\" class=\"dijitReset dijitInputField dijitInputContainer dijitInline epi-resourceInputContainer\" id=\"widget_${id}\">\r\n    <div data-dojo-attach-point=\"displayNode, dropAreaNode, stateNode\" class=\"dijit dijitReset dijitInline dijitInlineTable dijitLeft dijitTextBox displayNode\">\r\n        <div class=\"dijitReset dijitLeft dijitInputField dijitInputContainer\">\r\n            <div data-dojo-attach-point=\"clearButton\" class=\"epi-clearButton\">&nbsp;</div>\r\n            <div data-dojo-attach-point=\"resourceName\" class=\"dijitInline epi-resourceName dojoxEllipsis\"/>\r\n                <span data-dojo-attach-point=\"selectedContentNameNode\"></span> <span data-dojo-attach-point=\"selectedContentLinkNode\"></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick: _onButtonClick\" data-dojo-attach-point=\"button\" data-dojo-props=\"label:'...'\"></div>\r\n</div>","epi-cms/widget/XFormEditor":function(){define(["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/_base/Deferred","dojo/when","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojo/query","dojo/html","dijit/focus","dijit/form/Button","epi/shell/widget/dialog/Dialog","epi/dependency","epi-cms/legacy/LegacyFormEditor","epi-cms/_ContentContextMixin","epi-cms/legacy/LegacyDialogPopup","epi/routes","epi-cms/widget/XFormPropertyWidget","epi/i18n!epi/cms/nls/episerver.cms.legacy.legacyformeditor","epi/i18n!epi/cms/nls/episerver.cms.widget.xformeditor"],function(_1992,event,lang,_1993,when,_1994,_1995,_1996,query,html,_1997,_1998,_1999,_199a,_199b,_199c,_199d,_199e,_199f,res,_19a0){return _1992([_199b,_199c],{localization:lang.mixin(res,_19a0),destroyOnHide:true,editorWidgetClass:_199f,store:null,stopEditOnBlur:true,templateString:"            <div class=\"dijit dijitReset dijitInline dijitLeft epi-xFormEditor\">                <div data-dojo-attach-point=\"output\" data-dojo-type=\"dijit/form/TextBox\" value=\"${localization.helptext}\"></div>                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"openButton\" data-dojo-attach-event=\"onClick: openEditor\" data-dojo-props=\"label:'${localization.buttonlabel}'\"></div>                <a href=\"#\" data-dojo-attach-point=\"viewDataLink\" data-dojo-attach-event=\"click: _openViewDataDialog\" title=\"${localization.viewdata.tooltip}\" class=\"disabled\">${localization.viewdata.text}</a>            </div>",postMixInProperties:function(){this.inherited(arguments);var _19a1=_199a.resolve("epi.storeregistry");this.store=this.store||_19a1.get("epi.cms.xform");},openEditor:function(){this.inherited(arguments);this.onFocus();},_createDialog:function(){if(this.contentLink){lang.mixin(this.params,{"contentLink":this.contentLink});}else{when(this.getCurrentContext(),lang.hitch(this,function(_19a2){lang.mixin(this.params,{"contentLink":_19a2.id});}));}this.inherited(arguments);},_openViewDataDialog:function(evt){event.stop(evt);if(_1994.contains(this.viewDataLink,"disabled")){return;}this._showFormDataDialog("Edit/XFormViewData.aspx",this.contentLink,this.value);},_onCancel:function(){this.inherited(arguments);this.setDisplayValue(this.value);},_onDialogCancel:function(){this.inherited(arguments);this.setDisplayValue(this.value);},_showFormDataDialog:function(path,_19a3,_19a4){var route=_199e.getActionPath({id:_19a3,path:path,moduleArea:"LegacyCMS",IsInLegacyWrapper:true,formid:_19a4}),_19a5=new _199d({url:route,dialogArguments:window.document,showCancelButton:true,features:{width:750,height:300},autoFit:true,showLoadingOverlay:false});this.connect(_19a5,"onLoad",function(_19a6){if(!_19a6){return;}var h1=query("h1[class=\"EP-prefix\"]",_19a6.containerIframe.contentDocument.body);_1996.create("span",{innerHTML:this.localization.viewdata.forms+" >"},h1.parent()[0],"first");var _19a7=query("select[id$=\"SelectForm\"]",_19a6.containerIframe.contentDocument.body);if(_19a7){_1995.set(_19a7.parent()[0],"display","none");}var _19a8=query("input[type=\"checkbox\"][id$=\"ShowResultFromAllPages\"]",_19a6.containerIframe.contentDocument.body);if(_19a8){_1995.set(_19a8.parent()[0],"display","none");}});_19a5.show();},setDisplayValue:function(value){if(!value){this.output.set("value",this.localization.helptext);_1994.add(this.viewDataLink,"disabled");return;}_1993.when(this.store.query({id:value}),lang.hitch(this,function(_19a9){if(_19a9&&_19a9.name){this.output.set("value",_19a9.name);this.contentLink&&_1994.remove(this.viewDataLink,"disabled");}else{this.set("value",null);}this.onBlur();}));}});});},"epi-cms/widget/XFormPropertyWidget":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/epi","epi/routes","epi-cms/legacy/LegacyDialogWrapper","epi-cms/core/ContentReference","epi/i18n!epi/cms/nls/episerver.cms.widget.xformeditor"],function(_19aa,lang,epi,_19ab,_19ac,_19ad,res){return _19aa([_19ac],{title:res.selectform,onChange:function(_19ae){},postMixInProperties:function(){this.features=lang.mixin({width:800,height:400},this.editorFeatures);this.autoFit=true;this.connect(this,"onCallback","_onCallback");this.inherited(arguments);},startup:function(){this.inherited(arguments);this.set("url",this._buildIframeUrl());},onCancel:function(){},_buildIframeUrl:function(){var _19af={moduleArea:"LegacyCMS",path:"edit/XFormSelect.aspx",epslanguage:this.contentLanguage,propertyname:this.fullName};lang.mixin(_19af,{"pageId":new _19ad(this.contentLink).createVersionUnspecificReference().id,"form":this.value?this.value:""});return _19ab.getActionPath(_19af);},_onCallback:function(_19b0){var _19b1=_19b0?_19b0.id:null;if(!epi.areEqual(this.value,_19b1)&&_19b0!==null){this.value=_19b1;this.onChange(_19b1);}else{this.onCancel();}}});});},"*now":function(r){r(["dojo/i18n!*preload*epi-cms/nls/widgets*[\"ar\",\"ca\",\"cs\",\"da\",\"de\",\"el\",\"en-gb\",\"en-us\",\"es-es\",\"fi-fi\",\"fr-fr\",\"he-il\",\"hu\",\"it-it\",\"ja-jp\",\"ko-kr\",\"nl-nl\",\"nb\",\"pl\",\"pt-br\",\"pt-pt\",\"ru\",\"sk\",\"sl\",\"sv\",\"th\",\"tr\",\"zh-tw\",\"zh-cn\",\"ROOT\"]"]);}}});