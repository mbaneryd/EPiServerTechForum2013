//>>built
require({cache:{"url:epi-packaging/templates/RestartSite.htm":"<div style=\"display: none;\" class=\"restartContainer\">\r\n    <span>${res.restartrequiredmessage}</span>\r\n    <input type=\"button\" dojoAttachPoint=\"restartButton\" data-dojo-type=\"dijit/form/Button\" label=\"${res.restartbuttonlabel}\"/>\r\n</div>"}});define("epi-packaging/RestartSite",["dojo","dijit","epi/routes","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojox/widget/Standby","dojo/text!./templates/RestartSite.htm","epi/i18n!epi/packaging/nls/EPiServer.Packaging.UI.RestartSite"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){return _1.declare([_4,_5,_6],{res:_9,templateString:_8,pingTimeout:5000,restartUrl:null,checkStatusUrl:null,antiForgeryData:null,_restartStandby:null,constructor:function(){if(_3){this.restartUrl=_3.getActionPath({moduleArea:"EPiServer.Packaging.UI",controller:"AddOns",action:"Restart"});this.checkStatusUrl=_3.getActionPath({moduleArea:"EPiServer.Packaging.UI",controller:"AddOns",action:"CheckRestartRequired"});}},postMixInProperties:function(){if(!this.restartUrl){console.error("restartUrl is not specified");}if(!this.checkStatusUrl){console.error("checkStatusUrl is not specified");}this.inherited(arguments);},startup:function(){_1.connect(this.restartButton,"onClick",this,function(){this._requestRestart();});this.inherited(arguments);},hide:function(){_1.style(this.domNode,"display","none");},show:function(){_1.style(this.domNode,"display","block");},showIfRestartRequired:function(){var _a={};this.antiForgeryData.AddAntiforgeryToken(_a);_1.xhrPost({content:_a,url:this.checkStatusUrl,handleAs:"json",load:_1.hitch(this,function(_b){if(!_b){return;}else{if(_b.restartRequired==true){this.show();}else{this.hide();}this.onRestartCheckComplete(_b.restartRequired==true);}}),error:_1.hitch(this,function(_c,_d){_1.publish("onServerError",[_d]);this.hide();})});},onRestartFinished:function(){},onRestartCheckComplete:function(_e){},_requestRestart:function(){if(!this._restartStandby){this._restartStandby=new _7({target:this.domNode});document.body.appendChild(this._restartStandby.domNode);this._restartStandby.startup();}this._restartStandby.show();var _f={};this.antiForgeryData.AddAntiforgeryToken(_f);_1.xhrPost({content:_f,url:this.restartUrl,handleAs:"json",load:_1.hitch(this,function(_10,_11){if(_10.restartRequired){this.counter=0;this._ping();}else{this._restartStandby.hide();alert(this.res.restartfailedmessage);}}),error:_1.hitch(this,function(err,_12){this._restartStandby.hide();_1.publish("onServerError",[_12]);}),handle:function(){}});},_ping:function(){this.counter++;if(this.counter>100){this._restartStandby.hide();return;}setTimeout(_1.hitch(this,function(){var _13={};this.antiForgeryData.AddAntiforgeryToken(_13);_1.xhrPost({content:_13,url:this.checkStatusUrl,handleAs:"json",load:_1.hitch(this,function(_14,_15){if(_14.restartRequired==true){this._ping();}else{this._restartStandby.hide();this.hide();this.onRestartFinished();}}),error:_1.hitch(this,function(err,_16){if(_16.xhr.status==500){this._restartStandby.hide();_1.publish("onServerError",[_16]);}else{this._ping();}})});}),this.pingTimeout);}});});