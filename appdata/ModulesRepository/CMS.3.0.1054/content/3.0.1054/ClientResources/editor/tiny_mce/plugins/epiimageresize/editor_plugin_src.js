(function(tinymce){tinymce.create("tinymce.plugins.epiimageresize",{init:function(ed){ed.onInit.add(function(ed){var _imageLastSize={},dom=ed.dom,imageSizeHasChanged=function(ed,el){var elId=_getImageId(el),previousSize=null!==_imageLastSize?_imageLastSize[elId]:null;previousSize&&(previousSize.height!==el.height||previousSize.width!==el.width)&&ed.undoManager.add()},_getImageId=function(el){var elId=dom.getAttrib(el,"mce_epiimageresize_id");return elId||(elId=ed.id+"_"+ed.dom.uniqueId(),dom.setAttrib(el,"mce_epiimageresize_id",elId)),elId},saveImageSize=function(el){var elId=_getImageId(el),size={height:el.height,width:el.width};_imageLastSize[elId]=size};ed.onMouseDown.add(function(ed){var el=ed.selection.getNode();return null!=el&&"IMG"==el.nodeName&&(ed.undoManager.hasUndo()||ed.undoManager.add(),saveImageSize(el)),!0}),ed.onMouseUp.add(function(ed){var el=ed.selection.getNode();return null!=el&&"IMG"==el.nodeName&&setTimeout(function(){imageSizeHasChanged(ed,el)},100),!0})})},getInfo:function(){return{longname:"image resizing plugin",author:"EPiServer AB",authorurl:"http://www.episerver.com",infourl:"http://www.episerver.com",version:1}}}),tinymce.PluginManager.add("epiimageresize",tinymce.plugins.epiimageresize)})(tinymce);