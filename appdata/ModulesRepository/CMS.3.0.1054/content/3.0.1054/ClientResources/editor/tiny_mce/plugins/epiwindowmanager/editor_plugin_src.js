(function(tinymce,$){tinymce.create("tinymce.plugins.epiWindowManager",{init:function(ed){ed.onBeforeRenderUI.add(function(){ed.windowManager=new tinymce.epiWindowManager(ed)})},getInfo:function(){return{longname:"EPiServer Window Manager",author:"EPiServer AB",authorurl:"http://www.episerver.com",infourl:"http://www.episerver.com",version:"1.0"}}}),tinymce.create("tinymce.epiWindowManager:tinymce.WindowManager",{epiWindowManager:function(ed){this.parent(ed),this.isIE=tinymce.isIE||tinymce.isIE11},open:function(f,p){var u,t=this,ed=t.editor;f=f||{},p=p||{},!f.type&&t.isIE&&(t.bookmark=ed.selection.getBookmark(1)),f.width=parseInt(f.width||320)+(t.isIE?18:0),f.height=parseInt(f.height||240)+(t.isIE?8:0),p.mce_inline=!0,p.mce_auto_focus=f.auto_focus,u=f.url||f.file,t.features=f,t.params=p,window.top.tinymce=tinymce,window.top.tinyMCE=tinyMCE;var restoreSelection=function(){!f.type&&t.isIE&&ed.selection.moveToBookmark(t.bookmark)},onCallback=function(returnValue,callbackArgs){restoreSelection(),f.onCallback&&f.onCallback(returnValue,callbackArgs)},onHide=function(){t.onClose.dispatch(this),ed.windowManager.onClose.dispatch()};require(["epi-cms/legacy/LegacyDialogPopup"],function(LegacyDialogPopup){f.dialogArguments=f.dialogArguments||{},f.callbackArguments=f.callbackArguments||{},t.features.height&&(t.features.height+=60);var _dialog=new LegacyDialogPopup({url:u,onCallback:onCallback,onHide:onHide,onBeforePerformAction:restoreSelection,callbackArguments:f.callbackArguments,dialogArguments:f.dialogArguments,showCancelButton:!0,destroyOnHide:!0,features:t.features,autoFit:!t.features.height,showLoadingOverlay:!1});t.onOpen.dispatch(t,f,p),_dialog.show().then(function(){f.onReady&&f.onReady(_dialog)})})},close:function(win){win.EPi.GetDialog(win).Close()},resizeBy:function(dw,dh,win){win.setTimeout(function(){var doc=win.document;if(null!=doc&&null!=doc.body){var originalHeight=0!==doc.documentElement.clientHeight?doc.documentElement.clientHeight:doc.documentElement.offsetHeight,body=$(doc.body),additionalHeight=this.isIE?15:20,heightChange=body.outerHeight()+body.offset().top+additionalHeight-originalHeight;win.resizeBy(0,heightChange>0?heightChange:0)}},10)},setTitle:function(){},focus:function(){}}),tinymce.PluginManager.add("epiwindowmanager",tinymce.plugins.epiWindowManager)})(tinymce,epiJQuery);