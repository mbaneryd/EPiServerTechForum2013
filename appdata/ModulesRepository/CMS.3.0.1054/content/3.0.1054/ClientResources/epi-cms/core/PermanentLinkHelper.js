//>>built
define("epi-cms/core/PermanentLinkHelper",["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/store/Memory","dojo/when","epi/dependency","epi/Url","epi-cms/ApplicationSettings","epi-cms/core/ContentReference"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){var _a={_cacheStore:new _4({idAttribute:"id",data:[]}),_storeCache:function(_b){if(!_b){return;}var _c=this._cacheStore.get(_b.contentLink);if(_c){return;}this._cacheStore.put({id:_b.contentLink,internalLink:this._toInternal(_b)});},_tryGetContentLink:function(_d){if(!_d){return null;}var _e=new _7(_d),_f=_e.query["id"];if(!_f){try{_f=_9.toContentReference(_d);if(isNaN(_f.id)){return null;}return _f.toString();}catch(e){return null;}}return _f;},_toInternal:function(_10){var _11,_12=_8.applicationVirtualPath||"";if(_10){_11=_12+"/link/"+_10.contentGuid.replace(/-/g,"")+".aspx";_11=_11.replace(/\/\//g,"/");}return _11;},toPermanentLink:function(_13,_14){this._storeCache(_13);return this._toInternal(_13);},isPermanentLink:function(_15){return (/(\/link\/)(?=([0-9a-z]{32})(\.aspx))/i).test(_15);},getContent:function(_16,_17){if(!_16){return null;}var dfd=new _2(),_18=_6.resolve("epi.storeregistry"),_19=_18.get("epi.cms.content.light"),_1a=_3.mixin({"query":"getcontentbypermanentlink","permanentLink":_16},_17||{}),_1b;var _1c=this._cacheStore.query({internalLink:_16}),_1d=_1c&&_1c.length>0,_1e=this.isPermanentLink(_16),_1f=_1e?null:this._tryGetContentLink(_16);_1b=_1d||_1f?_19.get(_1f||_1c[0].id):_19.query(_1a);_5(_1b,_3.hitch(this,function(_20){var _21=_20&&_20 instanceof Array?_20[0]:_20;if(!_1d){this._storeCache(_21);}dfd.resolve(_21);}));return dfd;}};return _a;});