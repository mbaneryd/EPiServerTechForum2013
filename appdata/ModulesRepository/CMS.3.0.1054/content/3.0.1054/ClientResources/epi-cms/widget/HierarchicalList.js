//>>built
require({cache:{"url:epi-cms/widget/templates/HierarchicalList.html":"<div class=\"epi-hierarchicalList\">\r\n    <div data-dojo-attach-point=\"container\"\r\n         data-dojo-type=\"dijit/layout/BorderContainer\"\r\n         data-dojo-props=\"gutters: false\">\r\n        <div class=\"epi-gadgetInnerToolbar\"\r\n             data-dojo-attach-point=\"searchBox\"\r\n             data-dojo-type=\"epi-cms/widget/SearchBox\"\r\n             data-dojo-props=\"region:'top', splitter: false, triggerContextChange: this.triggerContextChange\"\r\n             data-dojo-attach-event=\"onItemAction:_onSearchAction\"></div>\r\n        <div class=\"epi-secondaryGadgetContainer epi-gadgetTopContainer\"\r\n             data-dojo-attach-point=\"tree\"\r\n             data-dojo-type=\"epi-cms/widget/FolderTree\" \r\n             data-dojo-props=\"region:'center', splitter:false, model: this.model.treeStoreModel, showRoot: false, contextMenu: this.contextMenu\"></div>\r\n        <div data-dojo-attach-point=\"list\" class=\"epi-gadgetBottomContainer\"\r\n             data-dojo-type=\"epi-cms/widget/ContentList\"\r\n             data-dojo-props=\"region:'bottom', splitter:true, store: this.model.store, queryOptions: this.model.listQueryOptions, contextMenu: this.contextMenu, resources: this.res\">\r\n            <div data-dojo-attach-point=\"createContentArea\" class=\"epi-createContentContainer\">\r\n                <div class=\"epi-createContent\">\r\n                    <span data-dojo-attach-point=\"createContentAreaIcon\" class=\"dijitReset dijitInline dijitIcon\"></span>\r\n                    <span data-dojo-attach-point=\"createContentAreaText\" class=\"dijitReset dijitInline epi-createContentText\"></span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>","url:epi-cms/widget/templates/AssetsDropZone.html":"<div class=\"epi-assetsDropZone\">\r\n    <span class=\"dijitReset dijitInline epi-dropZoneText\">${res.dropzonedescription}</span>\r\n</div>\r\n"}});define("epi-cms/widget/HierarchicalList",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/on","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","dijit/layout/BorderContainer","dojox/html/entities","epi/string","epi/shell/command/_WidgetCommandBinderMixin","epi/shell/widget/_FocusableMixin","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/dialog/Alert","epi/shell/widget/ContextMenu","epi-cms/widget/SearchBox","epi-cms/widget/FolderTree","epi-cms/widget/ContentList","epi-cms/widget/FilesUploadDropZone","epi-cms/widget/UploadUtil","epi-cms/widget/viewmodel/HierarchicalListViewModel","dojo/text!./templates/HierarchicalList.html","dojo/text!./templates/AssetsDropZone.html","epi/i18n!epi/cms/nls/episerver.cms.widget.hierachicallist"],function(_1,_2,_3,_4,_5,_6,_7,_8,on,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_1a,_1b,_1c,res){return _2([_c,_a,_b,_12,_10],{contextMenu:null,templateString:_1b,showRoot:false,enableDndFileDropZone:false,showCreateContentArea:false,triggerContextChange:false,res:res,modelClassName:_1a,hierarchicalListClass:"",noDataMessage:"",createContentIcon:"",createContentText:"",_dropZoneCreated:false,modelBindingMap:{"searchRoots":["searchRoots"],"searchArea":["searchArea"],"listQuery":["listQuery"],"currentTreeItem":["currentTreeItem"],"currentListItem":["currentListItem"],"editingListItem":["editingListItem"],"showAllLanguages":["showAllLanguages"]},_setSearchAreaAttr:function(_1d){this.searchBox.set("area",_1d);},_setSearchRootsAttr:function(_1e){this.searchBox.set("searchRoots",_1e);},_setListQueryAttr:function(_1f){this.list.set("query",_1f);},_setShowAllLanguagesAttr:function(_20){this.searchBox.set("filterOnCulture",!_20);},_setCurrentTreeItemAttr:function(_21){if(_21){this._toggleActive(this.tree,this.list);_9(this.tree.selectContent(_21.toString()),_3.hitch(this,function(){var _22=this.tree.getNodesByItem(_21.toString())[0];if(_22){this.tree.model.set("previousSelection",{selectedContent:_22,selectedAncestors:_22.getTreePath()});}}));}},_setCurrentListItemAttr:function(_23){this.list.set("currentItem",_23);this._toggleActive(this.list,this.tree);},_setEditingListItemAttr:function(_24){this.list.set("editingItem",_24);},_setShowRootAttr:function(_25){this.tree.set("showRoot",_25);},postMixInProperties:function(){this.inherited(arguments);if(!this.model&&!this.commandProvider&&this.modelClassName){var _26=_2(this.modelClassName);this.model=this.commandProvider=new _26({repositoryKey:this.repositoryKey});}this.setupContextMenu();},setupContextMenu:function(){this.own(this.contextMenu=new _14({category:"context"}));this.contextMenu.addProvider(this.model);},postCreate:function(){this.inherited(arguments);_5.add(this.domNode,this.hierarchicalListClass);this._setupTree();this._setupCreateContentArea();this._setupList();if(this.enableDndFileDropZone){this._setupDropZone();}this._toggleCreateContentArea(this.showCreateContentArea);this.model.startup();this.own(this.model.clipboardManager.watch("data",_3.hitch(this,this._updateClipboardIndicators)));},startup:function(){this.inherited(arguments);if(this.contextMenu){this.contextMenu.startup();}},destroy:function(){this.model.destroy();this.inherited(arguments);},layout:function(){if(this.enableDndFileDropZone){var _27=this.list.grid;if(_27){_5.add(_27.bodyNode,"epi-drop-area");}}var _28=_7.getMarginBox(this.list.domNode),_29=_7.getMarginBox(this.searchBox.domNode),_2a=this._contentBox.h-_29.h-32;if(_28.h>_2a){this.list.resize({h:_2a});}this.container.resize(this._contentBox);},_toggleCreateContentArea:function(_2b){_8.set(this.createContentArea,{"display":_2b?"":"none"});},_toggleActive:function(_2c,_2d){_5.remove(_2d.domNode,"epi-focused");_5.add(_2c.domNode,"epi-focused");},_showNotification:function(_2e){var _2f=new _13({destroyOnHide:true,description:_f.toHTML(_2e)});_2f.show();},_onDrop:function(evt,_30){_30=_19.filterFileOnly(_30);if(!_30||_30.length<=0){return;}var _31=this.model.getCommand("uploadDefault");if(!_31){return;}_31.set("fileList",_30);_31.execute();},_setupDropZone:function(){if(!(_19.supportNativeDndFiles()&&!this._dropZoneCreated)){return;}var _32=new _18({"templateString":_1c,"res":res,"outsideDomNode":this.container.domNode});_6.place(_32.domNode,this.domNode,"first");this.connect(_32,"onDrop",this._onDrop);this._dropZoneCreated=true;var _33=this.model.getCommand("uploadDefault");if(_33){this.own(_33.watch("canExecute",function(_34,_35,_36){_32.set("enabled",_36);}));}},_setupTree:function(){var _37=this.model._commandRegistry;function _38(_39,_3a,e){this.model.onTreeItemSelected(_39,this.tree.model.isTypeOfRoot(_39));};function _3b(_3c){_3c?_37.copy.command.execute():_37.cut.command.execute();};this.own(on(this.tree,"copyOrCut",_3b),on(this.tree,"select",_3.hitch(this,_38)),on(this.tree,"paste",function(){_37.paste.command.execute();}),on(this.tree,"delete",function(){_37["delete"].command.execute();}),_4.after(this.tree,"onClick",_3.hitch(this,_38),true));this.model._commandRegistry.rename.command.set("renameDelegate",_3.hitch(this,function(_3d){this.tree.getNodesByItem(_3d)[0].edit();}));},_setupCreateContentArea:function(){_5.add(this.createContentAreaIcon,this.createContentIcon);this.createContentAreaText.innerHTML=this.createContentText;this.list.set("noDataMessage",this.noDataMessage);},_setupList:function(){this.own(on(this.list,"itemSelected",_3.hitch(this.model,this.model.onListItemSelected)),_4.after(this.model,"onListItemUpdated",_3.hitch(this.list,function(_3e){_9(_3e,_3.hitch(this,this.editContent));})));},_onSearchAction:function(_3f){this.model.onSearch(_3f.metadata);},_updateClipboardIndicators:function(_40,_41,_42){var _43=this.model.clipboardManager.isCopy();if(_41 instanceof Array){_1.forEach(_41,function(_44){this.tree.toggleCut(_44.data,false);this.list.toggleCut(_44.data,false);},this);}if(!_43&&_42 instanceof Array){_1.forEach(_42,function(_45){this.tree.toggleCut(_45.data,true);this.list.toggleCut(_45.data,true);},this);}}});});