//>>built
define("epi-cms/widget/VisitorGroupButton",["dojo","dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/_base/Deferred","dojo/dom-class","dijit/DropDownMenu","dijit/form/DropDownButton","dijit/focus","epi","epi/dependency","epi-cms/widget/VisitorGroupsSelector","epi/i18n!epi/cms/nls/episerver.cms.widget.visitorgroupsbutton"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d){return _2([_8],{_contextMenu:null,baseClass:"epi-mediumButton epi-chromelessButton",iconClass:"epi-iconUsers",contextMenuProperties:{},_visitorGroupsSelector:null,_viewSettingsManager:null,postMixInProperties:function(){this.inherited(arguments);_3.mixin(this.contextMenuProperties,{"class":"epi-DropDownMenu"});},postCreate:function(){this.inherited(arguments);this._viewSettingsManager=_b.resolve("epi.viewsettingsmanager");var _e=this._viewSettingsManager.getSettingProperty("visitorgroup");if(!this.dropDown){this.dropDown=dijit.DropDownMenu(this.contextMenuProperties);this._visitorGroupsSelector=new _c({checkedItem:_e});_4.connect(this._visitorGroupsSelector,"onItemSelected",this,this._onVisitorGroupSelected);this._addChildren(this._visitorGroupsSelector);_5.when(this._visitorGroupsSelector.isSetupFinished(),_3.hitch(this,function(_f){this._activeButton(!this._isDefaultSelection());this._updateTooltip();}));}_4.connect(this.dropDown,"onOpen",this,function(e){_9.focus(this._visitorGroupsSelector.menuNode.domNode);});},_updateTooltip:function(){var _10=null;if(this._isDefaultSelection()){_10=_d.defaulttooltip;}else{var _11=this._visitorGroupsSelector.currentSelectedItem;_10=_3.replace(_d.tooltip,{visitorgroup:_11.name});}this.set("title",_10);},_isDefaultSelection:function(){return this._visitorGroupsSelector.isDefaultItemSelected();},_onVisitorGroupSelected:function(_12){this._changeView(_12);},_changeView:function(_13){if(_13){if(_13.name==this._visitorGroupsSelector.defaultItem.name){_4.publish("/epi/cms/action/viewsettingvaluechanged",["visitorgroup",null]);}else{_4.publish("/epi/cms/action/viewsettingvaluechanged",["visitorgroup",_13.id]);}}this._activeButton(!this._isDefaultSelection());this._updateTooltip();},_addChildren:function(_14){this.dropDown.addChild(_14);},_activeButton:function(_15){if(!this.dropDown){return;}if(_15){_6.add(this.domNode,"dijitChecked");}else{_6.remove(this.domNode,"dijitChecked");}}});});