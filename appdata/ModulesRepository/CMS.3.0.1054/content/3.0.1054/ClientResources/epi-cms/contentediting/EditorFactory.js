//>>built
define("epi-cms/contentediting/EditorFactory",["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","epi/string"],function(_1,_2,_3,_4){return _1(null,{defaultWrapperType:"flyout",_registeredEditorWrappers:null,onEditorCreated:function(_5){},onEditorResolved:function(_6,_7){},constructor:function(){this._registeredEditorWrappers={};},registerEditorWrapper:function(_8,_9,_a){this._registeredEditorWrappers[_8]={wrapperClassType:_9,initializer:_a};},_getWrapperAndEditor:function(_b){var _c=_b.type;var _d=_b.name;var _e=_b.wrapperType;var _f=_b.editorParams||{};var _10=_b.editorWidgetType;if(!_e){if(_b.metadata.customEditorSettings&&_b.metadata.customEditorSettings.uiWrapperType){_e=_b.metadata.customEditorSettings.uiWrapperType;}else{_e=this.defaultWrapperType;}}if(!_10){if(_b.metadata.customEditorSettings&&_b.metadata.customEditorSettings.uiType){_10=_b.metadata.customEditorSettings.uiType;}else{if(_b.metadata.uiType){_10=_b.metadata.uiType;}else{_10="epi/shell/widget/FormContainer";_3.mixin(_f,{metadata:_b.metadata,onFieldCreated:function(_11,_12){}});}}}if(!_10){throw ("Could not resolve editor widget for property: "+_b.name);}if(_b.metadata.customEditorSettings&&_b.metadata.customEditorSettings.uiParams){_3.mixin(_f,_b.metadata.customEditorSettings.uiParams);}var _13=this._registeredEditorWrappers[_e];if(!_13){throw ("No suitable editor wrapper found for type: "+_e);}var _14={wrapperInitializer:_13.initializer,wrapperType:_13.wrapperClassType,editorWidgetType:_10,editorParams:_f};this.onEditorResolved(_14,_b);if(_e){return _14;}throw ("No suitable editor found");},createEditor:function(_15,_16,_17,_18){var def=new _2();var _19=this._getWrapperAndEditor(_15);var _1a=_4.slashName(_19.wrapperType);var _1b=_4.slashName(_19.editorWidgetType);require([_1a,_1b],_3.hitch(this,function(_1c){var _1d=_18||{};if(_15.metadata){_3.mixin(_1d,_15.metadata.settings);_3.mixin(_1d,_19.editorParams);_1d.selections=_15.metadata.selections;}var _1e={wrapperType:_19.wrapperType,editorWidgetType:_19.editorWidgetType,editorParams:_1d,blockDisplayNode:_16,overlayItem:_1d.overlayItem,property:_15,propertyName:_15.name,propertyDisplayName:_15.metadata.displayName,value:_17,contentModel:_15.contentModel};var _1f=new _1c(_1e);var _20=_19.wrapperInitializer;if(_20){_3.mixin(_1e.editorParams,{parent:_1f});_20(_1f,_1e);}this.onEditorCreated(_1f.getEditorWidget());def.resolve(_1f);}));return def;}});});