//>>built
define("epi-cms/contentediting/OnPageEditing",["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/when","epi/shell/gesture/ScrollPullDown","epi-cms/contentediting/_FormEditingMixin","epi-cms/contentediting/_ValidationMixin","epi-cms/contentediting/EditingBase"],function(_1,_2,_3,_4,_5,_6,_7,_8){return _1([_8,_6,_7],{_iframeConnects:null,postMixInProperties:function(){this.inherited(arguments);this.formSettings={doLayout:false,baseClass:"epi-cmsEditingForm epi-cmsEditingFormOpe",propertyFilter:function(_9,_a){return _a.groupName==="EPiServerCMS_SettingsPanel";}};},destroy:function(){this._removePullDownGesture();this.inherited(arguments);},onEditorWrapperCreated:function(_b){if(_b&&_b.editorWidget){var _c=_b.editorWidget;if(_c.onFieldCreated){this.connect(_c,"onFieldCreated",function(_d,_e){this._addStateWatch(_e);});}else{_c.set("name",_b.get("propertyName"));this._addStateWatch(_c);}_c.validate&&_c.validate();}},onSetActiveProperty:function(_f){var _10=this._mappingManager.findOne("propertyName",_f);if(!_10){dojo.publish("/epi/cms/action/switcheditmode",[null,{activePropertyOnStartup:_f}]);}else{this.inherited(arguments);}},_onOverlayItemClick:function(_11,e){var _12=this._activeEditorWrapper;if(_12){_12.tryToStopEditing();if(_12.editing||_11.name===_12.overlayItem.name){return;}}this.inherited(arguments);},placeForm:function(_13){_13.set("fitContainer",false);_13.set("transitionMode","slideIn");this.layoutContainer.addChild(_13,0);this._setupPullDownGesture(_13);},_setupPullDownGesture:function(_14){var _15=this;this._pullDownGesture=_5(_15.iframeWithOverlay.previewContainer,{isShown:false,show:function(){this.isShown=null;_4(_15.layoutContainer.selectChild(_14),_2.hitch(this,function(){this.isShown=true;_15.iframeWithOverlay.onViewportPullDown();}),_2.hitch(this,function(){this.isShown=false;_15.iframeWithOverlay.onViewportPullDown();}));},hide:function(){this.isShown=null;_4(_15.layoutContainer.selectChild(_15.iframeWithOverlay),_2.hitch(this,function(){this.isShown=false;_15.iframeWithOverlay.onViewportPullDown();}),_2.hitch(this,function(){this.isShown=true;_15.iframeWithOverlay.onViewportPullDown();}));}});this._pullDownGesture.addMouseWheelListener(_14.domNode);if(_15.iframeWithOverlay.iframe.isInspectable()){this._setupIframeMouseWheelListeners();}},_setupIframeMouseWheelListeners:function(){var _16=this._pullDownGesture.addMouseWheelListener(this.iframeWithOverlay.iframe.getDocument());this._iframeConnects=[];this._iframeConnects.push(this.connect(this.iframeWithOverlay.iframe,"onLoad",function(){_16=this._pullDownGesture.addMouseWheelListener(this.iframeWithOverlay.iframe.getDocument());}));this._iframeConnects.push(this.connect(this.iframeWithOverlay.iframe,"onUnload",function(){_16&&_16.remove();}));},_teardownIframeMouseWheelListeners:function(){if(this._iframeConnects){var c;while(c=this._iframeConnects.pop()){this.disconnect(c);}c=null;this._iframeConnects=null;}},_removePullDownGesture:function(){this._teardownIframeMouseWheelListeners();if(this._pullDownGesture){this._pullDownGesture.destroy();this._pullDownGesture=null;}},removeForm:function(_17){this._removePullDownGesture();this.layoutContainer.leftOver=_17;return false;}});});