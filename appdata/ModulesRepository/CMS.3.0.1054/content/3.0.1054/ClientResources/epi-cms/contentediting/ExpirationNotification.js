//>>built
define("epi-cms/contentediting/ExpirationNotification",["dojo/_base/declare","dojo/string","epi/datetime","epi/dependency","epi-cms/ApplicationSettings","epi-cms/contentediting/_ContentEditingNotification","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/cms/nls/episerver.cms.contentediting.versionstatus"],function(_1,_2,_3,_4,_5,_6,_7,_8){return _1([_6],{postscript:function(){this.inherited(arguments);this._notificationPeriod=_5.expirationNotificationPeriod;this._setupCommands();},_executeAction:function(_9){return _9.contentData.properties.iversionable_expire;},_onExecuteSuccess:function(_a){var _b=_3.serverTime();var _c=_a?_a.stopPublish:null,_d=new Date(_c);var _e=null;if(_c&&_3.isDateValid(_d)){if(new Date(_b.getTime()+this._notificationPeriod*1000)>_d){_e=_d<_b?_8.expired:_2.substitute(_7.expiretimetext,[_3.timeToGo(_d)]);}}if(!_e){this._setNotification(null);}else{this._setNotification({content:_e,commands:[this._editingCommands.manageExpiration]});}},_viewModelValueHandler:null,_setupCommands:function(){if(!this._editingCommands){this._editingCommands=_4.resolve("epi.cms.contentEditing.command.Editing");}if(this._commandsWatchHandler){this._commandsWatchHandler.unwatch();}var _f=this;var _10=null;_f._commandsWatchHandler=this._editingCommands.manageExpiration.watch("viewModel",function(_11,_12,_13){if(_f._viewModelValueHandler){_f._viewModelValueHandler.unwatch();}_f._viewModelValueHandler=_13.watch("value",function(_14,_15,_16){_f._onExecuteSuccess(_16);});});}});});