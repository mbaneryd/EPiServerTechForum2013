(function(tinymce){tinymce.create("tinymce.plugins.EPiTrailing",{init:function(ed){var t=this;ed.onSetContent.add(function(ed){t._insertTrailingElement(ed)}),ed.onChange.add(function(ed){t._insertTrailingElement(ed)}),ed.onPreProcess.add(function(ed,o){t._trimEmptyElements(ed,o)})},getInfo:function(){return{longname:"Trailing element",author:"EPiServer AB",authorurl:"http://www.episerver.com",infourl:"http://www.episerver.com",version:1}},_insertTrailingElement:function(ed){var body=ed.getBody(),last=body&&body.lastChild;body&&last&&ed.dom.isBlock(last)&&"P"!==last.tagName&&body.appendChild(ed.dom.create("p",null,'<br _mce_bogus="1" />'))},_trimEmptyElements:function(ed,o){if(o.get&&1!==o.node.childNodes.length){for(var last=o.node.lastChild;last&&"P"===last.nodeName&&1==last.childNodes.length&&"BR"==last.firstChild.nodeName;)ed.dom.remove(last),last=o.node.lastChild;for(var first=o.node.firstChild;first&&"P"===first.nodeName&&1==first.childNodes.length&&"BR"==first.firstChild.nodeName;)ed.dom.remove(first),first=o.node.firstChild}}}),tinymce.PluginManager.add("epitrailing",tinymce.plugins.EPiTrailing)})(tinymce,epiJQuery);