//>>built
define("epi-cms/command/NewContent",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/topic","dojo/when","dojo/promise/all","epi/dependency","epi/shell/command/_Command","epi/shell/TypeDescriptorManager","epi-cms/contentediting/ContentActionSupport"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b){return _2([_9],{contentType:null,createAsLocalAsset:false,canChangeLocalAssetName:true,postscript:function(){this.inherited(arguments);var _c=this.contentType;this.label=this.label||_a.getResourceValue(_c,"create");this.tooltip=this.tooltip||_a.getResourceValue(_c,"createdescription");this.iconClass=this.iconClass||_a.getValue(_c,"commandIconClass");if(!this.store){var _d=_8.resolve("epi.storeregistry");this.store=_d.get("epi.cms.contenttype");}},_execute:function(){_5.publish("/epi/shell/action/changeview","epi-cms/contentediting/CreateContent",null,{requestedType:this.contentType,parent:this.model,createAsLocalAsset:this.createAsLocalAsset,canChangeLocalAssetName:this.canChangeLocalAssetName,view:_a.getValue(this.contentType,"createView")});},_onModelChange:function(){if(this.model&&this.model instanceof Array){if(this.model.length==1){this.model=this.model[0];}else{this.model=null;}}var _e=this.model,_f=_b.action.Create,_10=_b.providerCapabilities.Create,_11=_e&&!(_e.isWastebasket||_e.isDeleted)&&_b.hasLanguageAccess(_e)&&_b.isActionAvailable(_e,_f,_10,true);this.set("canExecute",!!_11);if(!_e){return;}_6(this._getContentType(_e),_3.hitch(this,function(_12){if(!_12){this.set("isAvailable",false);return;}_6(this._checkAvailability(_12.availableContentTypes),_3.hitch(this,function(_13){this.set("isAvailable",_13);}));}));},_getContentType:function(_14){if(!_14){return null;}return this.store.get(_14.contentTypeID);},_checkAvailability:function(_15){if(_15.length===0){return false;}var _16=new _4();var _17=_1.map(_15,_3.hitch(this,function(_18){return this.store.get(_18);}));_6(_7(_17),_3.hitch(this,function(_19){var _1a=_1.some(_19,_3.hitch(this,function(_1b){return _a.isBaseTypeIdentifier(_1b.typeIdentifier,this.contentType);}));_16.resolve(_1a);}));return _16;}});});