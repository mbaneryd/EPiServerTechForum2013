function preinit(){var url;(url=tinyMCEPopup.getParam("external_link_list_url"))&&document.write('<script language="javascript" type="text/javascript" src="'+tinyMCEPopup.editor.documentBaseURI.toAbsolute(url)+'"></script>')}function changeClass(){var f=document.forms[0];f.classes.value=getSelectValue(f,"classlist")}function init(){tinyMCEPopup.resizeToInnerSize();var html,formObj=document.forms[0],inst=tinyMCEPopup.editor,elm=inst.selection.getNode(),action="insert";if(document.getElementById("hrefbrowsercontainer").innerHTML=getBrowserHTML("hrefbrowser","href","file","advlink"),document.getElementById("popupurlbrowsercontainer").innerHTML=getBrowserHTML("popupurlbrowser","popupurl","file","advlink"),document.getElementById("targetlistcontainer").innerHTML=getTargetListHTML("targetlist","target"),html=getLinkListHTML("linklisthref","href"),""==html?document.getElementById("linklisthrefrow").style.display="none":document.getElementById("linklisthrefcontainer").innerHTML=html,html=getAnchorListHTML("anchorlist","href"),""==html?document.getElementById("anchorlistrow").style.display="none":document.getElementById("anchorlistcontainer").innerHTML=html,isVisible("hrefbrowser")&&(document.getElementById("href").style.width="260px"),isVisible("popupurlbrowser")&&(document.getElementById("popupurl").style.width="180px"),elm=inst.dom.getParent(elm,"A"),null==elm){var prospect=inst.dom.create("p",null,inst.selection.getContent());1===prospect.childNodes.length&&(elm=prospect.firstChild)}if(null!=elm&&"A"==elm.nodeName&&(action="update"),formObj.insert.value=tinyMCEPopup.getLang(action,"Insert",!0),setPopupControlsDisabled(!0),"update"==action){var href=inst.dom.getAttrib(elm,"href"),onclick=inst.dom.getAttrib(elm,"onclick"),linkTarget=inst.dom.getAttrib(elm,"target")?inst.dom.getAttrib(elm,"target"):"_self";setFormValue("href",href),setFormValue("title",inst.dom.getAttrib(elm,"title")),setFormValue("id",inst.dom.getAttrib(elm,"id")),setFormValue("style",inst.dom.getAttrib(elm,"style")),setFormValue("rel",inst.dom.getAttrib(elm,"rel")),setFormValue("rev",inst.dom.getAttrib(elm,"rev")),setFormValue("charset",inst.dom.getAttrib(elm,"charset")),setFormValue("hreflang",inst.dom.getAttrib(elm,"hreflang")),setFormValue("dir",inst.dom.getAttrib(elm,"dir")),setFormValue("lang",inst.dom.getAttrib(elm,"lang")),setFormValue("tabindex",inst.dom.getAttrib(elm,"tabindex",elm.tabindex!==void 0?elm.tabindex:"")),setFormValue("accesskey",inst.dom.getAttrib(elm,"accesskey",elm.accesskey!==void 0?elm.accesskey:"")),setFormValue("type",inst.dom.getAttrib(elm,"type")),setFormValue("onfocus",inst.dom.getAttrib(elm,"onfocus")),setFormValue("onblur",inst.dom.getAttrib(elm,"onblur")),setFormValue("onclick",onclick),setFormValue("ondblclick",inst.dom.getAttrib(elm,"ondblclick")),setFormValue("onmousedown",inst.dom.getAttrib(elm,"onmousedown")),setFormValue("onmouseup",inst.dom.getAttrib(elm,"onmouseup")),setFormValue("onmouseover",inst.dom.getAttrib(elm,"onmouseover")),setFormValue("onmousemove",inst.dom.getAttrib(elm,"onmousemove")),setFormValue("onmouseout",inst.dom.getAttrib(elm,"onmouseout")),setFormValue("onkeypress",inst.dom.getAttrib(elm,"onkeypress")),setFormValue("onkeydown",inst.dom.getAttrib(elm,"onkeydown")),setFormValue("onkeyup",inst.dom.getAttrib(elm,"onkeyup")),setFormValue("target",linkTarget),setFormValue("classes",inst.dom.getAttrib(elm,"class")),null!=onclick&&-1!=onclick.indexOf("window.open")?parseWindowOpen(onclick):parseFunction(onclick),selectByValue(formObj,"dir",inst.dom.getAttrib(elm,"dir")),selectByValue(formObj,"rel",inst.dom.getAttrib(elm,"rel")),selectByValue(formObj,"rev",inst.dom.getAttrib(elm,"rev")),selectByValue(formObj,"linklisthref",href),"#"==href.charAt(0)&&selectByValue(formObj,"anchorlist",href),addClassesToList("classlist",tinyMCEPopup.getParam("style_formats",!1)?{tag:"A"}:"advlink_styles"),selectByValue(formObj,"classlist",inst.dom.getAttrib(elm,"class"),!0),selectByValue(formObj,"targetlist",linkTarget,!0)}else addClassesToList("classlist",tinyMCEPopup.getParam("style_formats",!1)?{tag:"A"}:"advlink_styles")}function checkPrefix(n){n.value&&Validator.isEmail(n)&&!/^\s*mailto:/i.test(n.value)&&confirm(tinyMCEPopup.getLang("advlink_dlg.is_email"))&&(n.value="mailto:"+n.value),/^\s*www\./i.test(n.value)&&confirm(tinyMCEPopup.getLang("advlink_dlg.is_external"))&&(n.value="http://"+n.value)}function setFormValue(name,value){document.forms[0].elements[name].value=value}function parseWindowOpen(onclick){var formObj=document.forms[0];-1!=onclick.indexOf("return false;")?(formObj.popupreturn.checked=!0,onclick=onclick.replace("return false;","")):formObj.popupreturn.checked=!1;var onClickData=parseLink(onclick);if(null!=onClickData){formObj.ispopup.checked=!0,setPopupControlsDisabled(!1);var onClickWindowOptions=parseOptions(onClickData.options),url=onClickData.url;formObj.popupname.value=onClickData.target,formObj.popupurl.value=url,formObj.popupwidth.value=getOption(onClickWindowOptions,"width"),formObj.popupheight.value=getOption(onClickWindowOptions,"height"),formObj.popupleft.value=getOption(onClickWindowOptions,"left"),formObj.popuptop.value=getOption(onClickWindowOptions,"top"),-1!=formObj.popupleft.value.indexOf("screen")&&(formObj.popupleft.value="c"),-1!=formObj.popuptop.value.indexOf("screen")&&(formObj.popuptop.value="c"),formObj.popuplocation.checked="yes"==getOption(onClickWindowOptions,"location"),formObj.popupscrollbars.checked="yes"==getOption(onClickWindowOptions,"scrollbars"),formObj.popupmenubar.checked="yes"==getOption(onClickWindowOptions,"menubar"),formObj.popupresizable.checked="yes"==getOption(onClickWindowOptions,"resizable"),formObj.popuptoolbar.checked="yes"==getOption(onClickWindowOptions,"toolbar"),formObj.popupstatus.checked="yes"==getOption(onClickWindowOptions,"status"),formObj.popupdependent.checked="yes"==getOption(onClickWindowOptions,"dependent"),buildOnClick()}}function parseFunction(onclick){document.forms[0],parseLink(onclick)}function getOption(opts,name){return opts[name]===void 0?"":opts[name]}function setPopupControlsDisabled(state){var formObj=document.forms[0];formObj.popupname.disabled=state,formObj.popupurl.disabled=state,formObj.popupwidth.disabled=state,formObj.popupheight.disabled=state,formObj.popupleft.disabled=state,formObj.popuptop.disabled=state,formObj.popuplocation.disabled=state,formObj.popupscrollbars.disabled=state,formObj.popupmenubar.disabled=state,formObj.popupresizable.disabled=state,formObj.popuptoolbar.disabled=state,formObj.popupstatus.disabled=state,formObj.popupreturn.disabled=state,formObj.popupdependent.disabled=state,setBrowserDisabled("popupurlbrowser",state)}function parseLink(link){link=link.replace(RegExp("&#39;","g"),"'");var fnName=link.replace(RegExp("\\s*([A-Za-z0-9.]*)\\s*\\(.*","gi"),"$1"),template=templates[fnName];if(template){for(var variableNames=template.match(RegExp("'?\\$\\{[A-Za-z0-9.]*\\}'?","gi")),regExp="\\s*[A-Za-z0-9.]*\\s*\\(",replaceStr="",i=0;variableNames.length>i;i++)regExp+=-1!=variableNames[i].indexOf("'${")?"'(.*)'":"([0-9]*)",replaceStr+="$"+(i+1),variableNames[i]=variableNames[i].replace(RegExp("[^A-Za-z0-9]","gi"),""),i!=variableNames.length-1?(regExp+="\\s*,\\s*",replaceStr+="<delim>"):regExp+=".*";regExp+="\\);?";var variables=[];variables._function=fnName;for(var variableValues=link.replace(RegExp(regExp,"gi"),replaceStr).split("<delim>"),i=0;variableNames.length>i;i++)variables[variableNames[i]]=variableValues[i];return variables}return null}function parseOptions(opts){if(null==opts||""==opts)return[];opts=opts.toLowerCase(),opts=opts.replace(/;/g,","),opts=opts.replace(/[^0-9a-z=,]/g,"");for(var optionChunks=opts.split(","),options=[],i=0;optionChunks.length>i;i++){var parts=optionChunks[i].split("=");2==parts.length&&(options[parts[0]]=parts[1])}return options}function buildOnClick(){var formObj=document.forms[0];if(!formObj.ispopup.checked)return formObj.onclick.value="",void 0;var onclick="window.open('",url=formObj.popupurl.value;onclick+=url+"','",onclick+=formObj.popupname.value+"','",formObj.popuplocation.checked&&(onclick+="location=yes,"),formObj.popupscrollbars.checked&&(onclick+="scrollbars=yes,"),formObj.popupmenubar.checked&&(onclick+="menubar=yes,"),formObj.popupresizable.checked&&(onclick+="resizable=yes,"),formObj.popuptoolbar.checked&&(onclick+="toolbar=yes,"),formObj.popupstatus.checked&&(onclick+="status=yes,"),formObj.popupdependent.checked&&(onclick+="dependent=yes,"),""!=formObj.popupwidth.value&&(onclick+="width="+formObj.popupwidth.value+","),""!=formObj.popupheight.value&&(onclick+="height="+formObj.popupheight.value+","),""!=formObj.popupleft.value&&(onclick+="c"!=formObj.popupleft.value?"left="+formObj.popupleft.value+",":"left='+(screen.availWidth/2-"+formObj.popupwidth.value/2+")+',"),""!=formObj.popuptop.value&&(onclick+="c"!=formObj.popuptop.value?"top="+formObj.popuptop.value+",":"top='+(screen.availHeight/2-"+formObj.popupheight.value/2+")+',"),","==onclick.charAt(onclick.length-1)&&(onclick=onclick.substring(0,onclick.length-1)),onclick+="');",formObj.popupreturn.checked&&(onclick+="return false;"),formObj.onclick.value=onclick,""==formObj.href.value&&(formObj.href.value=url)}function setAttrib(elm,attrib,value){var formObj=document.forms[0],valueElm=formObj.elements[attrib.toLowerCase()],dom=tinyMCEPopup.editor.dom;(value===void 0||null==value)&&(value="",valueElm&&(value=valueElm.value)),"style"==attrib&&(value=dom.serializeStyle(dom.parseStyle(value),"a")),dom.setAttrib(elm,attrib,value)}function getAnchorListHTML(id,target){var name,i,len,ed=tinyMCEPopup.editor,nodes=ed.dom.select("a"),html="";for(i=0,len=nodes.length;len>i;i++)""!=(name=ed.dom.getAttrib(nodes[i],"name"))&&(html+='<option value="#'+name+'">'+name+"</option>"),""==(name=nodes[i].id)||nodes[i].href||(html+='<option value="#'+name+'">'+name+"</option>");return""==html?"":html='<select id="'+id+'" name="'+id+'" class="mceAnchorList"'+' onchange="this.form.'+target+'.value=this.options[this.selectedIndex].value"'+">"+'<option value="">---</option>'+html+"</select>"}function insertAction(){var elm,elementArray,i,inst=tinyMCEPopup.editor;if(elm=inst.selection.getNode(),checkPrefix(document.forms[0].href),elm=inst.dom.getParent(elm,"A"),!document.forms[0].href.value)return i=inst.selection.getBookmark(),inst.dom.remove(elm,1),inst.selection.moveToBookmark(i),tinyMCEPopup.execCommand("mceEndUndoLevel"),tinyMCEPopup.close(),void 0;if(null==elm)for(inst.getDoc().execCommand("unlink",!1,null),tinyMCEPopup.execCommand("mceInsertLink",!1,"#mce_temp_url#",{skip_undo:1}),elementArray=tinymce.grep(inst.dom.select("a"),function(n){return"#mce_temp_url#"==inst.dom.getAttrib(n,"href")}),i=0;elementArray.length>i;i++)setAllAttribs(elm=elementArray[i]);else setAllAttribs(elm);(1!=elm.childNodes.length||"IMG"!=elm.firstChild.nodeName)&&(inst.focus(),inst.selection.select(elm),inst.selection.collapse(0),tinyMCEPopup.storeSelection()),tinyMCEPopup.execCommand("mceEndUndoLevel"),tinyMCEPopup.close()}function setAllAttribs(elm){var formObj=document.forms[0],href=formObj.href.value.replace(/ /g,"%20"),target=getSelectValue(formObj,"targetlist");setAttrib(elm,"href",href),setAttrib(elm,"title"),setAttrib(elm,"target","_self"==target?"":target),setAttrib(elm,"id"),setAttrib(elm,"style"),setAttrib(elm,"class",getSelectValue(formObj,"classlist")),setAttrib(elm,"rel"),setAttrib(elm,"rev"),setAttrib(elm,"charset"),setAttrib(elm,"hreflang"),setAttrib(elm,"dir"),setAttrib(elm,"lang"),setAttrib(elm,"tabindex"),setAttrib(elm,"accesskey"),setAttrib(elm,"type"),setAttrib(elm,"onfocus"),setAttrib(elm,"onblur"),setAttrib(elm,"onclick"),setAttrib(elm,"ondblclick"),setAttrib(elm,"onmousedown"),setAttrib(elm,"onmouseup"),setAttrib(elm,"onmouseover"),setAttrib(elm,"onmousemove"),setAttrib(elm,"onmouseout"),setAttrib(elm,"onkeypress"),setAttrib(elm,"onkeydown"),setAttrib(elm,"onkeyup"),tinyMCE.isMSIE5&&(elm.outerHTML=elm.outerHTML)}function getSelectValue(form_obj,field_name){var elm=form_obj.elements[field_name];return elm&&null!=elm.options&&-1!=elm.selectedIndex?elm.options[elm.selectedIndex].value:""}function getLinkListHTML(elm_id,target_form_element,onchange_func){if("undefined"==typeof tinyMCELinkList||0==tinyMCELinkList.length)return"";var html="";html+='<select id="'+elm_id+'" name="'+elm_id+'"',html+=' class="mceLinkList" onchange="this.form.'+target_form_element+".value=",html+="this.options[this.selectedIndex].value;",onchange_func!==void 0&&(html+=onchange_func+"('"+target_form_element+"',this.options[this.selectedIndex].text,this.options[this.selectedIndex].value);"),html+='"><option value="">---</option>';for(var i=0;tinyMCELinkList.length>i;i++)html+='<option value="'+tinyMCELinkList[i][1]+'">'+tinyMCELinkList[i][0]+"</option>";return html+="</select>"}function getTargetListHTML(elm_id,target_form_element){var targets=tinyMCEPopup.getParam("theme_advanced_link_targets","").split(";"),html="";html+='<select id="'+elm_id+'" name="'+elm_id+'" onchange="this.form.'+target_form_element+".value=",html+='this.options[this.selectedIndex].value;">',html+='<option value="_self">'+tinyMCEPopup.getLang("advlink_dlg.target_same")+"</option>",html+='<option value="_blank">'+tinyMCEPopup.getLang("advlink_dlg.target_blank")+" (_blank)</option>",html+='<option value="_parent">'+tinyMCEPopup.getLang("advlink_dlg.target_parent")+" (_parent)</option>",html+='<option value="_top">'+tinyMCEPopup.getLang("advlink_dlg.target_top")+" (_top)</option>";for(var i=0;targets.length>i;i++){var key,value;""!=targets[i]&&(key=targets[i].split("=")[0],value=targets[i].split("=")[1],html+='<option value="'+key+'">'+value+" ("+key+")</option>")}return html+="</select>"}tinyMCEPopup.requireLangPack();var templates={"window.open":"window.open('${url}','${target}','${options}')"};preinit(),tinyMCEPopup.onInit.add(init);