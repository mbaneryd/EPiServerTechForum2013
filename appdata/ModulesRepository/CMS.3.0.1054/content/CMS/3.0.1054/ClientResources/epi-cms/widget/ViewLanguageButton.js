//>>built
define("epi-cms/widget/ViewLanguageButton",["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/topic","dojo/when","dojo/dom-class","dijit/DropDownMenu","dijit/form/DropDownButton","dijit/focus","epi/dependency","epi-cms/widget/ViewLanguageSelector","epi/i18n!epi/cms/nls/episerver.cms.widget.viewlanguagebutton"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c){return _1([_8],{_contextMenu:null,baseClass:"epi-mediumButton epi-chromelessButton",iconClass:"",contextMenuProperties:{},_viewLanguageSelector:null,_viewSettingsManager:null,postMixInProperties:function(){this.inherited(arguments);_2.mixin(this.contextMenuProperties,{"class":"epi-DropDownMenu"});this.profile=this.profile||_a.resolve("epi.shell.Profile");},postCreate:function(){this.inherited(arguments);_5(this.profile.getContentLanguage(),_2.hitch(this,function(_d){this._viewSettingsManager=_a.resolve("epi.viewsettingsmanager");var _e={languageId:_d},_f=this._viewSettingsManager.getSettingProperty("viewlanguage")||_e.languageId;if(!this.dropDown){this.dropDown=_7(this.contextMenuProperties);this.own(this.dropDown);this._viewLanguageSelector=new _b({defaultItem:_e,checkedItem:_f});this.own(_3.after(this._viewLanguageSelector,"onItemSelected",_2.hitch(this,"_onViewLanguageSelected"),true));this._addChildren(this._viewLanguageSelector);_5(this._viewLanguageSelector.fetchData(),_2.hitch(this,function(_10){if(this._viewLanguageSelector.get("items").length===0){_6.add(this.domNode,"dijitHidden");return;}this._changeView();}));}this.own(_3.after(this.dropDown,"onOpen",_2.hitch(this,function(e){_9.focus(this._viewLanguageSelector.menuNode.domNode);}),true));this.own(_4.subscribe("/epi/cms/contentdata/updated",_2.hitch(this,function(){this._languageSettingsChanged();})));}));},_languageSettingsChanged:function(){_5(this._viewLanguageSelector.fetchData(),_2.hitch(this,function(_11){var _12=this._viewLanguageSelector.get("currentSelectedItem");this._changeView(_12||this._viewLanguageSelector.defaultItem);}));},_updateButton:function(_13){var _14=_13||this._viewLanguageSelector.get("currentSelectedItem")||this._viewLanguageSelector.defaultItem;var _15=_2.replace(_c.tooltip,{viewlanguage:_14?_14.name:null});var _16=_14&&_14.urlSegment?_14.urlSegment.toUpperCase():null;var _17=this.get("label");this.set("title",_15);this.set("label",_16);if(_17!=_16){this.onResize();}},onResize:function(){},_isDefaultSelection:function(){if(this._viewLanguageSelector.get("currentSelectedItem")){return this._viewLanguageSelector.isDefaultItemSelected();}return true;},_onViewLanguageSelected:function(_18){this._changeView(_18);this.closeDropDown();},_changeView:function(_19){if(_19){_4.publish("/epi/cms/action/viewsettingvaluechanged","viewlanguage",_19.languageId);}this._viewLanguageSelector.checkItem(_19);this._activeButton(!this._isDefaultSelection());this._updateButton(_19);},_addChildren:function(_1a){this.dropDown.addChild(_1a);},_activeButton:function(_1b){if(!this.dropDown){return;}_6.toggle(this.domNode,"dijitChecked",_1b);_6.toggle(this.domNode,"epi-expandoButtonLangSelected",_1b);}});});