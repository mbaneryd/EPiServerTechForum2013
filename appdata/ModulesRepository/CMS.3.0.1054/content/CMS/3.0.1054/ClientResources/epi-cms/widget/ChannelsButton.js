//>>built
define("epi-cms/widget/ChannelsButton",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/connect","dojo/_base/Deferred","dojo/dom-class","dijit/DropDownMenu","dijit/form/DropDownButton","dijit/focus","epi","epi/dependency","epi-cms/widget/ChannelSelector","epi-cms/widget/ResolutionSelector","epi/i18n!epi/cms/nls/episerver.cms.widget.channelbutton"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e){return _1([_8],{_contextMenu:null,baseClass:"epi-mediumButton epi-chromelessButton",iconClass:"epi-iconDevice",contextMenuProperties:{},_channelSelector:null,_resolutionSelector:null,_viewSettingsManager:null,postMixInProperties:function(){this.inherited(arguments);_2.mixin(this.contextMenuProperties,{"class":"epi-DropDownMenu"});},postCreate:function(){this.inherited(arguments);this._viewSettingsManager=_b.resolve("epi.viewsettingsmanager");var _f=this._viewSettingsManager.getSettingProperty("resolution");var _10=this._viewSettingsManager.getSettingProperty("epichannel");if(!this.dropDown){this.dropDown=dijit.DropDownMenu(this.contextMenuProperties);this._channelSelector=new _c({checkedItem:_10});_4.connect(this._channelSelector,"onItemSelected",this,this._onChannelSelected);this._resolutionSelector=new _d({checkedItem:_f});_4.connect(this._resolutionSelector,"onItemSelected",this,this._onResolutionSelected);this._addChildren(this._channelSelector);this._addChildren(this._resolutionSelector);_5.when(this._channelSelector.isSetupFinished(),_2.hitch(this,function(_11){this._activeButton(!this._isDefaultSelection());this._updateTooltip();this._setupKeyboardNav();}));}},_setupKeyboardNav:function(){var _12=[];_3.forEach([this._channelSelector,this._resolutionSelector],function(_13){_12=_12.concat(_3.map(_13.menuNode.getChildren(),function(_14){return {menuItem:_14,menu:_13.menuNode};}));});var _15=0;var _16=_2.hitch(this,function(_17){_15+=_17==="next"?1:-1;_15=_15>=_12.length?0:_15;_15=_15<0?_12.length-1:_15;var _18=_12[_15];_18.menu.focusChild(_18.menuItem);});var _19=function(){_16("next");};var _1a=function(){_16("prev");};_4.connect(this.dropDown,"onOpen",this,function(e){_9.focus(this._channelSelector.menuNode.domNode);});this._channelSelector.menuNode.focusNext=this._resolutionSelector.menuNode.focusNext=_19;this._channelSelector.menuNode.focusPrev=this._resolutionSelector.menuNode.focusPrev=_1a;},_updateTooltip:function(){var _1b=null;if(this._isDefaultSelection()){_1b=_e.defaulttooltip;}else{var _1c=this._channelSelector.currentSelectedItem;var _1d=this._resolutionSelector.currentSelectedItem;_1b=_2.replace(_e.tooltip,{channel:_1c.name,resolution:_1d.name});}this.set("title",_1b);},_isDefaultSelection:function(){return (this._channelSelector.isDefaultItemSelected()&&this._resolutionSelector.isDefaultItemSelected());},_onChannelSelected:function(_1e){var _1f=this._resolutionSelector.getDefaultResolution(_1e);if(!this._resolutionSelector.currentSelectedItem||(this._resolutionSelector.currentSelectedItem&&this._resolutionSelector.currentSelectedItem.name!=_1f.name)){this._resolutionSelector.checkItem(_1f);}this._changeView(_1f,_1e);},_onResolutionSelected:function(_20){this._changeView(_20);},_changeView:function(_21,_22){if(_21){if(_21.name==this._resolutionSelector.defaultItem.name){_4.publish("/epi/cms/action/viewsettingvaluechanged",["resolution",null]);}else{var _23=_21.width+"x"+_21.height;_4.publish("/epi/cms/action/viewsettingvaluechanged",["resolution",_23]);}}if(_22){if(_22.name==this._channelSelector.defaultItem.name){_4.publish("/epi/cms/action/viewsettingvaluechanged",["epichannel",null]);}else{_4.publish("/epi/cms/action/viewsettingvaluechanged",["epichannel",_22.channelName]);}}this._activeButton(!this._isDefaultSelection());this._updateTooltip();},_addChildren:function(_24){this.dropDown.addChild(_24);},_activeButton:function(_25){if(!this.dropDown){return;}if(_25){_6.add(this.domNode,"dijitChecked");}else{_6.remove(this.domNode,"dijitChecked");}}});});