(function(){function get(id){return document.getElementById(id)}function clone(obj){var i,len,copy,attr;if(null==obj||"object"!=typeof obj)return obj;if("length"in obj){for(copy=[],i=0,len=obj.length;len>i;++i)copy[i]=clone(obj[i]);return copy}copy={};for(attr in obj)obj.hasOwnProperty(attr)&&(copy[attr]=clone(obj[attr]));return copy}function getVal(id){var elm=get(id);return"SELECT"==elm.nodeName?elm.options[elm.selectedIndex].value:"checkbox"==elm.type?elm.checked:elm.value}function setVal(id,value,name){if(value!==void 0&&null!=value){var elm=get(id);"SELECT"==elm.nodeName?selectByValue(document.forms[0],id,value):"checkbox"==elm.type?("string"==typeof value&&(value=value.toLowerCase(),value=!name&&"true"===value||name&&value===name.toLowerCase()),elm.checked=!!value):elm.value=value}}var url;(url=tinyMCEPopup.getParam("media_external_list_url"))&&document.write('<script language="javascript" type="text/javascript" src="'+tinyMCEPopup.editor.documentBaseURI.toAbsolute(url)+'"></script>'),window.Media={init:function(){var html,editor,self=this;self.editor=editor=tinyMCEPopup.editor,get("filebrowsercontainer").innerHTML=getBrowserHTML("filebrowser","src","media","media"),get("qtsrcfilebrowsercontainer").innerHTML=getBrowserHTML("qtsrcfilebrowser","quicktime_qtsrc","media","media"),get("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor"),get("video_altsource1_filebrowser").innerHTML=getBrowserHTML("video_filebrowser_altsource1","video_altsource1","media","media"),get("video_altsource2_filebrowser").innerHTML=getBrowserHTML("video_filebrowser_altsource2","video_altsource2","media","media"),get("audio_altsource1_filebrowser").innerHTML=getBrowserHTML("audio_filebrowser_altsource1","audio_altsource1","media","media"),get("audio_altsource2_filebrowser").innerHTML=getBrowserHTML("audio_filebrowser_altsource2","audio_altsource2","media","media"),get("video_poster_filebrowser").innerHTML=getBrowserHTML("filebrowser_poster","video_poster","image","media"),html=self.getMediaListHTML("medialist","src","media","media"),""==html?get("linklistrow").style.display="none":get("linklistcontainer").innerHTML=html,isVisible("filebrowser")&&(get("src").style.width="230px"),isVisible("video_filebrowser_altsource1")&&(get("video_altsource1").style.width="220px"),isVisible("video_filebrowser_altsource2")&&(get("video_altsource2").style.width="220px"),isVisible("audio_filebrowser_altsource1")&&(get("audio_altsource1").style.width="220px"),isVisible("audio_filebrowser_altsource2")&&(get("audio_altsource2").style.width="220px"),isVisible("filebrowser_poster")&&(get("video_poster").style.width="220px"),editor.dom.setOuterHTML(get("media_type"),self.getMediaTypeHTML(editor)),self.setDefaultDialogSettings(editor),self.data=clone(tinyMCEPopup.getWindowArg("data")),self.dataToForm(),self.preview(),updateColor("bgcolor_pick","bgcolor")},insert:function(){var editor=tinyMCEPopup.editor;this.formToData(),editor.execCommand("mceRepaint"),tinyMCEPopup.restoreSelection(),editor.selection.setNode(editor.plugins.media.dataToImg(this.data)),tinyMCEPopup.close()},preview:function(){get("prev").innerHTML=this.editor.plugins.media.dataToHtml(this.data,!0)},moveStates:function(to_form,field){function parseQueryParams(str){var out={};return str&&tinymce.each(str.split("&"),function(item){var parts=item.split("=");out[unescape(parts[0])]=unescape(parts[1])}),out}function setOptions(type,names){var i,name,formItemName,value,list;if(type==data.type||"global"==type)for(names=tinymce.explode(names),i=0;names.length>i;i++)name=names[i],formItemName="global"==type?name:type+"_"+name,"global"==type?list=data:"video"==type||"audio"==type?(list=data.video.attrs,list||to_form||(data.video.attrs=list={})):list=data.params,list&&(to_form?setVal(formItemName,list[name],"video"==type||"audio"==type?name:""):(delete list[name],value=getVal(formItemName),"video"!=type&&"audio"!=type||value!==!0||(value=name),defaultStates[formItemName]?value!==defaultStates[formItemName]&&(value=""+value,list[name]=value):value&&(value=""+value,list[name]=value)))}var ext,src,typeInfo,defaultStates,src,data=this.data,editor=this.editor,mediaPlugin=editor.plugins.media;defaultStates={quicktime_autoplay:!0,quicktime_controller:!0,flash_play:!0,flash_loop:!0,flash_menu:!0,windowsmedia_autostart:!0,windowsmedia_enablecontextmenu:!0,windowsmedia_invokeurls:!0,realmedia_autogotourl:!0,realmedia_imagestatus:!0},to_form||(data.type=get("media_type").options[get("media_type").selectedIndex].value,data.width=getVal("width"),data.height=getVal("height"),src=getVal("src"),"src"==field&&(ext=src.replace(/^.*\.([^.]+)$/,"$1"),(typeInfo=mediaPlugin.getType(ext))&&(data.type=typeInfo.name.toLowerCase()),setVal("media_type",data.type)),("video"==data.type||"audio"==data.type)&&(data.video.sources||(data.video.sources=[]),data.video.sources[0]={src:getVal("src")})),get("video_options").style.display="none",get("audio_options").style.display="none",get("flash_options").style.display="none",get("quicktime_options").style.display="none",get("shockwave_options").style.display="none",get("windowsmedia_options").style.display="none",get("realmedia_options").style.display="none",get("embeddedaudio_options").style.display="none",get(data.type+"_options")&&(get(data.type+"_options").style.display="block"),setVal("media_type",data.type),setOptions("flash","play,loop,menu,swliveconnect,quality,scale,salign,wmode,base,flashvars"),setOptions("quicktime","loop,autoplay,cache,controller,correction,enablejavascript,kioskmode,autohref,playeveryframe,targetcache,scale,starttime,endtime,target,qtsrcchokespeed,volume,qtsrc"),setOptions("shockwave","sound,progress,autostart,swliveconnect,swvolume,swstretchstyle,swstretchhalign,swstretchvalign"),setOptions("windowsmedia","autostart,enabled,enablecontextmenu,fullscreen,invokeurls,mute,stretchtofit,windowlessvideo,balance,baseurl,captioningid,currentmarker,currentposition,defaultframe,playcount,rate,uimode,volume"),setOptions("realmedia","autostart,loop,autogotourl,center,imagestatus,maintainaspect,nojava,prefetch,shuffle,console,controls,numloop,scriptcallbacks"),setOptions("video","poster,autoplay,loop,muted,preload,controls"),setOptions("audio","autoplay,loop,preload,controls"),setOptions("embeddedaudio","autoplay,loop,controls"),setOptions("global","id,name,vspace,hspace,bgcolor,align,width,height"),to_form?"video"==data.type?(data.video.sources[0]&&setVal("src",data.video.sources[0].src),src=data.video.sources[1],src&&setVal("video_altsource1",src.src),src=data.video.sources[2],src&&setVal("video_altsource2",src.src)):"audio"==data.type?(data.video.sources[0]&&setVal("src",data.video.sources[0].src),src=data.video.sources[1],src&&setVal("audio_altsource1",src.src),src=data.video.sources[2],src&&setVal("audio_altsource2",src.src)):("flash"==data.type&&tinymce.each(editor.getParam("flash_video_player_flashvars",{url:"$url",poster:"$poster"}),function(value,name){"$url"==value&&(data.params.src=parseQueryParams(data.params.flashvars)[name]||data.params.src||"")}),setVal("src",data.params.src)):(src=getVal("src"),src.match(/youtube\.com\/embed\/\w+/)?(data.width=425,data.height=350,data.params.frameborder="0",data.type="iframe",setVal("src",src),setVal("media_type",data.type)):(src.match(/youtu\.be\/[a-z1-9.-_]+/)&&(data.width=425,data.height=350,data.params.frameborder="0",data.type="iframe",src="http://www.youtube.com/embed/"+src.match(/youtu.be\/([a-z1-9.-_]+)/)[1],setVal("src",src),setVal("media_type",data.type)),src.match(/youtube\.com(.+)v=([^&]+)/)&&(data.width=425,data.height=350,data.params.frameborder="0",data.type="iframe",src="http://www.youtube.com/embed/"+src.match(/v=([^&]+)/)[1],setVal("src",src),setVal("media_type",data.type))),src.match(/video\.google\.com(.+)docid=([^&]+)/)&&(data.width=425,data.height=326,data.type="flash",src="http://video.google.com/googleplayer.swf?docId="+src.match(/docid=([^&]+)/)[1]+"&hl=en",setVal("src",src),setVal("media_type",data.type)),src.match(/vimeo\.com\/([0-9]+)/)&&(data.width=425,data.height=350,data.params.frameborder="0",data.type="iframe",src="http://player.vimeo.com/video/"+src.match(/vimeo.com\/([0-9]+)/)[1],setVal("src",src),setVal("media_type",data.type)),src.match(/stream\.cz\/((?!object).)*\/([0-9]+)/)&&(data.width=425,data.height=350,data.params.frameborder="0",data.type="iframe",src="http://www.stream.cz/object/"+src.match(/stream.cz\/[^/]+\/([0-9]+)/)[1],setVal("src",src),setVal("media_type",data.type)),src.match(/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/)&&(data.width=425,data.height=350,data.params.frameborder="0",data.type="iframe",src="http://maps.google.com/maps/ms?msid="+src.match(/msid=(.+)/)[1]+"&output=embed",setVal("src",src),setVal("media_type",data.type)),"video"==data.type?(data.video.sources||(data.video.sources=[]),data.video.sources[0]={src:src},src=getVal("video_altsource1"),src&&(data.video.sources[1]={src:src}),src=getVal("video_altsource2"),src&&(data.video.sources[2]={src:src})):"audio"==data.type?(data.video.sources||(data.video.sources=[]),data.video.sources[0]={src:src},src=getVal("audio_altsource1"),src&&(data.video.sources[1]={src:src}),src=getVal("audio_altsource2"),src&&(data.video.sources[2]={src:src})):data.params.src=src,setVal("width",data.width||("audio"==data.type?300:320)),setVal("height",data.height||("audio"==data.type?32:240)))},dataToForm:function(){this.moveStates(!0)},formToData:function(field){("width"==field||"height"==field)&&this.changeSize(field),"source"==field?(this.moveStates(!1,field),setVal("source",this.editor.plugins.media.dataToHtml(this.data)),this.panel="source"):("source"==this.panel&&(this.data=clone(this.editor.plugins.media.htmlToData(getVal("source"))),this.dataToForm(),this.panel=""),this.moveStates(!1,field),this.preview())},beforeResize:function(){this.width=parseInt(getVal("width")||("audio"==this.data.type?"300":"320"),10),this.height=parseInt(getVal("height")||("audio"==this.data.type?"32":"240"),10)},changeSize:function(type){var width,height;get("constrain").checked&&(width=parseInt(getVal("width")||("audio"==this.data.type?"300":"320"),10),height=parseInt(getVal("height")||("audio"==this.data.type?"32":"240"),10),"width"==type?(this.height=Math.round(width/this.width*height),setVal("height",this.height)):(this.width=Math.round(height/this.height*width),setVal("width",this.width)))},getMediaListHTML:function(){if("undefined"!=typeof tinyMCEMediaList&&tinyMCEMediaList.length>0){var html="";html+='<select id="linklist" name="linklist" style="width: 250px" onchange="this.form.src.value=this.options[this.selectedIndex].value;Media.formToData(\'src\');">',html+='<option value="">---</option>';for(var i=0;tinyMCEMediaList.length>i;i++)html+='<option value="'+tinyMCEMediaList[i][1]+'">'+tinyMCEMediaList[i][0]+"</option>";return html+="</select>"}return""},getMediaTypeHTML:function(editor){function option(media_type,element){return editor.schema.getElementRule(element||media_type)?'<option value="'+media_type+'">'+tinyMCEPopup.editor.translate("media_dlg."+media_type)+"</option>":""}var html="";return html+='<select id="media_type" name="media_type" onchange="Media.formToData(\'type\');">',html+=option("video"),html+=option("audio"),html+=option("flash","object"),html+=option("quicktime","object"),html+=option("shockwave","object"),html+=option("windowsmedia","object"),html+=option("realmedia","object"),html+=option("iframe"),editor.getParam("media_embedded_audio",!1)&&(html+=option("embeddedaudio","object")),html+="</select>"},setDefaultDialogSettings:function(editor){var defaultDialogSettings=editor.getParam("media_dialog_defaults",{});tinymce.each(defaultDialogSettings,function(v,k){setVal(k,v)})}},tinyMCEPopup.requireLangPack(),tinyMCEPopup.onInit.add(function(){Media.init()})})();