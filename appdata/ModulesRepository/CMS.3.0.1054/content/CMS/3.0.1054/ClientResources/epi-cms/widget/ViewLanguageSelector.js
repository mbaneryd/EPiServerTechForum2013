//>>built
define("epi-cms/widget/ViewLanguageSelector",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/Deferred","dojo/when","epi/dependency","epi-cms/widget/_ItemSelectorBase","epi-cms/widget/_DropDownWidgetItemMixin","epi-cms/component/SiteTreeModel","epi/i18n!epi/cms/nls/episerver.cms.widget.viewlanguageselector"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){return _1([_7,_8],{_viewLanguageHash:{},_isFinished:null,_siteTreeModel:null,postCreate:function(){this.inherited(arguments);this.set("header",_a.header);if(!this._siteTreeModel){var _b=_6.resolve("epi.storeregistry"),_c=_b.get("epi.cms.sitestructure");this._siteTreeModel=new _9({store:_c});}},fetchData:function(){var _d=new _4();_5(this._siteTreeModel.getCurrentSite(),_2.hitch(this,function(_e){if(_e){_5(this._siteTreeModel.getChildren({url:_e.currentSite},_2.hitch(this,function(_f){this._createHashMap(_f);if(this.defaultItem){this.defaultItem.name=this._viewLanguageHash[this.defaultItem.languageId]||this.defaultItem.name;}this.set("items",_f);_d.resolve({status:true});})));}}));return _d.promise;},checkItem:function(_10){if(!_10||!this._viewLanguageHash[_10.languageId]){_10=this.get("currentSelectedItem");}this.inherited(arguments);},_getCurrentSelectedItemAttr:function(){var _11=null;_3.some([this.currentSelectedItem,this.checkedItem,this.defaultItem],_2.hitch(this,function(_12){if(_12&&(this._viewLanguageHash[_12.languageId||_12])){_11=_12.languageId?_12:{languageId:_12,name:this._viewLanguageHash[_12]};return true;}return false;}));return _11;},_createHashMap:function(_13){this._viewLanguageHash={};_3.forEach(_13,_2.hitch(this,function(_14){this._viewLanguageHash[_14.languageId]=_14.name;}));}});});