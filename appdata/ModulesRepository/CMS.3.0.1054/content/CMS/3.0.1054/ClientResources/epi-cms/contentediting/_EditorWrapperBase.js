//>>built
define("epi-cms/contentediting/_EditorWrapperBase",["dojo/_base/declare","dojo/_base/lang","dijit/_Widget","epi/epi"],function(_1,_2,_3,_4){return _1([_3],{wrapperType:"",editorWidgetType:null,editorParams:null,editing:false,disabled:false,blockDisplayNode:null,editorWidget:null,isModified:false,_resetValue:null,_lastSavedValue:null,_createdEditor:false,propertyName:"",propertyDisplayName:"",overlayItem:null,isOverlayDisabled:false,isUndoDisabled:false,hasInlineEditor:false,contentModel:null,onStartEdit:function(_5,_6){},onValueChange:function(_7,_8,_9){},onCancel:function(_a){},onStopEdit:function(_b,_c,_d){},postCreate:function(){this.inherited(arguments);this._contentModelWatchHandle=this.contentModel.watch(this.propertyName,_2.hitch(this,"contentModelChanged"));},destroy:function(){this._contentModelWatchHandle.unwatch();if(this._createdEditor&&this.editorWidget){this.editorWidget.destroyRecursive();}if(this.editorWidget){this.editorWidget.parent=null;}this.blockDisplayNode=this.overlayItem=this.editorWidget=null;this.inherited(arguments);},contentModelChanged:function(_e,_f,_10){if(!this.editing){this.set("value",_10);}},startEdit:function(_11){this._startEdit(_11);},_startEdit:function(_12){_2.mixin(this.editorParams,_12);this.set("editing",true);this.set("isModified",false);this._lastSavedValue=this._resetValue=_2.clone(this.getEditorValue());this.isValid();this.onStartEdit(this,this.editorParams);},_stopEdit:function(_13){this.set("editing",false);this._removeEditingFeatures();this.onStopEdit(this,this.getEditorValue(),this._resetValue,_13);},cancel:function(){if(this.isModified){this.save(this._resetValue);}else{this.set("value",this._resetValue);}this.set("editing",false);this._removeEditingFeatures();this.onCancel(this);},save:function(val){this.set("value",val);this.set("isModified",true);this.onValueChange(this,val,this._lastSavedValue);this._lastSavedValue=_2.clone(val);},hasBeenEdited:function(){return this.editing&&(!_4.areEqual(this.getEditorValue(),this._resetValue));},hasPendingChanges:function(){return this.editing&&(!_4.areEqual(this.getEditorValue(),this._lastSavedValue));},tryToStopEditing:function(_14){if(this.editing){if(this.isValid()){if(this.hasBeenEdited()){if(this.hasPendingChanges()){this.save(this.getEditorValue());}this._stopEdit(_14);}else{this.cancel(_14);}}else{this._onTryToStopWithInvalidValue();}}},_removeEditingFeatures:function(){},_onTryToStopWithInvalidValue:function(){},_onEditorKeyPress:function(e){if(this.editing){if(e.altKey||e.ctrlKey){return;}if(e.keyCode==dojo.keys.ESCAPE){dojo.stopEvent(e);this.cancel();}else{if(e.keyCode==dojo.keys.ENTER&&e.target.tagName=="INPUT"){dojo.stopEvent(e);this.tryToStopEditing(false);}}}},_onChange:function(val){if(this.editing&&this.isValid()&&this.hasPendingChanges()){this.save(val);}},getEditorWidget:function(){return this.editorWidget;},getEditorValue:function(){var ew=this.editorWidget;if(ew){return ew.get("value");}return null;},setEditorValue:function(val){var ew=this.editorWidget;if(ew&&!_4.areEqual(val,ew.get("value"))){ew.set("value",val);}},_setValueAttr:function(_15){this.setEditorValue(_15);this._set("value",this.getEditorValue()||_15);},isValid:function(){return (this.editorWidget&&this.editorWidget.isValid?this.editorWidget.isValid():true);},focus:function(){this.editorWidget.focus();setTimeout(_2.hitch(this,function(){if(this.editorWidget.focusNode&&this.editorWidget.focusNode.tagName=="INPUT"){dijit.selectInputText(this.editorWidget.focusNode);}}),0);}});});