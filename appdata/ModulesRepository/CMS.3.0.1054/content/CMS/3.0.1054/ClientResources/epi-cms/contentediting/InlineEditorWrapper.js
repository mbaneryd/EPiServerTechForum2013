//>>built
define("epi-cms/contentediting/InlineEditorWrapper",["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-style","dojo/Deferred","dojo/on","dojo/when","epi/string","epi-cms/contentediting/OverlayBasedEditorWrapper"],function(_1,_2,_3,_4,_5,_6,on,_7,_8,_9){return _2([_9],{width:"100%",hasInlineEditor:true,matchStyle:false,destroy:function(){this._removeEditingFeatures();this._removeLocalHandlers();this._blockDisplayNodeOpacity=null;this.inherited(arguments);},_onViewportClick:function(_a){this._stopEditorEditing(_a);},_stopEditorEditing:function(_b){var _c=this.getEditorWidget();if(!_c||!_c.isEditing()){return;}_c.onEditorBlur(_b);this.tryToStopEditing(true);},_getOrCreateEditor:function(){if(this._createdEditor){return this.editorWidget;}var _d=new _6();var _e=_8.slashName(this.editorWidgetType),_f=_4.mixin(this.editorParams,{value:this.value});if(this.matchStyle){_f.style=this._computeStyling();}require([_e],_4.hitch(this,function(_10){var _11=this.editorWidget=new _10(_f);_11.placeAt(this.get("overlayItem").domNode);this.own(on(_11.domNode,"editorstatechanged",_4.hitch(this,this._onEditorStateChanged)));this._handlers=[this.connect(_11,"onClick",_3.stop),this.connect(_11,"onEditorResizing",this._onEditorResizing),this.connect(_11,"onEditorResized",this._onEditorResized)];this._handlers.push(this.connect(_11,"onChange","_onEditorChange"));this._handlers.push(this.connect(_11,"onKeyPress","_onEditorKeyPress"));this._createdEditor=true;_d.resolve(_11);}));return _d;},_computeStyling:function(){var _12=_5.getComputedStyle(this.blockDisplayNode),_13="line-height:"+_12.lineHeight+";",_14=_5.getComputedStyle(this.domNode);["Weight","Family","Size","Style"].forEach(function(_15){var _16=_12["font"+_15],_17=_14["font"+_15];if(_17!=_16){_13+="font-"+_15+":"+_12["font"+_15]+";";}},this);var _18=this.width;if(_18=="100%"){_13+="width:100%;";}else{_13+="width:"+(_18+(Number(_18)==_18?"px":""))+";";}_13+="position: absolute; left: 0px; top: 0px;";return _13;},_onEditorChange:function(_19){this._onChange(_19);},_onEditorResizing:function(_1a){},_onEditorResized:function(_1b){},_onEditorStateChanged:function(_1c){var _1d=this.get("overlayItem");_1d&&_1d.set("error",_1c==="Error");},startEdit:function(){var _1e=this.getInherited(arguments);_7(this._getOrCreateEditor(),_4.hitch(this,function(_1f){this._blockDisplayNodeOpacity=_5.get(this.blockDisplayNode,"opacity");_5.set(_1f.domNode,{"display":""});_5.set(this.blockDisplayNode,{"opacity":0.5});_1e.apply(this);this.focus();}));},_removeLocalHandlers:function(){(this._handlers instanceof Array&&this._handlers.length>0)&&this._handlers.forEach(function(_20){_20.remove();});},_removeEditingFeatures:function(){(this.blockDisplayNode&&this._blockDisplayNodeOpacity)&&_5.set(this.blockDisplayNode,{"opacity":this._blockDisplayNodeOpacity});(this.editorWidget&&this.editorWidget.domNode)&&_5.set(this.editorWidget.domNode,"display","none");},_toggleSupportCustomDnd:function(_21){var _22=this.get("overlayItem");if(!_22){return;}var _23=this.getEditorWidget();if(!_23||!_23.supportCustomDnd){return;}if(_21===true){_22.transferDndControlTo(_23);_23._onDropDataHandler||(_23._onDropDataHandler=_23.connect(_22,"onDropData",_4.hitch(_23,function(_24,_25,_26,_27){_23.onDropData(_24,_25,_26,_27);})));return;}_22.transferDndControlTo(_22);_23._onDropDataHandler&&_23.disconnect(_23._onDropDataHandler);_23._onDropDataHandler=null;},_toggleOverlayItemZIndex:function(_28){var _29=this.get("overlayItem");if(!_29||!_29.item){return;}var _2a=parseInt(_5.get(_29.item,"zIndex"),10);_5.set(_29.item,{"zIndex":_28===true?++_2a:--_2a});}});});