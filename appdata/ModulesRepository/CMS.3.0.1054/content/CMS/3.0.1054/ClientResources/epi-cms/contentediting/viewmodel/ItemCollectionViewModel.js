//>>built
define("epi-cms/contentediting/viewmodel/ItemCollectionViewModel",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","dojo/when","epi/dependency","epi/string","epi-cms/contentediting/viewmodel/LinkItemModel","epi-cms/contentediting/viewmodel/_ViewModelMixin"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){return _2([_9],{_instanceId:null,_autoId:0,_selectedItem:null,_data:null,itemModelClass:null,itemModelType:null,constructor:function(_a,_b){_2.safeMixin(this,_b);},postscript:function(_c){var _d=_8.slashName(this.itemModelType);require([_d],_3.hitch(this,function(_e){this.itemModelClass=_e;this._instanceId=new Date().getTime();this._init(_c);}));},moveNext:function(){this._move(1)&&this.emit("changed");},movePrevious:function(){this._move(-1)&&this.emit("changed");},remove:function(){if(!this.get("canEdit")){return;}var _f=this.getItemIndex(this._selectedItem);this._data.splice(_f,1);var len=this._data.length;this.set("selectedItem",this._data[_f>=len?len-1:_f]||null);this.emit("changed");},addTo:function(_10,_11,_12){if(!_10){return false;}if(this.getItemIndex(_10)>=0){this.moveTo(_10,null,false);this.emit("changed");}else{var _13=this;_6(_13._createItemModel(_10),function(_14){if(!_11){_13._data.push(_14);}else{var _15=_13.getItemIndex(_11)+(_12?0:1);_13._data.splice(_15,0,_14);}_13.emit("changed",{uiChanged:false});});}},moveTo:function(_16,_17,_18){if(!_16&&!this._selectedItem){return false;}this.set("selectedItem",_16||this._selectedItem);var _19=this.getItemIndex(this._selectedItem);this._data.splice(_19,1);var _1a=(_17?this.getItemIndex(_17):(this._data.length-1))+(_18?0:1);this._data.splice(_1a,0,this._selectedItem);this.emit("changed");},updateItemData:function(_1b){var _1c=this.getItemIndex(this._selectedItem);if(_1c<0){return;}var _1d=this;_6(_1d._createItemModel(_1b),function(_1e){_1d._selectedItem=_1d._data[_1c]=_1e;_1d.emit("changed");});},swap:function(_1f,_20){if(!this._data[_1f]||!this._data[_20]){return false;}var _21=this._data[_1f];this._data[_1f]=this._data[_20];this._data[_20]=_21;return true;},getItemIndex:function(_22){var _23=-1;if(!_22||!(_22 instanceof this.itemModelClass)){return _23;}this._data.some(function(i,o){if(i.id===_22.id){_23=o;return true;}return false;},this);return _23;},_init:function(_24){var _25=this,_26;this.set("selectedItem",null);if(!(_24 instanceof Array)){this._data=[];}else{_26=_24.map(function(_27){return this._createItemModel(_27);},this);_5(_26).then(function(_28){_25._data=_28;_25.emit("initCompleted");});}},_generateItemId:function(){return this._instanceId+"_"+this._autoId++;},_createItemModel:function(_29){var _2a=this.itemModelClass,id={id:this._generateItemId()},_2b,dfd=new _4();if(this.getItemIndex(_29)>=0){return _29;}if(_29 instanceof _2a){_2b=_3.mixin(_3.clone(_29),id);}else{_2b=new _2a(_3.mixin(_3.clone(_29),id));}_6(_2b.parse(true),function(){dfd.resolve(_2b);});return dfd;},_move:function(_2c){var _2d=this.getItemIndex(this._selectedItem);if(_2d<0){return false;}return this.swap(_2d,_2d+_2c);},_canMoveNextGetter:function(){var _2e=this.getItemIndex(this._selectedItem);return !!(this._selectedItem&&_2e>=0&&_2e<(this._data.length-1));},_canMovePreviousGetter:function(){var _2f=this.getItemIndex(this._selectedItem);return !!(this._selectedItem&&_2f>0&&_2f<=(this._data.length-1));},_canEditGetter:function(){return !this.readOnly&&!!this._selectedItem;},_valueGetter:function(){return this._data.map(function(_30){return _30.serialize();},this);},_dataGetter:function(){return this._data||[];},_dataSetter:function(_31){this._init(_31);},_selectedItemGetter:function(){return this._selectedItem;},_selectedItemSetter:function(_32){this._selectedItem=_32;}});});