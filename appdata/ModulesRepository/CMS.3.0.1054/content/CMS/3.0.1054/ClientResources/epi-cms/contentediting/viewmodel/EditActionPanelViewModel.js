//>>built
define("epi-cms/contentediting/viewmodel/EditActionPanelViewModel",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/string","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/viewmodel/_ContentViewModelObserver","epi-cms/contentediting/viewmodel/PublishMenuViewModel","epi/datetime","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b){return _2([_7],{state:null,buttonText:null,statusText:null,statusIcon:null,additionalClass:null,nonEditableIndicator:null,visible:null,publishMenuViewModel:null,inUseNotificationManager:null,skipChildModels:false,_virtualStatusEnum:{NotCreated:0,NotPublishedYet:1,NoChangeToPublish:2,ChangesToPublish:3,ReadyToPublish:4,ScheduledPublish:5,Published:6,PreviouslyPublished:7,Expired:8,InUse:9,Deleted:10},_virtualStatusCssState:[],_virtualStatusLocalization:[],_statusIcon:[],_watchers:null,_statusMap:{},postscript:function(){this.res=this.res||_b;this.inherited(arguments);this.inUseNotificationManager=this.inUseNotificationManager||_a.resolve("epi.cms.contentediting.inUseNotificationManager");if(this._virtualStatusCssState.length===0){for(var _c in this._virtualStatusEnum){this._virtualStatusCssState.push(_c);this._virtualStatusLocalization.push(this.res["status"][_c.toLowerCase()]);}this._statusMap[_6.versionStatus.CheckedOut]=this._virtualStatusEnum.NotPublishedYet;this._statusMap[_6.versionStatus.CheckedIn]=this._virtualStatusEnum.ReadyToPublish;this._statusMap[_6.versionStatus.Rejected]=this._virtualStatusEnum.ChangesToPublish;this._statusMap[_6.versionStatus.DelayedPublish]=this._virtualStatusEnum.ScheduledPublish;this._statusMap[_6.versionStatus.Published]=this._virtualStatusEnum.Published;this._statusMap[_6.versionStatus.PreviouslyPublished]=this._virtualStatusEnum.PreviouslyPublished;this._statusMap[_6.versionStatus.Expired]=this._virtualStatusEnum.Expired;this._statusIcon[_6.versionStatus.DelayedPublish]="epi-iconClock";this._statusIcon[_6.versionStatus.Rejected]="epi-iconStop";}if(!this.skipChildModels){this.publishMenuViewModel=new _8({inUseNotificationManager:this.inUseNotificationManager});}},destroy:function(){if(this.publishMenuViewModel){this.publishMenuViewModel.destroy();}this.inherited(arguments);},_setDataModelAttr:function(_d){this.inherited(arguments);if(this.publishMenuViewModel){this.publishMenuViewModel.set("dataModel",_d);}},onDataModelChange:function(_e,_f,_10){var _11=this.dataModel.contentData,_12=this._getVirtualStatus(_11);this.set("state",this._virtualStatusCssState[_12]);this.set("additionalClass",_12===this._virtualStatusEnum.ChangesToPublish?"animated8 shake":"");this._setStatusText(_12,_11);this.set("buttonText",this._getButtonText(_12,_11));this.set("statusIcon",this._statusIcon[_11.versionStatus]||"");var _13=this.dataModel.canChangeContent(_6.action.Edit);this.set("nonEditableIndicator",!_13);this.set("visible",!_11.isWastebasket);},_setStatusText:function(_14,_15){if(_15.status===_6.versionStatus.DelayedPublish){this.set("statusText",_5.substitute(this._virtualStatusLocalization[_14],[_9.toUserFriendlyHtml(_15.properties.iversionable_startpublish)]));}else{if(_14===this._virtualStatusEnum.InUse){var _16=this.inUseNotificationManager.getOtherUsersInUseNotifications(_15.inUseNotifications);this.set("statusText",_5.substitute(this._virtualStatusLocalization[_14],[_16.join(",")]));}else{this.set("statusText",this._virtualStatusLocalization[_14]);}}},_getButtonText:function(_17,_18){if((_17==this._virtualStatusEnum.NotPublishedYet||_17==this._virtualStatusEnum.ChangesToPublish||_17==this._virtualStatusEnum.ReadyToPublish)&&this.dataModel.canChangeContent(_6.action.Publish)){return this.res.buttonlabel.publish;}else{return this.res.buttonlabel.option;}},_getVirtualStatus:function(_19){if(_19.isDeleted){return this._virtualStatusEnum.Deleted;}var _1a,_1b,_1c;_1a=this.inUseNotificationManager.ignoreOthersNotifications;this.inUseNotificationManager.ignoreOthersNotifications=true;_1b=this.dataModel.canChangeContent();this.inUseNotificationManager.ignoreOthersNotifications=_1a;_1c=this.inUseNotificationManager.hasInUseNotificationWarning(_19.inUseNotifications);if(_1c&&_1b){return this._virtualStatusEnum.InUse;}if(_19.isCommonDraft){if(_19.status===_6.versionStatus.Published){return this._virtualStatusEnum.NoChangeToPublish;}if(_19.status===_6.versionStatus.CheckedOut){return _19.isMasterVersion?this._virtualStatusEnum.NotPublishedYet:this._virtualStatusEnum.ChangesToPublish;}}return this._statusMap[_19.status];}});});