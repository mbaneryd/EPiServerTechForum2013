//>>built
require({cache:{"url:epi-cms/widget/templates/CategorySelector.html":"<div class=\"dijitReset dijitInputField dijitInputContainer dijitInline epi-resourceInputContainer epi-categorySelector\" id=\"widget_${id}\">\r\n    <div data-dojo-attach-point=\"categoriesGroupContainer\" class=\"dijit dijitReset dijitInline dijitInlineTable dijitLeft dijitTextBox displayNode epi-categoriesGroup\">\r\n    </div> \r\n    <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick: _onButtonClick\" data-dojo-attach-point=\"button\" class=\"epi-categoriesSelectorButton\" data-dojo-props=\"label:'+'\"></div>\r\n</div>"}});define("epi-cms/widget/CategorySelector",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/query","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/form/Button","dijit/Tooltip","dojox/html/entities","epi-cms/widget/_HasChildDialogMixin","epi-cms/widget/CategorySelectorDialog","epi/shell/widget/_ValueRequiredMixin","epi/dependency","epi/epi","epi/shell/widget/dialog/Dialog","dojo/text!./templates/CategorySelector.html","epi/i18n!epi/cms/nls/episerver.cms.widget.CategorySelector"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,epi,_14,_15,res){return _2([_b,_a,_c,_10,_12],{templateString:_15,localization:res,multiple:true,value:null,store:null,_categories:null,_categoriesParentsName:{},onChange:function(_16){},postMixInProperties:function(){this.inherited(arguments);if(!this.store){var _17=_13.resolve("epi.storeregistry");this.store=_17.get("epi.cms.category");}},destroyDescendants:function(){if(this._tooltip){this._tooltip.destroy();delete this._tooltip;}this.inherited(arguments);},_setValueAttr:function(_18){if(!_3.isArray(_18)){_18=[_18];}var _19=_1.filter(_18,function(v){return !!v;});this._setValueAndFireOnChange(_19);if(_19.length>0){this._set("value",_19);}else{this._set("value",null);}this._started&&this.validate();},_setValueAndFireOnChange:function(_1a){if(epi.areEqual(this._categories,_1a)){return;}this._categories=_1a;this.onChange(this._categories);this._updateDisplayNode();},_getValueAttr:function(){return this._categories;},_setReadOnlyAttr:function(_1b){this._set("readOnly",_1b);_8.set(this.button.domNode,"display",_1b?"none":"");_6.toggle(this.domNode,"dijitReadOnly",_1b);},focus:function(){this.button.focus();},_createCategoryButton:function(_1c){if(_9("div[data-epi-category-id="+_1c.id+"]",this.categoriesGroupContainer).length!==0){return;}var _1d=_7.create("div",{"class":"dijitReset dijitLeft dijitInputField dijitInputContainer epi-categoryButton"});var _1e=_7.create("div",{"class":"dijitInline epi-resourceName"});var _1f=_7.create("div",{"class":"dojoxEllipsis",innerHTML:_f.encode(_1c.description)});_7.place(_1f,_1e);_7.place(_1e,_1d);this._tooltip=new _e({connectId:_1f,label:_f.encode(this._getCategoryPath(_1c))});var _20=_7.create("div",{"class":"epi-removeButton",innerHTML:"&nbsp;"});_5.set(_20,"data-epi-category-id",_1c.id);var _21=_20.onClick?"onClick":"onclick";if(!this.readOnly){this.connect(_20,_21,_3.hitch(this,this._onRemoveClick));_7.place(_20,_1e);}else{_7.place(_7.create("span",{innerHTML:"&nbsp;"}),_1e);}_7.place(_1d,this.categoriesGroupContainer);},_getCategoryPath:function(_22){if(!_22.parentsNameCollection||_22.parentsNameCollection.length==1){return "";}var _23=_22.parentsNameCollection[1];for(i=2;i<_22.parentsNameCollection.length;i++){_23=_23+"/"+_22.parentsNameCollection[i];}return _23;},_createNoCategoriesChosenSpan:function(){this.categoriesGroupContainer.innerHTML="";_7.create("span",{innerHTML:this.localization.nocategorieschosen},this.categoriesGroupContainer);},_updateDisplayNode:function(){this.categoriesGroupContainer.innerHTML="";if(!this._categories||this._categories.length===0){this._createNoCategoriesChosenSpan();return;}this._categoriesParentsName={};var _24=[];this._categories.forEach(function(_25){_24.push(this.store.refresh(_25));},this);_4(_24).then(_3.hitch(this,function(_26){_26.forEach(function(_27){if(_27&&_27.visible){this._categoriesParentsName[_27.id]=_27.parentsNameCollection;this._createCategoryButton(_27);}else{var _28=this._categories.indexOf(_27.id);if(_28!=-1){this._categories.splice(_28,1);}}if(this._categories.length===0){this._createNoCategoriesChosenSpan();}},this);}));},_onRemoveClick:function(arg){if(!this._categories){return;}var _29=parseInt(_5.get(arg.target,"data-epi-category-id"),10);var _2a=this._categories.indexOf(_29);if(_2a==-1){return;}var _2b=_3.clone(this._categories);_2b.splice(_2a,1);this.set("value",_2b);},_getCategoriesParentsNameClone:function(){var _2c={};_1.forEach(this._categories,_3.hitch(this,function(_2d){_2c[_2d]=this._categoriesParentsName[_2d];}));return _2c;},_onShow:function(){this.categorySelectorDialog.set("value",_3.clone(this._categories));this.categorySelectorDialog.set("selectedCategoriesData",this._getCategoriesParentsNameClone());this.isShowingChildDialog=true;this.categorySelectorDialog.onShow();},_onExecute:function(){var _2e=this.categorySelectorDialog.get("value");this.set("value",_2e);},_isEmptyArray:function(_2f){return !_2f||_2f.length===0;},_onDialogHide:function(){this.focus();this.isShowingChildDialog=false;},_createDialog:function(){this.categorySelectorDialog=new _11({rootCategory:this.root});this.dialog=new _14({title:this.localization.popuptitle,content:this.categorySelectorDialog,dialogClass:"epi-dialog-portrait"});this.connect(this.dialog,"onExecute","_onExecute");this.connect(this.dialog,"onShow","_onShow");this.connect(this.dialog,"onHide","_onDialogHide");this.dialog.startup();},_onButtonClick:function(){if(!this.dialog){this._createDialog();}this.dialog.show(true);}});});