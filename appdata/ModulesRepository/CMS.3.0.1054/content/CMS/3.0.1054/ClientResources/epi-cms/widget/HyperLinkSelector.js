//>>built
define("epi-cms/widget/HyperLinkSelector",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/dom-style","dojo/dom-construct","dojo/when","dojo/DeferredList","dijit/_Widget","epi/string","epi/shell/widget/_ModelBindingMixin","epi-cms/widget/_HyperLinkFieldItem","epi-cms/widget/viewmodel/HyperLinkSelectorViewModel"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d){return _2([_9,_b],{value:null,_dfCreateWidget:null,modelClassName:_d,modelBindingMap:{"wrapperSettings":["wrapperSettings"],"selectedWrapper":["selectedWrapper"]},postMixInProperties:function(){this.inherited(arguments);if(!this.model&&this.modelClassName){var _e=_2(this.modelClassName);this.model=new _e({providers:this.providers});}},_setSelectedWrapperAttr:function(_f){if(!_f){return;}_1.forEach(this.wrappers,function(_10){_10.set("selected",false);if(_10.inputWidget){_10.inputWidget.set("state","");}});if(_f.inputWidget){_f.set("selected",true);}},_setWrapperSettingsAttr:function(_11){var _12=[];_1.forEach(_11,_3.hitch(this,function(_13){_13.groupname+=this.id;var _14=new _c(_13);if(_13.invisible){_5.set(_14.domNode,{display:"none"});}_14.on("radioButtonChange",_3.hitch(this,function(){this.set("selectedWrapper",_14);_14.focus();}));_12.push(_14);}));this.set("wrappers",_12);},_setWrappersAttr:function(_15){this._set("wrappers",_15);if(this._dfCreateWidget){this._dfCreateWidget.cancel();this._dfCreateWidget=null;}var _16=[],_17=_3.hitch(this,function(_18,_19){var _1a=new _18(_19.settings);_19.addChild(_1a);_19.set("required",this.required);});_1.forEach(_15,function(_1b){var df=new _4();_16.push(df);var _1c=_3.getObject(_1b.widgetType);if(!_1c){require([_a.slashName(_1b.widgetType)],function(_1d){_17(_1d,_1b);df.resolve();});}else{_17(_1c,_1b);df.resolve();}});this._dfCreateWidget=new _8(_16);_7(this._dfCreateWidget,_3.hitch(this,function(_1e){_1.forEach(_15,function(_1f){_6.place(_1f.domNode,this.domNode);},this);this.onSelectorsCreated(this);if(this.value){this._setValueForWidgets(this.value);}else{if(this.wrappers&&this.wrappers.length>0){this.wrappers[0].set("selected",true);}}}));},onSelectorsCreated:function(_20){},_getSelectedWrapper:function(){return _1.filter(this.wrappers,function(_21){return (_21.inputWidget&&_21.get("selected"));})[0];},_getValueAttr:function(){var _22=this._getSelectedWrapper();if(_22){if(_22.inputWidget&&_22.settings.isContentLink){this.value=_22.inputWidget.get("permanentLink");}else{this.value=_22.get("value");}}return this.value;},_setValueAttr:function(_23){this._set("value",_23);this._setValueForWidgets(_23);},_setValueForWidgets:function(_24){_1.forEach(this.wrappers,function(_25){_25.set("value",null);});if(!_24){return;}_7(this.model.getContentData(_24),_3.hitch(this,function(_26){if(_26){_1.every(this.wrappers,function(_27){if(_27&&_27.settings.isContentLink){if(_1.some(_27.settings.allowedTypes,_3.hitch(this,function(_28){return this.model.isBaseTypeIdentifier(_26.typeIdentifier,_28);}))){_27.set("value",_26.contentLink);var _29=_26.missingLanguageBranch&&_26.missingLanguageBranch.isTranslationNeeded;_27.set("showAllLanguages",_29);this.set("selectedWrapper",_27);return false;}}return true;},this);}else{_1.every(this.wrappers,function(_2a){if(_2a&&!_2a.settings.isContentLink){var _2b=_2a.inputWidget;if(_2b&&_2b.validator(_24,_2b.constraints)){_2a.set("value",_24);this.set("selectedWrapper",_2a);return false;}}return true;},this);}}));},validate:function(){var _2c=this._getSelectedWrapper();return _2c?_2c.validate():false;},focus:function(){var _2d=this._getSelectedWrapper();if(_2d){_2d.focus();}},reset:function(){this.set("value",null);}});});