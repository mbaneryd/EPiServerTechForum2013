//>>built
define("epi-cms/contentediting/EditToolbar",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/DeferredList","dojo/dom-class","dojo/topic","dojo/when","dojox/html/ellipsis","epi","epi/dependency","epi/shell/widget/ToolbarSet","epi/shell/command/withConfirmation","epi-cms/contentediting/command/Editing","epi-cms/contentediting/viewmodel/EditActionPanelViewModel","epi-cms/contentediting/StandardToolbar","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu","epi-cms/widget/NotificationStatusBar","epi-cms/contentediting/EditActionPanel"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,res,_10){return _1([_f],{res:res,_editActionViewModel:null,_commands:null,_revertToPublished:null,postMixInProperties:function(){this.inherited(arguments);this._commands=_d;this._revertToPublished=_c(this._commands.revertToPublished,null,{title:_10.reverttopublishconfirmation.dialogtitle,heading:_10.reverttopublishconfirmation.confirmquestion,description:_10.reverttopublishconfirmation.description});this._commands.revertToPublished.watch("canExecute",_2.hitch(this,function(){this.setItemProperty(this._commands.revertToPublished.name,"disabled",!this._commands.revertToPublished.canExecute);}));this._editActionViewModel=new _e();this.own(this._editActionViewModel);},resize:function(_11){this.inherited(arguments);if(_11){_5.toggle(this.domNode,"epi-editToolbarNarrow",_11.w<620);_5.toggle(this.domNode,"epi-editToolbarMedium",_11.w>=620&&_11.w<1000);this._editActionViewModel.set("expanded",_11.w>=1000);}},setupChildren:function(){var _12=[{parent:"center",name:"autosave",label:this.res.autosave.savinglabel,type:"dropdown",settings:{"class":"epi-autosave-hidden"}},{parent:"autosave",name:"undo",title:this.res.undo.title,label:_9.resources.action.undo,type:"menuitem",iconClass:"epi-iconUndo",settings:{disabled:true,showLabel:false},action:function(){_6.publish("/epi/cms/action/undo",[]);}},{parent:"autosave",name:"redo",title:this.res.redo.title,label:_9.resources.action.redo,type:"menuitem",iconClass:"epi-iconRedo",settings:{disabled:true,showLabel:false},action:function(){_6.publish("/epi/cms/action/redo",[]);}},{parent:"autosave",name:"reverttopublished",title:this._commands.revertToPublished.tooltip,label:this._commands.revertToPublished.label,type:"menuitem",iconClass:"epi-iconRevert",settings:{separate:true},action:_2.hitch(this,function(){this._revertToPublished.execute();})},{parent:"trailing",name:"notifications",widgetType:"epi-cms/widget/NotificationStatusBar"},{name:"editactionpanel",label:_9.resources.action.publish,parent:"trailing",widgetType:"epi-cms/contentediting/EditActionPanel",settings:{model:this._editActionViewModel}},{parent:"trailing",name:"editmodeswitch",title:this.res.formedit.title,label:this.res.formedit.label,widgetType:"dijit/form/ToggleButton",iconClass:"epi-iconForms",settings:{showLabel:false,"class":"epi-mediumButton epi-modeButton"},action:function(){if(this.get("state")==="Loading"){return;}this.set("state","Loading");setTimeout(function(){_6.publish("/epi/cms/action/switcheditmode");},0);}}];return _7(this.inherited(arguments),_2.hitch(this,function(){return this.add(_12);}));},_setContentViewModelAttr:function(_13){this._set("contentViewModel",_13);_7(this.isSetup(),_2.hitch(this,function(){this._updateToolbarItemsModel(_13);}));},_updateToolbarItemsModel:function(_14){this.setItemProperty("autosave","label","");this.setItemProperty("autosave","class","epi-autoSaveButton epi-disabledDropdownArrow");var _15=_14.contentData;this.setItemProperty("notifications","notificationContext",{contextTypeName:"epi.cms.contentdata",contextId:_15.contentLink});var _16="",_17="";if(_14.viewName==="formedit"){this.setItemProperty("editmodeswitch","checked",true);_16=this.res.onpageedit.title;_17=this.res.onpageedit.label;}else{this.setItemProperty("editmodeswitch","checked",false);_16=this.res.formedit.title;_17=this.res.formedit.label;}this.setItemProperty("editmodeswitch","title",_16);this.setItemProperty("editmodeswitch","label",_17);var _18=this._hasCustomViews(this.viewConfigurations.availableViews);var _19=this._hasBuiltInViews(this.viewConfigurations.availableViews);this.setItemVisibility("editmodeswitch",!_18&&_19&&_15.hasTemplate);this.setItemVisibility("viewselect",_18);this._editActionViewModel.set("dataModel",_14);},_hasCustomViews:function(_1a){return _3.filter(_1a,function(_1b){return !_1b.hideFromViewMenu&&_1b.key!=="onpageedit"&&_1b.key!=="formedit";}).length;},_hasBuiltInViews:function(_1c){return _3.filter(_1c,function(_1d){return _1d.key=="onpageedit"||_1d.key=="formedit";}).length==2;}});});