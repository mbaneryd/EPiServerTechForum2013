tinyMCEPopup.requireLangPack();var epiquote={init:function(){var i,e,radio,disabled="disabled",checked="checked",t=this,f=document.forms[0],ed=tinyMCEPopup.editor,s=ed.selection;if(e=ed.dom.getParent(s.getNode(),"q"),tinyMCEPopup.resizeToInnerSize(),null==e&&(e=ed.dom.getParent(s.getNode(),"blockquote")),null!=e){for(t._bookmark=s.getBookmark(),i=0;f.quoteType.length>i;i++)f.quoteType[i].setAttribute(disabled,disabled);radio="BLOCKQUOTE"==e.nodeName?f.blockquote:f.quote,radio.removeAttribute(disabled),radio.setAttribute(checked,checked),f.title.value=e.title,f.cite.value=e.cite,f.insert.value=ed.getLang("update"),f.remove.style.display="",document.title=document.getElementById("general_tab_title").innerHTML=ed.getLang("epiquote_dlg.titleupdate")}epiquote._inlineQuoteEnabled()||f.quote.setAttribute(disabled,disabled)},insert:function(){var e,i,quoteType,code,p,contentLower,parentLower,outerSelection,f=document.forms[0],ed=tinyMCEPopup.editor,t=this,attrs={},q="q";tinyMCEPopup.restoreSelection();var s=ed.selection;for(t._bookmark&&s.moveToBookmark(t._bookmark),i=0;f.quoteType.length>i;i++)f.quoteType[i].checked&&(quoteType=f.quoteType[i].value);if(epiquote._trimSelection(s),f.title.value.length&&(attrs.title=f.title.value),f.cite.value.length&&(attrs.cite=f.cite.value),quoteType===q){var parentNode=s.getNode();e=ed.dom.getParent(parentNode,quoteType),p=ed.dom.getParent(parentNode,ed.dom.isBlock,ed.getBody()),contentLower=s.getContent().toLowerCase().replace(/^\s\s*/,"").replace(/\s\s*$/,""),parentLower=ed.dom.getOuterHTML(p).toLowerCase().replace(/^\s\s*/,"").replace(/\s\s*$/,""),outerSelection=contentLower===parentLower}if(null==e){if(quoteType===q&&!epiquote._inlineQuoteEnabled())return alert(ed.getLang("epiquote_dlg.invalidselectionforq")),!1;code=outerSelection?p.innerHTML:s.getContent();var node=s.getNode();null!=node&&"BLOCKQUOTE"==node.nodeName?ed.dom.setAttribs(node,attrs):(code=ed.dom.createHTML(quoteType,attrs,code),outerSelection&&(code=ed.dom.createHTML("p",{},code)),tinymce.isGecko?ed.execCommand("insertHTML",!1,code):tinymce.isIE&&"Control"===ed.selection.getSel().type?ed.dom.setOuterHTML(ed.selection.getSel().createRange().item(0),code):ed.execCommand("mceInsertContent",!1,code))}else ed.dom.setAttribs(e,attrs);ed.undoManager.add(),tinyMCEPopup.close()},remove:function(){var elm,type,i,inst=tinyMCEPopup.editor,quoteTypes=document.forms[0].quoteType;for(i=0;quoteTypes.length>i;i++)quoteTypes[i].checked&&(type=quoteTypes[i].value);type&&(elm=inst.dom.getParent(inst.selection.getNode(),type),tinyMCEPopup.execCommand("mceRemoveNode",inst,elm)),tinyMCEPopup.close()},_inlineQuoteEnabled:function(){var ed=tinyMCEPopup.editor,s=ed.selection,e=s.getNode();if(ed.dom.getOuterHTML(e)===s.getContent()&&ed.dom.isBlock(e))return!1;switch(e.nodeName){case"BODY":case"TD":case"TH":case"UL":case"OL":case"BLOCKQUOTE":return!1}return!0},_trimSelection:function(s){var text,initialLength,startSpaces,endSpaces,r=s.getRng();tinyMCEPopup.editor,r.toString?text=""+r:r.text&&(text=r.text),text&&text.length&&text.length!=tinymce.trim(text).length&&(initialLength=text.length,startSpaces=initialLength-text.replace(/^\s+/,"").length,endSpaces=initialLength-text.search(/\s+$/),r.toString||r.text&&(r.moveStart("character",startSpaces),r.moveEnd("character",-endSpaces)),s.setRng(r))}};tinyMCEPopup.onInit.add(epiquote.init,epiquote);