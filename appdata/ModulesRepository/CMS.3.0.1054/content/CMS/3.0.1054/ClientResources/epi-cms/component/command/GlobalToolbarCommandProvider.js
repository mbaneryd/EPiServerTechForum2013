//>>built
define("epi-cms/component/command/GlobalToolbarCommandProvider",["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/topic","dojo/when","dijit/form/ToggleButton","dijit/layout/ContentPane","epi/dependency","epi/shell/ViewSettings","epi/shell/command/_Command","epi/shell/command/ToggleCommand","epi/shell/ViewSettings","epi/shell/widget/ExpandoButton","epi-cms/widget/ViewSettingsExpandoButton","epi-cms/widget/VisitorGroupButton","epi-cms/widget/ChannelsButton","epi-cms/widget/ViewLanguageButton","epi-cms/widget/command/CreateContentFromSelector","epi-cms/component/command/_GlobalToolbarCommandProvider","epi/i18n!epi/cms/nls/episerver.cms.contentediting"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15){var _16=_2([_c],{iconClass:"epi-iconTree",tooltip:_15.toolbar.buttons.togglenavigationpane,label:_15.toolbar.buttons.togglenavigationpane,canExecute:true,constructor:function(){_5.subscribe("/epi/layout/pinnable/navigation/visibilitychanged",_4.hitch(this,function(_17){this.set("active",_17);}));},_execute:function(){_5.publish("/epi/layout/pinnable/navigation/toggle");}});var _18=_2([_c],{iconClass:"epi-iconFolder",tooltip:_15.toolbar.buttons.toggleassetspane,label:_15.toolbar.buttons.toggleassetspane,canExecute:true,constructor:function(){_5.subscribe("/epi/layout/pinnable/tools/visibilitychanged",_4.hitch(this,function(_19){this.set("active",_19);}));},_execute:function(){_5.publish("/epi/layout/pinnable/tools/toggle");}});var _1a=_2([_b],{iconClass:"epi-iconEye",canExecute:true,label:_15.toolbar.buttons.viewsetting.viewsettingbutton,constructor:function(){_5.subscribe("/epi/shell/action/viewchanged",_4.hitch(this,function(_1b){this.set("isAvailable",typeof _1b!="string"||_1b=="epi-cms/contentediting/PageDataController");}));}});var _1c=_2([_c],{iconClass:"epi-iconPreview",tooltip:_15.toolbar.buttons.togglepreviewmode.label,label:_15.toolbar.buttons.togglepreviewmode.label,canExecute:true,constructor:function(){this._profile=_9.resolve("epi.shell.Profile");this._setPanelSettings();_5.subscribe("/epi/cms/action/disablepreview",_4.hitch(this,function(){this.set("active",false);this._restoreSidePanels();}));_5.subscribe("/epi/shell/action/viewchanged",_4.hitch(this,function(_1d){var _1e=typeof _1d!="string"||_1d=="epi-cms/contentediting/PageDataController";if(!_1e&&this.active){this.execute();}this.set("isAvailable",_1e);}));},_restoreSidePanels:function(){_5.publish("/epi/layout/pinnable/navigation/toggle",this.get("isNavigationVisible"));_5.publish("/epi/layout/pinnable/tools/toggle",this.get("isToolsVisible"));},_hideSidePanels:function(){this._setPanelSettings();_5.publish("/epi/layout/pinnable/navigation/toggle",false);_5.publish("/epi/layout/pinnable/tools/toggle",false);},_setPanelSettings:function(){_6(this._profile.get("navigation"),_4.hitch(this,function(_1f){this.set("isNavigationVisible",_1f.visible);}));_6(this._profile.get("tools"),_4.hitch(this,function(_20){this.set("isToolsVisible",_20.visible);}));},_execute:function(){this.set("active",!this.active);if(this.active){this._hideSidePanels();_5.publish("/epi/shell/action/changeview","view");}else{this._restoreSidePanels();_5.publish("/epi/shell/action/changeview/back",true);}}});return _2([_14],{contentRepositoryDescriptors:null,viewName:null,postscript:function(){this.inherited(arguments);this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_9.resolve("epi.cms.contentRepositoryDescriptors");this.viewName=this.viewName||_a.viewName;this._addLeadingCommands();this._addCreateCommands();this._addViewCommands();this._addTrailingCommands();},_addLeadingCommands:function(){this.addToLeading(new _16(),{widget:_7,"class":"epi-leadingToggleButton epi-mediumButton"});},_addCreateCommands:function(){var _21=this.viewName;var _22=[];var _23=function(_24){return _24==_21;};for(var _25 in this.contentRepositoryDescriptors){var _26=this.contentRepositoryDescriptors[_25];if(_1.some(_26.mainViews,_23)){_22.push(_26);}}_1.forEach(_22,function(_27){_1.forEach(_27.creatableTypes,function(_28){this.addCommand(this._createCommand(_28),{category:"create"});},this);},this);},_createCommand:function(_29){return new _13({creatingTypeIdentifier:_29});},_addViewCommands:function(){this.addCommand(new _1a(),{widget:_f,showInGroup:true,buttons:[new _12(),new _10(),new _11()],category:"view"});this.addCommand(new _1c(),{widget:_e,showInGroup:true,hasToggleableChildren:false,buttons:[new _8({iconClass:"","class":"epi-expandoButtonActiveNode",content:"<span>"+_15.toolbar.buttons.togglepreviewmode.message+"</span>"})],category:"view"});},_addTrailingCommands:function(){this.addToTrailing(new _18(),{widget:_7,"class":"epi-trailingToggleButton epi-mediumButton"});}});});