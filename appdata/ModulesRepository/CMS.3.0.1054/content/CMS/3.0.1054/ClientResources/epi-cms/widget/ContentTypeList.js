//>>built
define("epi-cms/widget/ContentTypeList",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/Deferred","dojo/promise/all","dojo/when","dijit/layout/_LayoutWidget","epi/dependency","epi/shell/widget/_ModelBindingMixin","epi/shell/TypeDescriptorManager","epi-cms/widget/ContentTypeGroup","epi/i18n!epi/cms/nls/episerver.cms.widget.contenttypelist"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d){return _2([_8,_a],{groups:null,modelBindingMap:{"effectiveParentLink":["effectiveParentLink"]},_setEffectiveParentLinkAttr:function(){if(this._started&&this.model.requestedType){this.refresh();}},postMixInProperties:function(){this.inherited(arguments);this.groups={};},buildRendering:function(){this.inherited(arguments);var _e=new _c();this.connect(_e,"onSelect",function(_f){this.model.set("contentTypeId",_f.id);this.onContentTypeSelected(_f);});this.addChild(_e);this._suggestedContentTypes=_e;},refresh:function(){this.clear();this._setupWidgetTemplate();_7(_6({types:this.model.getSuggestedContentTypes(),groups:this._groupContentTypes()}),_3.hitch(this,function(_10){var _11=_10.types,_12=_10.groups,_13=_12.grouped,_14=_12.contentTypes;if(_11.length<=0){this._suggestedContentTypes.setVisibility(false);}else{_4.add(this._suggestedContentTypes.titleNode,"epi-ribbonHeaderSpecial");this._suggestedContentTypes.set("title",this._suggestedTypesTitle);this._suggestedContentTypes.set("contentTypes",_11);this._suggestedContentTypes.setVisibility(true);}var key,_15;for(key in _13){_15=this._getOrCreateGroup(key);_15.set("contentTypes",_13[key]);}if(_14 instanceof Array&&_14.length===1){var _16=_14[0];this.model.set("contentTypeId",_16.id);this.onContentTypeSelected(_16);}}));},setVisibility:function(_17){this.getChildren().forEach(function(_18){_18.setVisibility(_17);},this);},_setupWidgetTemplate:function(){this._suggestedTypesTitle=_b.getResourceValue(this.model.requestedType,"suggestedtypes");this._otherTypesTitle=_b.getResourceValue(this.model.requestedType,"othertypes");},clear:function(){this._suggestedContentTypes.clear();for(var key in this.groups){this.groups[key].destroyRecursive();delete this.groups[key];}},_getOrCreateGroup:function(_19){var _1a=this.groups[_19];if(!_1a){_1a=new _c({title:_19});this.connect(_1a,"onSelect",function(_1b){this.model.set("contentTypeId",_1b.id);this.onContentTypeSelected(_1b);});this.addChild(_1a);this.groups[_19]=_1a;}return _1a;},_groupContentTypes:function(){var _1c={},_1d=new _5(),_1e=this._otherTypesTitle;_7(this.model.getAvailableContentTypes(),_3.hitch(this,function(_1f){var _20=_1f.length;_1.forEach(_1f,function(_21){_7(_21,function(_22){var _23=_22.groupName||_1e,_24=_1c[_23]||[];_24.push(_22);_1c[_23]=_24;_20--;if(_20===0){_1d.resolve({grouped:_1c,contentTypes:_1f});}});});}));return _1d;},onContentTypeSelected:function(){}});});