//>>built
define("epi/shell/widget/FormContainer",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/Deferred","dojo/_base/connect","dojo/dom-geometry","dojo/dom-style","dojo/aspect","dojo/when","dijit/layout/_LayoutWidget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Form","epi/epi","epi/dependency","epi/string","epi/shell/widget/WidgetFactory","epi/shell/MetadataTransformer"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12){return _1([_a,_b,_c],{templateString:"<div class=\"epi-formContainer\">                            <div data-dojo-type=\"dijit/form/Form\" class=\"epi-formArea\" data-dojo-attach-point=\"form\">                            </div>                         </div>",value:null,metadata:null,propertyFilter:null,defaultContainerWidget:"epi.shell.layout.SimpleContainer",readOnly:false,doLayout:true,_widgetMap:null,_uiSetUp:false,_aspectHandles:null,postMixInProperties:function(){this.inherited(arguments);this._widgetMap={};this._aspectHandles=[];},startup:function(){this.inherited(arguments);this._setupUI();},destroy:function(_13){_2.forEach(this._aspectHandles,function(_14){_14.remove();});this._aspectHandles=null;if(this.containerLayout){this.containerLayout.destroyRecursive(_13);}this.inherited(arguments);},_getValueAttr:function(){return this.form.get("value");},_setValueAttr:function(_15){if(this._formCreated){if(_15){this.form.set("value",_15);}else{this.form.reset();}}this._set("value",_15);},onGroupCreated:function(_16,_17){},onChange:function(_18){},onFieldCreated:function(_19,_1a){},_onFormCreated:function(_1b){if(_e.isEmpty(this.get("value"))){this._onChange();}this.onFormCreated(_1b);},onFormCreated:function(_1c){},_setupUI:function(){var _1d=new _11();var _1e=new _12({propertyFilter:this.propertyFilter});_9(this.metadata,_3.hitch(this,function(_1f){var _20=_1f.layoutType||this.defaultContainerWidget;require([_10.slashName(_20)],_3.hitch(this,function(_21){this.containerLayout=new _21();this.containerLayout.placeAt(this.form.domNode);this._uiSetUp=false;var _22=!this.value;var _23=_1e.toComponentDefinitions(_1f,"",_22,this.readOnly);var _24=[],_25=[];_24.push(this.containerLayout);this.connect(_1d,"onWidgetCreated",function(_26,_27){var _28=_24[_24.length-1];var _29=_25.length?_25[_25.length-1]:null;this._widgetMap[_26.id]={parent:_28,group:_29};this.own(this.watch("readOnly",_3.hitch(this,function(_2a,_2b,_2c){_26.set("readOnly",_2c);})));if(_27.settings._type==="field"){_26.set("editMode","createcontent");this.connect(_26,"onChange","_onChange");this._aspectHandles.push(_8.before(_26,"focus",_3.hitch(this,function(){this._beforeSetFocus(_26);})));this.onFieldCreated(_27.settings.name,_26);}else{if(_27.settings._type==="group"){_25.push(_26);this.onGroupCreated(_27.settings.name,_26);}else{if(_27.settings._type==="parent"){_24.push(_26);}}}});this.connect(_1d,"onWidgetHierarchyCreated",function(_2d,_2e){if(_2e.settings._type==="group"){_25.pop();}else{if(_2e.settings._type==="parent"){_24.pop();}}});_9(_1d.createWidgets(this.containerLayout,_23),_3.hitch(this,function(){this._formCreated=true;this.form.connectChildren();this.set("value",this.value||{});this.layout();this._uiSetUp=true;this._onFormCreated(this);_1d=null;_24=null;_25=null;}));this.own(this.form.watch("state",_3.hitch(this,function(_2f,_30,_31){this.set("state",_31);})));}));}));},_onChange:function(){if(!this._uiSetUp){return;}var _32=this.form.get("value");if(!_e.areEqual(this.value,_32)){this.value=_32;this.onChange(_32);}},layout:function(){if(!this._started){return;}var _33=this.containerLayout;if(_33&&_33.resize){var _34=this._containerContentBox||this._contentBox;_33.resize(this.doLayout&&_34&&_34.w&&_34.h?_34:null);}},validate:function(){return this._uiSetUp&&this.form.validate();},isValid:function(){return this.validate();},_beforeSetFocus:function(_35){if(this._widgetMap[_35.id]){var _36=this._widgetMap[_35.id].parent;var _37=this._widgetMap[_35.id].group;this._beforeSetFocus(_36);if(_36.selectChild){_36.selectChild(_37);}}}});});