//>>built
define("dgrid/extensions/Pagination",["../_StoreMixin","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/on","dojo/query","dojo/string","dojo/has","put-selector/put","dojo/i18n!./nls/pagination","dojo/_base/sniff","xstyle/css!../css/extensions/Pagination.css"],function(_1,_2,_3,_4,on,_5,_6,_7,_8,_9){function _a(_b){if(_b.noDataNode){_8(_b.noDataNode,"!");delete _b.noDataNode;}else{_b.cleanup();}_b.contentNode.innerHTML="";};function _c(_d){if(_d.loadingNode){_8(_d.loadingNode,"!");delete _d.loadingNode;}else{if(_d._oldPageNodes){for(var id in _d._oldPageNodes){_d.removeRow(_d._oldPageNodes[id]);}delete _d._oldPageNodes;if(_d._oldPageObserver){_d._oldPageObserver.cancel();_d._numObservers--;delete _d._oldPageObserver;}}}delete _d._isLoading;};return _2(_1,{rowsPerPage:10,pagingTextBox:false,previousNextArrows:true,firstLastArrows:false,pagingLinks:2,pageSizeOptions:[],showLoadingMessage:true,i18nPagination:_9,showFooter:true,_currentPage:1,_total:0,buildRendering:function(){this.inherited(arguments);var _e=this,_f=this.paginationNode=_8(this.footerNode,"div.dgrid-pagination"),_10=this.paginationStatusNode=_8(_f,"div.dgrid-status"),_11=this.pageSizeOptions,_9=this.i18nPagination,_12,_13;_10.tabIndex=0;if(_11.length){var _14=_8(_f,"select.dgrid-page-size"),i;for(i=0;i<_11.length;i++){_8(_14,"option",_11[i],{value:_11[i],selected:this.rowsPerPage===_11[i]});}this._listeners.push(on(_14,"change",function(){_e.rowsPerPage=+_14.value;_e.gotoPage(1);}));}_10.innerHTML=_6.substitute(_9.status,{start:1,end:1,total:0});_12=this.paginationNavigationNode=_8(_f,"div.dgrid-navigation");if(this.firstLastArrows){_13=this.paginationFirstNode=_8(_12,"span.dgrid-first.dgrid-page-link","«");_13.setAttribute("aria-label",_9.gotoFirst);_13.tabIndex=0;}if(this.previousNextArrows){_13=this.paginationPreviousNode=_8(_12,"span.dgrid-previous.dgrid-page-link","‹");_13.setAttribute("aria-label",_9.gotoPrev);_13.tabIndex=0;}this.paginationLinksNode=_8(_12,"span.dgrid-pagination-links");if(this.previousNextArrows){_13=this.paginationNextNode=_8(_12,"span.dgrid-next.dgrid-page-link","›");_13.setAttribute("aria-label",_9.gotoNext);_13.tabIndex=0;}if(this.firstLastArrows){_13=this.paginationLastNode=_8(_12,"span.dgrid-last.dgrid-page-link","»");_13.setAttribute("aria-label",_9.gotoLast);_13.tabIndex=0;}this._listeners.push(on(_12,".dgrid-page-link:click,.dgrid-page-link:keydown",function(_15){if(_15.type==="keydown"&&_15.keyCode!==13){return;}var cls=this.className,_16,max;if(_e._isLoading||cls.indexOf("dgrid-page-disabled")>-1){return;}_16=_e._currentPage;max=Math.ceil(_e._total/_e.rowsPerPage);if(this===_e.paginationPreviousNode){_e.gotoPage(_16-1);}else{if(this===_e.paginationNextNode){_e.gotoPage(_16+1);}else{if(this===_e.paginationFirstNode){_e.gotoPage(1);}else{if(this===_e.paginationLastNode){_e.gotoPage(max);}else{if(cls==="dgrid-page-link"){_e.gotoPage(+this.innerHTML,true);}}}}}}));},destroy:function(){this.inherited(arguments);if(this._pagingTextBoxHandle){this._pagingTextBoxHandle.remove();}},_updateNavigation:function(_17){var _18=this,_9=this.i18nPagination,_19=this.paginationLinksNode,_1a=this._currentPage,_1b=this.pagingLinks,_1c=this.paginationNavigationNode,end=Math.ceil(this._total/this.rowsPerPage),_1d=this._pagingTextBoxHandle;function _1e(_1f){var _20;if(_18.pagingTextBox&&_1f==_1a&&end>1){_20=_8(_19,"input.dgrid-page-input[type=text][value=$]",_1a);_20.setAttribute("aria-label",_9.jumpPage);_18._pagingTextBoxHandle=on(_20,"change",function(){var _21=+this.value;if(!isNaN(_21)&&_21>0&&_21<=end){_18.gotoPage(+this.value,true);}});}else{_20=_8(_19,"span"+(_1f==_1a?".dgrid-page-disabled":"")+".dgrid-page-link",_1f);_20.setAttribute("aria-label",_9.gotoPage);_20.tabIndex=0;}if(_1f==_1a&&_17){_20.focus();}};if(_1d){_1d.remove();}_19.innerHTML="";_5(".dgrid-first, .dgrid-previous",_1c).forEach(function(_22){_8(_22,(_1a==1?".":"!")+"dgrid-page-disabled");});_5(".dgrid-last, .dgrid-next",_1c).forEach(function(_23){_8(_23,(_1a>=end?".":"!")+"dgrid-page-disabled");});if(_1b&&end>0){_1e(1);var _24=_1a-_1b;if(_24>2){_8(_19,"span.dgrid-page-skip","...");}else{_24=2;}for(var i=_24;i<Math.min(_1a+_1b+1,end);i++){_1e(i);}if(_1a+_1b+1<end){_8(_19,"span.dgrid-page-skip","...");}if(end>1){_1e(end);}}else{if(_18.pagingTextBox){_1e(_1a);}}},refresh:function(){var _25=this;this.inherited(arguments);if(!this.store){return;}return this.gotoPage(1).then(function(_26){setTimeout(function(){on.emit(_25.domNode,"dgrid-refresh-complete",{bubbles:true,cancelable:false,grid:_25,results:_26});},0);return _26;});},_onNotification:function(_27){if(_27.length!==this._rowsOnPage){this.gotoPage(this._currentPage);}},renderArray:function(_28,_29){var _2a=this,_2b=this.inherited(arguments);this._lastCollection=null;if(!_29){if(this._topLevelRequest){this._topLevelRequest.cancel();delete this._topLevelRequest;}if(typeof _28.cancel==="function"){this._topLevelRequest=_28;}_4.when(_28,function(){if(_2a._topLevelRequest){delete _2a._topLevelRequest;}});}return _2b;},insertRow:function(){var _2c=this._oldPageNodes,row=this.inherited(arguments);if(_2c&&row===_2c[row.id]){delete _2c[row.id];}return row;},gotoPage:function(_2d,_2e){var _2f=this,dfd=new _4();var _30=this._trackError(function(){var _31=_2f.rowsPerPage,_32=(_2d-1)*_31,_33=_3.mixin(_2f.get("queryOptions"),{start:_32,count:_31}),_34,_35=_2f.contentNode,_36,_37,_38,i,len;if(_2f.showLoadingMessage){_a(_2f);_36=_2f.loadingNode=_8(_35,"div.dgrid-loading");_36.innerHTML=_2f.loadingMessage;}else{_2f._oldPageNodes=_37={};_38=_35.children;for(i=0,len=_38.length;i<len;i++){_37[_38[i].id]=_38[i];}_2f._oldPageObserver=_2f.observers.pop();}_2f._isLoading=true;_34=_2f.store.query(_2f.query,_33);_4.when(_2f.renderArray(_34,null,_33),function(_39){_c(_2f);_2f.scrollTo({y:0});_4.when(_34.total,function(_3a){if(!_3a){if(_2f.noDataNode){_8(_2f.noDataNode,"!");delete _2f.noDataNode;}_2f.noDataNode=_8(_2f.contentNode,"div.dgrid-no-data");_2f.noDataNode.innerHTML=_2f.noDataMessage;}_2f.paginationStatusNode.innerHTML=_6.substitute(_2f.i18nPagination.status,{start:Math.min(_32+1,_3a),end:Math.min(_3a,_32+_31),total:_3a});_2f._total=_3a;_2f._currentPage=_2d;_2f._rowsOnPage=_39.length;_2f._updateNavigation(_2e);});if(_7("ie")<7||(_7("ie")&&_7("quirks"))){_2f.resize();}dfd.resolve(_34);},function(_3b){_c(_2f);dfd.reject(_3b);});return dfd.promise;});if(!_30){dfd.reject();}return dfd.promise;}});});