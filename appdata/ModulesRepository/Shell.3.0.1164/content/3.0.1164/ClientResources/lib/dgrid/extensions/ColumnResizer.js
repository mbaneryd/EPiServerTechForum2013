//>>built
define("dgrid/extensions/ColumnResizer",["dojo/_base/declare","dojo/on","dojo/query","dojo/_base/lang","dojo/dom","dojo/dom-geometry","dojo/has","../util/misc","put-selector/put","dojo/_base/html","xstyle/css!../css/extensions/ColumnResizer.css"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){function _a(_b,_c,_d,_e,id){for(var i=1;i<_c;i++){_b[_d+i][_e]=id;}};function _f(_10){var i=_10.length,l=i,_11=_10[0].length,_12=new Array(i);while(i--){_12[i]=new Array(_11);}var _13={};for(i=0;i<l;i++){var row=_12[i],_14=_10[i];for(var j=0,js=0;j<_11;j++){var _15=_14[js],k;if(typeof row[j]!="undefined"){continue;}row[j]=_15.id;if(_15.rowSpan&&_15.rowSpan>1){_a(_12,_15.rowSpan,i,j,_15.id);}if(i>0&&_15.colSpan&&_15.colSpan>1){for(k=1;k<_15.colSpan;k++){row[++j]=_15.id;if(_15.rowSpan&&_15.rowSpan>1){_a(_12,_15.rowSpan,i,j,_15.id);}}}_13[_15.id]=_10[0][j].id;js++;}}return _13;};function _16(_17,_18,_19,_1a){if(_19<=0){return;}var _1b=_17.columns[_18],_1c={grid:_17,columnId:_18,width:_19,bubbles:true,cancelable:true},_1d;if(_1a){_1c.parentType=_1a;}if(!_17._resizedColumns||_2.emit(_17.headerNode,"dgrid-columnresize",_1c)){if(_19==="auto"){delete _1b.width;}else{_1b.width=_19;_19+="px";}_1d=_17._columnSizes[_18];if(_1d){_1d.set("width",_19);}else{_1d=_8.addCssRule("#"+_8.escapeCssIdentifier(_17.domNode.id)+" .dgrid-column-"+_18,"width: "+_19+";");}_17._columnSizes[_18]=_1d;_17.resize();return true;}};var _1e,_1f=0;var _20={create:function(){_1e=_9("div.dgrid-column-resizer");},destroy:function(){_9(_1e,"!");_1e=null;},show:function(_21){var pos=_6.position(_21.domNode,true);_1e.style.top=pos.y+"px";_1e.style.height=pos.h+"px";_9(document.body,_1e);},move:function(x){_1e.style.left=x+"px";},hide:function(){_1e.parentNode.removeChild(_1e);}};return _1(null,{resizeNode:null,minWidth:40,adjustLastColumn:true,_resizedColumns:false,buildRendering:function(){this.inherited(arguments);if(!_1f++){_20.create();}},destroy:function(){this.inherited(arguments);for(var _22 in this._columnSizes){this._columnSizes[_22].remove();}if(!--_1f){_20.destroy();}},resizeColumnWidth:function(_23,_24){return _16(this,_23,_24);},configStructure:function(){var _25=this._oldColumnSizes=_4.mixin({},this._columnSizes),k;this._resizedColumns=false;this._columnSizes={};this.inherited(arguments);for(k in _25){if(!(k in this._columnSizes)){_25[k].remove();}}delete this._oldColumnSizes;},_configColumn:function(_26){this.inherited(arguments);var _27=_26.id,_28;if("width" in _26){if((_28=this._oldColumnSizes[_27])){_28.set("width",_26.width+"px");}else{_28=_8.addCssRule("#"+this.domNode.id+" .dgrid-column-"+_27,"width: "+_26.width+"px;");}this._columnSizes[_27]=_28;}},renderHeader:function(){this.inherited(arguments);var _29=this;var _2a;if(this.columnSets&&this.columnSets.length){var csi=this.columnSets.length;while(csi--){_2a=_4.mixin(_2a||{},_f(this.columnSets[csi]));}}else{if(this.subRows&&this.subRows.length>1){_2a=_f(this.subRows);}}var _2b=_3(".dgrid-cell",_29.headerNode),i=_2b.length;while(i--){var _2c=_2b[i],id=_2c.columnId,col=_29.columns[id],_2d=_2c.childNodes;if(!col||col.resizable===false){continue;}var _2e=_9("div.dgrid-resize-header-container");_2c.contents=_2e;while(_2d.length>0){_9(_2e,_2d[0]);}_9(_2c,_2e,"div.dgrid-resize-handle.resizeNode-"+id).columnId=_2a?_2a[id]:id;}if(!_29.mouseMoveListen){_2(_29.headerNode,".dgrid-resize-handle:mousedown"+(_7("touch")?",.dgrid-resize-handle:touchstart":""),function(e){_29._resizeMouseDown(e,this);_29.mouseMoveListen.resume();_29.mouseUpListen.resume();});_29._listeners.push(_29.mouseMoveListen=_2.pausable(document,"mousemove"+(_7("touch")?",touchmove":""),_8.throttleDelayed(function(e){_29._updateResizerPosition(e);})));_29._listeners.push(_29.mouseUpListen=_2.pausable(document,"mouseup"+(_7("touch")?",touchend":""),function(e){_29._resizeMouseUp(e);_29.mouseMoveListen.pause();_29.mouseUpListen.pause();}));_29.mouseMoveListen.pause();_29.mouseUpListen.pause();}},_resizeMouseDown:function(e,_2f){e.preventDefault();_5.setSelectable(this.domNode,false);this._startX=this._getResizeMouseLocation(e);this._targetCell=_3(".dgrid-column-"+_2f.columnId,this.headerNode)[0];this._updateResizerPosition(e);_20.show(this);},_resizeMouseUp:function(e){var _30=this._columnSizes,_31,_32,_33;if(this.adjustLastColumn){_33=this.headerNode.clientWidth-1;}if(!this._resizedColumns){_31=_3(".dgrid-cell",this.headerNode);if(this.columnSets&&this.columnSets.length){_31=_31.filter(function(_34){var idx=_34.columnId.split("-");return idx[0]=="0"&&!(_34.columnId in _30);});}else{if(this.subRows&&this.subRows.length>1){_31=_31.filter(function(_35){return _35.columnId.charAt(0)=="0"&&!(_35.columnId in _30);});}}_32=_31.map(function(_36){return _36.offsetWidth;});_31.forEach(function(_37,i){this.resizeColumnWidth(_37.columnId,_32[i]);},this);this._resizedColumns=true;}_5.setSelectable(this.domNode,true);var _38=this._targetCell,_39=this._getResizeMouseLocation(e)-this._startX,_3a=_38.offsetWidth+_39,obj=this._getResizedColumnWidths(),_3b=obj.totalWidth,_3c=obj.lastColId,_3d=_3(".dgrid-column-"+_3c,this.headerNode)[0].offsetWidth;if(_3a<this.minWidth){_3a=this.minWidth;}if(_16(this,_38.columnId,_3a,e.type)){if(_38.columnId!=_3c&&this.adjustLastColumn){if(_3b+_39<_33){_16(this,_3c,"auto",e.type);}else{if(_3d-_39<=this.minWidth){_16(this,_3c,this.minWidth,e.type);}}}}_20.hide();delete this._startX;delete this._targetCell;},_updateResizerPosition:function(e){if(!this._targetCell){return;}var _3e=this._getResizeMouseLocation(e),_3f=_3e-this._startX,_40=this._targetCell.offsetWidth,_41=_3e;if(_40+_3f<this.minWidth){_41=this._startX-(_40-this.minWidth);}_20.move(_41);},_getResizeMouseLocation:function(e){var _42=0;if(e.pageX){_42=e.pageX;}else{if(e.clientX){_42=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;}}return _42;},_getResizedColumnWidths:function(){var _43=0,_44=_3(".dgrid-cell",this.headerNode);if(this.columnSets&&this.columnSets.length){_44=_44.filter(function(_45){var idx=_45.columnId.split("-");return idx[1]=="0";});}else{if(this.subRows&&this.subRows.length>1){_44=_44.filter(function(_46){return _46.columnId.charAt(0)=="0";});}}var i=_44.length;if(!i){return {};}var _47=_44[i-1].columnId;while(i--){_43+=_44[i].offsetWidth;}return {totalWidth:_43,lastColId:_47};}});});