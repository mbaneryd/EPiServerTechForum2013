//>>built
define("dgrid/List",["dojo/_base/kernel","dojo/_base/declare","dojo/on","dojo/has","./util/misc","dojo/has!touch?./TouchScroll","xstyle/has-class","put-selector/put","dojo/_base/sniff","xstyle/css!./css/dgrid.css"],function(_1,_2,_3,_4,_5,_6,_7,_8){_7("mozilla","opera","webkit","ie","ie-6","ie-6-7","quirks","no-quirks","touch");var _9="dgrid-row-odd",_a="dgrid-row-even",_b,_c;function _d(id){return document.getElementById(id);};function _e(_f,_10){var _11=document.body,_12;_8(_11,_f,".dgrid-scrollbar-measure");_12=_f["offset"+_10]-_f["client"+_10];_8(_f,"!dgrid-scrollbar-measure");_11.removeChild(_f);return _12;};_4.add("dom-scrollbar-width",function(_13,doc,_14){return _e(_14,"Width");});_4.add("dom-scrollbar-height",function(_15,doc,_16){return _e(_16,"Height");});var _17=0;function _18(){return "dgrid_"+_17++;};var _19=/ +/g;function _1a(cls){var _1b=cls?"."+cls.replace(_19,"."):"";if(this._class){_1b="!"+this._class.replace(_19,"!")+_1b;}_8(this.domNode,_1b);this._class=cls;};function _1c(){return this._class;};var _1d=_4("ie")<7&&!_4("quirks")?function(){var _1e,w,h,_1f;if(!this._started){return;}_1e=document.documentElement;w=_1e.clientWidth;h=_1e.clientHeight;_1f=this._prevWinDims||[];if(_1f[0]!==w||_1f[1]!==h){this.resize();this._prevWinDims=[w,h];}}:function(){if(this._started){this.resize();}};function _20(){return {x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop};};function _21(_22){if(typeof _22.x!=="undefined"){this.bodyNode.scrollLeft=_22.x;}if(typeof _22.y!=="undefined"){this.bodyNode.scrollTop=_22.y;}};return _2(_4("touch")?_6:null,{tabableHeader:false,showHeader:false,showFooter:false,maintainOddEven:true,cleanAddedRules:true,useTouchScroll:true,postscript:function(_23,_24){var _25=this;(this._Row=function(id,_26,_27){this.id=id;this.data=_26;this.element=_27;}).prototype.remove=function(){_25.removeRow(this.element);};if(_24){this.srcNodeRef=_24=_24.nodeType?_24:_d(_24);}this.create(_23,_24);},listType:"list",create:function(_28,_29){var _2a=this.domNode=_29||_8("div"),cls;if(_28){this.params=_28;_2.safeMixin(this,_28);cls=_28["class"]||_28.className||_2a.className;this._sort=_28.sort||[];delete this.sort;}else{this._sort=[];}this.observers=[];this._numObservers=0;this._listeners=[];this._rowIdToObject={};this.postMixInProperties&&this.postMixInProperties();this.id=_2a.id=_2a.id||this.id||_18();this.buildRendering();if(cls){_1a.call(this,cls);}this.postCreate();delete this.srcNodeRef;if(this.domNode.offsetHeight){this.startup();}},buildRendering:function(){var _2b=this.domNode,_2c=this,_2d,_2e,_2f,_30,_31;_31=this.isRTL=(document.body.dir||document.documentElement.dir||document.body.style.direction).toLowerCase()=="rtl";_2b.className="";_8(_2b,"[role=grid].ui-widget.dgrid.dgrid-"+this.listType);_2d=this.headerNode=_8(_2b,"div.dgrid-header.dgrid-header-row.ui-widget-header"+(this.showHeader?"":".dgrid-header-hidden"));if(_4("quirks")||_4("ie")<8){_2e=_8(_2b,"div.dgrid-spacer");}_2f=this.bodyNode=_8(_2b,"div.dgrid-scroller");_2f.tabIndex=-1;this.headerScrollNode=_8(_2b,"div.dgrid-header-scroll.dgrid-scrollbar-width.ui-widget-header");_30=this.footerNode=_8("div.dgrid-footer"+(this.showFooter?"":".dgrid-footer-hidden"));_8(_2b,_30);if(_31){_2b.className+=" dgrid-rtl"+(_4("webkit")?"":" dgrid-rtl-nonwebkit");}_3(_2f,"scroll",function(_32){if(_2c.showHeader){_2d.scrollLeft=_32.scrollLeft||_2f.scrollLeft;}_32.stopPropagation();_3.emit(_2b,"scroll",{scrollTarget:_2f});});this.configStructure();this.renderHeader();this.contentNode=this.touchNode=_8(this.bodyNode,"div.dgrid-content.ui-widget-content");this._listeners.push(this._resizeHandle=_3(window,"resize",_5.throttleDelayed(_1d,this)));},postCreate:_4("touch")?function(){if(this.useTouchScroll){this.inherited(arguments);}}:function(){},startup:function(){if(this._started){return;}this.inherited(arguments);this._started=true;this.resize();this.set("sort",this._sort);},configStructure:function(){},resize:function(){var _33=this.bodyNode,_34=this.headerNode,_35=this.footerNode,_36=_34.offsetHeight,_37=this.showFooter?_35.offsetHeight:0,_38=_4("quirks")||_4("ie")<7;this.headerScrollNode.style.height=_33.style.marginTop=_36+"px";_33.style.marginBottom=_37+"px";if(_38){_33.style.height="";_33.style.height=Math.max((this.domNode.offsetHeight-_36-_37),0)+"px";if(_37){_35.style.bottom="1px";setTimeout(function(){_35.style.bottom="";},0);}}if(!_b){_b=_4("dom-scrollbar-width");_c=_4("dom-scrollbar-height");if(_4("ie")){_b++;_c++;}_5.addCssRule(".dgrid-scrollbar-width","width: "+_b+"px");_5.addCssRule(".dgrid-scrollbar-height","height: "+_c+"px");if(_b!=17&&!_38){_5.addCssRule(".dgrid-header","right: "+_b+"px");_5.addCssRule(".dgrid-rtl-nonwebkit .dgrid-header","left: "+_b+"px");}}if(_38){_34.style.width=_33.clientWidth+"px";setTimeout(function(){_34.scrollLeft=_33.scrollLeft;},0);}},addCssRule:function(_39,css){var _3a=_5.addCssRule(_39,css);if(this.cleanAddedRules){this._listeners.push(_3a);}return _3a;},on:function(_3b,_3c){var _3d=_3(this.domNode,_3b,_3c);if(!_4("dom-addeventlistener")){this._listeners.push(_3d);}return _3d;},cleanup:function(){var _3e=this.observers,i;for(i in this._rowIdToObject){if(this._rowIdToObject[i]!=this.columns){var _3f=_d(i);if(_3f){this.removeRow(_3f,true);}}}for(i=0;i<_3e.length;i++){var _40=_3e[i];_40&&_40.cancel();}this.observers=[];this._numObservers=0;this.preload=null;},destroy:function(){if(this._listeners){for(var i=this._listeners.length;i--;){this._listeners[i].remove();}delete this._listeners;}this.cleanup();_8(this.domNode,"!");this.inherited(arguments);},refresh:function(){this.cleanup();this._rowIdToObject={};this._autoId=0;this.contentNode.innerHTML="";this.scrollTo({x:0,y:0});},newRow:function(_41,_42,_43,i,_44){if(_42){var row=this.insertRow(_41,_42,_43,i,_44);_8(row,".ui-state-highlight");setTimeout(function(){_8(row,"!ui-state-highlight");},250);return row;}},adjustRowIndices:function(_45){var _46=_45;var _47=_46.rowIndex;if(_47>-1){do{if(_46.rowIndex>-1){if(this.maintainOddEven){if((_46.className+" ").indexOf("dgrid-row ")>-1){_8(_46,"."+(_47%2==1?_9:_a)+"!"+(_47%2==0?_9:_a));}}_46.rowIndex=_47++;}}while((_46=_46.nextSibling)&&_46.rowIndex!=_47);}},renderArray:function(_48,_49,_4a){_4a=_4a||{};var _4b=this,_4c=_4a.start||0,_4d=this.observers,_4e,_4f,_50;if(!_49){this._lastCollection=_48;}if(_48.observe){_4b._numObservers++;_50=_4d.push(_48.observe(function(_51,_52,to){var row,_53,_54,_55;function _56(){_54=(_54.connected||_54).nextSibling;};if(_52>-1&&_4e[_52]){row=_4e.splice(_52,1)[0];if(row.parentNode==_4f){_53=row.nextSibling;if(_53){if(_52!=to){_53.rowIndex--;}}_4b.removeRow(row);}if(_4b._processScroll){_4b._processScroll();}}if(to>-1){if(_4e.length){_54=_4e[to];if(!_54){_54=_4e[to-1];if(_54){_56();}}}else{_54=_4b._getFirstRowSibling&&_4b._getFirstRowSibling(_4f);}if(row&&_54&&row.id===_54.id){_56();}if(_54&&!_54.parentNode){_54=_d(_54.id);}_55=(_49&&_49.parentNode)||(_54&&_54.parentNode)||_4b.contentNode;row=_4b.newRow(_51,_55,_54,_4a.start+to,_4a);if(row){row.observerIndex=_50;_4e.splice(to,0,row);if(!_53||to<_52){var _57=row.previousSibling;_53=!_57||_57.rowIndex+1==row.rowIndex||row.rowIndex==0?row:_57;}}_4a.count++;}_52!=to&&_53&&_4b.adjustRowIndices(_53);_4b._onNotification(_4e,_51,_52,to);},true))-1;}var _58=document.createDocumentFragment(),_59;function _5a(_5b){_59=_4b.insertRow(_5b,_58,null,_4c++,_4a);_59.observerIndex=_50;return _59;};function _5c(_5d){if(typeof _50!=="undefined"){_4d[_50].cancel();_4d[_50]=0;_4b._numObservers--;}if(_5d){throw _5d;}};function _5e(_5f){_4f=_49?_49.parentNode:_4b.contentNode;if(_4f&&_4f.parentNode&&(_4f!==_4b.contentNode||_5f.length)){_4f.insertBefore(_58,_49||null);_59=_5f[_5f.length-1];_59&&_4b.adjustRowIndices(_59);}else{if(_4d[_50]){_5c();}}return (_4e=_5f);};if(_48.map){_4e=_48.map(_5a,console.error);if(_4e.then){return _4e.then(_5e,_5c);}}else{_4e=[];for(var i=0,l=_48.length;i<l;i++){_4e[i]=_5a(_48[i]);}}return _5e(_4e);},_onNotification:function(_60,_61,_62,to){},renderHeader:function(){},_autoId:0,insertRow:function(_63,_64,_65,i,_66){var _67=_66.parentId,id=this.id+"-row-"+(_67?_67+"-":"")+((this.store&&this.store.getIdentity)?this.store.getIdentity(_63):this._autoId++),row=_d(id),_68=row&&row.previousSibling;if(row){this.removeRow(row);}row=this.renderRow(_63,_66);row.className=(row.className||"")+" ui-state-default dgrid-row "+(i%2==1?_9:_a);this._rowIdToObject[row.id=id]=_63;_64.insertBefore(row,_65||null);if(_68){this.adjustRowIndices(_68);}row.rowIndex=i;return row;},renderRow:function(_69,_6a){return _8("div",""+_69);},removeRow:function(_6b,_6c){_6b=_6b.element||_6b;delete this._rowIdToObject[_6b.id];if(!_6c){_8(_6b,"!");}},row:function(_6d){var id;if(_6d instanceof this._Row){return _6d;}if(_6d.target&&_6d.target.nodeType){_6d=_6d.target;}if(_6d.nodeType){var _6e;do{var _6f=_6d.id;if((_6e=this._rowIdToObject[_6f])){return new this._Row(_6f.substring(this.id.length+5),_6e,_6d);}_6d=_6d.parentNode;}while(_6d&&_6d!=this.domNode);return;}if(typeof _6d=="object"){id=this.store.getIdentity(_6d);}else{id=_6d;_6d=this._rowIdToObject[this.id+"-row-"+id];}return new this._Row(id,_6d,_d(this.id+"-row-"+id));},cell:function(_70){return {row:this.row(_70)};},_move:function(_71,_72,_73,_74){var _75,_76,_77;_77=_76=_71.element;_72=_72||1;do{if((_75=_76[_72<0?"previousSibling":"nextSibling"])){do{_76=_75;if(_76&&(_76.className+" ").indexOf(_73+" ")>-1){_77=_76;_72+=_72<0?1:-1;break;}}while((_75=(!_74||!_76.hidden)&&_76[_72<0?"lastChild":"firstChild"]));}else{_76=_76.parentNode;if(_76===this.bodyNode||_76===this.headerNode){break;}}}while(_72);return _77;},up:function(row,_78,_79){if(!row.element){row=this.row(row);}return this.row(this._move(row,-(_78||1),"dgrid-row",_79));},down:function(row,_7a,_7b){if(!row.element){row=this.row(row);}return this.row(this._move(row,_7a||1,"dgrid-row",_7b));},scrollTo:_4("touch")?function(_7c){return this.useTouchScroll?this.inherited(arguments):_21.call(this,_7c);}:_21,getScrollPosition:_4("touch")?function(){return this.useTouchScroll?this.inherited(arguments):_20.call(this);}:_20,get:function(_7d){var fn="_get"+_7d.charAt(0).toUpperCase()+_7d.slice(1);if(typeof this[fn]==="function"){return this[fn].apply(this,[].slice.call(arguments,1));}if(!1&&typeof this[fn+"Attr"]==="function"){}return this[_7d];},set:function(_7e,_7f){if(typeof _7e==="object"){for(var k in _7e){this.set(k,_7e[k]);}}else{var fn="_set"+_7e.charAt(0).toUpperCase()+_7e.slice(1);if(typeof this[fn]==="function"){this[fn].apply(this,[].slice.call(arguments,1));}else{if(!1&&typeof this[fn+"Attr"]==="function"){}this[_7e]=_7f;}}return this;},_getClass:_1c,_setClass:_1a,_getClassName:_1c,_setClassName:_1a,_setSort:function(_80,_81){this._sort=typeof _80!="string"?_80:[{attribute:_80,descending:_81}];this.refresh();if(this._lastCollection){if(_80.length){if(typeof _80!="string"){_81=_80[0].descending;_80=_80[0].attribute;}this._lastCollection.sort(function(a,b){var _82=a[_80],_83=b[_80];if(_82===undefined){_82="";}if(_83===undefined){_83="";}return _82==_83?0:(_82>_83==!_81?1:-1);});}this.renderArray(this._lastCollection);}},sort:function(_84,_85){_1.deprecated("sort(...)","use set(\"sort\", ...) instead","dgrid 0.4");this.set("sort",_84,_85);},_getSort:function(){return this._sort;},_setShowHeader:function(_86){var _87=this.headerNode;this.showHeader=_86;_8(_87,(_86?"!":".")+"dgrid-header-hidden");this.renderHeader();this.resize();if(_86){_87.scrollLeft=this.getScrollPosition().x;}},setShowHeader:function(_88){_1.deprecated("setShowHeader(...)","use set(\"showHeader\", ...) instead","dgrid 0.4");this.set("showHeader",_88);},_setShowFooter:function(_89){this.showFooter=_89;_8(this.footerNode,(_89?"!":".")+"dgrid-footer-hidden");this.resize();}});});