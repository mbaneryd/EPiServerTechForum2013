//>>built
define("epi/datetime",["epi","epi/dependency","dojo","dojo/date","dojo/date/stamp","dojo/date/locale","dojo/_base/lang","dojo/i18n"],function(_1,_2,_3,_4,_5,_6,_7,_8){var _9={serverTimeDelta:0,deserialize:function(_a){var _b=/((?:\d{4})-(?:0[1-9]|1[012])-(?:0[1-9]|[12][0-9]|3[01])T(?:[01][0-9]|2[0123]):(?:[0-5][0-9])(?::(?:[0-5][0-9])(?:.\d+)?)?(?:(?:[+-](?:\d{2}):(?:[0-5][0-9]))|Z))/gi;if(!_a){return null;}else{if(_a.match&&_a.match(_b)){var _c=_5.fromISOString(_a.match(_b)[0]);return _c;}else{throw "Invalid JSON date";}}},serialize:function(_d){return _5.toISOString(_d);},transformDate:function(_e){var _f=(_10(_e)&&!(_e instanceof Date));var _11=(_f?_12(_e):_12(_e,true));return _11;},isDateValid:function(obj){return ((obj&&obj instanceof Date)&&(!isNaN(obj.getTime())));},toUserFriendlyString:function(_13,_14,_15){if(!_13){return "";}if(!(_13 instanceof Date)){_13=this.deserialize(_13);}var _16=_8.getLocalization("dojo.cldr","gregorian");var _17=new Date();var _18=new Date(_13);_17.setHours(0,0,0,0);_18.setHours(0,0,0,0);var _19=_4.difference(_17,_18,"day");if(_19===0){return _15?_6.format(_13,{selector:"time",locale:_14}):_16["field-day-relative+0"]+" "+_6.format(_13,{selector:"time",locale:_14});}if(_19===1){return _16["field-day-relative+1"]+" "+_6.format(_13,{selector:"time",locale:_14});}if(_19===-1){return _16["field-day-relative+-1"]+" "+_6.format(_13,{selector:"time",locale:_14});}if(_4.difference(_17,_13,"year")===0){var _1a=_16["dateFormatItem-MMMd"];return _6.format(_13,{datePattern:_1a,locale:_14});}return _6.format(_13,{locale:_14});},toUserFriendlyHtml:function(_1b,_1c,_1d){var _1e=this.toUserFriendlyString(_1b,_1c,_1d);if(_1e===""){return _1e;}return "<span class='epi-timestamp'>"+_1e+"</span>";},timePassed:function(_1f,to){to=to||new Date();return _20(_1f,to);},timeToGo:function(_21){return _20(this.serverTime(),_21);},serverTime:function(){return new Date(new Date().getTime()+this.serverTimeDelta);}};var _20=function(_22,_23){var _24=_1.resources.text.day;var _25=_1.resources.text.days;var _26=_1.resources.text.hour;var _27=_1.resources.text.hours;var _28=_1.resources.text.minute;var _29=_1.resources.text.minutes;var _2a=_1.resources.text.second;var _2b=_1.resources.text.seconds;var _2c="";var _2d=_23-_22;if(_2d<0){return " 1 "+_2a;}var _2e=Math.floor(_2d/1000/60/60/24);var _2f=new Date(_2d);var _30=_2f.getUTCHours();var _31=_2f.getMinutes();var _32=_2f.getSeconds();if(_2e!=0){_2c=_2c+" "+_2e+" "+(_2e>1?_25:_24);}if(_30!=0){_2c=_2c+" "+_30+" "+(_30>1?_27:_26);}if(_31!=0){_2c=_2c+" "+_31+" "+(_31>1?_29:_28);}if(_2c.length>0){return _2c;}return " "+_32+" "+(_32>1?_2b:_2a);};var _10=function(obj){if(_3.isObject(obj)){for(var _33 in obj){return true;}}return false;};var _12=function(obj,_34){if(_34){if(obj instanceof Date){return _5.toISOString(obj,{zulu:true});}else{return obj;}}var _35=_3.clone(obj);for(var _36 in obj){if(obj[_36] instanceof Date){_35[_36]=_5.toISOString(obj[_36],{zulu:true});}else{if(_10(obj[_36])){_35[_36]=_12(obj[_36]);}}}return _35;};_3.mixin(_1,{datetime:_9});return _1.datetime;});