//>>built
define("epi/shell/widget/TabContainer",["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/aspect","dojo/dom-class","dijit/layout/ContentPane","dijit/layout/TabContainer","dijit/registry","epi/dependency","epi/shell/widget/layout/ComponentContainer","epi/shell/widget/dialog/Confirmation","epi/shell/widget/TabController","epi/shell/widget/dialog/Alert","epi/shell/widget/_ActionConsumerWidget","epi/i18n!epi/shell/ui/nls/EPiServer.Shell.UI.Resources.TabContainer"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,res){return _2([_8,_f],{controllerWidget:_d,_selectedPage:null,_componentsController:null,res:res,confirmationBeforeRemoval:true,startup:function(){if(this._started){return;}this.inherited(arguments);this.connect(this.tablist,"onLayoutChanged",this._changeLayout);this.connect(this.tablist,"onTabTitleChanged",this._changeName);this.connect(this.tablist,"onAddNewTab",this._createTab);this._componentsController=_a.resolve("epi.shell.controller.Components");if(this.getChildren().length<=0){this._createTab();}},postCreate:function(){this.inherited(arguments);_6.add(this.domNode,"epi-mainApplicationArea");},_makeController:function(){var _10=this.inherited(arguments);this.connect(_10,"onSelectChild",this._pageSelected);var _11=[{label:this.res.addgadget,onClick:_4.hitch(this,this._showComponentDialog)},{label:this.res.createtab,onClick:_4.hitch(this,this._createTab)},{label:this.res.rearrangegadget,onChange:_4.hitch(this,this._rearrangeGadgets),type:"checkedmenuitem",checked:false,rearrangeGadgets:function(_12){this.set("checked",_12);}}];_1.forEach(_11,_10.addAddMenuItem,_10);return _10;},_rearrangeGadgets:function(_13){if(this._selectedPage){this._selectedPage.changeLockButtonState(_13);}},_showComponentDialog:function(){if(this._selectedPage){this._selectedPage.showComponentSelector();}},_componentSelected:function(){var _14=this._selectedPage;_14.addComponent.apply(_14,arguments);},_pageSelected:function(_15){this._selectedPage=_15;},_createTab:function(){var _16=this._componentsController.getComponentDefinition(this.id);this._componentsController.getEmptyComponentDefinition("EPiServer.Shell.ViewComposition.Containers.ComponentContainer",_4.hitch(this,function(_17){var _18=_17[0];_18.settings.personalizableHeading=this.res.newtabname;_18.settings.numberOfColumns=2;_18.settings.containerUnlocked=true;_18.settings.closable=true;this._componentsController.addComponent(this,_18,_4.hitch(this,function(_19){var _1a=this.getChildren();this.selectChild(_1a[_1a.length-1]);}));}));},_changeName:function(_1b,_1c){if(this._isEmpty(_1c)){this._showMessageDialog(this.res.tabnamecannotbeemptymessage).then(function(_1d){if(_1d){_1b.controlButton.tabName.innerHTML=_1b.controlButton.tabCurrentName;_1b.controlButton._setTabTitleEditable(true);}});}else{var _1e=String(_1b.title);var _1f=this._componentsController.getComponentDefinition(_1b.id);_1b.title=_1c;_1b.tabCurrentName=_1c;if(_1f!=null){_1f.settings.personalizableHeading=_1c;this._componentsController.saveComponent(_1f,function(){},_4.hitch(this,function(){this._showMessageDialog(this.res.tabnamecouldnotbesaved).then(function(_20){if(_20){_1b.set("title",_1e);_1b.set("tabCurrentName",_1e);_1b.controlButton.revertTabTitleChanges(true,_1e,_1c);}});}));}else{}}},_getNumberOfColumns:function(evt){if(!evt||!evt.target){return 1;}var _21=_9.getEnclosingWidget(evt.target);if(!_21||!_21.label){return 1;}return _4.trim(_21.label).substr(0,1);},_changeLayout:function(_22,evt){var _23=this._getNumberOfColumns(evt),_24=null;if(typeof _22.setColumns=="function"){_22.setColumns(_23);}_24=this._componentsController.getComponentDefinition(_22.id);if(_24!=null){_24.settings.numberOfColumns=_23;this._componentsController.saveComponent(_24);}else{}},closeChild:function(_25){if(this.getChildren().length==1){return;}if(!this.confirmationBeforeRemoval){this.inherited(arguments);this._removeTab(_25);}else{return this._showRemovalConfirmationDialog(_4.hitch(this,function(_26){if(_26){_8.prototype.closeChild.apply(this,[_25]);this._removeTab(_25);}}));}},_removeTab:function(_27){var _28=this._componentsController.getComponentDefinition(_27.id);this._componentsController.removeComponent(_28.id);var _29=this.getChildren().length;if(_29==1){for(var _2a in this.tablist.pane2button){this.tablist.pane2button[_2a].closeTabMenuItem.set("disabled",true);}}},_showRemovalConfirmationDialog:function(_2b){var _2c=new _c({description:this.res.removetabquestion,title:epi.resources.header.episerver,onAction:_2b});_2c.show();},_showMessageDialog:function(_2d){var _2e=new _3();var _2f=new _e({description:_2d});_2f.show();_5.after(_2f,"destroy",function(){_2e.resolve(true);});return _2e;},_isEmpty:function(_30){return (_4.trim(_30)===""?true:false);}});});